LavaPack.loadBundle([[1303,{"./hdkey":1302,"./thirdparty":1304,bs58check:2005,buffer:1996,crypto:2106,"ethereumjs-util":2437,randombytes:5476,"scrypt-js":5669,"uuid/v4":1307},function(){with(this)return function(){"use strict";return function(e,t,r){(function(t){(function(){var n=this&&this.__assign||function(){return n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},n.apply(this,arguments)},i=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{u(n.next(e))}catch(e){a(e)}}function o(e){try{u(n.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,o)}u((n=n.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var r,n,i,a,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(a){return function(o){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(i=2&a[0]?n.return:a[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,a[1])).done)return i;switch(n=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,n=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){s.label=a[1];break}if(6===a[0]&&s.label<i[1]){s.label=i[1],i=a;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(a);break}i[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],n=0}finally{r=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,o])}}};Object.defineProperty(r,"__esModule",{value:!0});var s=e("crypto"),o=e("ethereumjs-util"),u=e("scrypt-js"),c=e("./hdkey");Object.defineProperty(r,"hdkey",{enumerable:!0,get:function(){return c.default}});var l=e("./thirdparty");Object.defineProperty(r,"thirdparty",{enumerable:!0,get:function(){return l.default}});var f=e("bs58check"),d=e("randombytes"),p=e("uuid/v4");function h(e,t,r){if(t.toLowerCase().startsWith("0x")&&(t=t.slice(2)),!t&&!r)return t;if(r%2)throw new Error("Invalid length argument, must be an even number");if("number"==typeof r&&t.length!==r)throw new Error("Invalid "+e+", string must be "+r+" hex characters");if(!/^([0-9a-f]{2})+$/i.test(t))throw new Error("Invalid "+e+", string must be "+("number"==typeof r?r:"empty or a non-zero even number of")+" hex characters");return t}function m(e,r,n){if(!t.isBuffer(r))throw new Error("Invalid "+e+", must be a string ("+("number"==typeof n?""+2*n:"empty or a non-zero even number of")+" hex characters) or buffer"+("number"==typeof n?" ("+n+" bytes)":""));if("number"==typeof n&&r.length!==n)throw new Error("Invalid "+e+", buffer must be "+n+" bytes");return r}var y=function(){function e(e,t){if(void 0===t&&(t=undefined),this.privateKey=e,this.publicKey=t,e&&t)throw new Error("Cannot supply both a private and a public key to the constructor");if(e&&!o.isValidPrivate(e))throw new Error("Private key does not satisfy the curve requirements (ie. it is invalid)");if(t&&!o.isValidPublic(t))throw new Error("Invalid public key")}return e.generate=function(t){if(void 0===t&&(t=!1),!t)return new e(d(32));for(var r=new o.BN("088f924eeceeda7fe92e1f5b0fffffffffffffff",16);;){var n=d(32);if(new o.BN(o.privateToAddress(n)).lte(r))return new e(n)}},e.generateVanityAddress=function(t){for(t instanceof RegExp||(t=new RegExp(t));;){var r=d(32),n=o.privateToAddress(r);if(t.test(n.toString("hex")))return new e(r)}},e.fromPublicKey=function(t,r){return void 0===r&&(r=!1),r&&(t=o.importPublic(t)),new e(undefined,t)},e.fromExtendedPublicKey=function(t){if("xpub"!==t.slice(0,4))throw new Error("Not an extended public key");var r=f.decode(t).slice(45);return e.fromPublicKey(r,!0)},e.fromPrivateKey=function(t){return new e(t)},e.fromExtendedPrivateKey=function(t){if("xprv"!==t.slice(0,4))throw new Error("Not an extended private key");var r=f.decode(t);if(0!==r[45])throw new Error("Invalid extended private key");return e.fromPrivateKey(r.slice(46))},e.fromV1=function(r,n){return i(this,void 0,void 0,(function(){var i,c,l,f,d;return a(this,(function(a){switch(a.label){case 0:if("1"!==(i="object"==typeof r?r:JSON.parse(r)).Version)throw new Error("Not a V1 Wallet");if("scrypt"!==i.Crypto.KeyHeader.Kdf)throw new Error("Unsupported key derivation scheme");return c=i.Crypto.KeyHeader.KdfParams,[4,u.scrypt(t.from(n),t.from(i.Crypto.Salt,"hex"),c.N,c.R,c.P,c.DkLen)];case 1:if(l=a.sent(),f=t.from(i.Crypto.CipherText,"hex"),o.keccak256(t.concat([l.slice(16,32),f])).toString("hex")!==i.Crypto.MAC)throw new Error("Key derivation failed - possibly wrong passphrase");return d=s.createDecipheriv("aes-128-cbc",o.keccak256(l.slice(0,16)).slice(0,16),t.from(i.Crypto.IV,"hex")),[2,new e(b(d,f))]}}))}))},e.fromV3=function(r,n,c){return void 0===c&&(c=!1),i(this,void 0,void 0,(function(){var i,l,f,d,p;return a(this,(function(a){switch(a.label){case 0:if(3!==(i="object"==typeof r?r:JSON.parse(c?r.toLowerCase():r)).version)throw new Error("Not a V3 wallet");return"scrypt"!==i.crypto.kdf?[3,2]:(f=i.crypto.kdfparams,[4,u.scrypt(t.from(n),t.from(f.salt,"hex"),f.n,f.r,f.p,f.dklen)]);case 1:return l=a.sent(),[3,3];case 2:if("pbkdf2"!==i.crypto.kdf)throw new Error("Unsupported key derivation scheme");if("hmac-sha256"!==(f=i.crypto.kdfparams).prf)throw new Error("Unsupported parameters to PBKDF2");l=s.pbkdf2Sync(t.from(n),t.from(f.salt,"hex"),f.c,f.dklen,"sha256"),a.label=3;case 3:if(d=t.from(i.crypto.ciphertext,"hex"),o.keccak256(t.concat([t.from(l.slice(16,32)),d])).toString("hex")!==i.crypto.mac)throw new Error("Key derivation failed - possibly wrong passphrase");return p=s.createDecipheriv(i.crypto.cipher,l.slice(0,16),t.from(i.crypto.cipherparams.iv,"hex")),[2,new e(b(p,d))]}}))}))},e.fromEthSale=function(r,n){var i="object"==typeof r?r:JSON.parse(r),a=t.from(i.encseed,"hex"),u=s.pbkdf2Sync(n,n,2e3,32,"sha256").slice(0,16),c=b(s.createDecipheriv("aes-128-cbc",u,a.slice(0,16)),a.slice(16)),l=new e(o.keccak256(c));if(l.getAddress().toString("hex")!==i.ethaddr)throw new Error("Decoded key mismatch - possibly wrong passphrase");return l},Object.defineProperty(e.prototype,"pubKey",{get:function(){return g(this.publicKey)||(this.publicKey=o.privateToPublic(this.privateKey)),this.publicKey},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"privKey",{get:function(){if(!g(this.privateKey))throw new Error("This is a public key only wallet");return this.privateKey},enumerable:!1,configurable:!0}),e.prototype.getPrivateKey=function(){return this.privKey},e.prototype.getPrivateKeyString=function(){return o.bufferToHex(this.privKey)},e.prototype.getPublicKey=function(){return this.pubKey},e.prototype.getPublicKeyString=function(){return o.bufferToHex(this.getPublicKey())},e.prototype.getAddress=function(){return o.publicToAddress(this.pubKey)},e.prototype.getAddressString=function(){return o.bufferToHex(this.getAddress())},e.prototype.getChecksumAddressString=function(){return o.toChecksumAddress(this.getAddressString())},e.prototype.toV3=function(e,r){return i(this,void 0,void 0,(function(){var i,c,l,f,y,v;return a(this,(function(a){switch(a.label){case 0:if(!g(this.privateKey))throw new Error("This is a public key only wallet");switch(w=r,_={cipher:"aes-128-ctr",kdf:"scrypt",salt:d(32),iv:d(16),uuid:d(16),dklen:32,c:262144,n:262144,r:8,p:1},i=w?("string"==typeof w.salt&&(w.salt=t.from(h("salt",w.salt),"hex")),"string"==typeof w.iv&&(w.iv=t.from(h("iv",w.iv,32),"hex")),"string"==typeof w.uuid&&(w.uuid=t.from(h("uuid",w.uuid,32),"hex")),w.salt&&m("salt",w.salt),w.iv&&m("iv",w.iv,16),w.uuid&&m("uuid",w.uuid,16),n(n({},_),w)):_,i.kdf){case"pbkdf2":return[3,1];case"scrypt":return[3,2]}return[3,4];case 1:return c=function(e){return{dklen:e.dklen,salt:e.salt,c:e.c,prf:"hmac-sha256"}}(i),l=s.pbkdf2Sync(t.from(e),c.salt,c.c,c.dklen,"sha256"),[3,5];case 2:return c=function(e){return{dklen:e.dklen,salt:e.salt,n:e.n,r:e.r,p:e.p}}(i),[4,u.scrypt(t.from(e),c.salt,c.n,c.r,c.p,c.dklen)];case 3:return l=a.sent(),[3,5];case 4:throw new Error("Unsupported kdf");case 5:if(!(f=s.createCipheriv(i.cipher,l.slice(0,16),i.iv)))throw new Error("Unsupported cipher");return y=b(f,this.privKey),v=o.keccak256(t.concat([t.from(l.slice(16,32)),t.from(y)])),[2,{version:3,id:p({random:i.uuid}),address:this.getAddress().toString("hex"),crypto:{ciphertext:y.toString("hex"),cipherparams:{iv:i.iv.toString("hex")},cipher:i.cipher,kdf:i.kdf,kdfparams:n(n({},c),{salt:c.salt.toString("hex")}),mac:v.toString("hex")}}]}var w,_}))}))},e.prototype.getV3Filename=function(e){return["UTC--",(e?new Date(e):new Date).toJSON().replace(/:/g,"-"),"--",this.getAddress().toString("hex")].join("")},e.prototype.toV3String=function(e,t){return i(this,void 0,void 0,(function(){var r,n;return a(this,(function(i){switch(i.label){case 0:return n=(r=JSON).stringify,[4,this.toV3(e,t)];case 1:return[2,n.apply(r,[i.sent()])]}}))}))},e}();function b(e,r){return t.concat([e.update(r),e.final()])}function g(e){return e!==undefined&&null!==e}r.default=y}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/smart-transactions-controller>@metamask/controllers>ethereumjs-wallet"}],[1304,{"./index":1303,"aes-js":1590,buffer:1996,crypto:2106,"ethereumjs-util":2437,"scrypt-js":5669,utf8:5928},function(){with(this)return function(){"use strict";return function(e,t,r){(function(t){(function(){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{u(n.next(e))}catch(e){a(e)}}function o(e){try{u(n.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,o)}u((n=n.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var r,n,i,a,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(a){return function(o){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(i=2&a[0]?n.return:a[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,a[1])).done)return i;switch(n=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,n=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){s.label=a[1];break}if(6===a[0]&&s.label<i[1]){s.label=i[1],i=a;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(a);break}i[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],n=0}finally{r=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,o])}}};Object.defineProperty(r,"__esModule",{value:!0}),r.fromQuorumWallet=r.fromKryptoKit=r.fromEtherCamp=r.fromEtherWallet=void 0;var a=e("crypto"),s=e("ethereumjs-util"),o=e("scrypt-js"),u=e("./index"),c=e("utf8"),l=e("aes-js");var f={count:1,keysize:16,ivsize:16,digest:"md5"};function d(e,r,n){var i=function(e){return e?{count:e.count||f.count,keysize:e.keysize||f.keysize,ivsize:e.ivsize||f.ivsize,digest:e.digest||f.digest}:f}(n);function s(t){var n=a.createHash(i.digest);n.update(t),n.update(e),n.update(r),t=n.digest();for(var s=1,o=i.count;s<o;s++)(n=a.createHash(i.digest)).update(t),t=n.digest();return t}for(var o=[],u=0;t.concat(o).length<i.keysize+i.ivsize;)o[u]=s(0===u?t.alloc(0):o[u-1]),u++;var c=t.concat(o);return{key:c.slice(0,i.keysize),iv:c.slice(i.keysize,i.keysize+i.ivsize)}}function p(e,r){var n,i="object"==typeof e?e:JSON.parse(e);if(i.locked){if("string"!=typeof r)throw new Error("Password required");if(r.length<7)throw new Error("Password must be at least 7 characters");var s=function(e){var r=t.from(e,"base64");return"Salted__"===r.slice(0,8).toString()?{salt:r.slice(8,16),ciphertext:r.slice(16)}:{ciphertext:r}}(i.encrypted?i.private.slice(0,128):i.private);if(!s.salt)throw new Error("Unsupported EtherWallet key format");var o=d(t.from(r),s.salt,{keysize:32,ivsize:16});n=function(e,r){return t.concat([e.update(r),e.final()])}(a.createDecipheriv("aes-256-cbc",o.key,o.iv),t.from(s.ciphertext)),n=t.from(c.decode(n.toString()),"hex")}else{if(64!==i.private.length)throw new Error("Invalid private key length");n=t.from(i.private,"hex")}var l=new u.default(n);if(l.getAddressString()!==i.address)throw new Error("Invalid private key or address");return l}function h(e){return new u.default(s.keccak256(t.from(e)))}function m(e,r){return n(this,void 0,void 0,(function(){var n,a,c,f,d,p,h;return i(this,(function(i){switch(i.label){case 0:return"#"===e[0]&&(e=e.slice(1)),n=e[0],e=e.slice(1),"d"!==n?[3,1]:(a=s.sha256(s.toBuffer(e)),[3,4]);case 1:if("q"!==n)return[3,3];if("string"!=typeof r)throw new Error("Password required");return c=s.sha256(t.from(e.slice(0,30))),f=e.slice(30,46),d=function(e){function r(e){try{return decodeURIComponent(e)}catch(e){return String.fromCharCode(65533)}}for(var n="",i="",a=0;a<e.length;a++)e[a]<=127?(n+=r(i)+String.fromCharCode(e[a]),i=""):i+="%"+e[a].toString(16);return t.from(n+r(i))}(c),[4,o.scrypt(t.from(r,"utf8"),d,16384,8,1,32)];case 2:if(p=i.sent(),h=new l.ModeOfOperation.ecb(p),a=t.concat([t.from(h.decrypt(c.slice(0,16))),t.from(h.decrypt(c.slice(16,32)))]),f.length>0&&f!==s.sha256(s.sha256(a)).slice(0,8).toString("hex"))throw new Error("Failed to decrypt input - possibly invalid passphrase");return[3,4];case 3:throw new Error("Unsupported or invalid entropy type");case 4:return[2,new u.default(a)]}}))}))}function y(e,t){if(e.length<10)throw new Error("Passphrase must be at least 10 characters");if(t.length<10)throw new Error("User id must be at least 10 characters");var r=e+t,n=a.pbkdf2Sync(r,r,2e3,32,"sha256");return new u.default(n)}r.fromEtherWallet=p,r.fromEtherCamp=h,r.fromKryptoKit=m,r.fromQuorumWallet=y;var b={fromEtherWallet:p,fromEtherCamp:h,fromKryptoKit:m,fromQuorumWallet:y};r.default=b}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/smart-transactions-controller>@metamask/controllers>ethereumjs-wallet"}],[1305,{},function(){with(this)return function(){"use strict";return function(e,t,r){for(var n=[],i=0;i<256;++i)n[i]=(i+256).toString(16).substr(1);t.exports=function(e,t){var r=t||0,i=n;return[i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]]].join("")}}}},{package:"@metamask/smart-transactions-controller>@metamask/controllers>ethereumjs-wallet>uuid"}],[1306,{},function(){with(this)return function(){"use strict";return function(e,t,r){var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(n){var i=new Uint8Array(16);t.exports=function(){return n(i),i}}else{var a=new Array(16);t.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),a[t]=e>>>((3&t)<<3)&255;return a}}}}},{package:"@metamask/smart-transactions-controller>@metamask/controllers>ethereumjs-wallet>uuid"}],[1307,{"./lib/bytesToUuid":1305,"./lib/rng":1306},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("./lib/rng"),i=e("./lib/bytesToUuid");t.exports=function(e,t,r){var a=t&&r||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var s=(e=e||{}).random||(e.rng||n)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t)for(var o=0;o<16;++o)t[a+o]=s[o];return t||i(s)}}}},{package:"@metamask/smart-transactions-controller>@metamask/controllers>ethereumjs-wallet>uuid"}],[1308,{"./utils/index.js":1309,buffer:1996},function(){with(this)return function(){"use strict";return function(e,t,r){(function(r){(function(){var n=e("./utils/index.js"),i=n.uint256Coder,a=(n.coderBoolean,n.coderFixedBytes,n.coderAddress,n.coderDynamicBytes,n.coderString,n.coderArray,n.paramTypePart,n.getParamCoder);function s(){}function o(e,t){if(e.length!==t.length)throw new Error("[ethjs-abi] while encoding params, types/values mismatch, Your contract requires "+e.length+" types (arguments), and you passed in "+t.length);var n=[];function s(e){return parseInt(32*Math.ceil(e/32))}e.forEach((function(e,r){var i=a(e);n.push({dynamic:i.dynamic,value:i.encode(t[r])})}));var o=0,u=0;n.forEach((function(e){e.dynamic?(o+=32,u+=s(e.value.length)):o+=s(e.value.length)}));var c=0,l=o,f=new r(o+u);return n.forEach((function(e,t){e.dynamic?(i.encode(l).copy(f,c),c+=32,e.value.copy(f,l),l+=s(e.value.length)):(e.value.copy(f,c),c+=s(e.value.length))})),"0x"+f.toString("hex")}function u(e,t,r){var o=!(arguments.length>3&&arguments[3]!==undefined)||arguments[3];arguments.length<3&&(r=t,t=e,e=[]),r=n.hexOrBuffer(r);var u=new s,c=0;return t.forEach((function(t,n){var s=a(t);if(s.dynamic){var l=i.decode(r,c),f=s.decode(r,l.value.toNumber());c+=l.consumed}else{f=s.decode(r,c);c+=f.consumed}o&&(u[n]=f.value),e[n]&&(u[e[n]]=f.value)})),u}function c(e){var t=e.name+"("+n.getKeys(e.inputs,"type").join(",")+")";return"0x"+new r(n.keccak256(t),"hex").slice(0,4).toString("hex")}function l(e,t){var r=o(n.getKeys(e.inputs,"type"),t).substring(2);return""+c(e)+r}function f(e){var t=e.name+"("+n.getKeys(e.inputs,"type").join(",")+")";return"0x"+n.keccak256(t)}function d(e,t,i){var s=!(arguments.length>3&&arguments[3]!==undefined)||arguments[3],o=e.inputs.filter((function(e){return!e.indexed})),c=n.getKeys(o,"name",!0),l=n.getKeys(o,"type"),f=u(c,l,n.hexOrBuffer(t),s),d=e.anonymous?0:1;return e.inputs.filter((function(e){return e.indexed})).map((function(e,t){var n=new r(i[t+d].slice(2),"hex"),s=a(e.type);f[e.name]=s.decode(n,0).value})),f._eventName=e.name,f}function p(e,t){var r=!(arguments.length>2&&arguments[2]!==undefined)||arguments[2];if(e&&t.topics[0]===f(e))return d(e,t.data,t.topics,r)}t.exports={encodeParams:o,decodeParams:u,encodeMethod:l,decodeMethod:function(e,t){return u(n.getKeys(e.outputs,"name",!0),n.getKeys(e.outputs,"type"),n.hexOrBuffer(t))},encodeEvent:function(e,t){return l(e,t)},decodeEvent:d,decodeLogItem:p,logDecoder:function(e){var t=!(arguments.length>1&&arguments[1]!==undefined)||arguments[1],r={};return e.filter((function(e){return"event"===e.type})).map((function(e){r[f(e)]=e})),function(e){return e.map((function(e){return p(r[e.topics[0]],e,t)})).filter((function(e){return e}))}},eventSignature:f,encodeSignature:c}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/smart-transactions-controller>@metamask/controllers>eth-method-registry>ethjs>ethjs-abi"}],[1309,{"bn.js":1298,buffer:1996,"js-sha3":1322,"number-to-bn":5220},function(){with(this)return function(){"use strict";return function(e,t,r){(function(r){(function(){var n=e("bn.js"),i=e("number-to-bn"),a=e("js-sha3").keccak_256;function s(e){for(var t=e,r=t[0];t.length>0&&"0"===r.toString();)r=(t=t.slice(1))[0];return t}function o(e){var t=e.toString(16);return t.length%2&&(t="0"+t),s(new r(t,"hex"))}function u(e,t){return!("string"!=typeof e||!e.match(/^0x[0-9A-Fa-f]*$/))&&(!t||e.length===2+2*t)}function c(e,t){var n=e;if(!r.isBuffer(n)){if(!u(n)){var i=new Error(t?"[ethjs-abi] invalid "+t:"[ethjs-abi] invalid hex or buffer, must be a prefixed alphanumeric even length hex string");throw i.reason="[ethjs-abi] invalid hex string, hex must be prefixed and alphanumeric (e.g. 0x023..)",i.value=n,i}(n=n.substring(2)).length%2&&(n="0"+n),n=new r(n,"hex")}return n}function l(e,t){return{encode:function(n){var a=n;return"object"==typeof a&&a.toString&&(a.toTwos||a.dividedToIntegerBy)&&(a=a.toString(10).split(".")[0]),"string"!=typeof a&&"number"!=typeof a||(a=String(a).split(".")[0]),a=(a=i(a)).toTwos(8*e).maskn(8*e),t&&(a=a.fromTwos(8*e).toTwos(256)),a.toArrayLike(r,"be",32)},decode:function(r,i){var a=32-e,s=new n(r.slice(i+a,i+32));return s=t?s.fromTwos(8*e):s.maskn(8*e),{consumed:32,value:new n(s.toString(10))}}}}var f=l(32,!1),d={encode:function(e){return f.encode(e?1:0)},decode:function(e,t){var r=f.decode(e,t);return{consumed:r.consumed,value:!r.value.isZero()}}};function p(e){return{encode:function(e){var t=e;if(32===(t=c(t)).length)return t;var n=new r(32);return n.fill(0),t.copy(n),n},decode:function(t,r){if(0!==t.length&&t.length<r+32)throw new Error("[ethjs-abi] while decoding fixed bytes, invalid bytes data length: "+e);return{consumed:32,value:"0x"+t.slice(r,r+e).toString("hex")}}}}var h={encode:function(e){var t=e,n=new r(32);if(!u(t,20))throw new Error("[ethjs-abi] while encoding address, invalid address value, not alphanumeric 20 byte hex string");return t=c(t),n.fill(0),t.copy(n,12),n},decode:function(e,t){if(0===e.length)return{consumed:32,value:"0x"};if(0!==e.length&&e.length<t+32)throw new Error("[ethjs-abi] while decoding address data, invalid address data, invalid byte length "+e.length);return{consumed:32,value:"0x"+e.slice(t+12,t+32).toString("hex")}}};function m(e){var t=parseInt(32*Math.ceil(e.length/32)),n=new r(t-e.length);return n.fill(0),r.concat([f.encode(e.length),e,n])}function y(e,t){if(0!==e.length&&e.length<t+32)throw new Error("[ethjs-abi] while decoding dynamic bytes data, invalid bytes length: "+e.length+" should be less than "+(t+32));var r=f.decode(e,t).value;if(r=r.toNumber(),0!==e.length&&e.length<t+32+r)throw new Error("[ethjs-abi] while decoding dynamic bytes data, invalid bytes length: "+e.length+" should be less than "+(t+32+r));return{consumed:parseInt(32+32*Math.ceil(r/32),10),value:e.slice(t+32,t+32+r)}}var b={encode:function(e){return m(c(e))},decode:function(e,t){var r=y(e,t);return r.value="0x"+r.value.toString("hex"),r},dynamic:!0},g={encode:function(e){return m(new r(e,"utf8"))},decode:function(e,t){var r=y(e,t);return r.value=r.value.toString("utf8"),r},dynamic:!0};function v(e,t){return{encode:function(n){var i=new r(0),a=t;if(!Array.isArray(n))throw new Error("[ethjs-abi] while encoding array, invalid array data, not type Object (Array)");if(-1===a&&(a=n.length,i=f.encode(a)),a!==n.length)throw new Error("[ethjs-abi] while encoding array, size mismatch array length "+a+" does not equal "+n.length);return n.forEach((function(t){i=r.concat([i,e.encode(t)])})),i},decode:function(r,n){var i,a=t,s=n,o=0;-1===a&&(a=(i=f.decode(r,s)).value.toNumber(),o+=i.consumed,s+=i.consumed);for(var u=[],c=0;c<a;c++){var l=e.decode(r,s);o+=l.consumed,s+=l.consumed,u.push(l.value)}return{consumed:o,value:u}},dynamic:-1===t}}var w=new RegExp(/^((u?int|bytes)([0-9]*)|(address|bool|string)|(\[([0-9]*)\]))/);t.exports={BN:n,bnToBuffer:o,isHexString:u,hexOrBuffer:c,hexlify:function(e){return"number"==typeof e?"0x"+o(new n(e)).toString("hex"):e.mod||e.modulo?"0x"+o(e).toString("hex"):"0x"+c(e).toString("hex")},stripZeros:s,keccak256:a,getKeys:function(e,t,r){var n=[];if(!Array.isArray(e))throw new Error("[ethjs-abi] while getting keys, invalid params value "+JSON.stringify(e));for(var i=0;i<e.length;i++){var a=e[i][t];if(r&&!a)a="";else if("string"!=typeof a)throw new Error("[ethjs-abi] while getKeys found invalid ABI data structure, type value not string");n.push(a)}return n},numberToBN:i,coderNumber:l,uint256Coder:f,coderBoolean:d,coderFixedBytes:p,coderAddress:h,coderDynamicBytes:b,coderString:g,coderArray:v,paramTypePart:w,getParamCoder:function(e){for(var t=e,r=null,n="[ethjs-abi] while getting param coder (getParamCoder) type value "+JSON.stringify(t)+" is either invalid or unsupported by ethjs-abi.";t;){var i=t.match(w);if(!i)throw new Error(n);t=t.substring(i[0].length);var a=i[2]||i[4]||i[5];switch(a){case"int":case"uint":if(r)throw new Error(n);var s=parseInt(i[3]||256);if(0===s||s>256||s%8!=0)throw new Error("[ethjs-abi] while getting param coder for type "+t+", invalid "+a+"<N> width: "+t);r=l(s/8,"int"===a);break;case"bool":if(r)throw new Error(n);r=d;break;case"string":if(r)throw new Error(n);r=g;break;case"bytes":if(r)throw new Error(n);if(i[3]){var o=parseInt(i[3]);if(0===o||o>32)throw new Error("[ethjs-abi] while getting param coder for prefix bytes, invalid type "+t+", size "+o+" should be 0 or greater than 32");r=p(o)}else r=b;break;case"address":if(r)throw new Error(n);r=h;break;case"[]":if(!r||r.dynamic)throw new Error(n);r=v(r,-1);break;default:if(!r||r.dynamic)throw new Error(n);r=v(r,parseInt(i[6]))}}if(!r)throw new Error(n);return r}}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/smart-transactions-controller>@metamask/controllers>eth-method-registry>ethjs>ethjs-abi"}],[131,{"@babel/runtime/helpers/defineProperty":193,"@babel/runtime/helpers/interopRequireDefault":199,lodash:5091},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var i=n(e("@babel/runtime/helpers/defineProperty")),a=e("lodash");function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach((function(t){(0,i.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var u={version:48,async migrate(e){const t=(0,a.cloneDeep)(e);t.meta.version=48;const r=t.data;return t.data=function(e={}){var t,r,n,i,a,s,u,f,d;null===(t=e.NetworkController)||void 0===t||delete t.settings;const p=(null===(r=e.NetworkController)||void 0===r?void 0:r.provider)||{};if(("rpc"!==p.type||"string"==typeof p.chainId&&l.test(p.chainId))&&"localhost"!==p.type){if(null!==(n=e.NetworkController)&&void 0!==n&&n.provider){var h,m;if("rpcTarget"in e.NetworkController.provider){const t=e.NetworkController.provider.rpcTarget;e.NetworkController.provider.rpcUrl=t}null===(h=e.NetworkController)||void 0===h||(null===(m=h.provider)||void 0===m||delete m.rpcTarget)}}else e.NetworkController.provider={type:"rinkeby",rpcUrl:"",chainId:"0x4",nickname:"",rpcPrefs:{},ticker:"ETH"};e.PreferencesController||(e.PreferencesController={});e.PreferencesController.frequentRpcListDetail||(e.PreferencesController.frequentRpcListDetail=[]);e.PreferencesController.frequentRpcListDetail.unshift({rpcUrl:"http://localhost:8545",chainId:"0x539",ticker:"ETH",nickname:"Localhost 8545",rpcPrefs:{}}),null===(i=e.CachedBalancesController)||void 0===i||delete i.cachedBalances;const y=null===(a=e.TransactionController)||void 0===a?void 0:a.transactions;Array.isArray(y)&&y.forEach((e=>{const t=null==e?void 0:e.metamaskNetworkId;"string"==typeof t&&c.test(t)&&(e.metamaskNetworkId=parseInt(t,16).toString(10))}));const b=(null===(s=e.AddressBookController)||void 0===s?void 0:s.addressBook)||{};Object.keys(b).forEach((e=>{if(/^\d+$/iu.test(e)){const t=`0x${parseInt(e,10).toString(16)}`;!function(e,t){Object.values(e).forEach((e=>{e&&"object"==typeof e&&(e.chainId=t)}))}(b[e],t),b[t]?function(e,t,r){const n=e[t]||{},i=o({},e[r]);Object.keys(n).forEach((e=>{if(i[e]&&"object"==typeof i[e]){const t={};new Set([...Object.keys(i[e]),...Object.keys(n[e]||{})]).forEach((r=>{var a;t[r]=i[e][r]||(null===(a=n[e])||void 0===a?void 0:a[r])||""})),i[e]=t}else n[e]&&"object"==typeof n[e]&&(i[e]=n[e])})),e[r]=i}(b,e,t):b[t]=b[e],delete b[e]}})),null===(u=e.IncomingTransactionsController)||void 0===u||null===(f=u.incomingTxLastFetchedBlocksByNetwork)||void 0===f||delete f.localhost;const g=null===(d=e.PreferencesController)||void 0===d?void 0:d.accountTokens;g&&Object.keys(g).forEach((e=>{var t,r;const n=(null===(t=g[e])||void 0===t?void 0:t.localhost)||[];if(n.length>0){const t=g[e].rpc||[];t.length>0?g[e].rpc=function(e,t){const r=a(e),n=a(t),i=[];return new Set([...Object.keys(r),...Object.keys(n)]).forEach((e=>{i.push(o(o({},r[e]),n[e]))})),i;function a(e){return e.reduce(((e,t)=>(null!=t&&t.address&&"string"==typeof(null==t?void 0:t.address)&&(e[t.address]=t),e)),{})}}(n,t):g[e].rpc=n}null===(r=g[e])||void 0===r||delete r.localhost}));return e}(r),t}};r.default=u;const c=/^0x[0-9a-f]+$/iu,l=/^0x[1-9a-f]+[0-9a-f]*$/iu}}},{package:"$root$"}],[1310,{"./has-tx-object":1311,"babel-runtime/core-js/json/stringify":1731,"babel-runtime/core-js/object/assign":1732,"babel-runtime/helpers/asyncToGenerator":1740,"babel-runtime/regenerator":1857,"ethjs-abi":1313,"ethjs-filter":2483,"ethjs-util":2491,"js-sha3":1322,"promise-to-callback":5344},function(){with(this)return function(){"use strict";return function(e,t,r){var n=o(e("babel-runtime/regenerator")),i=o(e("babel-runtime/core-js/json/stringify")),a=o(e("babel-runtime/helpers/asyncToGenerator")),s=o(e("babel-runtime/core-js/object/assign"));function o(e){return e&&e.__esModule?e:{default:e}}var u=e("ethjs-abi"),c=e("ethjs-filter"),l=e("ethjs-util").getKeys,f=e("js-sha3").keccak_256,d=e("./has-tx-object"),p=e("promise-to-callback");function h(e){return e.filter((function(e){return("function"===e.type||"event"===e.type)&&e.name.length>0}))}t.exports=function(){var e=(o=(0,a.default)(n.default.mark((function e(t){var a,o,c,l,f,p=t.methodObject,h=t.methodArgs;return n.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="call",o={},d(h)&&(o=h.pop()),(c=(0,s.default)({},r.defaultTxObject,o,{to:r.address})).data=u.encodeMethod(p,h),!1===p.constant&&(a="sendTransaction"),e.next=8,r.query[a](c);case 8:if(l=e.sent,"call"!==a){e.next=19;break}return e.prev=10,f=u.decodeMethod(p,l),e.abrupt("return",f);case 15:throw e.prev=15,e.t0=e.catch(10),new Error("[ethjs-contract] while formatting incoming raw call data "+(0,i.default)(l)+" "+e.t0);case 19:return e.abrupt("return",l);case 20:case"end":return e.stop()}}),e,this,[[10,15]])}))),function(e){return o.apply(this,arguments)}),t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},r=this;var o;function m(e){return function(){var t=[].slice.call(arguments),n=l(e.inputs,"type",!1),i="0x"+f(e.name+"("+n.join(",")+")"),a=[i],o=(0,s.default)({},t[0])||{},c=(0,s.default)({},t[0]||{},{to:r.address,topics:a}),d=(0,s.default)({},o,{decoder:function(t){return u.decodeEvent(e,t,a)},defaultFilterObject:c});return new r.filters.Filter(d)}}function y(t){return function(){var r=void 0,n=[].slice.call(arguments);"function"==typeof n[n.length-1]&&(r=n.pop());var i=e({methodObject:t,methodArgs:n});return r?p(i)(r):i}}r.abi=t.contractABI||[],r.query=t.query,r.address=t.address||"0x",r.bytecode=t.contractBytecode||"0x",r.defaultTxObject=t.contractDefaultTxObject||{},r.filters=new c(r.query),h(r.abi).forEach((function(e){"function"===e.type?r[e.name]=y(e):"event"===e.type&&(r[e.name]=m(e))}))}}}},{package:"@metamask/smart-transactions-controller>@metamask/controllers>eth-method-registry>ethjs>ethjs-contract"}],[1311,{"babel-runtime/core-js/object/keys":1735},function(){with(this)return function(){"use strict";return function(e,t,r){var n,i=e("babel-runtime/core-js/object/keys"),a=(n=i)&&n.__esModule?n:{default:n};var s=["from","to","data","value","gasPrice","gas"];t.exports=function(e){if(!Array.isArray(e)||0===e.length)return!1;var t=e[e.length-1];if(!t)return!1;if("object"!=typeof t)return!1;if(0===(0,a.default)(t).length)return!0;var r=(0,a.default)(t);if(s.some((function(e){return r.includes(e)})))return!0;return!1}}}},{package:"@metamask/smart-transactions-controller>@metamask/controllers>eth-method-registry>ethjs>ethjs-contract"}],[1312,{"./contract":1310,"./has-tx-object":1311,"babel-runtime/core-js/object/assign":1732,"ethjs-abi":1313,"ethjs-filter":2483,"ethjs-util":2491,"js-sha3":1322},function(){with(this)return function(){"use strict";return function(e,t,r){var n,i=e("babel-runtime/core-js/object/assign"),a=(n=i)&&n.__esModule?n:{default:n};var s=e("ethjs-abi"),o=(e("js-sha3").keccak_256,e("ethjs-filter"),e("ethjs-util").getKeys),u=e("./contract"),c=e("./has-tx-object");function l(e){return e.filter((function(e){return"constructor"===e.type}))[0]}t.exports=function(e){return function(t,r,n){if(!Array.isArray(t))throw new Error("[ethjs-contract] Contract ABI must be type Array, got type "+typeof t);if(void 0!==r&&"string"!=typeof r)throw new Error("[ethjs-contract] Contract bytecode must be type String, got type "+typeof r);if(void 0!==n&&"object"!=typeof n)throw new Error("[ethjs-contract] Contract default tx object must be type Object, got type "+typeof t);var i={at:function(i){return new u({address:i,query:e,contractBytecode:r,contractDefaultTxObject:n,contractABI:t})},new:function(){var i={},u=null,f=[].slice.call(arguments);"function"==typeof f[f.length-1]&&(u=f.pop()),c(f)&&(i=f.pop());var d=l(t),p=(0,a.default)({},n,i);if(r&&(p.data=r),d){var h=s.encodeParams(o(d.inputs,"type"),f).substring(2);p.data=""+p.data+h}return u?e.sendTransaction(p,u):e.sendTransaction(p)}};return i}}}}},{package:"@metamask/smart-transactions-controller>@metamask/controllers>eth-method-registry>ethjs>ethjs-contract"}],[1313,{"./utils/index.js":1314,buffer:1996},function(){with(this)return function(){"use strict";return function(e,t,r){(function(r){(function(){var n=e("./utils/index.js"),i=n.uint256Coder,a=(n.coderBoolean,n.coderFixedBytes,n.coderAddress,n.coderDynamicBytes,n.coderString,n.coderArray,n.paramTypePart,n.getParamCoder);function s(){}function o(e,t){if(e.length!==t.length)throw new Error("[ethjs-abi] while encoding params, types/values mismatch, Your contract requires "+e.length+" types (arguments), and you passed in "+t.length);var n=[];function s(e){return parseInt(32*Math.ceil(e/32))}e.forEach((function(e,r){var i=a(e);n.push({dynamic:i.dynamic,value:i.encode(t[r])})}));var o=0,u=0;n.forEach((function(e){e.dynamic?(o+=32,u+=s(e.value.length)):o+=s(e.value.length)}));var c=0,l=o,f=new r(o+u);return n.forEach((function(e,t){e.dynamic?(i.encode(l).copy(f,c),c+=32,e.value.copy(f,l),l+=s(e.value.length)):(e.value.copy(f,c),c+=s(e.value.length))})),"0x"+f.toString("hex")}function u(e,t,r){var o=!(arguments.length>3&&arguments[3]!==undefined)||arguments[3];arguments.length<3&&(r=t,t=e,e=[]),r=n.hexOrBuffer(r);var u=new s,c=0;return t.forEach((function(t,n){var s=a(t);if(s.dynamic){var l=i.decode(r,c),f=s.decode(r,l.value.toNumber());c+=l.consumed}else{f=s.decode(r,c);c+=f.consumed}o&&(u[n]=f.value),e[n]&&(u[e[n]]=f.value)})),u}function c(e,t){var i=e.name+"("+n.getKeys(e.inputs,"type").join(",")+")";return""+("0x"+new r(n.keccak256(i),"hex").slice(0,4).toString("hex"))+o(n.getKeys(e.inputs,"type"),t).substring(2)}function l(e){var t=e.name+"("+n.getKeys(e.inputs,"type").join(",")+")";return"0x"+n.keccak256(t)}function f(e,t,i){var s=!(arguments.length>3&&arguments[3]!==undefined)||arguments[3],o=e.inputs.filter((function(e){return!e.indexed})),c=n.getKeys(o,"name",!0),l=n.getKeys(o,"type"),f=u(c,l,n.hexOrBuffer(t),s),d=e.anonymous?0:1;return e.inputs.filter((function(e){return e.indexed})).map((function(e,t){var n=new r(i[t+d].slice(2),"hex"),s=a(e.type);f[e.name]=s.decode(n,0).value})),f._eventName=e.name,f}function d(e,t){var r=!(arguments.length>2&&arguments[2]!==undefined)||arguments[2];if(e&&t.topics[0]===l(e))return f(e,t.data,t.topics,r)}t.exports={encodeParams:o,decodeParams:u,encodeMethod:c,decodeMethod:function(e,t){return u(n.getKeys(e.outputs,"name",!0),n.getKeys(e.outputs,"type"),n.hexOrBuffer(t))},encodeEvent:function(e,t){return c(e,t)},decodeEvent:f,decodeLogItem:d,logDecoder:function(e){var t=!(arguments.length>1&&arguments[1]!==undefined)||arguments[1],r={};return e.filter((function(e){return"event"===e.type})).map((function(e){r[l(e)]=e})),function(e){return e.map((function(e){return d(r[e.topics[0]],e,t)})).filter((function(e){return e}))}},eventSignature:l}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/smart-transactions-controller>@metamask/controllers>eth-method-registry>ethjs>ethjs-contract>ethjs-abi"}],[1314,{"bn.js":1298,buffer:1996,"js-sha3":1322,"number-to-bn":5220},function(){with(this)return function(){"use strict";return function(e,t,r){(function(r){(function(){var n=e("bn.js"),i=e("number-to-bn"),a=e("js-sha3").keccak_256;function s(e){for(var t=e,r=t[0];t.length>0&&"0"===r.toString();)r=(t=t.slice(1))[0];return t}function o(e){var t=e.toString(16);return t.length%2&&(t="0"+t),s(new r(t,"hex"))}function u(e,t){return!("string"!=typeof e||!e.match(/^0x[0-9A-Fa-f]*$/))&&(!t||e.length===2+2*t)}function c(e,t){var n=e;if(!r.isBuffer(n)){if(!u(n)){var i=new Error(t?"[ethjs-abi] invalid "+t:"[ethjs-abi] invalid hex or buffer, must be a prefixed alphanumeric even length hex string");throw i.reason="[ethjs-abi] invalid hex string, hex must be prefixed and alphanumeric (e.g. 0x023..)",i.value=n,i}(n=n.substring(2)).length%2&&(n="0"+n),n=new r(n,"hex")}return n}function l(e,t){return{encode:function(n){var a=n;return"object"==typeof a&&a.toString&&(a.toTwos||a.dividedToIntegerBy)&&(a=a.toString(10).split(".")[0]),"string"!=typeof a&&"number"!=typeof a||(a=String(a).split(".")[0]),a=(a=i(a)).toTwos(8*e).maskn(8*e),t&&(a=a.fromTwos(8*e).toTwos(256)),a.toArrayLike(r,"be",32)},decode:function(r,i){var a=32-e,s=new n(r.slice(i+a,i+32));return s=t?s.fromTwos(8*e):s.maskn(8*e),{consumed:32,value:new n(s.toString(10))}}}}var f=l(32,!1),d={encode:function(e){return f.encode(e?1:0)},decode:function(e,t){var r=f.decode(e,t);return{consumed:r.consumed,value:!r.value.isZero()}}};function p(e){return{encode:function(e){var t=e;if(32===(t=c(t)).length)return t;var n=new r(32);return n.fill(0),t.copy(n),n},decode:function(t,r){if(0!==t.length&&t.length<r+32)throw new Error("[ethjs-abi] while decoding fixed bytes, invalid bytes data length: "+e);return{consumed:32,value:"0x"+t.slice(r,r+e).toString("hex")}}}}var h={encode:function(e){var t=e,n=new r(32);if(!u(t,20))throw new Error("[ethjs-abi] while encoding address, invalid address value, not alphanumeric 20 byte hex string");return t=c(t),n.fill(0),t.copy(n,12),n},decode:function(e,t){if(0===e.length)return{consumed:32,value:"0x"};if(0!==e.length&&e.length<t+32)throw new Error("[ethjs-abi] while decoding address data, invalid address data, invalid byte length "+e.length);return{consumed:32,value:"0x"+e.slice(t+12,t+32).toString("hex")}}};function m(e){var t=parseInt(32*Math.ceil(e.length/32)),n=new r(t-e.length);return n.fill(0),r.concat([f.encode(e.length),e,n])}function y(e,t){if(0!==e.length&&e.length<t+32)throw new Error("[ethjs-abi] while decoding dynamic bytes data, invalid bytes length: "+e.length+" should be less than "+(t+32));var r=f.decode(e,t).value;if(r=r.toNumber(),0!==e.length&&e.length<t+32+r)throw new Error("[ethjs-abi] while decoding dynamic bytes data, invalid bytes length: "+e.length+" should be less than "+(t+32+r));return{consumed:parseInt(32+32*Math.ceil(r/32),10),value:e.slice(t+32,t+32+r)}}var b={encode:function(e){return m(c(e))},decode:function(e,t){var r=y(e,t);return r.value="0x"+r.value.toString("hex"),r},dynamic:!0},g={encode:function(e){return m(new r(e,"utf8"))},decode:function(e,t){var r=y(e,t);return r.value=r.value.toString("utf8"),r},dynamic:!0};function v(e,t){return{encode:function(n){var i=new r(0),a=t;if(!Array.isArray(n))throw new Error("[ethjs-abi] while encoding array, invalid array data, not type Object (Array)");if(-1===a&&(a=n.length,i=f.encode(a)),a!==n.length)throw new Error("[ethjs-abi] while encoding array, size mismatch array length "+a+" does not equal "+n.length);return n.forEach((function(t){i=r.concat([i,e.encode(t)])})),i},decode:function(r,n){var i,a=t,s=n,o=0;-1===a&&(a=(i=f.decode(r,s)).value.toNumber(),o+=i.consumed,s+=i.consumed);for(var u=[],c=0;c<a;c++){var l=e.decode(r,s);o+=l.consumed,s+=l.consumed,u.push(l.value)}return{consumed:o,value:u}},dynamic:-1===t}}var w=new RegExp(/^((u?int|bytes)([0-9]*)|(address|bool|string)|(\[([0-9]*)\]))/);t.exports={BN:n,bnToBuffer:o,isHexString:u,hexOrBuffer:c,hexlify:function(e){return"number"==typeof e?"0x"+o(new n(e)).toString("hex"):e.mod||e.modulo?"0x"+o(e).toString("hex"):"0x"+c(e).toString("hex")},stripZeros:s,keccak256:a,getKeys:function(e,t,r){var n=[];if(!Array.isArray(e))throw new Error("[ethjs-abi] while getting keys, invalid params value "+JSON.stringify(e));for(var i=0;i<e.length;i++){var a=e[i][t];if(r&&!a)a="";else if("string"!=typeof a)throw new Error("[ethjs-abi] while getKeys found invalid ABI data structure, type value not string");n.push(a)}return n},numberToBN:i,coderNumber:l,uint256Coder:f,coderBoolean:d,coderFixedBytes:p,coderAddress:h,coderDynamicBytes:b,coderString:g,coderArray:v,paramTypePart:w,getParamCoder:function(e){for(var t=e,r=null,n="[ethjs-abi] while getting param coder (getParamCoder) type value "+JSON.stringify(t)+" is either invalid or unsupported by ethjs-abi.";t;){var i=t.match(w);if(!i)throw new Error(n);t=t.substring(i[0].length);var a=i[2]||i[4]||i[5];switch(a){case"int":case"uint":if(r)throw new Error(n);var s=parseInt(i[3]||256);if(0===s||s>256||s%8!=0)throw new Error("[ethjs-abi] while getting param coder for type "+t+", invalid "+a+"<N> width: "+t);r=l(s/8,"int"===a);break;case"bool":if(r)throw new Error(n);r=d;break;case"string":if(r)throw new Error(n);r=g;break;case"bytes":if(r)throw new Error(n);if(i[3]){var o=parseInt(i[3]);if(0===o||o>32)throw new Error("[ethjs-abi] while getting param coder for prefix bytes, invalid type "+t+", size "+o+" should be 0 or greater than 32");r=p(o)}else r=b;break;case"address":if(r)throw new Error(n);r=h;break;case"[]":if(!r||r.dynamic)throw new Error(n);r=v(r,-1);break;default:if(!r||r.dynamic)throw new Error(n);r=v(r,parseInt(i[6]))}}if(!r)throw new Error(n);return r}}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/smart-transactions-controller>@metamask/controllers>eth-method-registry>ethjs>ethjs-contract>ethjs-abi"}],[1315,{"babel-runtime/core-js/json/stringify":1731,"babel-runtime/core-js/object/assign":1732,"babel-runtime/core-js/object/define-property":1734,"babel-runtime/core-js/object/keys":1735,"babel-runtime/helpers/asyncToGenerator":1740,"babel-runtime/regenerator":1857,"ethjs-format":2484,"ethjs-rpc":2487,"promise-to-callback":5344},function(){with(this)return function(){"use strict";return function(e,t,r){var n=c(e("babel-runtime/regenerator")),i=c(e("babel-runtime/core-js/json/stringify")),a=c(e("babel-runtime/helpers/asyncToGenerator")),s=c(e("babel-runtime/core-js/object/define-property")),o=c(e("babel-runtime/core-js/object/keys")),u=c(e("babel-runtime/core-js/object/assign"));function c(e){return e&&e.__esModule?e:{default:e}}var l=e("ethjs-format"),f=e("ethjs-rpc"),d=e("promise-to-callback");function p(e,t){var r=this,n=t||{};if(!(this instanceof p))throw new Error('[ethjs-query] the Eth object requires the "new" flag in order to function normally (i.e. `const eth = new Eth(provider);`).');if("object"!=typeof e)throw new Error("[ethjs-query] the Eth object requires that the first input 'provider' must be an object, got '"+typeof e+"' (i.e. 'const eth = new Eth(provider);')");r.options=(0,u.default)({debug:n.debug||!1,logger:n.logger||console,jsonSpace:n.jsonSpace||0}),r.rpc=new f(e),r.setProvider=r.rpc.setProvider}function h(e,t){return function(){var r,s=(r=(0,a.default)(n.default.mark((function r(){var a,s;return n.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!(f.length<t[2])){r.next=2;break}throw new Error("[ethjs-query] method '"+p+"' requires at least "+t[2]+" input (format type "+t[0][0]+"), "+f.length+" provided. For more information visit: https://github.com/ethereum/wiki/wiki/JSON-RPC#"+e.toLowerCase());case 2:if(!(f.length>t[0].length)){r.next=4;break}throw new Error("[ethjs-query] method '"+p+"' requires at most "+t[0].length+" params, "+f.length+" provided '"+(0,i.default)(f,null,c.options.jsonSpace)+"'. For more information visit: https://github.com/ethereum/wiki/wiki/JSON-RPC#"+e.toLowerCase());case 4:t[3]&&f.length<t[3]&&f.push("latest"),this.log("attempting method formatting for '"+p+"' with inputs "+(0,i.default)(f,null,this.options.jsonSpace)),r.prev=6,u=l.formatInputs(e,f),this.log("method formatting success for '"+p+"' with formatted result: "+(0,i.default)(u,null,this.options.jsonSpace)),r.next=14;break;case 11:throw r.prev=11,r.t0=r.catch(6),new Error("[ethjs-query] while formatting inputs '"+(0,i.default)(f,null,this.options.jsonSpace)+"' for method '"+p+"' error: "+r.t0);case 14:return r.next=16,this.rpc.sendAsync({method:e,params:u});case 16:return a=r.sent,r.prev=17,this.log("attempting method formatting for '"+p+"' with raw outputs: "+(0,i.default)(a,null,this.options.jsonSpace)),s=l.formatOutputs(e,a),this.log("method formatting success for '"+p+"' formatted result: "+(0,i.default)(s,null,this.options.jsonSpace)),r.abrupt("return",s);case 24:throw r.prev=24,r.t1=r.catch(17),new Error("[ethjs-query] while formatting outputs from RPC '"+(0,i.default)(a,null,this.options.jsonSpace)+"' for method '"+p+"' "+r.t1);case 28:case"end":return r.stop()}}),r,this,[[6,11],[17,24]])}))),function(){return r.apply(this,arguments)}),o=null,u=null,c=this,f=[].slice.call(arguments),p=e.replace("eth_","");f.length>0&&"function"==typeof f[f.length-1]&&(o=f.pop());var h=s.call(this);return o?d(h)(o):h}}t.exports=p,p.prototype.log=function(e){this.options.debug&&this.options.logger.log("[ethjs-query log] "+e)},(0,o.default)(l.schema.methods).forEach((function(e){(0,s.default)(p.prototype,e.replace("eth_",""),{enumerable:!0,value:h(e,l.schema.methods[e])})}))}}},{package:"@metamask/smart-transactions-controller>@metamask/controllers>eth-method-registry>ethjs>ethjs-query"}],[1316,{"./lib/getTransactionSuccess.js":1317,"bn.js":1298,buffer:1996,"ethjs-abi":1308,"ethjs-contract":1312,"ethjs-filter":2483,"ethjs-provider-http":2485,"ethjs-query":1315,"ethjs-unit":2489,"ethjs-util":2491,"js-sha3":1322,"number-to-bn":5220},function(){with(this)return function(){"use strict";return function(e,t,r){(function(r){(function(){var n=e("ethjs-query"),i=e("ethjs-filter"),a=e("ethjs-contract"),s=e("ethjs-provider-http"),o=e("ethjs-abi"),u=e("ethjs-unit"),c=e("js-sha3").keccak_256,l=e("number-to-bn"),f=e("bn.js"),d=e("ethjs-util"),p=e("./lib/getTransactionSuccess.js");function h(e,t){if(!(this instanceof h))throw new Error('[ethjs] the Eth object requires you construct it with the "new" flag (i.e. `const eth = new Eth(...);`).');var r=this;r.options=t||{};var s=new n(e,r.options.query);Object.keys(Object.getPrototypeOf(s)).forEach((function(e){r[e]=function(){for(var t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];return s[e].apply(s,r)}})),r.filter=new i(s,r.options.query),r.contract=new a(s,r.options.query),r.currentProvider=s.rpc.currentProvider,r.setProvider=s.setProvider,r.getTransactionSuccess=p(r)}t.exports=h,h.BN=f,h.isAddress=function(e){return d.isHexString(e,20)},h.keccak256=function(e){return"0x"+c(e)},h.Buffer=r,h.isHexString=d.isHexString,h.fromWei=u.fromWei,h.toWei=u.toWei,h.toBN=l,h.abi=o,h.fromAscii=d.fromAscii,h.toAscii=d.toAscii,h.fromUtf8=d.fromUtf8,h.toUtf8=d.toUtf8,h.HttpProvider=s}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/smart-transactions-controller>@metamask/controllers>eth-method-registry>ethjs"}],[1317,{},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=function(e){return function(t,r){var n=0,i=e.options.timeout||8e5,a=e.options.interval||7e3,s=new Promise((function(r,s){var o=setInterval((function(){(e.getTransactionReceipt(t,(function(e,t){e&&(clearInterval(o),s(e)),!e&&t&&(clearInterval(o),r(t))})),n>=i)&&(clearInterval(o),s("Receipt timeout waiting for tx hash: "+t));n+=a}),a)}));return r&&s.then((function(e){return r(null,e)})).catch((function(e){return r(e,null)})),r?null:s}}}}},{package:"@metamask/smart-transactions-controller>@metamask/controllers>eth-method-registry>ethjs"}],[1318,{"./helpers.js":1320},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0});var n=e("./helpers.js");r.JsonPatchError=n.PatchError,r.deepClone=n._deepClone;var i={add:function(e,t,r){return e[t]=this.value,{newDocument:r}},remove:function(e,t,r){var n=e[t];return delete e[t],{newDocument:r,removed:n}},replace:function(e,t,r){var n=e[t];return e[t]=this.value,{newDocument:r,removed:n}},move:function(e,t,r){var i=s(r,this.path);i&&(i=n._deepClone(i));var a=o(r,{op:"remove",path:this.from}).removed;return o(r,{op:"add",path:this.path,value:a}),{newDocument:r,removed:i}},copy:function(e,t,r){var i=s(r,this.from);return o(r,{op:"add",path:this.path,value:n._deepClone(i)}),{newDocument:r}},test:function(e,t,r){return{newDocument:r,test:f(e[t],this.value)}},_get:function(e,t,r){return this.value=e[t],{newDocument:r}}},a={add:function(e,t,r){return n.isInteger(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:r,index:t}},remove:function(e,t,r){return{newDocument:r,removed:e.splice(t,1)[0]}},replace:function(e,t,r){var n=e[t];return e[t]=this.value,{newDocument:r,removed:n}},move:i.move,copy:i.copy,test:i.test,_get:i._get};function s(e,t){if(""==t)return e;var r={op:"_get",path:t};return o(e,r),r.value}function o(e,t,o,u,l,d){if(void 0===o&&(o=!1),void 0===u&&(u=!0),void 0===l&&(l=!0),void 0===d&&(d=0),o&&("function"==typeof o?o(t,0,e,t.path):c(t,0)),""===t.path){var p={newDocument:e};if("add"===t.op)return p.newDocument=t.value,p;if("replace"===t.op)return p.newDocument=t.value,p.removed=e,p;if("move"===t.op||"copy"===t.op)return p.newDocument=s(e,t.from),"move"===t.op&&(p.removed=e),p;if("test"===t.op){if(p.test=f(e,t.value),!1===p.test)throw new r.JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",d,t,e);return p.newDocument=e,p}if("remove"===t.op)return p.removed=e,p.newDocument=null,p;if("_get"===t.op)return t.value=e,p;if(o)throw new r.JsonPatchError("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",d,t,e);return p}u||(e=n._deepClone(e));var h=(t.path||"").split("/"),m=e,y=1,b=h.length,g=undefined,v=void 0,w=void 0;for(w="function"==typeof o?o:c;;){if((v=h[y])&&-1!=v.indexOf("~")&&(v=n.unescapePathComponent(v)),l&&"__proto__"==v)throw new TypeError("JSON-Patch: modifying `__proto__` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(o&&g===undefined&&(m[v]===undefined?g=h.slice(0,y).join("/"):y==b-1&&(g=t.path),g!==undefined&&w(t,0,e,g)),y++,Array.isArray(m)){if("-"===v)v=m.length;else{if(o&&!n.isInteger(v))throw new r.JsonPatchError("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",d,t,e);n.isInteger(v)&&(v=~~v)}if(y>=b){if(o&&"add"===t.op&&v>m.length)throw new r.JsonPatchError("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",d,t,e);if(!1===(p=a[t.op].call(t,m,v,e)).test)throw new r.JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",d,t,e);return p}}else if(y>=b){if(!1===(p=i[t.op].call(t,m,v,e)).test)throw new r.JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",d,t,e);return p}if(m=m[v],o&&y<b&&(!m||"object"!=typeof m))throw new r.JsonPatchError("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",d,t,e)}}function u(e,t,i,a,s){if(void 0===a&&(a=!0),void 0===s&&(s=!0),i&&!Array.isArray(t))throw new r.JsonPatchError("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");a||(e=n._deepClone(e));for(var u=new Array(t.length),c=0,l=t.length;c<l;c++)u[c]=o(e,t[c],i,!0,s,c),e=u[c].newDocument;return u.newDocument=e,u}function c(e,t,a,s){if("object"!=typeof e||null===e||Array.isArray(e))throw new r.JsonPatchError("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,a);if(!i[e.op])throw new r.JsonPatchError("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,a);if("string"!=typeof e.path)throw new r.JsonPatchError("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,a);if(0!==e.path.indexOf("/")&&e.path.length>0)throw new r.JsonPatchError('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,a);if(("move"===e.op||"copy"===e.op)&&"string"!=typeof e.from)throw new r.JsonPatchError("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,a);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&e.value===undefined)throw new r.JsonPatchError("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,a);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&n.hasUndefined(e.value))throw new r.JsonPatchError("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,a);if(a)if("add"==e.op){var o=e.path.split("/").length,u=s.split("/").length;if(o!==u+1&&o!==u)throw new r.JsonPatchError("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,a)}else if("replace"===e.op||"remove"===e.op||"_get"===e.op){if(e.path!==s)throw new r.JsonPatchError("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,a)}else if("move"===e.op||"copy"===e.op){var c=l([{op:"_get",path:e.from,value:undefined}],a);if(c&&"OPERATION_PATH_UNRESOLVABLE"===c.name)throw new r.JsonPatchError("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,a)}}function l(e,t,i){try{if(!Array.isArray(e))throw new r.JsonPatchError("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)u(n._deepClone(t),n._deepClone(e),i||!0);else{i=i||c;for(var a=0;a<e.length;a++)i(e[a],a,t,undefined)}}catch(e){if(e instanceof r.JsonPatchError)return e;throw e}}function f(e,t){if(e===t)return!0;if(e&&t&&"object"==typeof e&&"object"==typeof t){var r,n,i,a=Array.isArray(e),s=Array.isArray(t);if(a&&s){if((n=e.length)!=t.length)return!1;for(r=n;0!=r--;)if(!f(e[r],t[r]))return!1;return!0}if(a!=s)return!1;var o=Object.keys(e);if((n=o.length)!==Object.keys(t).length)return!1;for(r=n;0!=r--;)if(!t.hasOwnProperty(o[r]))return!1;for(r=n;0!=r--;)if(!f(e[i=o[r]],t[i]))return!1;return!0}return e!=e&&t!=t}r.getValueByPointer=s,r.applyOperation=o,r.applyPatch=u,r.applyReducer=function(e,t,n){var i=o(e,t);if(!1===i.test)throw new r.JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return i.newDocument},r.validator=c,r.validate=l,r._areEquals=f}}},{package:"@metamask/smart-transactions-controller>fast-json-patch"}],[1319,{"./core.js":1318,"./helpers.js":1320},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0});
/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017 Joachim Wester
 * MIT license
 */
var n=e("./helpers.js"),i=e("./core.js"),a=new WeakMap,s=function(e){this.observers=new Map,this.obj=e},o=function(e,t){this.callback=e,this.observer=t};function u(e,t){void 0===t&&(t=!1);var r=a.get(e.object);c(r.value,e.object,e.patches,"",t),e.patches.length&&i.applyPatch(r.value,e.patches);var n=e.patches;return n.length>0&&(e.patches=[],e.callback&&e.callback(n)),n}function c(e,t,r,i,a){if(t!==e){"function"==typeof t.toJSON&&(t=t.toJSON());for(var s=n._objectKeys(t),o=n._objectKeys(e),u=!1,l=o.length-1;l>=0;l--){var f=e[p=o[l]];if(!n.hasOwnProperty(t,p)||t[p]===undefined&&f!==undefined&&!1===Array.isArray(t))Array.isArray(e)===Array.isArray(t)?(a&&r.push({op:"test",path:i+"/"+n.escapePathComponent(p),value:n._deepClone(f)}),r.push({op:"remove",path:i+"/"+n.escapePathComponent(p)}),u=!0):(a&&r.push({op:"test",path:i,value:e}),r.push({op:"replace",path:i,value:t}),!0);else{var d=t[p];"object"==typeof f&&null!=f&&"object"==typeof d&&null!=d&&Array.isArray(f)===Array.isArray(d)?c(f,d,r,i+"/"+n.escapePathComponent(p),a):f!==d&&(!0,a&&r.push({op:"test",path:i+"/"+n.escapePathComponent(p),value:n._deepClone(f)}),r.push({op:"replace",path:i+"/"+n.escapePathComponent(p),value:n._deepClone(d)}))}}if(u||s.length!=o.length)for(l=0;l<s.length;l++){var p=s[l];n.hasOwnProperty(e,p)||t[p]===undefined||r.push({op:"add",path:i+"/"+n.escapePathComponent(p),value:n._deepClone(t[p])})}}}r.unobserve=function(e,t){t.unobserve()},r.observe=function(e,t){var r,i=function(e){return a.get(e)}(e);if(i){var c=function(e,t){return e.observers.get(t)}(i,t);r=c&&c.observer}else i=new s(e),a.set(e,i);if(r)return r;if(r={},i.value=n._deepClone(e),t){r.callback=t,r.next=null;var l=function(){u(r)},f=function(){clearTimeout(r.next),r.next=setTimeout(l)};"undefined"!=typeof window&&(window.addEventListener("mouseup",f),window.addEventListener("keyup",f),window.addEventListener("mousedown",f),window.addEventListener("keydown",f),window.addEventListener("change",f))}return r.patches=[],r.object=e,r.unobserve=function(){u(r),clearTimeout(r.next),function(e,t){e.observers.delete(t.callback)}(i,r),"undefined"!=typeof window&&(window.removeEventListener("mouseup",f),window.removeEventListener("keyup",f),window.removeEventListener("mousedown",f),window.removeEventListener("keydown",f),window.removeEventListener("change",f))},i.observers.set(t,new o(t,r)),r},r.generate=u,r.compare=function(e,t,r){void 0===r&&(r=!1);var n=[];return c(e,t,n,"",r),n}}}},{package:"@metamask/smart-transactions-controller>fast-json-patch"}],[132,{lodash:5091},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");var i={version:49,async migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=49;const r=t.data;return t.data=function(e={}){if(e.PreferencesController){var t;const{metaMetricsId:r,participateInMetaMetrics:n,metaMetricsSendCount:i}=e.PreferencesController;e.MetaMetricsController=null!==(t=e.MetaMetricsController)&&void 0!==t?t:{},r!==undefined&&(e.MetaMetricsController.metaMetricsId=r,delete e.PreferencesController.metaMetricsId),n!==undefined&&(e.MetaMetricsController.participateInMetaMetrics=n,delete e.PreferencesController.participateInMetaMetrics),i!==undefined&&(e.MetaMetricsController.metaMetricsSendCount=i,delete e.PreferencesController.metaMetricsSendCount)}return e}(r),t}};r.default=i}}},{package:"$root$"}],[1320,{},function(){with(this)return function(){"use strict";return function(e,t,r){
/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017 Joachim Wester
 * MIT license
 */
var n,i=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},n(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var a=Object.prototype.hasOwnProperty;function s(e,t){return a.call(e,t)}function o(e){if(Array.isArray(e)){for(var t=new Array(e.length),r=0;r<t.length;r++)t[r]=""+r;return t}if(Object.keys)return Object.keys(e);t=[];for(var n in e)s(e,n)&&t.push(n);return t}function u(e){return-1===e.indexOf("/")&&-1===e.indexOf("~")?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function c(e,t){var r;for(var n in e)if(s(e,n)){if(e[n]===t)return u(n)+"/";if("object"==typeof e[n]&&""!=(r=c(e[n],t)))return u(n)+"/"+r}return""}function l(e,t){var r=[e];for(var n in t){var i="object"==typeof t[n]?JSON.stringify(t[n],null,2):t[n];void 0!==i&&r.push(n+": "+i)}return r.join("\n")}Object.defineProperty(r,"hasOwnProperty",{value:s}),r._objectKeys=o,r._deepClone=function(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}},r.isInteger=function(e){for(var t,r=0,n=e.length;r<n;){if(!((t=e.charCodeAt(r))>=48&&t<=57))return!1;r++}return!0},r.escapePathComponent=u,r.unescapePathComponent=function(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")},r._getPathRecursive=c,r.getPath=function(e,t){if(e===t)return"/";var r=c(e,t);if(""===r)throw new Error("Object not found in root");return"/"+r},r.hasUndefined=function e(t){if(t===undefined)return!0;if(t)if(Array.isArray(t)){for(var r=0,n=t.length;r<n;r++)if(e(t[r]))return!0}else if("object"==typeof t){var i=o(t),a=i.length;for(r=0;r<a;r++)if(e(t[i[r]]))return!0}return!1};var f=function(e){function t(t,r,n,i,a){var s=this.constructor,o=e.call(this,l(t,{name:r,index:n,operation:i,tree:a}))||this;return o.name=r,o.index=n,o.operation=i,o.tree=a,Object.setPrototypeOf(o,s.prototype),o.message=l(t,{name:r,index:n,operation:i,tree:a}),o}return i(t,e),t}(Error);r.PatchError=f}}},{package:"@metamask/smart-transactions-controller>fast-json-patch"}],[1321,{"./commonjs/core.js":1318,"./commonjs/duplex.js":1319,"./commonjs/helpers.js":1320},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("./commonjs/core.js");Object.assign(r,n);var i=e("./commonjs/duplex.js");Object.assign(r,i);var a=e("./commonjs/helpers.js");r.JsonPatchError=a.PatchError,r.deepClone=a._deepClone,r.escapePathComponent=a.escapePathComponent,r.unescapePathComponent=a.unescapePathComponent}}},{package:"@metamask/smart-transactions-controller>fast-json-patch"}],[1322,{_process:5342},function(){with(this)return function(){"use strict";return function(e,t,r){(function(e){(function(){
/**
 * [js-sha3]{@link https://github.com/emn178/js-sha3}
 *
 * @version 0.5.5
 * @author Chen, Yi-Cyuan [emn178@gmail.com]
 * @copyright Chen, Yi-Cyuan 2015-2016
 * @license MIT
 */
!function(r){"object"==typeof e&&e.versions&&e.versions.node&&(r=global);for(var n=!r.JS_SHA3_TEST&&"object"==typeof t&&t.exports,i="0123456789abcdef".split(""),a=[0,8,16,24],s=[1,0,32898,0,32906,2147483648,2147516416,2147483648,32907,0,2147483649,0,2147516545,2147483648,32777,2147483648,138,0,136,0,2147516425,0,2147483658,0,2147516555,0,139,2147483648,32905,2147483648,32771,2147483648,32770,2147483648,128,2147483648,32778,0,2147483658,2147483648,2147516545,2147483648,32896,2147483648,2147483649,0,2147516424,2147483648],o=[224,256,384,512],u=["hex","buffer","arrayBuffer","array"],c=function(e,t,r){return function(n){return new g(e,t,e).update(n)[r]()}},l=function(e,t,r){return function(n,i){return new g(e,t,i).update(n)[r]()}},f=function(e,t){var r=c(e,t,"hex");r.create=function(){return new g(e,t,e)},r.update=function(e){return r.create().update(e)};for(var n=0;n<u.length;++n){var i=u[n];r[i]=c(e,t,i)}return r},d=[{name:"keccak",padding:[1,256,65536,16777216],bits:o,createMethod:f},{name:"sha3",padding:[6,1536,393216,100663296],bits:o,createMethod:f},{name:"shake",padding:[31,7936,2031616,520093696],bits:[128,256],createMethod:function(e,t){var r=l(e,t,"hex");r.create=function(r){return new g(e,t,r)},r.update=function(e,t){return r.create(t).update(e)};for(var n=0;n<u.length;++n){var i=u[n];r[i]=l(e,t,i)}return r}}],p={},h=0;h<d.length;++h)for(var m=d[h],y=m.bits,b=0;b<y.length;++b)p[m.name+"_"+y[b]]=m.createMethod(y[b],m.padding);function g(e,t,r){this.blocks=[],this.s=[],this.padding=t,this.outputBits=r,this.reset=!0,this.block=0,this.start=0,this.blockCount=1600-(e<<1)>>5,this.byteCount=this.blockCount<<2,this.outputBlocks=r>>5,this.extraBytes=(31&r)>>3;for(var n=0;n<50;++n)this.s[n]=0}g.prototype.update=function(e){var t="string"!=typeof e;t&&e.constructor==r.ArrayBuffer&&(e=new Uint8Array(e));for(var n,i,s=e.length,o=this.blocks,u=this.byteCount,c=this.blockCount,l=0,f=this.s;l<s;){if(this.reset)for(this.reset=!1,o[0]=this.block,n=1;n<c+1;++n)o[n]=0;if(t)for(n=this.start;l<s&&n<u;++l)o[n>>2]|=e[l]<<a[3&n++];else for(n=this.start;l<s&&n<u;++l)(i=e.charCodeAt(l))<128?o[n>>2]|=i<<a[3&n++]:i<2048?(o[n>>2]|=(192|i>>6)<<a[3&n++],o[n>>2]|=(128|63&i)<<a[3&n++]):i<55296||i>=57344?(o[n>>2]|=(224|i>>12)<<a[3&n++],o[n>>2]|=(128|i>>6&63)<<a[3&n++],o[n>>2]|=(128|63&i)<<a[3&n++]):(i=65536+((1023&i)<<10|1023&e.charCodeAt(++l)),o[n>>2]|=(240|i>>18)<<a[3&n++],o[n>>2]|=(128|i>>12&63)<<a[3&n++],o[n>>2]|=(128|i>>6&63)<<a[3&n++],o[n>>2]|=(128|63&i)<<a[3&n++]);if(this.lastByteIndex=n,n>=u){for(this.start=n-u,this.block=o[c],n=0;n<c;++n)f[n]^=o[n];v(f),this.reset=!0}else this.start=n}return this},g.prototype.finalize=function(){var e=this.blocks,t=this.lastByteIndex,r=this.blockCount,n=this.s;if(e[t>>2]|=this.padding[3&t],this.lastByteIndex==this.byteCount)for(e[0]=e[r],t=1;t<r+1;++t)e[t]=0;for(e[r-1]|=2147483648,t=0;t<r;++t)n[t]^=e[t];v(n)},g.prototype.toString=g.prototype.hex=function(){this.finalize();for(var e,t=this.blockCount,r=this.s,n=this.outputBlocks,a=this.extraBytes,s=0,o=0,u="";o<n;){for(s=0;s<t&&o<n;++s,++o)e=r[s],u+=i[e>>4&15]+i[15&e]+i[e>>12&15]+i[e>>8&15]+i[e>>20&15]+i[e>>16&15]+i[e>>28&15]+i[e>>24&15];o%t==0&&(v(r),s=0)}return a&&(e=r[s],a>0&&(u+=i[e>>4&15]+i[15&e]),a>1&&(u+=i[e>>12&15]+i[e>>8&15]),a>2&&(u+=i[e>>20&15]+i[e>>16&15])),u},g.prototype.arrayBuffer=function(){this.finalize();var e,t=this.blockCount,r=this.s,n=this.outputBlocks,i=this.extraBytes,a=0,s=0,o=this.outputBits>>3;e=i?new ArrayBuffer(n+1<<2):new ArrayBuffer(o);for(var u=new Uint32Array(e);s<n;){for(a=0;a<t&&s<n;++a,++s)u[s]=r[a];s%t==0&&v(r)}return i&&(u[a]=r[a],e=e.slice(0,o)),e},g.prototype.buffer=g.prototype.arrayBuffer,g.prototype.digest=g.prototype.array=function(){this.finalize();for(var e,t,r=this.blockCount,n=this.s,i=this.outputBlocks,a=this.extraBytes,s=0,o=0,u=[];o<i;){for(s=0;s<r&&o<i;++s,++o)e=o<<2,t=n[s],u[e]=255&t,u[e+1]=t>>8&255,u[e+2]=t>>16&255,u[e+3]=t>>24&255;o%r==0&&v(n)}return a&&(e=o<<2,t=n[s],a>0&&(u[e]=255&t),a>1&&(u[e+1]=t>>8&255),a>2&&(u[e+2]=t>>16&255)),u};var v=function(e){var t,r,n,i,a,o,u,c,l,f,d,p,h,m,y,b,g,v,w,_,k,S,x,E,P,j,O,A,T,R,C,M,D,I,N,L,B,q,U,$,K,F,z,W,V,J,H,G,Z,Y,Q,X,ee,te,re,ne,ie,ae,se,oe,ue,ce,le;for(n=0;n<48;n+=2)i=e[0]^e[10]^e[20]^e[30]^e[40],a=e[1]^e[11]^e[21]^e[31]^e[41],o=e[2]^e[12]^e[22]^e[32]^e[42],u=e[3]^e[13]^e[23]^e[33]^e[43],c=e[4]^e[14]^e[24]^e[34]^e[44],l=e[5]^e[15]^e[25]^e[35]^e[45],f=e[6]^e[16]^e[26]^e[36]^e[46],d=e[7]^e[17]^e[27]^e[37]^e[47],t=(p=e[8]^e[18]^e[28]^e[38]^e[48])^(o<<1|u>>>31),r=(h=e[9]^e[19]^e[29]^e[39]^e[49])^(u<<1|o>>>31),e[0]^=t,e[1]^=r,e[10]^=t,e[11]^=r,e[20]^=t,e[21]^=r,e[30]^=t,e[31]^=r,e[40]^=t,e[41]^=r,t=i^(c<<1|l>>>31),r=a^(l<<1|c>>>31),e[2]^=t,e[3]^=r,e[12]^=t,e[13]^=r,e[22]^=t,e[23]^=r,e[32]^=t,e[33]^=r,e[42]^=t,e[43]^=r,t=o^(f<<1|d>>>31),r=u^(d<<1|f>>>31),e[4]^=t,e[5]^=r,e[14]^=t,e[15]^=r,e[24]^=t,e[25]^=r,e[34]^=t,e[35]^=r,e[44]^=t,e[45]^=r,t=c^(p<<1|h>>>31),r=l^(h<<1|p>>>31),e[6]^=t,e[7]^=r,e[16]^=t,e[17]^=r,e[26]^=t,e[27]^=r,e[36]^=t,e[37]^=r,e[46]^=t,e[47]^=r,t=f^(i<<1|a>>>31),r=d^(a<<1|i>>>31),e[8]^=t,e[9]^=r,e[18]^=t,e[19]^=r,e[28]^=t,e[29]^=r,e[38]^=t,e[39]^=r,e[48]^=t,e[49]^=r,m=e[0],y=e[1],J=e[11]<<4|e[10]>>>28,H=e[10]<<4|e[11]>>>28,A=e[20]<<3|e[21]>>>29,T=e[21]<<3|e[20]>>>29,oe=e[31]<<9|e[30]>>>23,ue=e[30]<<9|e[31]>>>23,F=e[40]<<18|e[41]>>>14,z=e[41]<<18|e[40]>>>14,I=e[2]<<1|e[3]>>>31,N=e[3]<<1|e[2]>>>31,b=e[13]<<12|e[12]>>>20,g=e[12]<<12|e[13]>>>20,G=e[22]<<10|e[23]>>>22,Z=e[23]<<10|e[22]>>>22,R=e[33]<<13|e[32]>>>19,C=e[32]<<13|e[33]>>>19,ce=e[42]<<2|e[43]>>>30,le=e[43]<<2|e[42]>>>30,te=e[5]<<30|e[4]>>>2,re=e[4]<<30|e[5]>>>2,L=e[14]<<6|e[15]>>>26,B=e[15]<<6|e[14]>>>26,v=e[25]<<11|e[24]>>>21,w=e[24]<<11|e[25]>>>21,Y=e[34]<<15|e[35]>>>17,Q=e[35]<<15|e[34]>>>17,M=e[45]<<29|e[44]>>>3,D=e[44]<<29|e[45]>>>3,E=e[6]<<28|e[7]>>>4,P=e[7]<<28|e[6]>>>4,ne=e[17]<<23|e[16]>>>9,ie=e[16]<<23|e[17]>>>9,q=e[26]<<25|e[27]>>>7,U=e[27]<<25|e[26]>>>7,_=e[36]<<21|e[37]>>>11,k=e[37]<<21|e[36]>>>11,X=e[47]<<24|e[46]>>>8,ee=e[46]<<24|e[47]>>>8,W=e[8]<<27|e[9]>>>5,V=e[9]<<27|e[8]>>>5,j=e[18]<<20|e[19]>>>12,O=e[19]<<20|e[18]>>>12,ae=e[29]<<7|e[28]>>>25,se=e[28]<<7|e[29]>>>25,$=e[38]<<8|e[39]>>>24,K=e[39]<<8|e[38]>>>24,S=e[48]<<14|e[49]>>>18,x=e[49]<<14|e[48]>>>18,e[0]=m^~b&v,e[1]=y^~g&w,e[10]=E^~j&A,e[11]=P^~O&T,e[20]=I^~L&q,e[21]=N^~B&U,e[30]=W^~J&G,e[31]=V^~H&Z,e[40]=te^~ne&ae,e[41]=re^~ie&se,e[2]=b^~v&_,e[3]=g^~w&k,e[12]=j^~A&R,e[13]=O^~T&C,e[22]=L^~q&$,e[23]=B^~U&K,e[32]=J^~G&Y,e[33]=H^~Z&Q,e[42]=ne^~ae&oe,e[43]=ie^~se&ue,e[4]=v^~_&S,e[5]=w^~k&x,e[14]=A^~R&M,e[15]=T^~C&D,e[24]=q^~$&F,e[25]=U^~K&z,e[34]=G^~Y&X,e[35]=Z^~Q&ee,e[44]=ae^~oe&ce,e[45]=se^~ue&le,e[6]=_^~S&m,e[7]=k^~x&y,e[16]=R^~M&E,e[17]=C^~D&P,e[26]=$^~F&I,e[27]=K^~z&N,e[36]=Y^~X&W,e[37]=Q^~ee&V,e[46]=oe^~ce&te,e[47]=ue^~le&re,e[8]=S^~m&b,e[9]=x^~y&g,e[18]=M^~E&j,e[19]=D^~P&O,e[28]=F^~I&L,e[29]=z^~N&B,e[38]=X^~W&J,e[39]=ee^~V&H,e[48]=ce^~te&ne,e[49]=le^~re&ie,e[0]^=s[n],e[1]^=s[n+1]};if(n)t.exports=p;else if(r)for(var w in p)r[w]=p[w]}(this)}).call(this)}).call(this,e("_process"))}}},{package:"@metamask/smart-transactions-controller>@metamask/controllers>eth-method-registry>ethjs>js-sha3"}],[1323,{"./url-alphabet/index.cjs":1324},function(){with(this)return function(){"use strict";return function(e,t,r){let{urlAlphabet:n}=e("./url-alphabet/index.cjs");let i=e=>crypto.getRandomValues(new Uint8Array(e)),a=(e,t,r)=>{let n=(2<<Math.log(e.length-1)/Math.LN2)-1,i=-~(1.6*n*t/e.length);return()=>{let a="";for(;;){let s=r(i),o=i;for(;o--;)if(a+=e[s[o]&n]||"",a.length===t)return a}}};t.exports={nanoid:(e=21)=>{let t="",r=crypto.getRandomValues(new Uint8Array(e));for(;e--;){let n=63&r[e];t+=n<36?n.toString(36):n<62?(n-26).toString(36).toUpperCase():n<63?"_":"-"}return t},customAlphabet:(e,t)=>a(e,t,i),customRandom:a,urlAlphabet:n,random:i}}}},{package:"@metamask/smart-transactions-controller>@metamask/controllers>nanoid"}],[1324,{},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports={urlAlphabet:"useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"}}}},{package:"@metamask/smart-transactions-controller>@metamask/controllers>nanoid"}],[1325,{"./resource":1327,"./services":1331,"./snaps":1335,"./utils":1340},function(){with(this)return function(){"use strict";return function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){n===undefined&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){n===undefined&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),i(e("./resource"),r),i(e("./services"),r),i(e("./snaps"),r),i(e("./utils"),r)}}},{package:"@metamask/snap-controllers"}],[1326,{"@metamask/obs-store":1345,"@metamask/safe-event-emitter":1232,"eth-rpc-errors":2371,nanoid:1368},function(){with(this)return function(){"use strict";return function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.ExternalResourceController=void 0;const i=e("@metamask/obs-store"),a=n(e("@metamask/safe-event-emitter")),s=e("eth-rpc-errors"),o=e("nanoid"),u=e=>`Not authorized to access resource with id "${e}".`;class c extends a.default{constructor({storageKey:e,requiredFields:t,initialResources:r}){super(),this.requiredFields=t,this.storageKey=e,this.store=new i.ObservableStore(((e,t)=>({[e]:t}))(e,r))}getResources(){return Object.assign({},this.store.getState()[this.storageKey])}setResources(e){this.store.updateState({[this.storageKey]:e})}clearResources(){this.setResources({})}deleteResourcesFor(e){const t=this.getResources(),r=Object.entries(t).reduce(((t,[r,n])=>(n.fromDomain!==e&&(t[r]=n),t)),{});this.setResources(r)}get(e,t){const r=this.getResources()[t];if(r&&r.fromDomain!==e)throw s.ethErrors.provider.unauthorized({message:u(t)});return r?Object.assign({},r):null}getAllResources(e){return Object.values(this.getResources()).filter((t=>t.fromDomain===e))}add(e,t){const r=this.processNewResource(e,t),{id:n}=r,i=this.getResources();if(i[n])throw new Error(`Resource with id "${n}" already exists.`);return i[n]=r,this.setResources(i),r.id}update(e,t){const{id:r}=t,n=this.getResources(),i=n[r];if(!i)throw s.ethErrors.rpc.resourceNotFound({message:`Resource with id "${r}" not found.`});if(i.fromDomain!==e)throw s.ethErrors.provider.unauthorized({message:u(r)});return n[r]=this.processNewResource(e,Object.assign(Object.assign({},n[r]),t)),this.setResources(n),r}processNewResource(e,t){return this.requiredFields.forEach((r=>{if(!(r in t))throw s.ethErrors.rpc.invalidParams(`Resource from "${e}" missing required field: ${r}`)})),Object.assign(Object.assign({},t),{fromDomain:e,id:t.id||(0,o.nanoid)()})}delete(e,t){const r=this.getResources(),n=r[t];if(!n)throw s.ethErrors.rpc.invalidParams({message:`Resource with id "${t}" not found.`});if(n.fromDomain!==e)throw s.ethErrors.provider.unauthorized({message:u(t)});return delete r[t],this.setResources(r),null}handleRpcRequest(e,t,r){if(!e||"string"!=typeof e)throw new Error("Invalid fromDomain.");switch(t){case"get":return this.get(e,r);case"getAll":return this.getAllResources(e);case"add":return this.add(e,r);case"update":return this.update(e,r);case"delete":return this.delete(e,r);default:throw s.ethErrors.rpc.methodNotFound({message:`Not an asset method: ${t}`})}}}r.ExternalResourceController=c}}},{package:"@metamask/snap-controllers"}],[1327,{"./ExternalResourceController":1326},function(){with(this)return function(){"use strict";return function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){n===undefined&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){n===undefined&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),i(e("./ExternalResourceController"),r)}}},{package:"@metamask/snap-controllers"}],[1328,{"@metamask/object-multiplex":1191,nanoid:1368,pump:5441},function(){with(this)return function(){"use strict";return function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.setupMultiplex=r.AbstractExecutionService=void 0;const i=n(e("@metamask/object-multiplex")),a=e("nanoid"),s=n(e("pump"));r.AbstractExecutionService=class{constructor({setupSnapProvider:e,messenger:t,unresponsivePollingInterval:r=5e3,unresponsiveTimeout:n=3e4}){this._snapRpcHooks=new Map,this.jobs=new Map,this.setupSnapProvider=e,this.snapToJobMap=new Map,this.jobToSnapMap=new Map,this._messenger=t,this._unresponsivePollingInterval=r,this._unresponsiveTimeout=n,this._timeoutForUnresponsiveMap=new Map}terminate(e){const t=this.jobs.get(e);if(!t)throw new Error(`Job with id "${e}" not found.`);Object.values(t.streams).forEach((e=>{try{!e.destroyed&&e.destroy(),e.removeAllListeners()}catch(e){console.error("Error while destroying stream",e)}})),this._terminate(t);const r=this.jobToSnapMap.get(e);r&&(clearTimeout(this._timeoutForUnresponsiveMap.get(r)),this._timeoutForUnresponsiveMap.delete(r),this._removeSnapAndJobMapping(e),this.jobs.delete(e),console.log(`job: "${e}" terminated`))}async terminateSnap(e){const t=this.snapToJobMap.get(e);t&&this.terminate(t)}async terminateAllSnaps(){for(const e of this.jobs.keys())this.terminate(e);this._snapRpcHooks.clear()}async getRpcMessageHandler(e){return this._snapRpcHooks.get(e)}async executeSnap(e){if(this.snapToJobMap.has(e.snapId))throw new Error(`Snap "${e.snapId}" is already being executed.`);const t=await this._initJob();this._mapSnapAndJob(e.snapId,t.id),await this._command(t.id,{jsonrpc:"2.0",method:"ping",id:(0,a.nanoid)()}),this.setupSnapProvider(e.snapId,t.streams.rpc);const r=await this._command(t.id,{jsonrpc:"2.0",method:"executeSnap",params:e,id:(0,a.nanoid)()});return this._pollForJobStatus(e.snapId),this._createSnapHooks(e.snapId,t.id),r}async _command(e,t){if("object"!=typeof t)throw new Error("Must send object.");const r=this.jobs.get(e);if(!r)throw new Error(`Job with id "${e}" not found.`);console.log("Parent: Sending Command",t);const n=await r.rpcEngine.handle(t);if(n.error)throw new Error(n.error.message);return n.result}_removeSnapHooks(e){this._snapRpcHooks.delete(e)}_createSnapHooks(e,t){this._snapRpcHooks.set(e,(async(r,n)=>await this._command(t,{id:(0,a.nanoid)(),jsonrpc:"2.0",method:"snapRpc",params:{origin:r,request:n,target:e}})))}_pollForJobStatus(e){const t=this.snapToJobMap.get(e);if(!t)throw new Error("no job id found for snap");const r=setTimeout((async()=>{try{await this._getJobStatus(t),this._pollForJobStatus(e)}catch(t){this.snapToJobMap.has(e)&&this._messenger.publish("ExecutionService:unresponsive",e)}}),this._unresponsivePollingInterval);this._timeoutForUnresponsiveMap.set(e,r)}async _getJobStatus(e){let t,r;const n=new Promise(((e,n)=>{t=e,r=n})),i=setTimeout((()=>{r(new Error("ping request timed out"))}),this._unresponsiveTimeout);return Promise.race([this._command(e,{jsonrpc:"2.0",method:"ping",params:[],id:(0,a.nanoid)()}).then((()=>{clearTimeout(i),t()})),n])}_getJobForSnap(e){return this.snapToJobMap.get(e)}_getSnapForJob(e){return this.jobToSnapMap.get(e)}_mapSnapAndJob(e,t){this.snapToJobMap.set(e,t),this.jobToSnapMap.set(t,e)}_removeSnapAndJobMapping(e){const t=this.jobToSnapMap.get(e);if(!t)throw new Error(`job: "${e}" has no mapped snap.`);this.jobToSnapMap.delete(e),this.snapToJobMap.delete(t),this._removeSnapHooks(t)}},r.setupMultiplex=function(e,t){const r=new i.default;return(0,s.default)(e,r,e,(e=>{e&&(t?console.error(`"${t}" stream failure.`,e):console.error(e))})),r}}}},{package:"@metamask/snap-controllers"}],[1329,{},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0})}}},{package:"@metamask/snap-controllers"}],[133,{lodash:5091},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");const i=["METASWAP_GAS_PRICE_ESTIMATES_LAST_RETRIEVED","METASWAP_GAS_PRICE_ESTIMATES","cachedFetch","BASIC_PRICE_ESTIMATES_LAST_RETRIEVED","BASIC_PRICE_ESTIMATES","BASIC_GAS_AND_TIME_API_ESTIMATES","BASIC_GAS_AND_TIME_API_ESTIMATES_LAST_RETRIEVED","GAS_API_ESTIMATES_LAST_RETRIEVED","GAS_API_ESTIMATES"];var a={version:50,async migrate(e){const t=(0,n.cloneDeep)(e);return t.meta.version=50,i.forEach((e=>{var t;return null===(t=window.localStorage)||void 0===t?void 0:t.removeItem(e)})),t}};r.default=a}}},{package:"$root$"}],[1330,{"./AbstractExecutionService":1328,"@metamask/execution-environments":1157,"@metamask/obs-store":1345,"@metamask/post-message-stream":1205,"json-rpc-engine":4641,"json-rpc-middleware-stream":1367,nanoid:1368,pump:5441},function(){with(this)return function(){"use strict";return function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.WebWorkerExecutionService=void 0;const i=e("@metamask/obs-store"),a=e("@metamask/post-message-stream"),s=e("@metamask/execution-environments"),o=e("json-rpc-engine"),u=e("json-rpc-middleware-stream"),c=e("nanoid"),l=n(e("pump")),f=e("./AbstractExecutionService");class d extends f.AbstractExecutionService{constructor({setupSnapProvider:e,workerUrl:t,messenger:r,unresponsivePollingInterval:n=5e3,unresponsiveTimeout:a=3e4}){super({setupSnapProvider:e,messenger:r,unresponsivePollingInterval:n,unresponsiveTimeout:a}),this.workerUrl=t,this.store=new i.ObservableStore({workers:{}})}_setWorker(e,t){this.jobs.set(e,t);const r=Object.assign(Object.assign({},this.store.getState().workers),{[e]:t});this.store.updateState({workers:r})}_deleteWorker(e){const t=Object.assign({},this.store.getState().workers);delete t[e],this.store.updateState({workers:t})}_terminate(e){e.worker.terminate(),this._deleteWorker(e.id)}async _initJob(){const e=(0,c.nanoid)(),t=new Worker(this.workerUrl,{name:e});t.addEventListener("error",(t=>{if(this._messenger){const r=this.jobToSnapMap.get(e);r&&this._messenger.publish("ExecutionService:unhandledError",r,{code:t.error.code,message:t.error.message,data:t.error.data})}}),{once:!0});const r=this._initWorkerStreams(t,e),n=new o.JsonRpcEngine,i=(0,u.createStreamMiddleware)();(0,l.default)(i.stream,r.command,i.stream),n.push(i.middleware);const a={id:e,streams:r,rpcEngine:n,worker:t};return this._setWorker(e,a),await this._command(e,{jsonrpc:"2.0",method:"ping",id:(0,c.nanoid)()}),a}_initWorkerStreams(e,t){const r=new a.WorkerParentPostMessageStream({worker:e}),n=(0,f.setupMultiplex)(r,`Worker:${t}`);return{command:n.createStream(s.SNAP_STREAM_NAMES.COMMAND),rpc:n.createStream(s.SNAP_STREAM_NAMES.JSON_RPC),_connection:r}}}r.WebWorkerExecutionService=d}}},{package:"@metamask/snap-controllers"}],[1331,{"./AbstractExecutionService":1328,"./ExecutionService":1329,"./WebWorkerExecutionService":1330},function(){with(this)return function(){"use strict";return function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){n===undefined&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){n===undefined&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),i(e("./AbstractExecutionService"),r),i(e("./ExecutionService"),r),i(e("./WebWorkerExecutionService"),r)}}},{package:"@metamask/snap-controllers"}],[1332,{},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.RequestQueue=void 0;r.RequestQueue=class{constructor(e){this.maxQueueSize=e,this.queueSizes=new Map}increment(e){var t;const r=null!==(t=this.queueSizes.get(e))&&void 0!==t?t:0;if(r>=this.maxQueueSize)throw new Error("Maximum number of requests reached. Try again later.");this.queueSizes.set(e,r+1)}decrement(e){var t;const r=null!==(t=this.queueSizes.get(e))&&void 0!==t?t:0;if(0===r)throw new Error(`Cannot decrement, ${e} does not have any outstanding requests.`);this.queueSizes.set(e,r-1)}get(e){var t;return null!==(t=this.queueSizes.get(e))&&void 0!==t?t:0}}}}},{package:"@metamask/snap-controllers"}],[1333,{"..":1325,"../utils":1340,"./RequestQueue":1332,"./default-endowments":1334,"./json-schemas":1336,"./utils":1339,"@metamask/controllers":1047,"eth-rpc-errors":2371,nanoid:1368,semver:5702},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.SnapController=r.SnapStatusEvent=r.SnapStatus=r.SNAP_APPROVAL_UPDATE=r.SNAP_PREFIX_REGEX=r.controllerName=void 0;const n=e("@metamask/controllers"),i=e("eth-rpc-errors"),a=e("nanoid"),s=e("semver"),o=e(".."),u=e("../utils"),c=e("./default-endowments"),l=e("./json-schemas"),f=e("./RequestQueue"),d=e("./utils");r.controllerName="SnapController",r.SNAP_PREFIX_REGEX=new RegExp(`^${d.SNAP_PREFIX}`,"u"),r.SNAP_APPROVAL_UPDATE="wallet_updateSnap";const p=new Set(["initialPermissions","id","permissionName","version"]),h={snapErrors:{},snaps:{},snapStates:{}};var m,y;!function(e){e.installing="installing",e.running="running",e.stopped="stopped",e.crashed="crashed"}(m=r.SnapStatus||(r.SnapStatus={})),function(e){e.start="start",e.stop="stop",e.crash="crash",e.update="update"}(y=r.SnapStatusEvent||(r.SnapStatusEvent={}));const b=e=>e.enabled,g={initial:m.installing,states:{[m.installing]:{on:{[y.start]:{target:m.running,cond:b}}},[m.running]:{on:{[y.stop]:m.stopped,[y.crash]:m.crashed}},[m.stopped]:{on:{[y.start]:{target:m.running,cond:b},[y.update]:m.installing}},[m.crashed]:{on:{[y.start]:{target:m.running,cond:b}}}}};class v extends n.BaseControllerV2{constructor({closeAllConnections:e,executeSnap:t,getRpcMessageHandler:r,messenger:n,state:i,terminateAllSnaps:a,terminateSnap:s,endowmentPermissionNames:o=[],npmRegistryUrl:u,idleTimeCheckInterval:c=5e3,maxIdleTime:l=3e4,maxRequestTime:f=6e4,fetchFunction:d=globalThis.fetch.bind(globalThis),featureFlags:p={}}){super({messenger:n,metadata:{snapErrors:{persist:!1,anonymous:!1},snapStates:{persist:!0,anonymous:!1},snaps:{persist:e=>Object.values(e).map((e=>Object.assign(Object.assign({},e),{status:m.stopped}))).reduce(((e,t)=>(e[t.id]=t,e)),{}),anonymous:!1}},name:"SnapController",state:Object.assign(Object.assign({},h),i)}),this._closeAllConnections=e,this._endowmentPermissionNames=o,this._executeSnap=t,this._getRpcMessageHandler=r,this._onUnhandledSnapError=this._onUnhandledSnapError.bind(this),this._onUnresponsiveSnap=this._onUnresponsiveSnap.bind(this),this._terminateSnap=s,this._terminateAllSnaps=a,this._idleTimeCheckInterval=c,this._maxIdleTime=l,this._maxRequestTime=f,this._pollForLastRequestStatus(),this._snapsRuntimeData=new Map,this._npmRegistryUrl=u,this._fetchFunction=d,this._featureFlags=p,this.messagingSystem.subscribe("ExecutionService:unhandledError",this._onUnhandledSnapError),this.messagingSystem.subscribe("ExecutionService:unresponsive",this._onUnresponsiveSnap),this.registerMessageHandlers()}registerMessageHandlers(){this.messagingSystem.registerActionHandler(`${r.controllerName}:add`,((...e)=>this.add(...e))),this.messagingSystem.registerActionHandler(`${r.controllerName}:get`,((...e)=>this.get(...e))),this.messagingSystem.registerActionHandler(`${r.controllerName}:getRpcMessageHandler`,((...e)=>this.getRpcMessageHandler(...e))),this.messagingSystem.registerActionHandler(`${r.controllerName}:getSnapState`,((...e)=>this.getSnapState(...e))),this.messagingSystem.registerActionHandler(`${r.controllerName}:has`,((...e)=>this.has(...e))),this.messagingSystem.registerActionHandler(`${r.controllerName}:updateSnapState`,((...e)=>this.updateSnapState(...e))),this.messagingSystem.registerActionHandler(`${r.controllerName}:clearSnapState`,((...e)=>this.clearSnapState(...e)))}_pollForLastRequestStatus(){this._timeoutForLastRequestStatus=setTimeout((async()=>{this._stopSnapsLastRequestPastMax(),this._pollForLastRequestStatus()}),this._idleTimeCheckInterval)}_stopSnapsLastRequestPastMax(){this._snapsRuntimeData.forEach((async(e,t)=>{0===e.pendingRequests&&e.lastRequest&&this._maxIdleTime&&(0,u.timeSince)(e.lastRequest)>this._maxIdleTime&&this.stopSnap(t,y.stop)}))}async _onUnresponsiveSnap(e){await this.stopSnap(e,y.crash),this.addSnapError({code:i.errorCodes.rpc.internal,message:"Snap Unresponsive",data:{snapId:e}})}async _onUnhandledSnapError(e,t){await this.stopSnap(e,y.crash),this.addSnapError(t)}_transitionSnapState(e,t){var r;const n=this.state.snaps[e].status;let i=null!==(r=g.states[n].on[t])&&void 0!==r?r:n;if(i.cond){if(!1===i.cond(this.state.snaps[e]))throw new Error(`Condition failed for state transition "${e}" with event "${t}".`)}i.target&&(i=i.target),i!==n&&this.update((t=>{t.snaps[e].status=i}))}async startSnap(e){const t=this.get(e);if(!t)throw new Error(`Snap "${e}" not found.`);if(!1===this.state.snaps[e].enabled)throw new Error(`Snap "${e}" is disabled.`);await this._startSnap({snapId:e,sourceCode:t.sourceCode})}enableSnap(e){this.update((t=>{t.snaps[e].enabled=!0}))}disableSnap(e){return this.update((t=>{if(!t.snaps[e])throw new Error(`Snap "${e}" not found.`);t.snaps[e].enabled=!1})),this.isRunning(e)?this.stopSnap(e,y.stop):Promise.resolve()}async stopSnap(e,t=y.stop){const r=this._getSnapRuntimeData(e);if(r){r.lastRequest=null;try{this.isRunning(e)&&(this._closeAllConnections(e),await this._terminateSnap(e))}finally{this.isRunning(e)&&this._transitionSnapState(e,t)}}}isRunning(e){const t=this.get(e);if(!t)throw new Error(`Snap "${e}" not found.`);return t.status===m.running}has(e){return Boolean(this.get(e))}get(e){return this.state.snaps[e]}getTruncated(e){const t=this.get(e);return t?Object.keys(t).reduce(((e,r)=>(p.has(r)&&(e[r]=t[r]),e)),{}):null}async updateSnapState(e,t){this.update((r=>{r.snapStates[e]=t}))}async clearSnapState(e){this.update((t=>{delete t.snapStates[e]}))}addSnapError(e){this.update((t=>{const r=(0,a.nanoid)();t.snapErrors[r]=Object.assign(Object.assign({},e),{internalID:r})}))}async removeSnapError(e){this.update((t=>{delete t.snapErrors[e]}))}async clearSnapErrors(){this.update((e=>{e.snapErrors={}}))}async getSnapState(e){var t;return null!==(t=this.state.snapStates[e])&&void 0!==t?t:null}clearState(){const e=Object.keys(this.state.snaps);e.forEach((e=>{this._closeAllConnections(e)})),this._terminateAllSnaps(),e.forEach(this.revokeAllSnapPermissions),this.update((e=>{e.snaps={},e.snapStates={}}))}async removeSnap(e){return this.removeSnaps([e])}async removeSnaps(e){if(!Array.isArray(e))throw new Error("Expected array of snap ids.");await Promise.all(e.map((async e=>{await this.disableSnap(e),this.revokeAllSnapPermissions(e);const t=(0,d.getSnapPermissionName)(e);await this.messagingSystem.call("PermissionController:revokePermissionForAllSubjects",t),this._snapsRuntimeData.delete(e),this.update((t=>{delete t.snaps[e],delete t.snapStates[e]})),this.messagingSystem.publish("SnapController:snapRemoved",e)})))}revokeAllSnapPermissions(e){this.messagingSystem.call("PermissionController:hasPermissions",e)&&this.messagingSystem.call("PermissionController:revokeAllPermissions",e)}getPermittedSnaps(e){var t;return Object.values(null!==(t=this.messagingSystem.call("PermissionController:getPermissions",e))&&void 0!==t?t:{}).reduce(((e,t)=>{if(t.parentCapability.startsWith(d.SNAP_PREFIX)){const n=t.parentCapability.replace(r.SNAP_PREFIX_REGEX,""),a=this.getTruncated(n);e[n]=a||{error:(0,i.serializeError)(new Error("Snap permitted but not installed."))}}return e}),{})}async installSnaps(e,t){const r={};return await Promise.all(Object.entries(t).map((async([t,{version:n}])=>{const a=(0,d.resolveVersion)(n),s=(0,d.getSnapPermissionName)(t);(0,d.isValidSnapVersionRange)(a)?this.messagingSystem.call("PermissionController:hasPermission",e,s)?r[t]=Object.assign({},await this.processRequestedSnap(e,t,a)):r[t]={error:i.ethErrors.provider.unauthorized(`Not authorized to install snap "${t}". Request the permission for the snap before attempting to install it.`)}:r[t]={error:i.ethErrors.rpc.invalidParams(`The "version" field must be a valid SemVer version range if specified. Received: "${a}".`)}}))),r}async processRequestedSnap(e,t,r){try{this.validateSnapId(t)}catch(e){return{error:i.ethErrors.rpc.invalidParams(`"${t}" is not a valid snap id.`)}}const n=t,a=this.getTruncated(n);if(a&&(0,d.getSnapPrefix)(n)!==d.SnapIdPrefixes.local){if((0,s.satisfies)(a.version,r))return a;if(!0!==this._featureFlags.dappsCanUpdateSnaps)return{error:i.ethErrors.rpc.invalidParams(`Version mismatch with already installed snap. ${n}@${a.version} doesn't satisfy requested version ${r}`)};try{const t=await this.updateSnap(e,n,r);return null===t?{error:i.ethErrors.rpc.invalidParams(`Snap "${n}@${a.version}" is already installed, couldn't update to a version inside requested "${r}" range.`)}:t}catch(e){return{error:(0,i.serializeError)(e)}}}a&&this.isRunning(n)&&await this.stopSnap(n,y.stop);try{const{sourceCode:t}=await this.add({origin:e,id:n,versionRange:r});return await this.authorize(n),await this._startSnap({snapId:n,sourceCode:t}),this.messagingSystem.publish("SnapController:snapInstalled",n),this.getTruncated(n)}catch(e){return console.error("Error when adding snap.",e),this.has(n)&&this.removeSnap(n),{error:(0,i.serializeError)(e)}}}async updateSnap(e,t,n=d.DEFAULT_REQUESTED_SNAP_VERSION){const i=this.get(t);if(i===undefined)throw new Error(`Could not find snap ${t}. Install the snap before attempting to update it.`);if(!(0,d.isValidSnapVersionRange)(n))throw new Error(`Received invalid Snap version range: "${n}".`);const a=await this._fetchSnap(t,n);if(!(0,s.gt)(a.manifest.version,i.version))return console.warn(`Tried updating snap "${t}" within "${n}" version range, but newer version "${i.version}" is already installed`),null;const{newPermissions:o,unusedPermissions:c,approvedPermissions:l}=await this.calculatePermissionsChange(t,a.manifest.initialPermissions);if(!await this.messagingSystem.call("ApprovalController:addRequest",{origin:e,type:r.SNAP_APPROVAL_UPDATE,requestData:{snapId:t,newVersion:a.manifest.version,newPermissions:o,approvedPermissions:l}},!0))return null;this.isRunning(t)&&this.stopSnap(t,y.stop),this._transitionSnapState(t,y.update),await this._set({origin:e,id:t,manifest:a.manifest,sourceCode:a.sourceCode,versionRange:n});const f=Object.keys(c);return(0,u.isNonEmptyArray)(f)&&this.messagingSystem.call("PermissionController:revokePermissions",{[t]:f}),(0,u.isNonEmptyArray)(Object.keys(o))&&this.messagingSystem.call("PermissionController:grantPermissions",{approvedPermissions:o,subject:{origin:t}}),await this._startSnap({snapId:t,sourceCode:a.sourceCode}),this.messagingSystem.publish("SnapController:snapUpdated",t,a.manifest.version,i.version),this.getTruncated(t)}async add(e){const{id:t}=e;this.validateSnapId(t);const r=t;if(!e||!("origin"in e)||!("id"in e)||!("manifest"in e)&&"sourceCode"in e||"manifest"in e&&!("sourceCode"in e))throw new Error(`Invalid add snap args for snap "${r}".`);const n=this._getSnapRuntimeData(r);n.installPromise||(console.info(`Adding snap: ${r}`),n.installPromise=this._set(e));try{return await n.installPromise}catch(e){throw n.installPromise=null,e}}validateSnapId(e){if(!e||"string"!=typeof e)throw new Error(`Invalid snap id: Not a string. Received "${e}"`);for(const t of Object.values(d.SnapIdPrefixes))if(e.startsWith(t)&&e.replace(t,"").length>0)return;throw new Error(`Invalid snap id. Received: "${e}"`)}async _startSnap(e){const{snapId:t}=e;if(this.isRunning(t))throw new Error(`Snap "${t}" is already started.`);try{const r=await this._executeWithTimeout(t,this._executeSnap(Object.assign(Object.assign({},e),{endowments:await this._getEndowments(t)})));return this._transitionSnapState(t,y.start),r}catch(e){throw await this._terminateSnap(t),e}}async _getEndowments(e){let t=[];for(const r of this._endowmentPermissionNames)if(this.messagingSystem.call("PermissionController:hasPermission",e,r)){const n=await this.messagingSystem.call("PermissionController:getEndowments",e,r);if(n){if(!Array.isArray(n)||n.some((e=>"string"!=typeof e)))throw new Error("Expected an array of string endowment names.");t=t.concat(n)}}const r=[...new Set([...c.DEFAULT_ENDOWMENTS,...t])];return r.length<c.DEFAULT_ENDOWMENTS.length+t.length&&console.error("Duplicate endowments found. Default endowments should not be requested.",t),r}async _set(e){var t;const{id:r,versionRange:n=d.DEFAULT_REQUESTED_SNAP_VERSION,origin:i}=e;let a,o,u;if("manifest"in e?(a=e.manifest,o=e.sourceCode,(0,l.validateSnapJsonFile)(d.NpmSnapFileNames.Manifest,a)):({manifest:a,sourceCode:o,svgIcon:u}=await this._fetchSnap(r,n)),!(0,s.satisfies)(a.version,n))throw new Error(`Version mismatch. Manifest for ${r} specifies version ${a.version} which doesn't satisfy requested version range ${n}`);if("string"!=typeof o||0===o.length)throw new Error(`Invalid source code for snap "${r}".`);const c=null==a?void 0:a.initialPermissions;if(!c||"object"!=typeof c||Array.isArray(c))throw new Error(`Invalid initial permissions for snap "${r}".`);const f=this.state.snaps[r],{version:p}=a,h=[...null!==(t=null==f?void 0:f.versionHistory)&&void 0!==t?t:[],{version:p,date:Date.now(),origin:i}],m=Object.assign(Object.assign({},f),{enabled:!0,id:r,initialPermissions:c,manifest:a,permissionName:(0,d.getSnapPermissionName)(r),sourceCode:o,status:g.initial,version:p,versionHistory:h});return this.update((e=>{e.snaps[r]=m})),this.messagingSystem.publish("SnapController:snapAdded",r,m,u),m}async _fetchSnap(e,t=d.DEFAULT_REQUESTED_SNAP_VERSION){try{const r=(0,d.getSnapPrefix)(e);switch(r){case d.SnapIdPrefixes.local:return this._fetchLocalSnap(e.replace(d.SnapIdPrefixes.local,""));case d.SnapIdPrefixes.npm:return this._fetchNpmSnap(e.replace(d.SnapIdPrefixes.npm,""),t);default:return(0,o.assertExhaustive)(r)}}catch(t){throw new Error(`Failed to fetch Snap "${e}": ${t.message}`)}}async _fetchNpmSnap(e,t){if(!(0,d.isValidSnapVersionRange)(t))throw new Error(`Received invalid Snap version range: "${t}".`);const{manifest:r,sourceCode:n,svgIcon:i}=await(0,d.fetchNpmSnap)(e,t,this._npmRegistryUrl,this._fetchFunction);return{manifest:r,sourceCode:n,svgIcon:i}}async _fetchLocalSnap(e){const t={cache:"no-cache"},r=new URL(d.NpmSnapFileNames.Manifest,e);if(!d.LOCALHOST_HOSTNAMES.has(r.hostname))throw new Error(`Invalid URL: Locally hosted Snaps must be hosted on localhost. Received URL: "${r.toString()}"`);const n=await(await this._fetchFunction(r.toString(),t)).json();(0,l.validateSnapJsonFile)(d.NpmSnapFileNames.Manifest,n);const i=n,{source:{location:{npm:{filePath:a,iconPath:s}}}}=i,[o,u]=await Promise.all([(await this._fetchFunction(new URL(a,e).toString(),t)).text(),s?(await this._fetchFunction(new URL(s,e).toString(),t)).text():undefined]);return(0,d.validateSnapShasum)(i,o),{manifest:i,sourceCode:o,svgIcon:u}}async authorize(e){console.info(`Authorizing snap: ${e}`);const t=this.state.snaps[e],{initialPermissions:r}=t;try{const{newPermissions:t,unusedPermissions:n}=await this.calculatePermissionsChange(e,r),i=Object.keys(n);if((0,u.isNonEmptyArray)(i)&&this.messagingSystem.call("PermissionController:revokePermissions",{[e]:i}),(0,u.isNonEmptyArray)(Object.keys(t))){const[r]=await this.messagingSystem.call("PermissionController:requestPermissions",{origin:e},t);return Object.values(r).map((e=>e.parentCapability))}return[]}finally{this._getSnapRuntimeData(e).installPromise=null}}destroy(){super.destroy(),this._timeoutForLastRequestStatus&&clearTimeout(this._timeoutForLastRequestStatus),this.messagingSystem.unsubscribe("ExecutionService:unhandledError",this._onUnhandledSnapError),this.messagingSystem.unsubscribe("ExecutionService:unresponsive",this._onUnresponsiveSnap)}async getRpcMessageHandler(e){const t=this._getSnapRuntimeData(e),r=null==t?void 0:t.rpcHandler;if(r)return r;const n=new f.RequestQueue(5),a=new Map,s=async(t,r)=>{if(!1===this.state.snaps[e].enabled)throw new Error(`Snap "${e}" is disabled.`);if(this.state.snaps[e].status===m.installing)throw new Error(`Snap "${e}" is currently being installed. Please try again later.`);let s=await this._getRpcMessageHandler(e);if(!1===this.isRunning(e)){if(s)throw new Error("This snap should not have a handler in its current state. This is a bug, please report it.");let r=a.get(e);if(r){if(n.get(t)>=n.maxQueueSize)throw new Error("Exceeds maximum number of requests waiting to be resolved, please try again.")}else r=this.startSnap(e),a.set(e,r);n.increment(t);try{await r}finally{n.decrement(t),a.get(e)===r&&a.delete(e)}s=await this._getRpcMessageHandler(e)}if(!s)throw new Error(`Snap execution service returned no RPC handler for running snap "${e}".`);let o=r;if(Object.hasOwnProperty.call(r,"jsonrpc")){if("2.0"!==r.jsonrpc)throw i.ethErrors.rpc.invalidRequest({message:'Invalid "jsonrpc" property. Must be "2.0" if provided.',data:r.jsonrpc})}else o=Object.assign(Object.assign({},r),{jsonrpc:"2.0"});this._recordSnapRpcRequestStart(e);const u=await this._executeWithTimeout(e,s(t,o));return this._recordSnapRpcRequestFinish(e),u};return t.rpcHandler=s,s}async _executeWithTimeout(e,t){let r;const n=new Promise(((t,n)=>{r=setTimeout((()=>{this.stopSnap(e,y.stop),n(new Error("The request timed out."))}),this._maxRequestTime)})),i=await Promise.race([t,n]);return clearTimeout(r),i}_recordSnapRpcRequestStart(e){const t=this._getSnapRuntimeData(e);t.pendingRequests+=1,t.lastRequest=null}_recordSnapRpcRequestFinish(e){const t=this._getSnapRuntimeData(e);t.pendingRequests-=1,0===t.pendingRequests&&(t.lastRequest=Date.now())}_getSnapRuntimeData(e){return this._snapsRuntimeData.has(e)||this._snapsRuntimeData.set(e,{lastRequest:null,rpcHandler:null,installPromise:null,pendingRequests:0}),this._snapsRuntimeData.get(e)}async calculatePermissionsChange(e,t){var r;const n=null!==(r=await this.messagingSystem.call("PermissionController:getPermissions",e))&&void 0!==r?r:{},i=(0,u.setDiff)(t,n),a=(0,u.setDiff)(n,t);return{newPermissions:i,unusedPermissions:a,approvedPermissions:(0,u.setDiff)(n,a)}}}r.SnapController=v}}},{package:"@metamask/snap-controllers"}],[1334,{},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.DEFAULT_ENDOWMENTS=void 0,r.DEFAULT_ENDOWMENTS=Object.freeze(["atob","btoa","BigInt","Buffer","console","crypto","Date","Math","setTimeout","clearTimeout","SubtleCrypto","TextDecoder","TextEncoder","URL","WebAssembly","setInterval","clearInterval"])}}},{package:"@metamask/snap-controllers"}],[1335,{"./SnapController":1333,"./default-endowments":1334,"./json-schemas":1336,"./utils":1339},function(){with(this)return function(){"use strict";return function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){n===undefined&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){n===undefined&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),i(e("./SnapController"),r),i(e("./json-schemas"),r),i(e("./utils"),r),i(e("./default-endowments"),r)}}},{package:"@metamask/snap-controllers"}],[1336,{"../utils":1339,"./validateNpmSnapPackageJson.js":1337,"./validateSnapManifest.js":1338},function(){with(this)return function(){"use strict";return function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.validateSnapJsonFile=void 0;const i=n(e("./validateNpmSnapPackageJson.js")),a=n(e("./validateSnapManifest.js")),s=e("../utils");r.validateSnapJsonFile=function(e,t){let r;switch(e){case s.NpmSnapFileNames.Manifest:t&&"object"==typeof t&&!Array.isArray(t)&&t.repository===undefined&&(t.repository=null),r=(0,a.default)(t);break;case s.NpmSnapFileNames.PackageJson:r=(0,i.default)(t);break;default:throw new Error(`Unrecognized file name "${e}".`)}if(r&&0!==r.length)throw new Error(`${r.reduce(((e,t={})=>{const{instancePath:r,message:n="unknown error"}=t;return`${e}${r?`\t${r}\n\t${n}\n\n`:`\t${n}\n\n`}`}),"").replace(/\n$/u,"")}`)}}}},{package:"@metamask/snap-controllers"}],[1337,{"ajv/dist/runtime/equal":1347,"ajv/dist/runtime/ucs2length":1348},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=o,t.exports.default=o;const n={title:"npm Snap package.json",type:"object",required:["version","name"],properties:{version:{type:"string",title:"Version",pattern:"^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-((?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\\+([0-9a-zA-Z-]+(?:\\.[0-9a-zA-Z-]+)*))?$"},name:{type:"string",title:"Package Name",minLength:1,maxLength:214,pattern:"^(?:@[a-z0-9-*~][a-z0-9-*._~]*/)?[a-z0-9-~][a-z0-9-._~]*$"},private:{type:"boolean",title:"Private"},main:{type:"string",title:"Main",minLength:1},publishConfig:{type:"object",title:"Publish Config",required:["registry"],properties:{access:{type:"string",minLength:1},registry:{type:"string",enum:["https://registry.npmjs.org","https://registry.npmjs.org/"]}}},repository:{type:"object",title:"Repository",additionalProperties:!1,required:["type","url"],properties:{type:{type:"string",minLength:1},url:{type:"string",minLength:1}}}}},i=new RegExp("^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-((?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\\+([0-9a-zA-Z-]+(?:\\.[0-9a-zA-Z-]+)*))?$","u"),a=new RegExp("^(?:@[a-z0-9-*~][a-z0-9-*._~]*/)?[a-z0-9-~][a-z0-9-._~]*$","u"),s=e("ajv/dist/runtime/ucs2length").default;e("ajv/dist/runtime/equal").default;function o(e,{instancePath:t="",parentData:r,parentDataProperty:u,rootData:c=e}={}){let l=null;if(e&&"object"==typeof e&&!Array.isArray(e)){if(e.version===undefined){const e={instancePath:t,schemaPath:"#/required",keyword:"required",params:{missingProperty:"version"},message:"must have required property '"+"version"+"'"};null===l?l=[e]:l.push(e)}if(e.name===undefined){const e={instancePath:t,schemaPath:"#/required",keyword:"required",params:{missingProperty:"name"},message:"must have required property '"+"name"+"'"};null===l?l=[e]:l.push(e)}if(e.version!==undefined){let r=e.version;if("string"==typeof r){if(!i.test(r)){const e={instancePath:t+"/version",schemaPath:"#/properties/version/pattern",keyword:"pattern",params:{pattern:"^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-((?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\\+([0-9a-zA-Z-]+(?:\\.[0-9a-zA-Z-]+)*))?$"},message:'must match pattern "'+"^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-((?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\\+([0-9a-zA-Z-]+(?:\\.[0-9a-zA-Z-]+)*))?$"+'"'};null===l?l=[e]:l.push(e)}}else{const e={instancePath:t+"/version",schemaPath:"#/properties/version/type",keyword:"type",params:{type:"string"},message:"must be string"};null===l?l=[e]:l.push(e)}}if(e.name!==undefined){let r=e.name;if("string"==typeof r){if(s(r)>214){const e={instancePath:t+"/name",schemaPath:"#/properties/name/maxLength",keyword:"maxLength",params:{limit:214},message:"must NOT have more than 214 characters"};null===l?l=[e]:l.push(e)}if(s(r)<1){const e={instancePath:t+"/name",schemaPath:"#/properties/name/minLength",keyword:"minLength",params:{limit:1},message:"must NOT have fewer than 1 characters"};null===l?l=[e]:l.push(e)}if(!a.test(r)){const e={instancePath:t+"/name",schemaPath:"#/properties/name/pattern",keyword:"pattern",params:{pattern:"^(?:@[a-z0-9-*~][a-z0-9-*._~]*/)?[a-z0-9-~][a-z0-9-._~]*$"},message:'must match pattern "'+"^(?:@[a-z0-9-*~][a-z0-9-*._~]*/)?[a-z0-9-~][a-z0-9-._~]*$"+'"'};null===l?l=[e]:l.push(e)}}else{const e={instancePath:t+"/name",schemaPath:"#/properties/name/type",keyword:"type",params:{type:"string"},message:"must be string"};null===l?l=[e]:l.push(e)}}if(e.private!==undefined&&"boolean"!=typeof e.private){const e={instancePath:t+"/private",schemaPath:"#/properties/private/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"};null===l?l=[e]:l.push(e)}if(e.main!==undefined){let r=e.main;if("string"==typeof r){if(s(r)<1){const e={instancePath:t+"/main",schemaPath:"#/properties/main/minLength",keyword:"minLength",params:{limit:1},message:"must NOT have fewer than 1 characters"};null===l?l=[e]:l.push(e)}}else{const e={instancePath:t+"/main",schemaPath:"#/properties/main/type",keyword:"type",params:{type:"string"},message:"must be string"};null===l?l=[e]:l.push(e)}}if(e.publishConfig!==undefined){let r=e.publishConfig;if(r&&"object"==typeof r&&!Array.isArray(r)){if(r.registry===undefined){const e={instancePath:t+"/publishConfig",schemaPath:"#/properties/publishConfig/required",keyword:"required",params:{missingProperty:"registry"},message:"must have required property '"+"registry"+"'"};null===l?l=[e]:l.push(e)}if(r.access!==undefined){let e=r.access;if("string"==typeof e){if(s(e)<1){const e={instancePath:t+"/publishConfig/access",schemaPath:"#/properties/publishConfig/properties/access/minLength",keyword:"minLength",params:{limit:1},message:"must NOT have fewer than 1 characters"};null===l?l=[e]:l.push(e)}}else{const e={instancePath:t+"/publishConfig/access",schemaPath:"#/properties/publishConfig/properties/access/type",keyword:"type",params:{type:"string"},message:"must be string"};null===l?l=[e]:l.push(e)}}if(r.registry!==undefined){let e=r.registry;if("string"!=typeof e){const e={instancePath:t+"/publishConfig/registry",schemaPath:"#/properties/publishConfig/properties/registry/type",keyword:"type",params:{type:"string"},message:"must be string"};null===l?l=[e]:l.push(e)}if("https://registry.npmjs.org"!==e&&"https://registry.npmjs.org/"!==e){const e={instancePath:t+"/publishConfig/registry",schemaPath:"#/properties/publishConfig/properties/registry/enum",keyword:"enum",params:{allowedValues:n.properties.publishConfig.properties.registry.enum},message:"must be equal to one of the allowed values"};null===l?l=[e]:l.push(e)}}}else{const e={instancePath:t+"/publishConfig",schemaPath:"#/properties/publishConfig/type",keyword:"type",params:{type:"object"},message:"must be object"};null===l?l=[e]:l.push(e)}}if(e.repository!==undefined){let r=e.repository;if(r&&"object"==typeof r&&!Array.isArray(r)){if(r.type===undefined){const e={instancePath:t+"/repository",schemaPath:"#/properties/repository/required",keyword:"required",params:{missingProperty:"type"},message:"must have required property '"+"type"+"'"};null===l?l=[e]:l.push(e)}if(r.url===undefined){const e={instancePath:t+"/repository",schemaPath:"#/properties/repository/required",keyword:"required",params:{missingProperty:"url"},message:"must have required property '"+"url"+"'"};null===l?l=[e]:l.push(e)}for(const e in r)if("type"!==e&&"url"!==e){const r={instancePath:t+"/repository",schemaPath:"#/properties/repository/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:e},message:"must NOT have additional properties"};null===l?l=[r]:l.push(r)}if(r.type!==undefined){let e=r.type;if("string"==typeof e){if(s(e)<1){const e={instancePath:t+"/repository/type",schemaPath:"#/properties/repository/properties/type/minLength",keyword:"minLength",params:{limit:1},message:"must NOT have fewer than 1 characters"};null===l?l=[e]:l.push(e)}}else{const e={instancePath:t+"/repository/type",schemaPath:"#/properties/repository/properties/type/type",keyword:"type",params:{type:"string"},message:"must be string"};null===l?l=[e]:l.push(e)}}if(r.url!==undefined){let e=r.url;if("string"==typeof e){if(s(e)<1){const e={instancePath:t+"/repository/url",schemaPath:"#/properties/repository/properties/url/minLength",keyword:"minLength",params:{limit:1},message:"must NOT have fewer than 1 characters"};null===l?l=[e]:l.push(e)}}else{const e={instancePath:t+"/repository/url",schemaPath:"#/properties/repository/properties/url/type",keyword:"type",params:{type:"string"},message:"must be string"};null===l?l=[e]:l.push(e)}}}else{const e={instancePath:t+"/repository",schemaPath:"#/properties/repository/type",keyword:"type",params:{type:"object"},message:"must be object"};null===l?l=[e]:l.push(e)}}}else{const e={instancePath:t,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"};null===l?l=[e]:l.push(e)}return o.errors=l,l}}}},{package:"@metamask/snap-controllers"}],[1338,{"ajv/dist/runtime/equal":1347,"ajv/dist/runtime/ucs2length":1348},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=c,t.exports.default=c;const n={title:"Snap Manifest",description:"The Snap manifest file MUST be named `snap.manifest.json` and located in the package root directory.",type:"object",additionalProperties:!1,required:["version","description","proposedName","source","initialPermissions","manifestVersion"],properties:{version:{type:"string",title:"Version",description:"MUST be a valid SemVer version string and equal to the corresponding `package.json` field.",pattern:"^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-((?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\\+([0-9a-zA-Z-]+(?:\\.[0-9a-zA-Z-]+)*))?$"},description:{type:"string",title:"Description",description:"MUST be a non-empty string less than or equal to 280 characters. A short description of the Snap.",minLength:1,maxLength:280},proposedName:{type:"string",title:"Proposed Name",description:"MUST be a string less than or equal to 214 characters. The Snap author's proposed name for the Snap. The Snap host application may display this name unmodified in its user interface. The proposed name SHOULD be human-readable.",minLength:1,maxLength:214,pattern:"^(?:[A-Za-z0-9-_]+( [A-Za-z0-9-_]+)*)|(?:(?:@[A-Za-z0-9-*~][A-Za-z0-9-*._~]*/)?[A-Za-z0-9-~][A-Za-z0-9-._~]*)$"},repository:{title:"Repository",description:"MAY be omitted. If present, MUST be equal to the corresponding package.json field.",oneOf:[{type:"null"},{type:"object",additionalProperties:!1,required:["type","url"],properties:{type:{type:"string",minLength:1},url:{type:"string",minLength:1}}}]},source:{type:"object",title:"Source",description:"Specifies some Snap metadata and where to fetch the Snap during installation.",additionalProperties:!1,required:["shasum","location"],properties:{shasum:{type:"string",description:"MUST be the Base64-encoded string representation of the SHA-256 hash of the Snap source file.",minLength:44,maxLength:44,pattern:"^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{3}=|[A-Za-z0-9+/]{2}==)?$"},location:{title:"Source Location",type:"object",additionalProperties:!1,required:["npm"],properties:{npm:{title:"npm",type:"object",additionalProperties:!1,required:["filePath","packageName","registry"],properties:{filePath:{type:"string",title:"File Path",description:"The path to the Snap bundle file from the project root directory.",minLength:1},iconPath:{type:"string",title:"Icon Path",description:"The path to an .svg file from the project root directory.",pattern:"\\w+\\.svg$"},packageName:{type:"string",title:"Package Name",description:"The Snap's npm package name.",minLength:1},registry:{type:"string",title:"npm Registry",description:"The npm registry URL.",enum:["https://registry.npmjs.org","https://registry.npmjs.org/"]}}}}}}},initialPermissions:{type:"object",title:"Initial Permissions",description:"MUST be a valid EIP-2255 wallet_requestPermissions parameter object, specifying the initial permissions that will be requested when the Snap is added to the host application."},manifestVersion:{type:"string",title:"Manifest Version",description:"The Snap manifest specification version targeted by the manifest.",enum:["0.1"]}}},i=new RegExp("^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-((?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\\+([0-9a-zA-Z-]+(?:\\.[0-9a-zA-Z-]+)*))?$","u"),a=new RegExp("^(?:[A-Za-z0-9-_]+( [A-Za-z0-9-_]+)*)|(?:(?:@[A-Za-z0-9-*~][A-Za-z0-9-*._~]*/)?[A-Za-z0-9-~][A-Za-z0-9-._~]*)$","u"),s=new RegExp("^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{3}=|[A-Za-z0-9+/]{2}==)?$","u"),o=new RegExp("\\w+\\.svg$","u"),u=e("ajv/dist/runtime/ucs2length").default;e("ajv/dist/runtime/equal").default;function c(e,{instancePath:t="",parentData:r,parentDataProperty:l,rootData:f=e}={}){let d=null,p=0;if(e&&"object"==typeof e&&!Array.isArray(e)){if(e.version===undefined){const e={instancePath:t,schemaPath:"#/required",keyword:"required",params:{missingProperty:"version"},message:"must have required property '"+"version"+"'"};null===d?d=[e]:d.push(e),p++}if(e.description===undefined){const e={instancePath:t,schemaPath:"#/required",keyword:"required",params:{missingProperty:"description"},message:"must have required property '"+"description"+"'"};null===d?d=[e]:d.push(e),p++}if(e.proposedName===undefined){const e={instancePath:t,schemaPath:"#/required",keyword:"required",params:{missingProperty:"proposedName"},message:"must have required property '"+"proposedName"+"'"};null===d?d=[e]:d.push(e),p++}if(e.source===undefined){const e={instancePath:t,schemaPath:"#/required",keyword:"required",params:{missingProperty:"source"},message:"must have required property '"+"source"+"'"};null===d?d=[e]:d.push(e),p++}if(e.initialPermissions===undefined){const e={instancePath:t,schemaPath:"#/required",keyword:"required",params:{missingProperty:"initialPermissions"},message:"must have required property '"+"initialPermissions"+"'"};null===d?d=[e]:d.push(e),p++}if(e.manifestVersion===undefined){const e={instancePath:t,schemaPath:"#/required",keyword:"required",params:{missingProperty:"manifestVersion"},message:"must have required property '"+"manifestVersion"+"'"};null===d?d=[e]:d.push(e),p++}for(const r in e)if("version"!==r&&"description"!==r&&"proposedName"!==r&&"repository"!==r&&"source"!==r&&"initialPermissions"!==r&&"manifestVersion"!==r){const e={instancePath:t,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:r},message:"must NOT have additional properties"};null===d?d=[e]:d.push(e),p++}if(e.version!==undefined){let r=e.version;if("string"==typeof r){if(!i.test(r)){const e={instancePath:t+"/version",schemaPath:"#/properties/version/pattern",keyword:"pattern",params:{pattern:"^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-((?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\\+([0-9a-zA-Z-]+(?:\\.[0-9a-zA-Z-]+)*))?$"},message:'must match pattern "'+"^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-((?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\\+([0-9a-zA-Z-]+(?:\\.[0-9a-zA-Z-]+)*))?$"+'"'};null===d?d=[e]:d.push(e),p++}}else{const e={instancePath:t+"/version",schemaPath:"#/properties/version/type",keyword:"type",params:{type:"string"},message:"must be string"};null===d?d=[e]:d.push(e),p++}}if(e.description!==undefined){let r=e.description;if("string"==typeof r){if(u(r)>280){const e={instancePath:t+"/description",schemaPath:"#/properties/description/maxLength",keyword:"maxLength",params:{limit:280},message:"must NOT have more than 280 characters"};null===d?d=[e]:d.push(e),p++}if(u(r)<1){const e={instancePath:t+"/description",schemaPath:"#/properties/description/minLength",keyword:"minLength",params:{limit:1},message:"must NOT have fewer than 1 characters"};null===d?d=[e]:d.push(e),p++}}else{const e={instancePath:t+"/description",schemaPath:"#/properties/description/type",keyword:"type",params:{type:"string"},message:"must be string"};null===d?d=[e]:d.push(e),p++}}if(e.proposedName!==undefined){let r=e.proposedName;if("string"==typeof r){if(u(r)>214){const e={instancePath:t+"/proposedName",schemaPath:"#/properties/proposedName/maxLength",keyword:"maxLength",params:{limit:214},message:"must NOT have more than 214 characters"};null===d?d=[e]:d.push(e),p++}if(u(r)<1){const e={instancePath:t+"/proposedName",schemaPath:"#/properties/proposedName/minLength",keyword:"minLength",params:{limit:1},message:"must NOT have fewer than 1 characters"};null===d?d=[e]:d.push(e),p++}if(!a.test(r)){const e={instancePath:t+"/proposedName",schemaPath:"#/properties/proposedName/pattern",keyword:"pattern",params:{pattern:"^(?:[A-Za-z0-9-_]+( [A-Za-z0-9-_]+)*)|(?:(?:@[A-Za-z0-9-*~][A-Za-z0-9-*._~]*/)?[A-Za-z0-9-~][A-Za-z0-9-._~]*)$"},message:'must match pattern "'+"^(?:[A-Za-z0-9-_]+( [A-Za-z0-9-_]+)*)|(?:(?:@[A-Za-z0-9-*~][A-Za-z0-9-*._~]*/)?[A-Za-z0-9-~][A-Za-z0-9-._~]*)$"+'"'};null===d?d=[e]:d.push(e),p++}}else{const e={instancePath:t+"/proposedName",schemaPath:"#/properties/proposedName/type",keyword:"type",params:{type:"string"},message:"must be string"};null===d?d=[e]:d.push(e),p++}}if(e.repository!==undefined){let r=e.repository;const n=p;let i=!1,a=null;const s=p;if(null!==r){const e={instancePath:t+"/repository",schemaPath:"#/properties/repository/oneOf/0/type",keyword:"type",params:{type:"null"},message:"must be null"};null===d?d=[e]:d.push(e),p++}(h=s===p)&&(i=!0,a=0);const o=p;if(r&&"object"==typeof r&&!Array.isArray(r)){if(r.type===undefined){const e={instancePath:t+"/repository",schemaPath:"#/properties/repository/oneOf/1/required",keyword:"required",params:{missingProperty:"type"},message:"must have required property '"+"type"+"'"};null===d?d=[e]:d.push(e),p++}if(r.url===undefined){const e={instancePath:t+"/repository",schemaPath:"#/properties/repository/oneOf/1/required",keyword:"required",params:{missingProperty:"url"},message:"must have required property '"+"url"+"'"};null===d?d=[e]:d.push(e),p++}for(const e in r)if("type"!==e&&"url"!==e){const r={instancePath:t+"/repository",schemaPath:"#/properties/repository/oneOf/1/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:e},message:"must NOT have additional properties"};null===d?d=[r]:d.push(r),p++}if(r.type!==undefined){let e=r.type;if("string"==typeof e){if(u(e)<1){const e={instancePath:t+"/repository/type",schemaPath:"#/properties/repository/oneOf/1/properties/type/minLength",keyword:"minLength",params:{limit:1},message:"must NOT have fewer than 1 characters"};null===d?d=[e]:d.push(e),p++}}else{const e={instancePath:t+"/repository/type",schemaPath:"#/properties/repository/oneOf/1/properties/type/type",keyword:"type",params:{type:"string"},message:"must be string"};null===d?d=[e]:d.push(e),p++}}if(r.url!==undefined){let e=r.url;if("string"==typeof e){if(u(e)<1){const e={instancePath:t+"/repository/url",schemaPath:"#/properties/repository/oneOf/1/properties/url/minLength",keyword:"minLength",params:{limit:1},message:"must NOT have fewer than 1 characters"};null===d?d=[e]:d.push(e),p++}}else{const e={instancePath:t+"/repository/url",schemaPath:"#/properties/repository/oneOf/1/properties/url/type",keyword:"type",params:{type:"string"},message:"must be string"};null===d?d=[e]:d.push(e),p++}}}else{const e={instancePath:t+"/repository",schemaPath:"#/properties/repository/oneOf/1/type",keyword:"type",params:{type:"object"},message:"must be object"};null===d?d=[e]:d.push(e),p++}var h;if((h=o===p)&&i?(i=!1,a=[a,1]):h&&(i=!0,a=1),i)p=n,null!==d&&(n?d.length=n:d=null);else{const e={instancePath:t+"/repository",schemaPath:"#/properties/repository/oneOf",keyword:"oneOf",params:{passingSchemas:a},message:"must match exactly one schema in oneOf"};null===d?d=[e]:d.push(e),p++}}if(e.source!==undefined){let r=e.source;if(r&&"object"==typeof r&&!Array.isArray(r)){if(r.shasum===undefined){const e={instancePath:t+"/source",schemaPath:"#/properties/source/required",keyword:"required",params:{missingProperty:"shasum"},message:"must have required property '"+"shasum"+"'"};null===d?d=[e]:d.push(e),p++}if(r.location===undefined){const e={instancePath:t+"/source",schemaPath:"#/properties/source/required",keyword:"required",params:{missingProperty:"location"},message:"must have required property '"+"location"+"'"};null===d?d=[e]:d.push(e),p++}for(const e in r)if("shasum"!==e&&"location"!==e){const r={instancePath:t+"/source",schemaPath:"#/properties/source/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:e},message:"must NOT have additional properties"};null===d?d=[r]:d.push(r),p++}if(r.shasum!==undefined){let e=r.shasum;if("string"==typeof e){if(u(e)>44){const e={instancePath:t+"/source/shasum",schemaPath:"#/properties/source/properties/shasum/maxLength",keyword:"maxLength",params:{limit:44},message:"must NOT have more than 44 characters"};null===d?d=[e]:d.push(e),p++}if(u(e)<44){const e={instancePath:t+"/source/shasum",schemaPath:"#/properties/source/properties/shasum/minLength",keyword:"minLength",params:{limit:44},message:"must NOT have fewer than 44 characters"};null===d?d=[e]:d.push(e),p++}if(!s.test(e)){const e={instancePath:t+"/source/shasum",schemaPath:"#/properties/source/properties/shasum/pattern",keyword:"pattern",params:{pattern:"^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{3}=|[A-Za-z0-9+/]{2}==)?$"},message:'must match pattern "'+"^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{3}=|[A-Za-z0-9+/]{2}==)?$"+'"'};null===d?d=[e]:d.push(e),p++}}else{const e={instancePath:t+"/source/shasum",schemaPath:"#/properties/source/properties/shasum/type",keyword:"type",params:{type:"string"},message:"must be string"};null===d?d=[e]:d.push(e),p++}}if(r.location!==undefined){let e=r.location;if(e&&"object"==typeof e&&!Array.isArray(e)){if(e.npm===undefined){const e={instancePath:t+"/source/location",schemaPath:"#/properties/source/properties/location/required",keyword:"required",params:{missingProperty:"npm"},message:"must have required property '"+"npm"+"'"};null===d?d=[e]:d.push(e),p++}for(const r in e)if("npm"!==r){const e={instancePath:t+"/source/location",schemaPath:"#/properties/source/properties/location/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:r},message:"must NOT have additional properties"};null===d?d=[e]:d.push(e),p++}if(e.npm!==undefined){let r=e.npm;if(r&&"object"==typeof r&&!Array.isArray(r)){if(r.filePath===undefined){const e={instancePath:t+"/source/location/npm",schemaPath:"#/properties/source/properties/location/properties/npm/required",keyword:"required",params:{missingProperty:"filePath"},message:"must have required property '"+"filePath"+"'"};null===d?d=[e]:d.push(e),p++}if(r.packageName===undefined){const e={instancePath:t+"/source/location/npm",schemaPath:"#/properties/source/properties/location/properties/npm/required",keyword:"required",params:{missingProperty:"packageName"},message:"must have required property '"+"packageName"+"'"};null===d?d=[e]:d.push(e),p++}if(r.registry===undefined){const e={instancePath:t+"/source/location/npm",schemaPath:"#/properties/source/properties/location/properties/npm/required",keyword:"required",params:{missingProperty:"registry"},message:"must have required property '"+"registry"+"'"};null===d?d=[e]:d.push(e),p++}for(const e in r)if("filePath"!==e&&"iconPath"!==e&&"packageName"!==e&&"registry"!==e){const r={instancePath:t+"/source/location/npm",schemaPath:"#/properties/source/properties/location/properties/npm/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:e},message:"must NOT have additional properties"};null===d?d=[r]:d.push(r),p++}if(r.filePath!==undefined){let e=r.filePath;if("string"==typeof e){if(u(e)<1){const e={instancePath:t+"/source/location/npm/filePath",schemaPath:"#/properties/source/properties/location/properties/npm/properties/filePath/minLength",keyword:"minLength",params:{limit:1},message:"must NOT have fewer than 1 characters"};null===d?d=[e]:d.push(e),p++}}else{const e={instancePath:t+"/source/location/npm/filePath",schemaPath:"#/properties/source/properties/location/properties/npm/properties/filePath/type",keyword:"type",params:{type:"string"},message:"must be string"};null===d?d=[e]:d.push(e),p++}}if(r.iconPath!==undefined){let e=r.iconPath;if("string"==typeof e){if(!o.test(e)){const e={instancePath:t+"/source/location/npm/iconPath",schemaPath:"#/properties/source/properties/location/properties/npm/properties/iconPath/pattern",keyword:"pattern",params:{pattern:"\\w+\\.svg$"},message:'must match pattern "'+"\\w+\\.svg$"+'"'};null===d?d=[e]:d.push(e),p++}}else{const e={instancePath:t+"/source/location/npm/iconPath",schemaPath:"#/properties/source/properties/location/properties/npm/properties/iconPath/type",keyword:"type",params:{type:"string"},message:"must be string"};null===d?d=[e]:d.push(e),p++}}if(r.packageName!==undefined){let e=r.packageName;if("string"==typeof e){if(u(e)<1){const e={instancePath:t+"/source/location/npm/packageName",schemaPath:"#/properties/source/properties/location/properties/npm/properties/packageName/minLength",keyword:"minLength",params:{limit:1},message:"must NOT have fewer than 1 characters"};null===d?d=[e]:d.push(e),p++}}else{const e={instancePath:t+"/source/location/npm/packageName",schemaPath:"#/properties/source/properties/location/properties/npm/properties/packageName/type",keyword:"type",params:{type:"string"},message:"must be string"};null===d?d=[e]:d.push(e),p++}}if(r.registry!==undefined){let e=r.registry;if("string"!=typeof e){const e={instancePath:t+"/source/location/npm/registry",schemaPath:"#/properties/source/properties/location/properties/npm/properties/registry/type",keyword:"type",params:{type:"string"},message:"must be string"};null===d?d=[e]:d.push(e),p++}if("https://registry.npmjs.org"!==e&&"https://registry.npmjs.org/"!==e){const e={instancePath:t+"/source/location/npm/registry",schemaPath:"#/properties/source/properties/location/properties/npm/properties/registry/enum",keyword:"enum",params:{allowedValues:n.properties.source.properties.location.properties.npm.properties.registry.enum},message:"must be equal to one of the allowed values"};null===d?d=[e]:d.push(e),p++}}}else{const e={instancePath:t+"/source/location/npm",schemaPath:"#/properties/source/properties/location/properties/npm/type",keyword:"type",params:{type:"object"},message:"must be object"};null===d?d=[e]:d.push(e),p++}}}else{const e={instancePath:t+"/source/location",schemaPath:"#/properties/source/properties/location/type",keyword:"type",params:{type:"object"},message:"must be object"};null===d?d=[e]:d.push(e),p++}}}else{const e={instancePath:t+"/source",schemaPath:"#/properties/source/type",keyword:"type",params:{type:"object"},message:"must be object"};null===d?d=[e]:d.push(e),p++}}if(e.initialPermissions!==undefined){let r=e.initialPermissions;if(!r||"object"!=typeof r||Array.isArray(r)){const e={instancePath:t+"/initialPermissions",schemaPath:"#/properties/initialPermissions/type",keyword:"type",params:{type:"object"},message:"must be object"};null===d?d=[e]:d.push(e),p++}}if(e.manifestVersion!==undefined){let r=e.manifestVersion;if("string"!=typeof r){const e={instancePath:t+"/manifestVersion",schemaPath:"#/properties/manifestVersion/type",keyword:"type",params:{type:"string"},message:"must be string"};null===d?d=[e]:d.push(e),p++}if("0.1"!==r){const e={instancePath:t+"/manifestVersion",schemaPath:"#/properties/manifestVersion/enum",keyword:"enum",params:{allowedValues:n.properties.manifestVersion.enum},message:"must be equal to one of the allowed values"};null===d?d=[e]:d.push(e),p++}}}else{const e={instancePath:t,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"};null===d?d=[e]:d.push(e),p++}return c.errors=d,d}}}},{package:"@metamask/snap-controllers"}],[1339,{"../utils":1340,"./json-schemas":1336,buffer:1996,"concat-stream":1349,crypto:2106,"fast-deep-equal":4209,"gunzip-maybe":4249,pump:5441,"readable-web-to-node-stream":5625,semver:5702,"tar-stream":5834},function(){with(this)return function(){"use strict";return function(e,t,r){(function(t){(function(){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.getSnapPermissionName=r.SNAP_PREFIX=r.getSnapPrefix=r.isValidSnapVersionRange=r.resolveVersion=r.validateSnapShasum=r.validateNpmSnapManifest=r.validateNpmSnap=r.ProgrammaticallyFixableSnapError=r.SnapValidationFailureReason=r.fetchNpmSnap=r.getSnapSourceShasum=r.PROPOSED_NAME_REGEX=r.DEFAULT_REQUESTED_SNAP_VERSION=r.DEFAULT_NPM_REGISTRY=r.LOCALHOST_HOSTNAMES=r.NpmSnapFileNames=r.SnapIdPrefixes=void 0;const i=e("crypto"),a=n(e("concat-stream")),s=n(e("fast-deep-equal")),o=n(e("gunzip-maybe")),u=n(e("pump")),c=e("readable-web-to-node-stream"),l=e("semver"),f=e("tar-stream"),d=e("../utils"),p=e("./json-schemas");var h,m;!function(e){e.npm="npm:",e.local="local:"}(h=r.SnapIdPrefixes||(r.SnapIdPrefixes={})),function(e){e.PackageJson="package.json",e.Manifest="snap.manifest.json"}(m=r.NpmSnapFileNames||(r.NpmSnapFileNames={})),r.LOCALHOST_HOSTNAMES=new Set(["localhost","127.0.0.1","::1"]),r.DEFAULT_NPM_REGISTRY="https://registry.npmjs.org",r.DEFAULT_REQUESTED_SNAP_VERSION="*";const y=1e5,b=`${Math.floor(100)}kb`;function g(e){return(0,i.createHash)("sha256").update(e,"utf8").digest("base64")}r.PROPOSED_NAME_REGEX=/^(?:[A-Za-z0-9-_]+( [A-Za-z0-9-_]+)*)|(?:(?:@[A-Za-z0-9-*~][A-Za-z0-9-*._~]*\/)?[A-Za-z0-9-~][A-Za-z0-9-._~]*)$/u,r.getSnapSourceShasum=g;const v=["manifest","packageJson","sourceCode"],w={manifest:m.Manifest,packageJson:m.PackageJson,sourceCode:"source code bundle"};var _;r.fetchNpmSnap=async function(e,t,n=r.DEFAULT_NPM_REGISTRY,i=fetch){const[s,p]=await async function(e,t,n=r.DEFAULT_NPM_REGISTRY,i=fetch){var a,s,o,u;const c=await(await i(new URL(e,n).toString())).json();if(!(0,d.isPlainObject)(c))throw new Error(`Failed to fetch package "${e}" metadata from npm.`);const f=(0,l.maxSatisfying)(Object.keys(null!==(a=null==c?void 0:c.versions)&&void 0!==a?a:{}),t);if(null===f)throw new Error(`Failed to find a matching version in npm metadata for package "${e}" and requested semver range "${t}"`);const p=null===(u=null===(o=null===(s=c.versions)||void 0===s?void 0:s[f])||void 0===o?void 0:o.dist)||void 0===u?void 0:u.tarball;if(!function(e){try{return Boolean(new URL(e))}catch(e){return!1}}(p)||!p.endsWith(".tgz"))throw new Error(`Failed to find valid tarball URL in npm metadata for package "${e}".`);const h=new URL(n),m=new URL(p);m.hostname=h.hostname,m.protocol=h.protocol;const y=await i(m.toString());if(!y.ok)throw new Error(`Failed to fetch tarball for package "${e}".`);return[await y.blob().then((e=>e.stream())),f]}(e,t,n,i),h={};return await new Promise(((e,t)=>{(0,u.default)(function(e){if("function"!=typeof e.getReader)return e;return new c.ReadableWebToNodeStream(e)}(s),(0,o.default)(),function(e){const t=(0,f.extract)(),r=new Map;return t.on("entry",((n,i,s)=>{const{name:o,type:u}=n;if("file"===u){const n=o.replace(E,"");if(n===m.PackageJson)return i.pipe((0,a.default)((r=>{try{e.packageJson=JSON.parse(r.toString())}catch(e){return t.destroy(new Error(`Failed to parse "${m.PackageJson}".`))}return s()})));if(n===m.Manifest)return i.pipe((0,a.default)((r=>{try{e.manifest=JSON.parse(r.toString())}catch(e){return t.destroy(new Error(`Failed to parse "${m.Manifest}".`))}return s()})));if(/\w+\.(?:js|svg)$/u.test(n))return i.pipe((0,a.default)((e=>(r.set(n,e),s()))))}return i.on("end",(()=>s())),i.resume()})),t.on("finish",(()=>{var t,n,i,a,s;if((0,d.isPlainObject)(e.manifest)){const{filePath:o,iconPath:u}=null!==(i=null===(n=null===(t=e.manifest.source)||void 0===t?void 0:t.location)||void 0===n?void 0:n.npm)&&void 0!==i?i:{};o&&(e.sourceCode=null===(a=r.get(o))||void 0===a?void 0:a.toString("utf8")),"string"==typeof u&&u.endsWith(".svg")&&(e.svgIcon=null===(s=r.get(u))||void 0===s?void 0:s.toString("utf8"))}r.clear()})),t}(h),(r=>{r?t(r):e()}))})),S(h,`npm Snap "${e}@${p}" validation error: `)},function(e){e.NameMismatch='"name" field mismatch',e.VersionMismatch='"version" field mismatch',e.RepositoryMismatch='"repository" field mismatch',e.ShasumMismatch='"shasum" field mismatch'}(_=r.SnapValidationFailureReason||(r.SnapValidationFailureReason={}));class k extends Error{constructor(e,t){super(e),this.reason=t}}function S(e,r){v.forEach((t=>{if(!e[t])throw new Error(`${r}Missing file "${w[t]}".`)}));const{manifest:n,packageJson:i,sourceCode:a,svgIcon:s}=e;try{(0,p.validateSnapJsonFile)(m.Manifest,n)}catch(e){throw new Error(`${r}"${m.Manifest}" is invalid:\n${e.message}`)}const o=n,{iconPath:u}=o.source.location.npm;if(u&&!s)throw new Error(`${r}Missing file "${u}".`);try{(0,p.validateSnapJsonFile)(m.PackageJson,i)}catch(e){throw new Error(`${r}"${m.PackageJson}" is invalid:\n${e.message}`)}const c=i;if(x({manifest:o,packageJson:c,sourceCode:a},r),s&&t.byteLength(s,"utf8")>y)throw new Error(`${r}The specified SVG icon exceeds the maximum size of ${b}.`);return{manifest:o,packageJson:c,sourceCode:a,svgIcon:s}}function x({manifest:e,packageJson:t,sourceCode:r},n){const i=t.name,a=t.version,o=t.repository,u=e.source.location.npm.packageName,c=e.version,l=e.repository;if(i!==u)throw new k(`${n}"${m.Manifest}" npm package name ("${u}") does not match the "${m.PackageJson}" "name" field ("${i}").`,_.NameMismatch);if(a!==c)throw new k(`${n}"${m.Manifest}" npm package version ("${c}") does not match the "${m.PackageJson}" "version" field ("${a}").`,_.VersionMismatch);if((o||l)&&!(0,s.default)(o,l))throw new k(`${n}"${m.Manifest}" "repository" field does not match the "${m.PackageJson}" "repository" field.`,_.RepositoryMismatch);return P(e,r,`${n}"${m.Manifest}" "shasum" field does not match computed shasum.`),[e,r,t]}r.ProgrammaticallyFixableSnapError=k,r.validateNpmSnap=S,r.validateNpmSnapManifest=x;const E=/^package\//u;function P(e,t,r="Invalid Snap manifest: manifest shasum does not match computed shasum."){if(e.source.shasum!==g(t))throw new k(r,_.ShasumMismatch)}r.validateSnapShasum=P,r.resolveVersion=function(e){return e===undefined||"latest"===e?r.DEFAULT_REQUESTED_SNAP_VERSION:e},r.isValidSnapVersionRange=function(e){return Boolean("string"==typeof e&&null!==(0,l.validRange)(e))},r.getSnapPrefix=function(e){const t=Object.values(h).find((t=>e.startsWith(t)));if(t!==undefined)return t;throw new Error(`Invalid or no prefix found for "${e}"`)},r.SNAP_PREFIX="wallet_snap_",r.getSnapPermissionName=function(e){return r.SNAP_PREFIX+e}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/snap-controllers"}],[134,{"../../../shared/constants/network":6110,lodash:5091},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash"),i=e("../../../shared/constants/network");var a={version:51,async migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=51;const r=t.data;return t.data=function(e){var t,r;const{chainId:n,type:a}=(null==e||null===(t=e.NetworkController)||void 0===t?void 0:t.provider)||{},s=null===(r=i.NETWORK_TYPE_TO_ID_MAP[a])||void 0===r?void 0:r.chainId;s&&n!==s&&(e.NetworkController.provider.chainId=s);return e}(r),t}};r.default=a}}},{package:"$root$"}],[1340,{"fast-deep-equal":4209},function(){with(this)return function(){"use strict";return function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.assertExhaustive=r.setDiff=r.isValidJson=r.isNonEmptyArray=r.hasProperty=r.isPlainObject=r.timeSince=void 0;const i=n(e("fast-deep-equal"));r.timeSince=function(e){return Date.now()-e},r.isPlainObject=function(e){return Boolean(e)&&"object"==typeof e&&!Array.isArray(e)};r.hasProperty=(e,t)=>Reflect.hasOwnProperty.call(e,t),r.isNonEmptyArray=function(e){return Array.isArray(e)&&e.length>0},r.isValidJson=function(e){try{return(0,i.default)(e,JSON.parse(JSON.stringify(e)))}catch(e){return!1}},r.setDiff=function(e,t){return Object.entries(e).reduce(((e,[r,n])=>(r in t||(e[r]=n),e)),{})},r.assertExhaustive=function(e){throw new Error("Invalid branch reached. Should be detected during compilation")}}}},{package:"@metamask/snap-controllers"}],[1341,{"./ObservableStore":1343},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.ComposedStore=void 0;const n=e("./ObservableStore");class i extends n.ObservableStore{constructor(e){super({}),this._children=e||{},Object.keys(this._children).forEach((e=>{const t=this._children[e];this._addChild(e,t)}))}_addChild(e,t){const r=t=>{const r=this.getState();r[e]=t,this.putState(r)};t.subscribe(r),r(t.getState())}}r.ComposedStore=i}}},{package:"@metamask/snap-controllers>@metamask/obs-store"}],[1342,{"./ObservableStore":1343},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.MergedStore=void 0;const n=e("./ObservableStore");class i extends n.ObservableStore{constructor(e=[]){super({}),this._children=e,e.forEach((e=>this._addChild(e))),this._updateWholeState()}_addChild(e){e.subscribe((()=>this._updateWholeState()))}_updateWholeState(){const e=this._children.map((e=>e.getState())),t=Object.assign({},...e);this.putState(t)}}r.MergedStore=i}}},{package:"@metamask/snap-controllers>@metamask/obs-store"}],[1343,{"@metamask/safe-event-emitter":1232},function(){with(this)return function(){"use strict";return function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.ObservableStore=void 0;const i=n(e("@metamask/safe-event-emitter"));class a extends i.default{constructor(e){super(),this._state=e||{}}getState(){return this._getState()}putState(e){this._putState(e),this.emit("update",e)}updateState(e){if(e&&"object"==typeof e){const t=this.getState();this.putState(Object.assign(Object.assign({},t),e))}else this.putState(e)}subscribe(e){this.on("update",e)}unsubscribe(e){this.removeListener("update",e)}_getState(){return this._state}_putState(e){this._state=e}}r.ObservableStore=a}}},{package:"@metamask/snap-controllers>@metamask/obs-store"}],[1344,{stream:1999},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.storeAsStream=void 0;const n=e("stream");class i extends n.Duplex{constructor(e){super({objectMode:!0}),this.resume(),this.handler=e=>this.push(e),this.obsStore=e,this.obsStore.subscribe(this.handler)}pipe(e,t){const r=super.pipe(e,t);return e.write(this.obsStore.getState()),r}_write(e,t,r){this.obsStore.putState(e),r()}_read(e){return undefined}_destroy(e,t){this.obsStore.unsubscribe(this.handler),super._destroy(e,t)}}r.storeAsStream=function(e){return new i(e)}}}},{package:"@metamask/snap-controllers>@metamask/obs-store"}],[1345,{"./ComposedStore":1341,"./MergedStore":1342,"./ObservableStore":1343,"./asStream":1344,"./transform":1346},function(){with(this)return function(){"use strict";return function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){n===undefined&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){n===undefined&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),i(e("./asStream"),r),i(e("./ComposedStore"),r),i(e("./MergedStore"),r),i(e("./ObservableStore"),r),i(e("./transform"),r)}}},{package:"@metamask/snap-controllers>@metamask/obs-store"}],[1346,{through2:1370},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.storeTransformStream=void 0;const n=e("through2");r.storeTransformStream=function(e){return n.obj(((t,r,n)=>{try{return n(null,e(t)),undefined}catch(e){return n(e),undefined}}))}}}},{package:"@metamask/snap-controllers>@metamask/obs-store"}],[1347,{"fast-deep-equal":4209},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0});const n=e("fast-deep-equal");n.code='require("ajv/dist/runtime/equal").default',r.default=n}}},{package:"@metamask/snap-controllers>ajv"}],[1348,{},function(){with(this)return function(){"use strict";return function(e,t,r){function n(e){const t=e.length;let r,n=0,i=0;for(;i<t;)n++,r=e.charCodeAt(i++),r>=55296&&r<=56319&&i<t&&(r=e.charCodeAt(i),56320==(64512&r)&&i++);return n}Object.defineProperty(r,"__esModule",{value:!0}),r.default=n,n.code='require("ajv/dist/runtime/ucs2length").default'}}},{package:"@metamask/snap-controllers>ajv"}],[1349,{buffer:1996,inherits:4319,"readable-stream":1364},function(){with(this)return function(){"use strict";return function(e,t,r){(function(r){(function(){var n=e("readable-stream").Writable,i=e("inherits"),a=Uint8Array;function s(e,t){if(!(this instanceof s))return new s(e,t);"function"==typeof e&&(t=e,e={}),e||(e={});var r=e.encoding,i=!1;r?"u8"!==(r=String(r).toLowerCase())&&"uint8"!==r||(r="uint8array"):i=!0,n.call(this,{objectMode:!0}),this.encoding=r,this.shouldInferEncoding=i,t&&this.on("finish",(function(){t(this.getBody())})),this.body=[]}function o(e){return"string"==typeof e||(t=e,/Array\]$/.test(Object.prototype.toString.call(t)))||e&&"function"==typeof e.subarray;var t}t.exports=s,i(s,n),s.prototype._write=function(e,t,r){this.body.push(e),r()},s.prototype.inferEncoding=function(e){var t=e===undefined?this.body[0]:e;return r.isBuffer(t)?"buffer":"undefined"!=typeof Uint8Array&&t instanceof Uint8Array?"uint8array":Array.isArray(t)?"array":"string"==typeof t?"string":"[object Object]"===Object.prototype.toString.call(t)?"object":"buffer"},s.prototype.getBody=function(){return this.encoding||0!==this.body.length?(this.shouldInferEncoding&&(this.encoding=this.inferEncoding()),"array"===this.encoding?function(e){for(var t=[],r=0;r<e.length;r++)t.push.apply(t,e[r]);return t}(this.body):"string"===this.encoding?function(e){for(var t=[],n=0;n<e.length;n++){var i=e[n];"string"==typeof i||r.isBuffer(i)?t.push(i):o(i)?t.push(r.from(i)):t.push(r.from(String(i)))}t=r.isBuffer(e[0])?(t=r.concat(t)).toString("utf8"):t.join("");return t}(this.body):"buffer"===this.encoding?function(e){for(var t=[],n=0;n<e.length;n++){var i=e[n];r.isBuffer(i)?t.push(i):o(i)?t.push(r.from(i)):t.push(r.from(String(i)))}return r.concat(t)}(this.body):"uint8array"===this.encoding?function(e){for(var t=0,n=0;n<e.length;n++)"string"==typeof e[n]&&(e[n]=r.from(e[n])),t+=e[n].length;for(var i=new a(t),s=(n=0,0);n<e.length;n++)for(var o=e[n],u=0;u<o.length;u++)i[s++]=o[u];return i}(this.body):this.body):[]}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/snap-controllers>concat-stream"}],[135,{"../../../shared/constants/network":6110,lodash:5091},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash"),i=e("../../../shared/constants/network");var a={version:52,async migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=52;const r=t.data;return t.data=function(e={}){if(e.PreferencesController){const{accountTokens:t,accountHiddenTokens:r,frequentRpcListDetail:n}=e.PreferencesController,a={},s={};if(t&&Object.keys(t).length>0){for(const e of Object.keys(t)){a[e]={},t[e][i.NETWORK_TYPE_RPC]&&n.forEach((r=>{a[e][r.chainId]=t[e][i.NETWORK_TYPE_RPC]}));for(const r of Object.keys(t[e]))switch(r){case i.MAINNET:a[e][i.MAINNET_CHAIN_ID]=t[e][i.MAINNET];break;case i.ROPSTEN:a[e][i.ROPSTEN_CHAIN_ID]=t[e][i.ROPSTEN];break;case i.RINKEBY:a[e][i.RINKEBY_CHAIN_ID]=t[e][i.RINKEBY];break;case i.GOERLI:a[e][i.GOERLI_CHAIN_ID]=t[e][i.GOERLI];break;case i.KOVAN:a[e][i.KOVAN_CHAIN_ID]=t[e][i.KOVAN]}}e.PreferencesController.accountTokens=a}if(r&&Object.keys(r).length>0){for(const e of Object.keys(r)){s[e]={},r[e][i.NETWORK_TYPE_RPC]&&n.forEach((t=>{s[e][t.chainId]=r[e][i.NETWORK_TYPE_RPC]}));for(const t of Object.keys(r[e]))switch(t){case i.MAINNET:s[e][i.MAINNET_CHAIN_ID]=r[e][i.MAINNET];break;case i.ROPSTEN:s[e][i.ROPSTEN_CHAIN_ID]=r[e][i.ROPSTEN];break;case i.RINKEBY:s[e][i.RINKEBY_CHAIN_ID]=r[e][i.RINKEBY];break;case i.GOERLI:s[e][i.GOERLI_CHAIN_ID]=r[e][i.GOERLI];break;case i.KOVAN:s[e][i.KOVAN_CHAIN_ID]=r[e][i.KOVAN]}}e.PreferencesController.accountHiddenTokens=s}}return e}(r),t}};r.default=a}}},{package:"$root$"}],[1350,{},function(){with(this)return function(){"use strict";return function(e,t,r){var n={};function i(e,t,r){r||(r=Error);var i=function(e){var r,n;function i(r,n,i){return e.call(this,function(e,r,n){return"string"==typeof t?t:t(e,r,n)}(r,n,i))||this}return n=e,(r=i).prototype=Object.create(n.prototype),r.prototype.constructor=r,r.__proto__=n,i}(r);i.prototype.name=r.name,i.prototype.code=e,n[e]=i}function a(e,t){if(Array.isArray(e)){var r=e.length;return e=e.map((function(e){return String(e)})),r>2?"one of ".concat(t," ").concat(e.slice(0,r-1).join(", "),", or ")+e[r-1]:2===r?"one of ".concat(t," ").concat(e[0]," or ").concat(e[1]):"of ".concat(t," ").concat(e[0])}return"of ".concat(t," ").concat(String(e))}i("ERR_INVALID_OPT_VALUE",(function(e,t){return'The value "'+t+'" is invalid for option "'+e+'"'}),TypeError),i("ERR_INVALID_ARG_TYPE",(function(e,t,r){var n,i,s,o;if("string"==typeof t&&(i="not ",t.substr(!s||s<0?0:+s,i.length)===i)?(n="must not be",t=t.replace(/^not /,"")):n="must be",function(e,t,r){return(r===undefined||r>e.length)&&(r=e.length),e.substring(r-t.length,r)===t}(e," argument"))o="The ".concat(e," ").concat(n," ").concat(a(t,"type"));else{var u=function(e,t,r){return"number"!=typeof r&&(r=0),!(r+t.length>e.length)&&-1!==e.indexOf(t,r)}(e,".")?"property":"argument";o='The "'.concat(e,'" ').concat(u," ").concat(n," ").concat(a(t,"type"))}return o+=". Received type ".concat(typeof r)}),TypeError),i("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),i("ERR_METHOD_NOT_IMPLEMENTED",(function(e){return"The "+e+" method is not implemented"})),i("ERR_STREAM_PREMATURE_CLOSE","Premature close"),i("ERR_STREAM_DESTROYED",(function(e){return"Cannot call "+e+" after a stream was destroyed"})),i("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),i("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),i("ERR_STREAM_WRITE_AFTER_END","write after end"),i("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),i("ERR_UNKNOWN_ENCODING",(function(e){return"Unknown encoding: "+e}),TypeError),i("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),t.exports.codes=n}}},{package:"@metamask/snap-controllers>concat-stream>readable-stream"}],[1351,{"./_stream_readable":1353,"./_stream_writable":1355,_process:5342,inherits:4319},function(){with(this)return function(){"use strict";return function(e,t,r){(function(r){(function(){var n=Object.keys||function(e){var t=[];for(var r in e)t.push(r);return t};t.exports=c;var i=e("./_stream_readable"),a=e("./_stream_writable");e("inherits")(c,i);for(var s=n(a.prototype),o=0;o<s.length;o++){var u=s[o];c.prototype[u]||(c.prototype[u]=a.prototype[u])}function c(e){if(!(this instanceof c))return new c(e);i.call(this,e),a.call(this,e),this.allowHalfOpen=!0,e&&(!1===e.readable&&(this.readable=!1),!1===e.writable&&(this.writable=!1),!1===e.allowHalfOpen&&(this.allowHalfOpen=!1,this.once("end",l)))}function l(){this._writableState.ended||r.nextTick(f,this)}function f(e){e.end()}Object.defineProperty(c.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(c.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(c.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(c.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState!==undefined&&this._writableState!==undefined&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(e){this._readableState!==undefined&&this._writableState!==undefined&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}})}).call(this)}).call(this,e("_process"))}}},{package:"@metamask/snap-controllers>concat-stream>readable-stream"}],[1352,{"./_stream_transform":1354,inherits:4319},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=i;var n=e("./_stream_transform");function i(e){if(!(this instanceof i))return new i(e);n.call(this,e)}e("inherits")(i,n),i.prototype._transform=function(e,t,r){r(null,e)}}}},{package:"@metamask/snap-controllers>concat-stream>readable-stream"}],[1353,{"../errors":1350,"./_stream_duplex":1351,"./internal/streams/async_iterator":1356,"./internal/streams/buffer_list":1357,"./internal/streams/destroy":1358,"./internal/streams/from":1360,"./internal/streams/state":1362,"./internal/streams/stream":1363,_process:5342,buffer:1996,events:1997,inherits:4319,"string_decoder/":5818,util:1995},function(){with(this)return function(){"use strict";return function(e,t,r){(function(r){(function(){var n;t.exports=x,x.ReadableState=S;e("events").EventEmitter;var i=function(e,t){return e.listeners(t).length},a=e("./internal/streams/stream"),s=e("buffer").Buffer,o=global.Uint8Array||function(){};var u,c=e("util");u=c&&c.debuglog?c.debuglog("stream"):function(){};var l,f,d,p=e("./internal/streams/buffer_list"),h=e("./internal/streams/destroy"),m=e("./internal/streams/state").getHighWaterMark,y=e("../errors").codes,b=y.ERR_INVALID_ARG_TYPE,g=y.ERR_STREAM_PUSH_AFTER_EOF,v=y.ERR_METHOD_NOT_IMPLEMENTED,w=y.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;e("inherits")(x,a);var _=h.errorOrDestroy,k=["error","close","destroy","pause","resume"];function S(t,r,i){n=n||e("./_stream_duplex"),t=t||{},"boolean"!=typeof i&&(i=r instanceof n),this.objectMode=!!t.objectMode,i&&(this.objectMode=this.objectMode||!!t.readableObjectMode),this.highWaterMark=m(this,t,"readableHighWaterMark",i),this.buffer=new p,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=!1!==t.emitClose,this.autoDestroy=!!t.autoDestroy,this.destroyed=!1,this.defaultEncoding=t.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(l||(l=e("string_decoder/").StringDecoder),this.decoder=new l(t.encoding),this.encoding=t.encoding)}function x(t){if(n=n||e("./_stream_duplex"),!(this instanceof x))return new x(t);var r=this instanceof n;this._readableState=new S(t,this,r),this.readable=!0,t&&("function"==typeof t.read&&(this._read=t.read),"function"==typeof t.destroy&&(this._destroy=t.destroy)),a.call(this)}function E(e,t,r,n,i){u("readableAddChunk",t);var a,c=e._readableState;if(null===t)c.reading=!1,function(e,t){if(u("onEofChunk"),t.ended)return;if(t.decoder){var r=t.decoder.end();r&&r.length&&(t.buffer.push(r),t.length+=t.objectMode?1:r.length)}t.ended=!0,t.sync?A(e):(t.needReadable=!1,t.emittedReadable||(t.emittedReadable=!0,T(e)))}(e,c);else if(i||(a=function(e,t){var r;n=t,s.isBuffer(n)||n instanceof o||"string"==typeof t||t===undefined||e.objectMode||(r=new b("chunk",["string","Buffer","Uint8Array"],t));var n;return r}(c,t)),a)_(e,a);else if(c.objectMode||t&&t.length>0)if("string"==typeof t||c.objectMode||Object.getPrototypeOf(t)===s.prototype||(t=function(e){return s.from(e)}(t)),n)c.endEmitted?_(e,new w):P(e,c,t,!0);else if(c.ended)_(e,new g);else{if(c.destroyed)return!1;c.reading=!1,c.decoder&&!r?(t=c.decoder.write(t),c.objectMode||0!==t.length?P(e,c,t,!1):R(e,c)):P(e,c,t,!1)}else n||(c.reading=!1,R(e,c));return!c.ended&&(c.length<c.highWaterMark||0===c.length)}function P(e,t,r,n){t.flowing&&0===t.length&&!t.sync?(t.awaitDrain=0,e.emit("data",r)):(t.length+=t.objectMode?1:r.length,n?t.buffer.unshift(r):t.buffer.push(r),t.needReadable&&A(e)),R(e,t)}Object.defineProperty(x.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState!==undefined&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),x.prototype.destroy=h.destroy,x.prototype._undestroy=h.undestroy,x.prototype._destroy=function(e,t){t(e)},x.prototype.push=function(e,t){var r,n=this._readableState;return n.objectMode?r=!0:"string"==typeof e&&((t=t||n.defaultEncoding)!==n.encoding&&(e=s.from(e,t),t=""),r=!0),E(this,e,t,!1,r)},x.prototype.unshift=function(e){return E(this,e,null,!0,!1)},x.prototype.isPaused=function(){return!1===this._readableState.flowing},x.prototype.setEncoding=function(t){l||(l=e("string_decoder/").StringDecoder);var r=new l(t);this._readableState.decoder=r,this._readableState.encoding=this._readableState.decoder.encoding;for(var n=this._readableState.buffer.head,i="";null!==n;)i+=r.write(n.data),n=n.next;return this._readableState.buffer.clear(),""!==i&&this._readableState.buffer.push(i),this._readableState.length=i.length,this};var j=1073741824;function O(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=j?e=j:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function A(e){var t=e._readableState;u("emitReadable",t.needReadable,t.emittedReadable),t.needReadable=!1,t.emittedReadable||(u("emitReadable",t.flowing),t.emittedReadable=!0,r.nextTick(T,e))}function T(e){var t=e._readableState;u("emitReadable_",t.destroyed,t.length,t.ended),t.destroyed||!t.length&&!t.ended||(e.emit("readable"),t.emittedReadable=!1),t.needReadable=!t.flowing&&!t.ended&&t.length<=t.highWaterMark,N(e)}function R(e,t){t.readingMore||(t.readingMore=!0,r.nextTick(C,e,t))}function C(e,t){for(;!t.reading&&!t.ended&&(t.length<t.highWaterMark||t.flowing&&0===t.length);){var r=t.length;if(u("maybeReadMore read 0"),e.read(0),r===t.length)break}t.readingMore=!1}function M(e){var t=e._readableState;t.readableListening=e.listenerCount("readable")>0,t.resumeScheduled&&!t.paused?t.flowing=!0:e.listenerCount("data")>0&&e.resume()}function D(e){u("readable nexttick read 0"),e.read(0)}function I(e,t){u("resume",t.reading),t.reading||e.read(0),t.resumeScheduled=!1,e.emit("resume"),N(e),t.flowing&&!t.reading&&e.read(0)}function N(e){var t=e._readableState;for(u("flow",t.flowing);t.flowing&&null!==e.read(););}function L(e,t){return 0===t.length?null:(t.objectMode?r=t.buffer.shift():!e||e>=t.length?(r=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.first():t.buffer.concat(t.length),t.buffer.clear()):r=t.buffer.consume(e,t.decoder),r);var r}function B(e){var t=e._readableState;u("endReadable",t.endEmitted),t.endEmitted||(t.ended=!0,r.nextTick(q,t,e))}function q(e,t){if(u("endReadableNT",e.endEmitted,e.length),!e.endEmitted&&0===e.length&&(e.endEmitted=!0,t.readable=!1,t.emit("end"),e.autoDestroy)){var r=t._writableState;(!r||r.autoDestroy&&r.finished)&&t.destroy()}}function U(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1}x.prototype.read=function(e){u("read",e),e=parseInt(e,10);var t=this._readableState,r=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&((0!==t.highWaterMark?t.length>=t.highWaterMark:t.length>0)||t.ended))return u("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?B(this):A(this),null;if(0===(e=O(e,t))&&t.ended)return 0===t.length&&B(this),null;var n,i=t.needReadable;return u("need readable",i),(0===t.length||t.length-e<t.highWaterMark)&&u("length less than watermark",i=!0),t.ended||t.reading?u("reading or ended",i=!1):i&&(u("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=O(r,t))),null===(n=e>0?L(e,t):null)?(t.needReadable=t.length<=t.highWaterMark,e=0):(t.length-=e,t.awaitDrain=0),0===t.length&&(t.ended||(t.needReadable=!0),r!==e&&t.ended&&B(this)),null!==n&&this.emit("data",n),n},x.prototype._read=function(e){_(this,new v("_read()"))},x.prototype.pipe=function(e,t){var n=this,a=this._readableState;switch(a.pipesCount){case 0:a.pipes=e;break;case 1:a.pipes=[a.pipes,e];break;default:a.pipes.push(e)}a.pipesCount+=1,u("pipe count=%d opts=%j",a.pipesCount,t);var s=(!t||!1!==t.end)&&e!==r.stdout&&e!==r.stderr?c:y;function o(t,r){u("onunpipe"),t===n&&r&&!1===r.hasUnpiped&&(r.hasUnpiped=!0,u("cleanup"),e.removeListener("close",h),e.removeListener("finish",m),e.removeListener("drain",l),e.removeListener("error",p),e.removeListener("unpipe",o),n.removeListener("end",c),n.removeListener("end",y),n.removeListener("data",d),f=!0,!a.awaitDrain||e._writableState&&!e._writableState.needDrain||l())}function c(){u("onend"),e.end()}a.endEmitted?r.nextTick(s):n.once("end",s),e.on("unpipe",o);var l=function(e){return function(){var t=e._readableState;u("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&i(e,"data")&&(t.flowing=!0,N(e))}}(n);e.on("drain",l);var f=!1;function d(t){u("ondata");var r=e.write(t);u("dest.write",r),!1===r&&((1===a.pipesCount&&a.pipes===e||a.pipesCount>1&&-1!==U(a.pipes,e))&&!f&&(u("false write response, pause",a.awaitDrain),a.awaitDrain++),n.pause())}function p(t){u("onerror",t),y(),e.removeListener("error",p),0===i(e,"error")&&_(e,t)}function h(){e.removeListener("finish",m),y()}function m(){u("onfinish"),e.removeListener("close",h),y()}function y(){u("unpipe"),n.unpipe(e)}return n.on("data",d),function(e,t,r){if("function"==typeof e.prependListener)return e.prependListener(t,r);e._events&&e._events[t]?Array.isArray(e._events[t])?e._events[t].unshift(r):e._events[t]=[r,e._events[t]]:e.on(t,r)}(e,"error",p),e.once("close",h),e.once("finish",m),e.emit("pipe",n),a.flowing||(u("pipe resume"),n.resume()),e},x.prototype.unpipe=function(e){var t=this._readableState,r={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,r)),this;if(!e){var n=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var a=0;a<i;a++)n[a].emit("unpipe",this,{hasUnpiped:!1});return this}var s=U(t.pipes,e);return-1===s||(t.pipes.splice(s,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,r)),this},x.prototype.on=function(e,t){var n=a.prototype.on.call(this,e,t),i=this._readableState;return"data"===e?(i.readableListening=this.listenerCount("readable")>0,!1!==i.flowing&&this.resume()):"readable"===e&&(i.endEmitted||i.readableListening||(i.readableListening=i.needReadable=!0,i.flowing=!1,i.emittedReadable=!1,u("on readable",i.length,i.reading),i.length?A(this):i.reading||r.nextTick(D,this))),n},x.prototype.addListener=x.prototype.on,x.prototype.removeListener=function(e,t){var n=a.prototype.removeListener.call(this,e,t);return"readable"===e&&r.nextTick(M,this),n},x.prototype.removeAllListeners=function(e){var t=a.prototype.removeAllListeners.apply(this,arguments);return"readable"!==e&&e!==undefined||r.nextTick(M,this),t},x.prototype.resume=function(){var e=this._readableState;return e.flowing||(u("resume"),e.flowing=!e.readableListening,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,r.nextTick(I,e,t))}(this,e)),e.paused=!1,this},x.prototype.pause=function(){return u("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(u("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},x.prototype.wrap=function(e){var t=this,r=this._readableState,n=!1;for(var i in e.on("end",(function(){if(u("wrapped end"),r.decoder&&!r.ended){var e=r.decoder.end();e&&e.length&&t.push(e)}t.push(null)})),e.on("data",(function(i){(u("wrapped data"),r.decoder&&(i=r.decoder.write(i)),!r.objectMode||null!==i&&i!==undefined)&&((r.objectMode||i&&i.length)&&(t.push(i)||(n=!0,e.pause())))})),e)this[i]===undefined&&"function"==typeof e[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));for(var a=0;a<k.length;a++)e.on(k[a],this.emit.bind(this,k[a]));return this._read=function(t){u("wrapped _read",t),n&&(n=!1,e.resume())},this},"function"==typeof Symbol&&(x.prototype[Symbol.asyncIterator]=function(){return f===undefined&&(f=e("./internal/streams/async_iterator")),f(this)}),Object.defineProperty(x.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(x.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(x.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(e){this._readableState&&(this._readableState.flowing=e)}}),x._fromList=L,Object.defineProperty(x.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),"function"==typeof Symbol&&(x.from=function(t,r){return d===undefined&&(d=e("./internal/streams/from")),d(x,t,r)})}).call(this)}).call(this,e("_process"))}}},{package:"@metamask/snap-controllers>concat-stream>readable-stream"}],[1354,{"../errors":1350,"./_stream_duplex":1351,inherits:4319},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=l;var n=e("../errors").codes,i=n.ERR_METHOD_NOT_IMPLEMENTED,a=n.ERR_MULTIPLE_CALLBACK,s=n.ERR_TRANSFORM_ALREADY_TRANSFORMING,o=n.ERR_TRANSFORM_WITH_LENGTH_0,u=e("./_stream_duplex");function c(e,t){var r=this._transformState;r.transforming=!1;var n=r.writecb;if(null===n)return this.emit("error",new a);r.writechunk=null,r.writecb=null,null!=t&&this.push(t),n(e);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}function l(e){if(!(this instanceof l))return new l(e);u.call(this,e),this._transformState={afterTransform:c.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",f)}function f(){var e=this;"function"!=typeof this._flush||this._readableState.destroyed?d(this,null,null):this._flush((function(t,r){d(e,t,r)}))}function d(e,t,r){if(t)return e.emit("error",t);if(null!=r&&e.push(r),e._writableState.length)throw new o;if(e._transformState.transforming)throw new s;return e.push(null)}e("inherits")(l,u),l.prototype.push=function(e,t){return this._transformState.needTransform=!1,u.prototype.push.call(this,e,t)},l.prototype._transform=function(e,t,r){r(new i("_transform()"))},l.prototype._write=function(e,t,r){var n=this._transformState;if(n.writecb=r,n.writechunk=e,n.writeencoding=t,!n.transforming){var i=this._readableState;(n.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},l.prototype._read=function(e){var t=this._transformState;null===t.writechunk||t.transforming?t.needTransform=!0:(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform))},l.prototype._destroy=function(e,t){u.prototype._destroy.call(this,e,(function(e){t(e)}))}}}},{package:"@metamask/snap-controllers>concat-stream>readable-stream"}],[1355,{"../errors":1350,"./_stream_duplex":1351,"./internal/streams/destroy":1358,"./internal/streams/state":1362,"./internal/streams/stream":1363,_process:5342,buffer:1996,inherits:4319,"util-deprecate":5929},function(){with(this)return function(){"use strict";return function(e,t,r){(function(r){(function(){function n(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,r){var n=e.entry;e.entry=null;for(;n;){var i=n.callback;t.pendingcb--,i(r),n=n.next}t.corkedRequestsFree.next=e}(t,e)}}var i;t.exports=x,x.WritableState=S;var a={deprecate:e("util-deprecate")},s=e("./internal/streams/stream"),o=e("buffer").Buffer,u=global.Uint8Array||function(){};var c,l=e("./internal/streams/destroy"),f=e("./internal/streams/state").getHighWaterMark,d=e("../errors").codes,p=d.ERR_INVALID_ARG_TYPE,h=d.ERR_METHOD_NOT_IMPLEMENTED,m=d.ERR_MULTIPLE_CALLBACK,y=d.ERR_STREAM_CANNOT_PIPE,b=d.ERR_STREAM_DESTROYED,g=d.ERR_STREAM_NULL_VALUES,v=d.ERR_STREAM_WRITE_AFTER_END,w=d.ERR_UNKNOWN_ENCODING,_=l.errorOrDestroy;function k(){}function S(t,a,s){i=i||e("./_stream_duplex"),t=t||{},"boolean"!=typeof s&&(s=a instanceof i),this.objectMode=!!t.objectMode,s&&(this.objectMode=this.objectMode||!!t.writableObjectMode),this.highWaterMark=f(this,t,"writableHighWaterMark",s),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var o=!1===t.decodeStrings;this.decodeStrings=!o,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var n=e._writableState,i=n.sync,a=n.writecb;if("function"!=typeof a)throw new m;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(n),t)!function(e,t,n,i,a){--t.pendingcb,n?(r.nextTick(a,i),r.nextTick(T,e,t),e._writableState.errorEmitted=!0,_(e,i)):(a(i),e._writableState.errorEmitted=!0,_(e,i),T(e,t))}(e,n,i,t,a);else{var s=O(n)||e.destroyed;s||n.corked||n.bufferProcessing||!n.bufferedRequest||j(e,n),i?r.nextTick(P,e,n,s,a):P(e,n,s,a)}}(a,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!1!==t.emitClose,this.autoDestroy=!!t.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new n(this)}function x(t){var r=this instanceof(i=i||e("./_stream_duplex"));if(!r&&!c.call(x,this))return new x(t);this._writableState=new S(t,this,r),this.writable=!0,t&&("function"==typeof t.write&&(this._write=t.write),"function"==typeof t.writev&&(this._writev=t.writev),"function"==typeof t.destroy&&(this._destroy=t.destroy),"function"==typeof t.final&&(this._final=t.final)),s.call(this)}function E(e,t,r,n,i,a,s){t.writelen=n,t.writecb=s,t.writing=!0,t.sync=!0,t.destroyed?t.onwrite(new b("write")):r?e._writev(i,t.onwrite):e._write(i,a,t.onwrite),t.sync=!1}function P(e,t,r,n){r||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,n(),T(e,t)}function j(e,t){t.bufferProcessing=!0;var r=t.bufferedRequest;if(e._writev&&r&&r.next){var i=t.bufferedRequestCount,a=new Array(i),s=t.corkedRequestsFree;s.entry=r;for(var o=0,u=!0;r;)a[o]=r,r.isBuf||(u=!1),r=r.next,o+=1;a.allBuffers=u,E(e,t,!0,t.length,a,"",s.finish),t.pendingcb++,t.lastBufferedRequest=null,s.next?(t.corkedRequestsFree=s.next,s.next=null):t.corkedRequestsFree=new n(t),t.bufferedRequestCount=0}else{for(;r;){var c=r.chunk,l=r.encoding,f=r.callback;if(E(e,t,!1,t.objectMode?1:c.length,c,l,f),r=r.next,t.bufferedRequestCount--,t.writing)break}null===r&&(t.lastBufferedRequest=null)}t.bufferedRequest=r,t.bufferProcessing=!1}function O(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function A(e,t){e._final((function(r){t.pendingcb--,r&&_(e,r),t.prefinished=!0,e.emit("prefinish"),T(e,t)}))}function T(e,t){var n=O(t);if(n&&(function(e,t){t.prefinished||t.finalCalled||("function"!=typeof e._final||t.destroyed?(t.prefinished=!0,e.emit("prefinish")):(t.pendingcb++,t.finalCalled=!0,r.nextTick(A,e,t)))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"),t.autoDestroy))){var i=e._readableState;(!i||i.autoDestroy&&i.endEmitted)&&e.destroy()}return n}e("inherits")(x,s),S.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(S.prototype,"buffer",{get:a.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer "+"instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(c=Function.prototype[Symbol.hasInstance],Object.defineProperty(x,Symbol.hasInstance,{value:function(e){return!!c.call(this,e)||this===x&&(e&&e._writableState instanceof S)}})):c=function(e){return e instanceof this},x.prototype.pipe=function(){_(this,new y)},x.prototype.write=function(e,t,n){var i,a=this._writableState,s=!1,c=!a.objectMode&&(i=e,o.isBuffer(i)||i instanceof u);return c&&!o.isBuffer(e)&&(e=function(e){return o.from(e)}(e)),"function"==typeof t&&(n=t,t=null),c?t="buffer":t||(t=a.defaultEncoding),"function"!=typeof n&&(n=k),a.ending?function(e,t){var n=new v;_(e,n),r.nextTick(t,n)}(this,n):(c||function(e,t,n,i){var a;return null===n?a=new g:"string"==typeof n||t.objectMode||(a=new p("chunk",["string","Buffer"],n)),!a||(_(e,a),r.nextTick(i,a),!1)}(this,a,e,n))&&(a.pendingcb++,s=function(e,t,r,n,i,a){if(!r){var s=function(e,t,r){e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=o.from(t,r));return t}(t,n,i);n!==s&&(r=!0,i="buffer",n=s)}var u=t.objectMode?1:n.length;t.length+=u;var c=t.length<t.highWaterMark;c||(t.needDrain=!0);if(t.writing||t.corked){var l=t.lastBufferedRequest;t.lastBufferedRequest={chunk:n,encoding:i,isBuf:r,callback:a,next:null},l?l.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else E(e,t,!1,u,n,i,a);return c}(this,a,c,e,t,n)),s},x.prototype.cork=function(){this._writableState.corked++},x.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.bufferProcessing||!e.bufferedRequest||j(this,e))},x.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new w(e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(x.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(x.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),x.prototype._write=function(e,t,r){r(new h("_write()"))},x.prototype._writev=null,x.prototype.end=function(e,t,n){var i=this._writableState;return"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),null!==e&&e!==undefined&&this.write(e,t),i.corked&&(i.corked=1,this.uncork()),i.ending||function(e,t,n){t.ending=!0,T(e,t),n&&(t.finished?r.nextTick(n):e.once("finish",n));t.ended=!0,e.writable=!1}(this,i,n),this},Object.defineProperty(x.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(x.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState!==undefined&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),x.prototype.destroy=l.destroy,x.prototype._undestroy=l.undestroy,x.prototype._destroy=function(e,t){t(e)}}).call(this)}).call(this,e("_process"))}}},{package:"@metamask/snap-controllers>concat-stream>readable-stream"}],[1356,{"./end-of-stream":1359,_process:5342},function(){with(this)return function(){"use strict";return function(e,t,r){(function(r){(function(){var n;function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var a=e("./end-of-stream"),s=Symbol("lastResolve"),o=Symbol("lastReject"),u=Symbol("error"),c=Symbol("ended"),l=Symbol("lastPromise"),f=Symbol("handlePromise"),d=Symbol("stream");function p(e,t){return{value:e,done:t}}function h(e){var t=e[s];if(null!==t){var r=e[d].read();null!==r&&(e[l]=null,e[s]=null,e[o]=null,t(p(r,!1)))}}function m(e){r.nextTick(h,e)}var y=Object.getPrototypeOf((function(){})),b=Object.setPrototypeOf((i(n={get stream(){return this[d]},next:function(){var e=this,t=this[u];if(null!==t)return Promise.reject(t);if(this[c])return Promise.resolve(p(undefined,!0));if(this[d].destroyed)return new Promise((function(t,n){r.nextTick((function(){e[u]?n(e[u]):t(p(undefined,!0))}))}));var n,i=this[l];if(i)n=new Promise(function(e,t){return function(r,n){e.then((function(){t[c]?r(p(undefined,!0)):t[f](r,n)}),n)}}(i,this));else{var a=this[d].read();if(null!==a)return Promise.resolve(p(a,!1));n=new Promise(this[f])}return this[l]=n,n}},Symbol.asyncIterator,(function(){return this})),i(n,"return",(function(){var e=this;return new Promise((function(t,r){e[d].destroy(null,(function(e){e?r(e):t(p(undefined,!0))}))}))})),n),y);t.exports=function(e){var t,r=Object.create(b,(i(t={},d,{value:e,writable:!0}),i(t,s,{value:null,writable:!0}),i(t,o,{value:null,writable:!0}),i(t,u,{value:null,writable:!0}),i(t,c,{value:e._readableState.endEmitted,writable:!0}),i(t,f,{value:function(e,t){var n=r[d].read();n?(r[l]=null,r[s]=null,r[o]=null,e(p(n,!1))):(r[s]=e,r[o]=t)},writable:!0}),t));return r[l]=null,a(e,(function(e){if(e&&"ERR_STREAM_PREMATURE_CLOSE"!==e.code){var t=r[o];return null!==t&&(r[l]=null,r[s]=null,r[o]=null,t(e)),void(r[u]=e)}var n=r[s];null!==n&&(r[l]=null,r[s]=null,r[o]=null,n(p(undefined,!0))),r[c]=!0})),e.on("readable",m.bind(null,r)),r}}).call(this)}).call(this,e("_process"))}}},{package:"@metamask/snap-controllers>concat-stream>readable-stream"}],[1357,{buffer:1996,util:1995},function(){with(this)return function(){"use strict";return function(e,t,r){function n(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var s=e("buffer").Buffer,o=e("util").inspect,u=o&&o.custom||"inspect";t.exports=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}var t,r,c;return t=e,r=[{key:"push",value:function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length}},{key:"unshift",value:function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length}},{key:"shift",value:function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(e){if(0===this.length)return"";for(var t=this.head,r=""+t.data;t=t.next;)r+=e+t.data;return r}},{key:"concat",value:function(e){if(0===this.length)return s.alloc(0);for(var t,r,n,i=s.allocUnsafe(e>>>0),a=this.head,o=0;a;)t=a.data,r=i,n=o,s.prototype.copy.call(t,r,n),o+=a.data.length,a=a.next;return i}},{key:"consume",value:function(e,t){var r;return e<this.head.data.length?(r=this.head.data.slice(0,e),this.head.data=this.head.data.slice(e)):r=e===this.head.data.length?this.shift():t?this._getString(e):this._getBuffer(e),r}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(e){var t=this.head,r=1,n=t.data;for(e-=n.length;t=t.next;){var i=t.data,a=e>i.length?i.length:e;if(a===i.length?n+=i:n+=i.slice(0,e),0==(e-=a)){a===i.length?(++r,t.next?this.head=t.next:this.head=this.tail=null):(this.head=t,t.data=i.slice(a));break}++r}return this.length-=r,n}},{key:"_getBuffer",value:function(e){var t=s.allocUnsafe(e),r=this.head,n=1;for(r.data.copy(t),e-=r.data.length;r=r.next;){var i=r.data,a=e>i.length?i.length:e;if(i.copy(t,t.length-e,0,a),0==(e-=a)){a===i.length?(++n,r.next?this.head=r.next:this.head=this.tail=null):(this.head=r,r.data=i.slice(a));break}++n}return this.length-=n,t}},{key:u,value:function(e,t){return o(this,function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?n(Object(r),!0).forEach((function(t){i(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},t,{depth:0,customInspect:!1}))}}],r&&a(t.prototype,r),c&&a(t,c),e}()}}},{package:"@metamask/snap-controllers>concat-stream>readable-stream"}],[1358,{_process:5342},function(){with(this)return function(){"use strict";return function(e,t,r){(function(e){(function(){function r(e,t){i(e,t),n(e)}function n(e){e._writableState&&!e._writableState.emitClose||e._readableState&&!e._readableState.emitClose||e.emit("close")}function i(e,t){e.emit("error",t)}t.exports={destroy:function(t,a){var s=this,o=this._readableState&&this._readableState.destroyed,u=this._writableState&&this._writableState.destroyed;return o||u?(a?a(t):t&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,e.nextTick(i,this,t)):e.nextTick(i,this,t)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(t||null,(function(t){!a&&t?s._writableState?s._writableState.errorEmitted?e.nextTick(n,s):(s._writableState.errorEmitted=!0,e.nextTick(r,s,t)):e.nextTick(r,s,t):a?(e.nextTick(n,s),a(t)):e.nextTick(n,s)})),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(e,t){var r=e._readableState,n=e._writableState;r&&r.autoDestroy||n&&n.autoDestroy?e.destroy(t):e.emit("error",t)}}}).call(this)}).call(this,e("_process"))}}},{package:"@metamask/snap-controllers>concat-stream>readable-stream"}],[1359,{"../../../errors":1350},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("../../../errors").codes.ERR_STREAM_PREMATURE_CLOSE;function i(){}t.exports=function e(t,r,a){if("function"==typeof r)return e(t,null,r);r||(r={}),a=function(e){var t=!1;return function(){if(!t){t=!0;for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];e.apply(this,n)}}}(a||i);var s=r.readable||!1!==r.readable&&t.readable,o=r.writable||!1!==r.writable&&t.writable,u=function(){t.writable||l()},c=t._writableState&&t._writableState.finished,l=function(){o=!1,c=!0,s||a.call(t)},f=t._readableState&&t._readableState.endEmitted,d=function(){s=!1,f=!0,o||a.call(t)},p=function(e){a.call(t,e)},h=function(){var e;return s&&!f?(t._readableState&&t._readableState.ended||(e=new n),a.call(t,e)):o&&!c?(t._writableState&&t._writableState.ended||(e=new n),a.call(t,e)):void 0},m=function(){t.req.on("finish",l)};return!function(e){return e.setHeader&&"function"==typeof e.abort}(t)?o&&!t._writableState&&(t.on("end",u),t.on("close",u)):(t.on("complete",l),t.on("abort",h),t.req?m():t.on("request",m)),t.on("end",d),t.on("finish",l),!1!==r.error&&t.on("error",p),t.on("close",h),function(){t.removeListener("complete",l),t.removeListener("abort",h),t.removeListener("request",m),t.req&&t.req.removeListener("finish",l),t.removeListener("end",u),t.removeListener("close",u),t.removeListener("finish",l),t.removeListener("end",d),t.removeListener("error",p),t.removeListener("close",h)}}}}},{package:"@metamask/snap-controllers>concat-stream>readable-stream"}],[136,{"../../../shared/constants/transaction":6114,"@babel/runtime/helpers/defineProperty":193,"@babel/runtime/helpers/interopRequireDefault":199,lodash:5091},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var i=n(e("@babel/runtime/helpers/defineProperty")),a=e("lodash"),s=e("../../../shared/constants/transaction");function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){(0,i.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var c={version:53,async migrate(e){const t=(0,a.cloneDeep)(e);t.meta.version=53;const r=t.data;return t.data=function(e){var t,r;const n=null==e||null===(t=e.TransactionController)||void 0===t?void 0:t.transactions,i=null==e||null===(r=e.IncomingTransactionsController)||void 0===r?void 0:r.incomingTransactions;Array.isArray(n)&&n.forEach((e=>{e&&(e.type!==s.TRANSACTION_TYPES.RETRY&&e.type!==s.TRANSACTION_TYPES.CANCEL&&(e.type=e.transactionCategory),delete e.transactionCategory)}));if(i){Object.entries(i).forEach((([t,r])=>{r&&(delete r.transactionCategory,e.IncomingTransactionsController.incomingTransactions[t]=u(u({},r),{},{type:s.TRANSACTION_TYPES.INCOMING}))}))}return e}(r),t}};r.default=c}}},{package:"$root$"}],[1360,{},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=function(){throw new Error("Readable.from is not available in the browser")}}}},{package:"@metamask/snap-controllers>concat-stream>readable-stream"}],[1361,{"../../../errors":1350,"./end-of-stream":1359},function(){with(this)return function(){"use strict";return function(e,t,r){var n;var i=e("../../../errors").codes,a=i.ERR_MISSING_ARGS,s=i.ERR_STREAM_DESTROYED;function o(e){if(e)throw e}function u(t,r,i,a){a=function(e){var t=!1;return function(){t||(t=!0,e.apply(void 0,arguments))}}(a);var o=!1;t.on("close",(function(){o=!0})),n===undefined&&(n=e("./end-of-stream")),n(t,{readable:r,writable:i},(function(e){if(e)return a(e);o=!0,a()}));var u=!1;return function(e){if(!o&&!u)return u=!0,function(e){return e.setHeader&&"function"==typeof e.abort}(t)?t.abort():"function"==typeof t.destroy?t.destroy():void a(e||new s("pipe"))}}function c(e){e()}function l(e,t){return e.pipe(t)}function f(e){return e.length?"function"!=typeof e[e.length-1]?o:e.pop():o}t.exports=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n,i=f(t);if(Array.isArray(t[0])&&(t=t[0]),t.length<2)throw new a("streams");var s=t.map((function(e,r){var a=r<t.length-1;return u(e,a,r>0,(function(e){n||(n=e),e&&s.forEach(c),a||(s.forEach(c),i(n))}))}));return t.reduce(l)}}}},{package:"@metamask/snap-controllers>concat-stream>readable-stream"}],[1362,{"../../../errors":1350},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("../../../errors").codes.ERR_INVALID_OPT_VALUE;t.exports={getHighWaterMark:function(e,t,r,i){var a=function(e,t,r){return null!=e.highWaterMark?e.highWaterMark:t?e[r]:null}(t,i,r);if(null!=a){if(!isFinite(a)||Math.floor(a)!==a||a<0)throw new n(i?r:"highWaterMark",a);return Math.floor(a)}return e.objectMode?16:16384}}}}},{package:"@metamask/snap-controllers>concat-stream>readable-stream"}],[1363,{events:1997},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=e("events").EventEmitter}}},{package:"@metamask/snap-controllers>concat-stream>readable-stream"}],[1364,{"./lib/_stream_duplex.js":1351,"./lib/_stream_passthrough.js":1352,"./lib/_stream_readable.js":1353,"./lib/_stream_transform.js":1354,"./lib/_stream_writable.js":1355,"./lib/internal/streams/end-of-stream.js":1359,"./lib/internal/streams/pipeline.js":1361},function(){with(this)return function(){"use strict";return function(e,t,r){(r=t.exports=e("./lib/_stream_readable.js")).Stream=r,r.Readable=r,r.Writable=e("./lib/_stream_writable.js"),r.Duplex=e("./lib/_stream_duplex.js"),r.Transform=e("./lib/_stream_transform.js"),r.PassThrough=e("./lib/_stream_passthrough.js"),r.finished=e("./lib/internal/streams/end-of-stream.js"),r.pipeline=e("./lib/internal/streams/pipeline.js")}}},{package:"@metamask/snap-controllers>concat-stream>readable-stream"}],[1365,{"readable-stream":5622},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0});const n=e("readable-stream");r.default=function(e){if(!e||!e.engine)throw new Error("Missing engine parameter!");const{engine:t}=e,r=new n.Duplex({objectMode:!0,read:function(){return undefined},write:function(e,n,i){t.handle(e,((e,t)=>{r.push(t)})),i()}});return t.on&&t.on("notification",(e=>{r.push(e)})),r}}}},{package:"@metamask/snap-controllers>json-rpc-middleware-stream"}],[1366,{"@metamask/safe-event-emitter":1232,"readable-stream":5622},function(){with(this)return function(){"use strict";return function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});const i=n(e("@metamask/safe-event-emitter")),a=e("readable-stream");r.default=function(){const e={},t=new a.Duplex({objectMode:!0,read:function(){return!1},write:function(t,n,i){let a;try{!t.id?function(e){r.emit("notification",e)}(t):function(t){const r=e[t.id];if(!r)throw new Error(`StreamMiddleware - Unknown response id "${t.id}"`);delete e[t.id],Object.assign(r.res,t),setTimeout(r.end)}(t)}catch(e){a=e}i(a)}}),r=new i.default;return{events:r,middleware:(r,n,i,a)=>{t.push(r),e[r.id]={req:r,res:n,next:i,end:a}},stream:t}}}}},{package:"@metamask/snap-controllers>json-rpc-middleware-stream"}],[1367,{"./createEngineStream":1365,"./createStreamMiddleware":1366},function(){with(this)return function(){"use strict";return function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.createStreamMiddleware=r.createEngineStream=void 0;const i=n(e("./createEngineStream"));r.createEngineStream=i.default;const a=n(e("./createStreamMiddleware"));r.createStreamMiddleware=a.default}}},{package:"@metamask/snap-controllers>json-rpc-middleware-stream"}],[1368,{"./url-alphabet/index.cjs":1369},function(){with(this)return function(){"use strict";return function(e,t,r){let{urlAlphabet:n}=e("./url-alphabet/index.cjs");let i=e=>crypto.getRandomValues(new Uint8Array(e)),a=(e,t,r)=>{let n=(2<<Math.log(e.length-1)/Math.LN2)-1,i=-~(1.6*n*t/e.length);return()=>{let a="";for(;;){let s=r(i),o=i;for(;o--;)if(a+=e[s[o]&n]||"",a.length===t)return a}}};t.exports={nanoid:(e=21)=>{let t="",r=crypto.getRandomValues(new Uint8Array(e));for(;e--;){let n=63&r[e];t+=n<36?n.toString(36):n<62?(n-26).toString(36).toUpperCase():n<63?"_":"-"}return t},customAlphabet:(e,t)=>a(e,t,i),customRandom:a,urlAlphabet:n,random:i}}}},{package:"@metamask/snap-controllers>nanoid"}],[1369,{},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports={urlAlphabet:"useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"}}}},{package:"@metamask/snap-controllers>nanoid"}],[137,{lodash:5091},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");function i(e){return"number"==typeof e||"string"==typeof e&&e.match(/^(0x)?\d+$/u)}var a={version:54,async migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=54;const r=function(e){const t=e;if(!t.PreferencesController)return t;const r=(t.PreferencesController.tokens||[]).filter((({decimals:e})=>i(e)));for(const e of r)"string"==typeof e.decimals&&(e.decimals=parseInt(e.decimals));t.PreferencesController.tokens=r;const{accountTokens:n}=t.PreferencesController;if(n&&"object"==typeof n)for(const e of Object.keys(n)){const t=n[e];if(t&&"object"==typeof t)for(const e of Object.keys(t)){const r=(t[e]||[]).filter((({decimals:e})=>i(e)));for(const e of r)"string"==typeof e.decimals&&(e.decimals=parseInt(e.decimals));t[e]=r}}return t.PreferencesController.accountTokens=n,t}(t.data);return t.data=r,t}};r.default=a}}},{package:"$root$"}],[1370,{_process:5342,"readable-stream":5622,util:2002,xtend:6092},function(){with(this)return function(){"use strict";return function(e,t,r){(function(r){(function(){var n=e("readable-stream").Transform,i=e("util").inherits,a=e("xtend");function s(e){n.call(this,e),this._destroyed=!1}function o(e,t,r){r(null,e)}function u(e){return function(t,r,n){return"function"==typeof t&&(n=r,r=t,t={}),"function"!=typeof r&&(r=o),"function"!=typeof n&&(n=null),e(t,r,n)}}i(s,n),s.prototype.destroy=function(e){if(!this._destroyed){this._destroyed=!0;var t=this;r.nextTick((function(){e&&t.emit("error",e),t.emit("close")}))}},t.exports=u((function(e,t,r){var n=new s(e);return n._transform=t,r&&(n._flush=r),n})),t.exports.ctor=u((function(e,t,r){function n(t){if(!(this instanceof n))return new n(t);this.options=a(e,t),s.call(this,this.options)}return i(n,s),n.prototype._transform=t,r&&(n.prototype._flush=r),n})),t.exports.obj=u((function(e,t,r){var n=new s(a({objectMode:!0,highWaterMark:16},e));return n._transform=t,r&&(n._flush=r),n}))}).call(this)}).call(this,e("_process"))}}},{package:"@metamask/snap-controllers>@metamask/obs-store>through2"}],[1371,{},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=function(e){if(e.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),r=0;r<t.length;r++)t[r]=255;for(var n=0;n<e.length;n++){var i=e.charAt(n),a=i.charCodeAt(0);if(255!==t[a])throw new TypeError(i+" is ambiguous");t[a]=n}var s=e.length,o=e.charAt(0),u=Math.log(s)/Math.log(256),c=Math.log(256)/Math.log(s);function l(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var r=0;if(" "!==e[r]){for(var n=0,i=0;e[r]===o;)n++,r++;for(var a=(e.length-r)*u+1>>>0,c=new Uint8Array(a);e[r];){var l=t[e.charCodeAt(r)];if(255===l)return;for(var f=0,d=a-1;(0!==l||f<i)&&-1!==d;d--,f++)l+=s*c[d]>>>0,c[d]=l%256>>>0,l=l/256>>>0;if(0!==l)throw new Error("Non-zero carry");i=f,r++}if(" "!==e[r]){for(var p=a-i;p!==a&&0===c[p];)p++;for(var h=new Uint8Array(n+(a-p)),m=n;p!==a;)h[m++]=c[p++];return h}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,n=0,i=0,a=t.length;i!==a&&0===t[i];)i++,r++;for(var u=(a-i)*c+1>>>0,l=new Uint8Array(u);i!==a;){for(var f=t[i],d=0,p=u-1;(0!==f||d<n)&&-1!==p;p--,d++)f+=256*l[p]>>>0,l[p]=f%s>>>0,f=f/s>>>0;if(0!==f)throw new Error("Non-zero carry");n=d,i++}for(var h=u-n;h!==u&&0===l[h];)h++;for(var m=o.repeat(r);h<u;++h)m+=e.charAt(l[h]);return m},decodeUnsafe:l,decode:function(e){var t=l(e);if(t)return t;throw new Error("Non-base"+s+" character")}}}}}},{package:"@ensdomains/content-hash>cids>multibase>@multiformats/base-x"}],[138,{"../../../shared/constants/network":6110,lodash:5091},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash"),i=e("../../../shared/constants/network");var a={version:55,async migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=55;const r=t.data;return t.data=function(e){var t;null!=e&&null!==(t=e.IncomingTransactionsController)&&void 0!==t&&t.incomingTxLastFetchedBlocksByNetwork&&(e.IncomingTransactionsController.incomingTxLastFetchedBlockByChainId=(0,n.mapKeys)(e.IncomingTransactionsController.incomingTxLastFetchedBlocksByNetwork,((e,t)=>{var r,n;return null!==(r=null===(n=i.NETWORK_TYPE_TO_ID_MAP[t])||void 0===n?void 0:n.chainId)&&void 0!==r?r:s})),delete e.IncomingTransactionsController.incomingTxLastFetchedBlockByChainId.UNKNOWN,delete e.IncomingTransactionsController.incomingTxLastFetchedBlocksByNetwork);return e}(r),t}};r.default=a;const s="UNKNOWN"}}},{package:"$root$"}],[1389,{assert:1615,buffer:1996,"component-type":2064,"join-component":4630},function(){with(this)return function(){"use strict";return function(e,t,r){(function(r){(function(){var n=e("component-type"),i=e("join-component"),a=e("assert");t.exports=function(e,t){switch(o(e),t=t||e.type,a(t,"You must pass an event type."),t){case"track":return function(e){a(e.anonymousId||e.userId,'You must pass either an "anonymousId" or a "userId".'),a(e.event,'You must pass an "event".')}(e);case"group":return function(e){a(e.anonymousId||e.userId,'You must pass either an "anonymousId" or a "userId".'),a(e.groupId,'You must pass a "groupId".')}(e);case"identify":case"page":case"screen":return function(e){a(e.anonymousId||e.userId,'You must pass either an "anonymousId" or a "userId".')}(e);case"alias":return function(e){a(e.userId,'You must pass a "userId".'),a(e.previousId,'You must pass a "previousId".')}(e);default:a(0,'Invalid event type: "'+t+'"')}};var s={anonymousId:["string","number"],category:"string",context:"object",event:"string",groupId:["string","number"],integrations:"object",name:"string",previousId:["string","number"],timestamp:"date",userId:["string","number"],type:"string"};function o(e){a("object"===n(e),"You must pass a message object.");var t=JSON.stringify(e);for(var o in a(r.byteLength(t,"utf8")<32768,"Your message must be < 32kb."),s){var u=e[o];if(u){var c=s[o];"array"!==n(c)&&(c=[c]);var l="object"===c[0]?"an":"a";a(c.some((function(e){return n(u)===e})),'"'+o+'" must be '+l+" "+i(c,"or")+".")}}}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"analytics-node>@segment/loosely-validate-event"}],[139,{lodash:5091},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");var i={version:56,async migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=56;const{PreferencesController:r}=t.data;return Array.isArray(null==r?void 0:r.tokens)&&(r.tokens=r.tokens.filter((({address:e})=>e))),null!=r&&r.accountTokens&&"object"==typeof r.accountTokens&&Object.keys(r.accountTokens).forEach((e=>{Object.keys(r.accountTokens[e]).forEach((t=>{r.accountTokens[e][t]=r.accountTokens[e][t].filter((({address:e})=>e))}))})),null!=r&&r.assetImages&&"undefined"in r.assetImages&&delete r.assetImages.undefined,t}};r.default=i}}},{package:"$root$"}],[14,{"../../../../shared/constants/network":6110,"@babel/runtime/helpers/interopRequireDefault":199,"eth-block-tracker":2276,"eth-json-rpc-infura":2315,"eth-json-rpc-middleware":2321,"json-rpc-engine":4641},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=function({network:e,projectId:t}){const r=(0,s.default)({network:e,projectId:t,maxAttempts:5,source:"metamask"}),n=(0,a.providerFromMiddleware)(r),u=new o.PollingBlockTracker({provider:n});return{networkMiddleware:(0,i.mergeMiddleware)([c({network:e}),(0,a.createBlockCacheMiddleware)({blockTracker:u}),(0,a.createInflightCacheMiddleware)(),(0,a.createBlockRefMiddleware)({blockTracker:u,provider:n}),(0,a.createRetryOnEmptyMiddleware)({blockTracker:u,provider:n}),(0,a.createBlockTrackerInspectorMiddleware)({blockTracker:u}),r]),blockTracker:u}};var i=e("json-rpc-engine"),a=e("eth-json-rpc-middleware"),s=n(e("eth-json-rpc-infura")),o=e("eth-block-tracker"),u=e("../../../../shared/constants/network");function c({network:e}){if(!u.NETWORK_TYPE_TO_ID_MAP[e])throw new Error(`createInfuraClient - unknown network "${e}"`);const{chainId:t,networkId:r}=u.NETWORK_TYPE_TO_ID_MAP[e];return(0,i.createScaffoldMiddleware)({eth_chainId:t,net_version:r})}}}},{package:"$root$"}],[140,{"../../../shared/modules/random-id":6122,"@babel/runtime/helpers/interopRequireDefault":199,lodash:5091},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var i=e("lodash"),a=n(e("../../../shared/modules/random-id"));var s={version:57,async migrate(e){const t=(0,i.cloneDeep)(e);t.meta.version=57;const r=t.data;return t.data=function(e){var t;null!=e&&null!==(t=e.TransactionController)&&void 0!==t&&t.transactions&&Array.isArray(e.TransactionController.transactions)&&!e.TransactionController.transactions.some((e=>"object"!=typeof e||void 0===e.txParams))&&(e.TransactionController.transactions=(0,i.keyBy)(e.TransactionController.transactions,(e=>(void 0!==e.id&&null!==e.id||(e.id=(0,a.default)()),e.id))));return e}(r),t}};r.default=s}}},{package:"$root$"}],[141,{lodash:5091},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");var i={version:58,async migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=58;const r=t.data;return t.data=function(e){var t;return null===(t=e.AppStateController)||void 0===t||delete t.swapsWelcomeMessageHasBeenShown,e}(r),t}};r.default=i}}},{package:"$root$"}],[142,{"../../../shared/constants/transaction":6114,lodash:5091},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash"),i=e("../../../shared/constants/transaction");var a={version:59,async migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=59;const r=t.data;return t.data=function(e){var t;const r=null==e||null===(t=e.TransactionController)||void 0===t?void 0:t.transactions;if((0,n.isPlainObject)(r)){const t=(0,n.groupBy)(Object.values(r),(e=>{var t,r;return`${null===(t=e.txParams)||void 0===t?void 0:t.nonce}-${null!==(r=e.chainId)&&void 0!==r?r:e.metamaskNetworkId}`})),a=(0,n.pickBy)(t,(e=>e.some((e=>e.type!==i.TRANSACTION_TYPES.CANCEL&&e.type!==i.TRANSACTION_TYPES.RETRY))));e.TransactionController.transactions=(0,n.keyBy)((0,n.concat)(...Object.values(a)),(e=>e.id))}return e}(r),t}};r.default=a}}},{package:"$root$"}],[143,{lodash:5091},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");const i="2020-08-31";var a={version:60,async migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=60;const r=function(e){var t;const r=null==e||null===(t=e.NotificationController)||void 0===t?void 0:t.notifications;var a;(0,n.isPlainObject)(r)&&(null===(a=r[2])||void 0===a?void 0:a.date)===i&&delete e.NotificationController.notifications[2];return e}(t.data);return t.data=r,t}};r.default=a}}},{package:"$root$"}],[144,{lodash:5091},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");var i={version:61,async migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=61;const r=function(e){const t=(new Date).getTime();e.AppStateController?(e.AppStateController.recoveryPhraseReminderHasBeenShown=!1,e.AppStateController.recoveryPhraseReminderLastShown=t):e.AppStateController={recoveryPhraseReminderHasBeenShown:!1,recoveryPhraseReminderLastShown:t};return e}(t.data);return t.data=r,t}};r.default=i}}},{package:"$root$"}],[145,{lodash:5091},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");var i={version:62,async migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=62;const r=function(e){if(e.MetaMetricsController){const{metaMetricsSendCount:t}=e.MetaMetricsController;t!==undefined&&delete e.MetaMetricsController.metaMetricsSendCount}return e}(t.data);return t.data=r,t}};r.default=i}}},{package:"$root$"}],[146,{"@babel/runtime/helpers/defineProperty":193,"@babel/runtime/helpers/interopRequireDefault":199,lodash:5091},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var i=n(e("@babel/runtime/helpers/defineProperty")),a=e("lodash");function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach((function(t){(0,i.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var u={version:63,async migrate(e){const t=(0,a.cloneDeep)(e);t.meta.version=63;const r=function(e){var t,r,n,i,a,s,u,c;const l=null==e||null===(t=e.PreferencesController)||void 0===t?void 0:t.accountTokens,f=null==e||null===(r=e.PreferencesController)||void 0===r?void 0:r.accountHiddenTokens,d={};l&&Object.keys(l).forEach((e=>{Object.keys(l[e]).forEach((t=>{const r=l[e][t];d[t]===undefined?d[t]={[e]:r}:d[t]=o(o({},d[t]),{},{[e]:r})}))}));const p={};f&&Object.keys(f).forEach((e=>{Object.keys(f[e]).forEach((t=>{const r=f[e][t];p[t]===undefined?p[t]={[e]:r}:p[t]=o(o({},p[t]),{},{[e]:r})}))}));e.TokensController?(e.TokensController.allTokens=d,e.TokensController.allIgnoredTokens=p):e.TokensController={allTokens:d,allIgnoredTokens:p};return null==e||(null===(n=e.PreferencesController)||void 0===n||delete n.accountHiddenTokens),null==e||null===(i=e.PreferencesController)||void 0===i||delete i.accountTokens,null==e||null===(a=e.PreferencesController)||void 0===a||delete a.assetImages,null==e||null===(s=e.PreferencesController)||void 0===s||delete s.hiddenTokens,null==e||null===(u=e.PreferencesController)||void 0===u||delete u.tokens,null==e||null===(c=e.PreferencesController)||void 0===c||delete c.suggestedTokens,e}(t.data);return t.data=r,t}};r.default=u}}},{package:"$root$"}],[147,{"../../../shared/constants/transaction":6114,lodash:5091},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash"),i=e("../../../shared/constants/transaction");const a="sentEther";var s={version:64,async migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=64;const r=function(e){var t;const r=null==e||null===(t=e.TransactionController)||void 0===t?void 0:t.transactions;if((0,n.isPlainObject)(r))for(const e of Object.values(r))e.type===a&&(e.type=i.TRANSACTION_TYPES.SIMPLE_SEND),e.history&&e.history.map((e=>(e.type&&e.type===a&&(e.type=i.TRANSACTION_TYPES.SIMPLE_SEND),e)));return e}(t.data);return t.data=r,t}};r.default=s}}},{package:"$root$"}],[1470,{},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0});var n="utf8: invalid string",i="utf8: invalid source encoding";function a(e){for(var t=0,r=0;r<e.length;r++){var i=e.charCodeAt(r);if(i<128)t+=1;else if(i<2048)t+=2;else if(i<55296)t+=3;else{if(!(i<=57343))throw new Error(n);if(r>=e.length-1)throw new Error(n);r++,t+=4}}return t}r.encode=function(e){for(var t=new Uint8Array(a(e)),r=0,n=0;n<e.length;n++){var i=e.charCodeAt(n);i<128?t[r++]=i:i<2048?(t[r++]=192|i>>6,t[r++]=128|63&i):i<55296?(t[r++]=224|i>>12,t[r++]=128|i>>6&63,t[r++]=128|63&i):(n++,i=(1023&i)<<10,i|=1023&e.charCodeAt(n),i+=65536,t[r++]=240|i>>18,t[r++]=128|i>>12&63,t[r++]=128|i>>6&63,t[r++]=128|63&i)}return t},r.encodedLength=a,r.decode=function(e){for(var t=[],r=0;r<e.length;r++){var n=e[r];if(128&n){var a=void 0;if(n<224){if(r>=e.length)throw new Error(i);if(128!=(192&(s=e[++r])))throw new Error(i);n=(31&n)<<6|63&s,a=128}else if(n<240){if(r>=e.length-1)throw new Error(i);var s=e[++r],o=e[++r];if(128!=(192&s)||128!=(192&o))throw new Error(i);n=(15&n)<<12|(63&s)<<6|63&o,a=2048}else{if(!(n<248))throw new Error(i);if(r>=e.length-2)throw new Error(i);s=e[++r],o=e[++r];var u=e[++r];if(128!=(192&s)||128!=(192&o)||128!=(192&u))throw new Error(i);n=(15&n)<<18|(63&s)<<12|(63&o)<<6|63&u,a=65536}if(n<a||n>=55296&&n<=57343)throw new Error(i);if(n>=65536){if(n>1114111)throw new Error(i);n-=65536,t.push(String.fromCharCode(55296|n>>10)),n=56320|1023&n}}t.push(String.fromCharCode(n))}return t.join("")}}}},{package:"3box>did-jwt>@stablelib/utf8"}],[148,{lodash:5091},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");var i={version:65,async migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=65;const r=function(e){if(e.PreferencesController){var t;const{completedOnboarding:r,firstTimeFlowType:n}=e.PreferencesController;e.OnboardingController=null!==(t=e.OnboardingController)&&void 0!==t?t:{},r!==undefined&&(e.OnboardingController.completedOnboarding=r,delete e.PreferencesController.completedOnboarding),n!==undefined&&(e.OnboardingController.firstTimeFlowType=n,delete e.PreferencesController.firstTimeFlowType)}return e}(t.data);return t.data=r,t}};r.default=i}}},{package:"$root$"}],[149,{"../../../shared/constants/hardware-wallets":6107,"@babel/runtime/helpers/defineProperty":193,"@babel/runtime/helpers/interopRequireDefault":199,lodash:5091},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var i=n(e("@babel/runtime/helpers/defineProperty")),a=e("lodash"),s=e("../../../shared/constants/hardware-wallets");function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){(0,i.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var c={version:66,async migrate(e){const t=(0,a.cloneDeep)(e);t.meta.version=66;const r=function(e){var t;const r=window.navigator.hid?s.LEDGER_TRANSPORT_TYPES.WEBHID:s.LEDGER_TRANSPORT_TYPES.U2F,n=Boolean(null===(t=e.PreferencesController)||void 0===t?void 0:t.useLedgerLive),i=u(u({},e),{},{PreferencesController:u(u({},null==e?void 0:e.PreferencesController),{},{ledgerTransportType:n?s.LEDGER_TRANSPORT_TYPES.LIVE:r})});return delete i.PreferencesController.useLedgerLive,i}(t.data);return t.data=r,t}};r.default=c}}},{package:"$root$"}],[15,{"../../../../shared/constants/time":6113,"@babel/runtime/helpers/defineProperty":193,"@babel/runtime/helpers/interopRequireDefault":199,_process:5342,"eth-block-tracker":2276,"eth-json-rpc-middleware":2321,"json-rpc-engine":4641},function(){with(this)return function(){"use strict";return function(e,t,r){(function(t){(function(){var n=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=function({rpcUrl:e,chainId:t}){const r=(0,s.createFetchMiddleware)({rpcUrl:e}),n=(0,s.providerFromMiddleware)(r),i=new o.PollingBlockTracker(l(l({},d),{},{provider:n}));return{networkMiddleware:(0,a.mergeMiddleware)([...f?[(0,a.createAsyncMiddleware)((async(e,t,r)=>("eth_estimateGas"===e.method&&await new Promise((e=>setTimeout(e,2*u.SECOND))),r())))]:[],p(t),(0,s.createBlockRefRewriteMiddleware)({blockTracker:i}),(0,s.createBlockCacheMiddleware)({blockTracker:i}),(0,s.createInflightCacheMiddleware)(),(0,s.createBlockTrackerInspectorMiddleware)({blockTracker:i}),r]),blockTracker:i}};var i=n(e("@babel/runtime/helpers/defineProperty")),a=e("json-rpc-engine"),s=e("eth-json-rpc-middleware"),o=e("eth-block-tracker"),u=e("../../../../shared/constants/time");function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach((function(t){(0,i.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const f=t.env.IN_TEST,d=f?{pollingInterval:u.SECOND}:{};function p(e){return(t,r,n,i)=>"eth_chainId"===t.method?(r.result=e,i()):n()}}).call(this)}).call(this,e("_process"))}}},{package:"$root$"}],[150,{"../../../shared/constants/network":6110,"@babel/runtime/helpers/defineProperty":193,"@babel/runtime/helpers/interopRequireDefault":199,"bignumber.js":1875,lodash:5091},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var i=n(e("@babel/runtime/helpers/defineProperty")),a=e("lodash"),s=n(e("bignumber.js")),o=e("../../../shared/constants/network");function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?u(Object(r),!0).forEach((function(t){(0,i.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const l=e=>new s.default(e||"0x0",16).gt(0);var f={version:67,async migrate(e){const t=(0,a.cloneDeep)(e);t.meta.version=67;const r=function(e){var t,r,n;const i=(null==e?void 0:e.PreferencesController)||{},a=i.preferences||{};if(a.showTestNetworks)return e;const s=(null==e||null===(t=e.TransactionController)||void 0===t?void 0:t.transactions)||{},u=(null===(r=e.NetworkController)||void 0===r?void 0:r.provider)||{},f=(null===(n=e.CachedBalancesController)||void 0===n?void 0:n.cachedBalances)||{},d=o.TEST_CHAINS.includes(null==u?void 0:u.chainId),p=Object.values(s).some((({chainId:e})=>o.TEST_CHAINS.includes(e))),h=o.TEST_CHAINS.some((e=>Object.values(f[e]||{}).some(l))),m=d||p||h;return c(c({},e),{},{PreferencesController:c(c({},i),{},{preferences:c(c({},a),{},{showTestNetworks:m})})})}(t.data);return t.data=r,t}};r.default=f}}},{package:"$root$"}],[151,{"@babel/runtime/helpers/defineProperty":193,"@babel/runtime/helpers/interopRequireDefault":199,"@babel/runtime/helpers/objectWithoutProperties":208,lodash:5091},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var i=n(e("@babel/runtime/helpers/defineProperty")),a=n(e("@babel/runtime/helpers/objectWithoutProperties")),s=e("lodash");const o=["PermissionsController","PermissionsMetadata"],u=["name","icon","extensionId"];function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach((function(t){(0,i.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var f={version:68,async migrate(e){const t=(0,s.cloneDeep)(e);t.meta.version=68;const r=function(e){const{PermissionsController:t={},PermissionsMetadata:r={}}=e,n=(0,a.default)(e,o),{domainMetadata:i={},permissionsHistory:s={},permissionsLog:u=[]}=r;return l(l({},n),{},{PermissionController:d(t),PermissionLogController:{permissionActivityLog:u,permissionHistory:s},SubjectMetadataController:p(i)})}(t.data);return t.data=r,t}};function d(e){const{domains:t={}}=e;return{subjects:Object.entries(t).reduce(((e,[t,r])=>{const{permissions:[n]}=r,i=n.caveats.find((e=>"exposedAccounts"===e.name)),a=l(l({},n),{},{caveats:[{type:"restrictReturnedAccounts",value:i.value}]});return delete a["@context"],e[t]={origin:t,permissions:{eth_accounts:a}},e}),{})}}function p(e){return{subjectMetadata:Object.entries(e).reduce(((e,[t,r])=>{const{name:n=null,icon:i=null,extensionId:s=null}=r,o=(0,a.default)(r,u);return delete o.lastUpdated,delete o.host,t&&(e[t]=l(l({name:n,iconUrl:i,extensionId:s},o),{},{origin:t})),e}),{})}}r.default=f}}},{package:"$root$"}],[152,{"../../../shared/constants/app":6105,lodash:5091},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash"),i=e("../../../shared/constants/app");var a={version:69,async migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=69;const r=function(e){var t;if("object"==typeof(null==e||null===(t=e.SubjectMetadataController)||void 0===t?void 0:t.subjectMetadata)){const{SubjectMetadataController:{subjectMetadata:t}}=e;Object.values(t).forEach((e=>{e&&"object"==typeof e&&!Array.isArray(e)&&(e.subjectType=e.extensionId?i.SUBJECT_TYPES.EXTENSION:i.SUBJECT_TYPES.WEBSITE)}))}return e}(t.data);return t.data=r,t}};r.default=a}}},{package:"$root$"}],[153,{lodash:5091},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");var i={version:70,async migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=70;const r=function(e){var t;if(Array.isArray(null==e||null===(t=e.PermissionLogController)||void 0===t?void 0:t.permissionActivityLog)){const{PermissionLogController:{permissionActivityLog:t}}=e;t.forEach((e=>{e&&"object"==typeof e&&!Array.isArray(e)&&(delete e.request,delete e.response)}))}return e}(t.data);return t.data=r,t}};r.default=i}}},{package:"$root$"}],[154,{lodash:5091},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");var i={version:71,async migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=71;const r=function(e){e.NotificationController&&(e.AnnouncementController={announcements:e.NotificationController.notifications},delete e.NotificationController);return e}(t.data);return t.data=r,t}};r.default=i}}},{package:"$root$"}],[155,{"../../../shared/constants/transaction":6114,lodash:5091},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e,t,r){return function(a){const s=(0,n.cloneDeep)(a);s.meta.version=e;try{const e=function(e,t,r){const n=e,{TransactionController:a}=n;if(a&&a.transactions){const{transactions:e}=a;n.TransactionController.transactions=e.map((e=>t(e)?(e.status=i.TRANSACTION_STATUSES.FAILED,e.err={message:r,note:`Tx automatically failed by migration because ${r}`},e):e))}return n}(s.data,r,t);s.data=e}catch(t){console.warn(`MetaMask Migration #${e}${t.stack}`)}return Promise.resolve(s)}};var n=e("lodash"),i=e("../../../shared/constants/transaction")}}},{package:"$root$"}],[156,{"./002":85,"./003":86,"./004":87,"./005":88,"./006":89,"./007":90,"./008":91,"./009":92,"./010":93,"./011":94,"./012":95,"./013":96,"./014":97,"./015":98,"./016":99,"./017":100,"./018":101,"./019":102,"./020":103,"./021":104,"./022":105,"./023":106,"./024":107,"./025":108,"./026":109,"./027":110,"./028":111,"./029":112,"./030":113,"./031":114,"./032":115,"./033":116,"./034":117,"./035":118,"./036":119,"./037":120,"./038":121,"./039":122,"./040":123,"./041":124,"./042":125,"./043":126,"./044":127,"./045":128,"./046":129,"./047":130,"./048":131,"./049":132,"./050":133,"./051":134,"./052":135,"./053":136,"./054":137,"./055":138,"./056":139,"./057":140,"./058":141,"./059":142,"./060":143,"./061":144,"./062":145,"./063":146,"./064":147,"./065":148,"./066":149,"./067":150,"./068":151,"./069":152,"./070":153,"./071":154,"@babel/runtime/helpers/interopRequireDefault":199},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var i=n(e("./002")),a=n(e("./003")),s=n(e("./004")),o=n(e("./005")),u=n(e("./006")),c=n(e("./007")),l=n(e("./008")),f=n(e("./009")),d=n(e("./010")),p=n(e("./011")),h=n(e("./012")),m=n(e("./013")),y=n(e("./014")),b=n(e("./015")),g=n(e("./016")),v=n(e("./017")),w=n(e("./018")),_=n(e("./019")),k=n(e("./020")),S=n(e("./021")),x=n(e("./022")),E=n(e("./023")),P=n(e("./024")),j=n(e("./025")),O=n(e("./026")),A=n(e("./027")),T=n(e("./028")),R=n(e("./029")),C=n(e("./030")),M=n(e("./031")),D=n(e("./032")),I=n(e("./033")),N=n(e("./034")),L=n(e("./035")),B=n(e("./036")),q=n(e("./037")),U=n(e("./038")),$=n(e("./039")),K=n(e("./040")),F=n(e("./041")),z=n(e("./042")),W=n(e("./043")),V=n(e("./044")),J=n(e("./045")),H=n(e("./046")),G=n(e("./047")),Z=n(e("./048")),Y=n(e("./049")),Q=n(e("./050")),X=n(e("./051")),ee=n(e("./052")),te=n(e("./053")),re=n(e("./054")),ne=n(e("./055")),ie=n(e("./056")),ae=n(e("./057")),se=n(e("./058")),oe=n(e("./059")),ue=n(e("./060")),ce=n(e("./061")),le=n(e("./062")),fe=n(e("./063")),de=n(e("./064")),pe=n(e("./065")),he=n(e("./066")),me=n(e("./067")),ye=n(e("./068")),be=n(e("./069")),ge=n(e("./070")),ve=n(e("./071"));var we=[i.default,a.default,s.default,o.default,u.default,c.default,l.default,f.default,d.default,p.default,h.default,m.default,y.default,b.default,g.default,v.default,w.default,_.default,k.default,S.default,x.default,E.default,P.default,j.default,O.default,A.default,T.default,R.default,C.default,M.default,D.default,I.default,N.default,L.default,B.default,q.default,U.default,$.default,K.default,F.default,z.default,W.default,V.default,J.default,H.default,G.default,Z.default,Y.default,Q.default,X.default,ee.default,te.default,re.default,ne.default,ie.default,ae.default,se.default,oe.default,ue.default,ce.default,le.default,fe.default,de.default,pe.default,he.default,me.default,ye.default,be.default,ge.default,ve.default];r.default=we}}},{package:"$root$"}],[1585,{},function(){with(this)return function(){"use strict";return function(e,t,r){function n(e){if("object"!=typeof e||null===e)throw new TypeError("First argument must be an abstract-leveldown compliant store");this.db=e,this._operations=[],this._written=!1}n.prototype._checkWritten=function(){if(this._written)throw new Error("write() already called on this batch")},n.prototype.put=function(e,t){this._checkWritten();var r=this.db._checkKey(e)||this.db._checkValue(t);if(r)throw r;return e=this.db._serializeKey(e),t=this.db._serializeValue(t),this._put(e,t),this},n.prototype._put=function(e,t){this._operations.push({type:"put",key:e,value:t})},n.prototype.del=function(e){this._checkWritten();var t=this.db._checkKey(e);if(t)throw t;return e=this.db._serializeKey(e),this._del(e),this},n.prototype._del=function(e){this._operations.push({type:"del",key:e})},n.prototype.clear=function(){return this._checkWritten(),this._clear(),this},n.prototype._clear=function(){this._operations=[]},n.prototype.write=function(e,t){if(this._checkWritten(),"function"==typeof e&&(t=e),"function"!=typeof t)throw new Error("write() requires a callback argument");"object"==typeof e&&null!==e||(e={}),this._written=!0,this._write(e,t)},n.prototype._write=function(e,t){this.db._batch(this._operations,e,t)},t.exports=n}}},{package:"3box>orbit-db>orbit-db-cache>level-js>abstract-leveldown"}],[1586,{_process:5342},function(){with(this)return function(){"use strict";return function(e,t,r){(function(e){(function(){function r(e){if("object"!=typeof e||null===e)throw new TypeError("First argument must be an abstract-leveldown compliant store");this.db=e,this._ended=!1,this._nexting=!1}r.prototype.next=function(t){var r=this;if("function"!=typeof t)throw new Error("next() requires a callback argument");return r._ended?(e.nextTick(t,new Error("cannot call next() after end()")),r):r._nexting?(e.nextTick(t,new Error("cannot call next() before previous next() has completed")),r):(r._nexting=!0,r._next((function(){r._nexting=!1,t.apply(null,arguments)})),r)},r.prototype._next=function(t){e.nextTick(t)},r.prototype.seek=function(e){if(this._ended)throw new Error("cannot call seek() after end()");if(this._nexting)throw new Error("cannot call seek() before next() has completed");e=this.db._serializeKey(e),this._seek(e)},r.prototype._seek=function(e){},r.prototype.end=function(t){if("function"!=typeof t)throw new Error("end() requires a callback argument");if(this._ended)return e.nextTick(t,new Error("end() already called on iterator"));this._ended=!0,this._end(t)},r.prototype._end=function(t){e.nextTick(t)},t.exports=r}).call(this)}).call(this,e("_process"))}}},{package:"3box>orbit-db>orbit-db-cache>level-js>abstract-leveldown"}],[1587,{"../is-buffer/index.js":4601,"./abstract-chained-batch":1585,"./abstract-iterator":1586,_process:5342,xtend:6092},function(){with(this)return function(){"use strict";return function(e,t,r){(function(r,n){(function(){var i=e("xtend"),a=e("./abstract-iterator"),s=e("./abstract-chained-batch"),o=Object.prototype.hasOwnProperty,u="start end gt gte lt lte".split(" ");function c(){this.status="new"}function l(e){return-1!==u.indexOf(e)}c.prototype.open=function(e,t){var r=this,n=this.status;if("function"==typeof e&&(t=e),"function"!=typeof t)throw new Error("open() requires a callback argument");"object"==typeof e&&null!==e||(e={}),e.createIfMissing=!1!==e.createIfMissing,e.errorIfExists=!!e.errorIfExists,this.status="opening",this._open(e,(function(e){if(e)return r.status=n,t(e);r.status="open",t()}))},c.prototype._open=function(e,t){n.nextTick(t)},c.prototype.close=function(e){var t=this,r=this.status;if("function"!=typeof e)throw new Error("close() requires a callback argument");this.status="closing",this._close((function(n){if(n)return t.status=r,e(n);t.status="closed",e()}))},c.prototype._close=function(e){n.nextTick(e)},c.prototype.get=function(e,t,r){if("function"==typeof t&&(r=t),"function"!=typeof r)throw new Error("get() requires a callback argument");var i=this._checkKey(e);if(i)return n.nextTick(r,i);e=this._serializeKey(e),"object"==typeof t&&null!==t||(t={}),t.asBuffer=!1!==t.asBuffer,this._get(e,t,r)},c.prototype._get=function(e,t,r){n.nextTick((function(){r(new Error("NotFound"))}))},c.prototype.put=function(e,t,r,i){if("function"==typeof r&&(i=r),"function"!=typeof i)throw new Error("put() requires a callback argument");var a=this._checkKey(e)||this._checkValue(t);if(a)return n.nextTick(i,a);e=this._serializeKey(e),t=this._serializeValue(t),"object"==typeof r&&null!==r||(r={}),this._put(e,t,r,i)},c.prototype._put=function(e,t,r,i){n.nextTick(i)},c.prototype.del=function(e,t,r){if("function"==typeof t&&(r=t),"function"!=typeof r)throw new Error("del() requires a callback argument");var i=this._checkKey(e);if(i)return n.nextTick(r,i);e=this._serializeKey(e),"object"==typeof t&&null!==t||(t={}),this._del(e,t,r)},c.prototype._del=function(e,t,r){n.nextTick(r)},c.prototype.batch=function(e,t,r){if(!arguments.length)return this._chainedBatch();if("function"==typeof t&&(r=t),"function"==typeof e&&(r=e),"function"!=typeof r)throw new Error("batch(array) requires a callback argument");if(!Array.isArray(e))return n.nextTick(r,new Error("batch(array) requires an array argument"));if(0===e.length)return n.nextTick(r);"object"==typeof t&&null!==t||(t={});for(var a=new Array(e.length),s=0;s<e.length;s++){if("object"!=typeof e[s]||null===e[s])return n.nextTick(r,new Error("batch(array) element must be an object and not `null`"));var o=i(e[s]);if("put"!==o.type&&"del"!==o.type)return n.nextTick(r,new Error("`type` must be 'put' or 'del'"));var u=this._checkKey(o.key);if(u)return n.nextTick(r,u);if(o.key=this._serializeKey(o.key),"put"===o.type){var c=this._checkValue(o.value);if(c)return n.nextTick(r,c);o.value=this._serializeValue(o.value)}a[s]=o}this._batch(a,t,r)},c.prototype._batch=function(e,t,r){n.nextTick(r)},c.prototype._setupIteratorOptions=function(e){return(e=function(e,t){var r={};for(var n in t)if(o.call(t,n)){var i=t[n];l(n)&&(i=e._serializeKey(i)),r[n]=i}return r}(this,e)).reverse=!!e.reverse,e.keys=!1!==e.keys,e.values=!1!==e.values,e.limit="limit"in e?e.limit:-1,e.keyAsBuffer=!1!==e.keyAsBuffer,e.valueAsBuffer=!1!==e.valueAsBuffer,e},c.prototype.iterator=function(e){return"object"==typeof e&&null!==e||(e={}),e=this._setupIteratorOptions(e),this._iterator(e)},c.prototype._iterator=function(e){return new a(this)},c.prototype._chainedBatch=function(){return new s(this)},c.prototype._serializeKey=function(e){return e},c.prototype._serializeValue=function(e){return e},c.prototype._checkKey=function(e){return null===e||e===undefined?new Error("key cannot be `null` or `undefined`"):r.isBuffer(e)&&0===e.length?new Error("key cannot be an empty Buffer"):""===e?new Error("key cannot be an empty String"):Array.isArray(e)&&0===e.length?new Error("key cannot be an empty Array"):void 0},c.prototype._checkValue=function(e){if(null===e||e===undefined)return new Error("value cannot be `null` or `undefined`")},t.exports=c}).call(this)}).call(this,{isBuffer:e("../is-buffer/index.js")},e("_process"))}}},{package:"3box>orbit-db>orbit-db-cache>level-js>abstract-leveldown"}],[1588,{"./abstract-chained-batch":1585,"./abstract-iterator":1586,"./abstract-leveldown":1587},function(){with(this)return function(){"use strict";return function(e,t,r){r.AbstractLevelDOWN=e("./abstract-leveldown"),r.AbstractIterator=e("./abstract-iterator"),r.AbstractChainedBatch=e("./abstract-chained-batch")}}},{package:"3box>orbit-db>orbit-db-cache>level-js>abstract-leveldown"}],[1591,{},function(){with(this)return function(){"use strict";return function(e,t,r){function n(){}t.exports=function(e,t,r){var i=!1;return r=r||n,a.count=e,0===e?t():a;function a(e,n){if(a.count<=0)throw new Error("after called too many times");--a.count,e?(i=!0,t(e),t=r):0!==a.count||i||t(null,n)}}}}},{package:"3box>ipfs>libp2p-webrtc-star>socket.io-client>engine.io-client>engine.io-parser>after"}],[1592,{"./package.json":1596,"@segment/loosely-validate-event":1389,_process:5342,assert:1615,axios:1699,"axios-retry":1697,"lodash.isstring":4913,md5:5114,ms:5126,"remove-trailing-slash":5650,"uuid/v4":1595},function(){with(this)return function(){"use strict";return function(e,t,r){(function(r){(function(){const n=e("assert"),i=e("remove-trailing-slash"),a=e("@segment/loosely-validate-event"),s=e("axios"),o=e("axios-retry"),u=e("ms"),c=e("uuid/v4"),l=e("md5"),f=e("./package.json").version,d=e("lodash.isstring"),p=global.setImmediate||r.nextTick.bind(r),h=()=>{};t.exports=class{constructor(e,t){t=t||{},n(e,"You must pass your Segment project's write key."),this.queue=[],this.writeKey=e,this.host=i(t.host||"https://api.segment.io"),this.timeout=t.timeout||!1,this.flushAt=Math.max(t.flushAt,1)||20,this.flushInterval=t.flushInterval||1e4,this.flushed=!1,Object.defineProperty(this,"enable",{configurable:!1,writable:!1,enumerable:!0,value:"boolean"!=typeof t.enable||t.enable}),this.axiosClient=s.create(),o(this.axiosClient,{retries:t.retryCount||3,retryCondition:this._isErrorRetryable,retryDelay:o.exponentialDelay})}_validate(e,t){try{a(e,t)}catch(t){if("Your message must be < 32kb."===t.message)return void console.log("Your message must be < 32kb. This is currently surfaced as a warning to allow clients to update. Versions released after August 1, 2018 will throw an error instead. Please update your code before then.",e);throw t}}identify(e,t){return this._validate(e,"identify"),this.enqueue("identify",e,t),this}group(e,t){return this._validate(e,"group"),this.enqueue("group",e,t),this}track(e,t){return this._validate(e,"track"),this.enqueue("track",e,t),this}page(e,t){return this._validate(e,"page"),this.enqueue("page",e,t),this}screen(e,t){return this._validate(e,"screen"),this.enqueue("screen",e,t),this}alias(e,t){return this._validate(e,"alias"),this.enqueue("alias",e,t),this}enqueue(e,t,n){return n=n||h,this.enable?((t=Object.assign({},t)).type=e,t.context=Object.assign({library:{name:"analytics-node",version:f}},t.context),t._metadata=Object.assign({nodeVersion:r.versions.node},t._metadata),t.timestamp||(t.timestamp=new Date),t.messageId||(t.messageId=`node-${l(JSON.stringify(t))}-${c()}`),t.anonymousId&&!d(t.anonymousId)&&(t.anonymousId=JSON.stringify(t.anonymousId)),t.userId&&!d(t.userId)&&(t.userId=JSON.stringify(t.userId)),this.queue.push({message:t,callback:n}),this.flushed?(this.queue.length>=this.flushAt&&this.flush(),void(this.flushInterval&&!this.timer&&(this.timer=setTimeout(this.flush.bind(this),this.flushInterval)))):(this.flushed=!0,void this.flush())):p(n)}flush(e){if(e=e||h,!this.enable)return p(e);if(this.timer&&(clearTimeout(this.timer),this.timer=null),!this.queue.length)return p(e);const t=this.queue.splice(0,this.flushAt),r=t.map((e=>e.callback)),n={batch:t.map((e=>e.message)),timestamp:new Date,sentAt:new Date},i=t=>{r.forEach((e=>e(t))),e(t,n)},a={};"undefined"==typeof window&&(a["user-agent"]=`analytics-node/${f}`);const s={method:"POST",url:`${this.host}/v1/batch`,auth:{username:this.writeKey},data:n,headers:a};this.timeout&&(s.timeout="string"==typeof this.timeout?u(this.timeout):this.timeout),this.axiosClient(s).then((()=>i())).catch((e=>{if(e.response){const t=new Error(e.response.statusText);return i(t)}i(e)}))}_isErrorRetryable(e){return!!o.isNetworkError(e)||!!e.response&&(e.response.status>=500&&e.response.status<=599||429===e.response.status)}}}).call(this)}).call(this,e("_process"))}}},{package:"analytics-node"}],[1593,{},function(){with(this)return function(){"use strict";return function(e,t,r){for(var n=[],i=0;i<256;++i)n[i]=(i+256).toString(16).substr(1);t.exports=function(e,t){var r=t||0,i=n;return[i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]]].join("")}}}},{package:"analytics-node>uuid"}],[1594,{},function(){with(this)return function(){"use strict";return function(e,t,r){var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(n){var i=new Uint8Array(16);t.exports=function(){return n(i),i}}else{var a=new Array(16);t.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),a[t]=e>>>((3&t)<<3)&255;return a}}}}},{package:"analytics-node>uuid"}],[1595,{"./lib/bytesToUuid":1593,"./lib/rng":1594},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("./lib/rng"),i=e("./lib/bytesToUuid");t.exports=function(e,t,r){var a=t&&r||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var s=(e=e||{}).random||(e.rng||n)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t)for(var o=0;o<16;++o)t[a+o]=s[o];return t||i(s)}}}},{package:"analytics-node>uuid"}],[1596,{},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports={name:"analytics-node",version:"3.4.0-beta.3",description:"The hassle-free way to integrate analytics into any Node.js application",license:"MIT",repository:"segmentio/analytics-node",author:{name:"Segment",email:"tools+npm@segment.com",url:"https://segment.com"},engines:{node:">=4"},"size-limit":[{limit:"25 KB",path:"index.js"}],scripts:{"circle-lint":".buildscript/circle.sh",dependencies:"yarn",size:"size-limit",test:"standard && nyc ava --timeout=20s&& .buildscript/e2e.sh","report-coverage":"nyc report --reporter=lcov > coverage.lcov && codecov",np:"np --no-publish",release:"yarn run np"},files:["index.js"],keywords:["analytics","stats","segment.io","segmentio","segment","client","driver"],dependencies:{"@segment/loosely-validate-event":"^2.0.0",axios:"^0.19.2","axios-retry":"^3.0.2","lodash.isstring":"^4.0.1",md5:"^2.2.1",ms:"^2.0.0","remove-trailing-slash":"^0.1.0",uuid:"^3.2.1"},devDependencies:{ava:"^0.25.0","basic-auth":"^2.0.1","body-parser":"^1.17.1",codecov:"^3.0.0",commander:"^2.9.0",delay:"^4.2.0",express:"^4.15.2",husky:"^3.0.4",nyc:"^14.1.1",pify:"^4.0.1",sinon:"^7.3.2","size-limit":"^1.3.5",snyk:"^1.171.1",standard:"^12.0.1"}}}}},{package:"analytics-node"}],[1597,{},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=function(e,t,r){var n=e.byteLength;if(t=t||0,r=r||n,e.slice)return e.slice(t,r);if(t<0&&(t+=n),r<0&&(r+=n),r>n&&(r=n),t>=n||t>=r||0===n)return new ArrayBuffer(0);for(var i=new Uint8Array(e),a=new Uint8Array(r-t),s=t,o=0;s<r;s++,o++)a[o]=i[s];return a.buffer}}}},{package:"3box>ipfs>libp2p-webrtc-star>socket.io-client>engine.io-client>engine.io-parser>arraybuffer.slice"}],[16,{"./middleware/pending":18,"eth-json-rpc-middleware":2321,"json-rpc-engine":4641},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function({version:e,getAccounts:t,processTransaction:r,processEthSignMessage:s,processTypedMessage:o,processTypedMessageV3:u,processTypedMessageV4:c,processPersonalMessage:l,processDecryptMessage:f,processEncryptionPublicKey:d,getPendingNonce:p,getPendingTransactionByHash:h}){return(0,n.mergeMiddleware)([(0,n.createScaffoldMiddleware)({eth_syncing:!1,web3_clientVersion:`MetaMask/v${e}`}),(0,i.createWalletMiddleware)({getAccounts:t,processTransaction:r,processEthSignMessage:s,processTypedMessage:o,processTypedMessageV3:u,processTypedMessageV4:c,processPersonalMessage:l,processDecryptMessage:f,processEncryptionPublicKey:d}),(0,a.createPendingNonceMiddleware)({getPendingNonce:p}),(0,a.createPendingTxMiddleware)({getPendingTransactionByHash:h})])};var n=e("json-rpc-engine"),i=e("eth-json-rpc-middleware"),a=e("./middleware/pending")}}},{package:"$root$"}],[160,{},function(){with(this)return function(){"use strict";return function(e,t,r){function n(e){return new Promise((t=>setTimeout(t,e)))}async function i(e){const t=await window.fetch(`http://localhost:8889?key=${e}`),r=await t.text();return r.length?JSON.parse(r):null}t.exports=class{static openBox(e){return this.address=e,Promise.resolve({onSyncDone:e=>{setTimeout(e,200)},openSpace:async(e,t)=>{const{onSyncDone:r}=t;return this.spaceName=e,setTimeout(r,150),await n(50),{private:{get:async e=>{await n(50);return await i(`${this.address}-${this.spaceName}-${e}`)},set:async(e,t)=>(await async function(e,t){return(await window.fetch("http://localhost:8889",{method:"POST",body:JSON.stringify({key:e,data:t})})).text()}(`${this.address}-${this.spaceName}-${e}`,t),await n(50),null)}}},logout:()=>undefined})}static async getConfig(e){return await i(`${e}-metamask-metamaskBackup`)?{spaces:{metamask:{}}}:{}}}}}},{package:"$root$"}],[1600,{"./asn1/api":1601,"./asn1/base":1603,"./asn1/constants":1607,"./asn1/decoders":1609,"./asn1/encoders":1612,"bn.js":1952},function(){with(this)return function(){"use strict";return function(e,t,r){const n=r;n.bignum=e("bn.js"),n.define=e("./asn1/api").define,n.base=e("./asn1/base"),n.constants=e("./asn1/constants"),n.decoders=e("./asn1/decoders"),n.encoders=e("./asn1/encoders")}}},{package:"3box>ipfs>libp2p-crypto>asn1.js"}],[1601,{"./decoders":1609,"./encoders":1612,inherits:4319},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("./encoders"),i=e("./decoders"),a=e("inherits");function s(e,t){this.name=e,this.body=t,this.decoders={},this.encoders={}}r.define=function(e,t){return new s(e,t)},s.prototype._createNamed=function(e){const t=this.name;function r(e){this._initNamed(e,t)}return a(r,e),r.prototype._initNamed=function(t,r){e.call(this,t,r)},new r(this)},s.prototype._getDecoder=function(e){return e=e||"der",this.decoders.hasOwnProperty(e)||(this.decoders[e]=this._createNamed(i[e])),this.decoders[e]},s.prototype.decode=function(e,t,r){return this._getDecoder(t).decode(e,r)},s.prototype._getEncoder=function(e){return e=e||"der",this.encoders.hasOwnProperty(e)||(this.encoders[e]=this._createNamed(n[e])),this.encoders[e]},s.prototype.encode=function(e,t,r){return this._getEncoder(t).encode(e,r)}}}},{package:"3box>ipfs>libp2p-crypto>asn1.js"}],[1602,{"../base/reporter":1605,buffer:1996,inherits:4319},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("inherits"),i=e("../base/reporter").Reporter,a=e("buffer").Buffer;function s(e,t){i.call(this,t),a.isBuffer(e)?(this.base=e,this.offset=0,this.length=e.length):this.error("Input not Buffer")}function o(e,t){if(Array.isArray(e))this.length=0,this.value=e.map((function(e){return o.isEncoderBuffer(e)||(e=new o(e,t)),this.length+=e.length,e}),this);else if("number"==typeof e){if(!(0<=e&&e<=255))return t.error("non-byte EncoderBuffer value");this.value=e,this.length=1}else if("string"==typeof e)this.value=e,this.length=a.byteLength(e);else{if(!a.isBuffer(e))return t.error("Unsupported type: "+typeof e);this.value=e,this.length=e.length}}n(s,i),r.DecoderBuffer=s,s.isDecoderBuffer=function(e){if(e instanceof s)return!0;return"object"==typeof e&&a.isBuffer(e.base)&&"DecoderBuffer"===e.constructor.name&&"number"==typeof e.offset&&"number"==typeof e.length&&"function"==typeof e.save&&"function"==typeof e.restore&&"function"==typeof e.isEmpty&&"function"==typeof e.readUInt8&&"function"==typeof e.skip&&"function"==typeof e.raw},s.prototype.save=function(){return{offset:this.offset,reporter:i.prototype.save.call(this)}},s.prototype.restore=function(e){const t=new s(this.base);return t.offset=e.offset,t.length=this.offset,this.offset=e.offset,i.prototype.restore.call(this,e.reporter),t},s.prototype.isEmpty=function(){return this.offset===this.length},s.prototype.readUInt8=function(e){return this.offset+1<=this.length?this.base.readUInt8(this.offset++,!0):this.error(e||"DecoderBuffer overrun")},s.prototype.skip=function(e,t){if(!(this.offset+e<=this.length))return this.error(t||"DecoderBuffer overrun");const r=new s(this.base);return r._reporterState=this._reporterState,r.offset=this.offset,r.length=this.offset+e,this.offset+=e,r},s.prototype.raw=function(e){return this.base.slice(e?e.offset:this.offset,this.length)},r.EncoderBuffer=o,o.isEncoderBuffer=function(e){if(e instanceof o)return!0;return"object"==typeof e&&"EncoderBuffer"===e.constructor.name&&"number"==typeof e.length&&"function"==typeof e.join},o.prototype.join=function(e,t){return e||(e=new a(this.length)),t||(t=0),0===this.length||(Array.isArray(this.value)?this.value.forEach((function(r){r.join(e,t),t+=r.length})):("number"==typeof this.value?e[t]=this.value:"string"==typeof this.value?e.write(this.value,t):a.isBuffer(this.value)&&this.value.copy(e,t),t+=this.length)),e}}}},{package:"3box>ipfs>libp2p-crypto>asn1.js"}],[1603,{"./buffer":1602,"./node":1604,"./reporter":1605},function(){with(this)return function(){"use strict";return function(e,t,r){const n=r;n.Reporter=e("./reporter").Reporter,n.DecoderBuffer=e("./buffer").DecoderBuffer,n.EncoderBuffer=e("./buffer").EncoderBuffer,n.Node=e("./node")}}},{package:"3box>ipfs>libp2p-crypto>asn1.js"}],[1604,{"../base/buffer":1602,"../base/reporter":1605,"minimalistic-assert":5119},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("../base/reporter").Reporter,i=e("../base/buffer").EncoderBuffer,a=e("../base/buffer").DecoderBuffer,s=e("minimalistic-assert"),o=["seq","seqof","set","setof","objid","bool","gentime","utctime","null_","enum","int","objDesc","bitstr","bmpstr","charstr","genstr","graphstr","ia5str","iso646str","numstr","octstr","printstr","t61str","unistr","utf8str","videostr"],u=["key","obj","use","optional","explicit","implicit","def","choice","any","contains"].concat(o);function c(e,t,r){const n={};this._baseState=n,n.name=r,n.enc=e,n.parent=t||null,n.children=null,n.tag=null,n.args=null,n.reverseArgs=null,n.choice=null,n.optional=!1,n.any=!1,n.obj=!1,n.use=null,n.useDecoder=null,n.key=null,n.default=null,n.explicit=null,n.implicit=null,n.contains=null,n.parent||(n.children=[],this._wrap())}t.exports=c;const l=["enc","parent","children","tag","args","reverseArgs","choice","optional","any","obj","use","alteredUse","key","default","explicit","implicit","contains"];c.prototype.clone=function(){const e=this._baseState,t={};l.forEach((function(r){t[r]=e[r]}));const r=new this.constructor(t.parent);return r._baseState=t,r},c.prototype._wrap=function(){const e=this._baseState;u.forEach((function(t){this[t]=function(){const r=new this.constructor(this);return e.children.push(r),r[t].apply(r,arguments)}}),this)},c.prototype._init=function(e){const t=this._baseState;s(null===t.parent),e.call(this),t.children=t.children.filter((function(e){return e._baseState.parent===this}),this),s.equal(t.children.length,1,"Root node can have only one child")},c.prototype._useArgs=function(e){const t=this._baseState,r=e.filter((function(e){return e instanceof this.constructor}),this);e=e.filter((function(e){return!(e instanceof this.constructor)}),this),0!==r.length&&(s(null===t.children),t.children=r,r.forEach((function(e){e._baseState.parent=this}),this)),0!==e.length&&(s(null===t.args),t.args=e,t.reverseArgs=e.map((function(e){if("object"!=typeof e||e.constructor!==Object)return e;const t={};return Object.keys(e).forEach((function(r){r==(0|r)&&(r|=0);const n=e[r];t[n]=r})),t})))},["_peekTag","_decodeTag","_use","_decodeStr","_decodeObjid","_decodeTime","_decodeNull","_decodeInt","_decodeBool","_decodeList","_encodeComposite","_encodeStr","_encodeObjid","_encodeTime","_encodeNull","_encodeInt","_encodeBool"].forEach((function(e){c.prototype[e]=function(){const t=this._baseState;throw new Error(e+" not implemented for encoding: "+t.enc)}})),o.forEach((function(e){c.prototype[e]=function(){const t=this._baseState,r=Array.prototype.slice.call(arguments);return s(null===t.tag),t.tag=e,this._useArgs(r),this}})),c.prototype.use=function(e){s(e);const t=this._baseState;return s(null===t.use),t.use=e,this},c.prototype.optional=function(){return this._baseState.optional=!0,this},c.prototype.def=function(e){const t=this._baseState;return s(null===t.default),t.default=e,t.optional=!0,this},c.prototype.explicit=function(e){const t=this._baseState;return s(null===t.explicit&&null===t.implicit),t.explicit=e,this},c.prototype.implicit=function(e){const t=this._baseState;return s(null===t.explicit&&null===t.implicit),t.implicit=e,this},c.prototype.obj=function(){const e=this._baseState,t=Array.prototype.slice.call(arguments);return e.obj=!0,0!==t.length&&this._useArgs(t),this},c.prototype.key=function(e){const t=this._baseState;return s(null===t.key),t.key=e,this},c.prototype.any=function(){return this._baseState.any=!0,this},c.prototype.choice=function(e){const t=this._baseState;return s(null===t.choice),t.choice=e,this._useArgs(Object.keys(e).map((function(t){return e[t]}))),this},c.prototype.contains=function(e){const t=this._baseState;return s(null===t.use),t.contains=e,this},c.prototype._decode=function(e,t){const r=this._baseState;if(null===r.parent)return e.wrapResult(r.children[0]._decode(e,t));let n,i=r.default,s=!0,o=null;if(null!==r.key&&(o=e.enterKey(r.key)),r.optional){let n=null;if(null!==r.explicit?n=r.explicit:null!==r.implicit?n=r.implicit:null!==r.tag&&(n=r.tag),null!==n||r.any){if(s=this._peekTag(e,n,r.any),e.isError(s))return s}else{const n=e.save();try{null===r.choice?this._decodeGeneric(r.tag,e,t):this._decodeChoice(e,t),s=!0}catch(e){s=!1}e.restore(n)}}if(r.obj&&s&&(n=e.enterObject()),s){if(null!==r.explicit){const t=this._decodeTag(e,r.explicit);if(e.isError(t))return t;e=t}const n=e.offset;if(null===r.use&&null===r.choice){let t;r.any&&(t=e.save());const n=this._decodeTag(e,null!==r.implicit?r.implicit:r.tag,r.any);if(e.isError(n))return n;r.any?i=e.raw(t):e=n}if(t&&t.track&&null!==r.tag&&t.track(e.path(),n,e.length,"tagged"),t&&t.track&&null!==r.tag&&t.track(e.path(),e.offset,e.length,"content"),r.any||(i=null===r.choice?this._decodeGeneric(r.tag,e,t):this._decodeChoice(e,t)),e.isError(i))return i;if(r.any||null!==r.choice||null===r.children||r.children.forEach((function(r){r._decode(e,t)})),r.contains&&("octstr"===r.tag||"bitstr"===r.tag)){const n=new a(i);i=this._getUse(r.contains,e._reporterState.obj)._decode(n,t)}}return r.obj&&s&&(i=e.leaveObject(n)),null===r.key||null===i&&!0!==s?null!==o&&e.exitKey(o):e.leaveKey(o,r.key,i),i},c.prototype._decodeGeneric=function(e,t,r){const n=this._baseState;return"seq"===e||"set"===e?null:"seqof"===e||"setof"===e?this._decodeList(t,e,n.args[0],r):/str$/.test(e)?this._decodeStr(t,e,r):"objid"===e&&n.args?this._decodeObjid(t,n.args[0],n.args[1],r):"objid"===e?this._decodeObjid(t,null,null,r):"gentime"===e||"utctime"===e?this._decodeTime(t,e,r):"null_"===e?this._decodeNull(t,r):"bool"===e?this._decodeBool(t,r):"objDesc"===e?this._decodeStr(t,e,r):"int"===e||"enum"===e?this._decodeInt(t,n.args&&n.args[0],r):null!==n.use?this._getUse(n.use,t._reporterState.obj)._decode(t,r):t.error("unknown tag: "+e)},c.prototype._getUse=function(e,t){const r=this._baseState;return r.useDecoder=this._use(e,t),s(null===r.useDecoder._baseState.parent),r.useDecoder=r.useDecoder._baseState.children[0],r.implicit!==r.useDecoder._baseState.implicit&&(r.useDecoder=r.useDecoder.clone(),r.useDecoder._baseState.implicit=r.implicit),r.useDecoder},c.prototype._decodeChoice=function(e,t){const r=this._baseState;let n=null,i=!1;return Object.keys(r.choice).some((function(a){const s=e.save(),o=r.choice[a];try{const r=o._decode(e,t);if(e.isError(r))return!1;n={type:a,value:r},i=!0}catch(t){return e.restore(s),!1}return!0}),this),i?n:e.error("Choice not matched")},c.prototype._createEncoderBuffer=function(e){return new i(e,this.reporter)},c.prototype._encode=function(e,t,r){const n=this._baseState;if(null!==n.default&&n.default===e)return;const i=this._encodeValue(e,t,r);return i===undefined||this._skipDefault(i,t,r)?void 0:i},c.prototype._encodeValue=function(e,t,r){const i=this._baseState;if(null===i.parent)return i.children[0]._encode(e,t||new n);let a=null;if(this.reporter=t,i.optional&&e===undefined){if(null===i.default)return;e=i.default}let s=null,o=!1;if(i.any)a=this._createEncoderBuffer(e);else if(i.choice)a=this._encodeChoice(e,t);else if(i.contains)s=this._getUse(i.contains,r)._encode(e,t),o=!0;else if(i.children)s=i.children.map((function(r){if("null_"===r._baseState.tag)return r._encode(null,t,e);if(null===r._baseState.key)return t.error("Child should have a key");const n=t.enterKey(r._baseState.key);if("object"!=typeof e)return t.error("Child expected, but input is not object");const i=r._encode(e[r._baseState.key],t,e);return t.leaveKey(n),i}),this).filter((function(e){return e})),s=this._createEncoderBuffer(s);else if("seqof"===i.tag||"setof"===i.tag){if(!i.args||1!==i.args.length)return t.error("Too many args for : "+i.tag);if(!Array.isArray(e))return t.error("seqof/setof, but data is not Array");const r=this.clone();r._baseState.implicit=null,s=this._createEncoderBuffer(e.map((function(r){const n=this._baseState;return this._getUse(n.args[0],e)._encode(r,t)}),r))}else null!==i.use?a=this._getUse(i.use,r)._encode(e,t):(s=this._encodePrimitive(i.tag,e),o=!0);if(!i.any&&null===i.choice){const e=null!==i.implicit?i.implicit:i.tag,r=null===i.implicit?"universal":"context";null===e?null===i.use&&t.error("Tag could be omitted only for .use()"):null===i.use&&(a=this._encodeComposite(e,o,r,s))}return null!==i.explicit&&(a=this._encodeComposite(i.explicit,!1,"context",a)),a},c.prototype._encodeChoice=function(e,t){const r=this._baseState,n=r.choice[e.type];return n||s(!1,e.type+" not found in "+JSON.stringify(Object.keys(r.choice))),n._encode(e.value,t)},c.prototype._encodePrimitive=function(e,t){const r=this._baseState;if(/str$/.test(e))return this._encodeStr(t,e);if("objid"===e&&r.args)return this._encodeObjid(t,r.reverseArgs[0],r.args[1]);if("objid"===e)return this._encodeObjid(t,null,null);if("gentime"===e||"utctime"===e)return this._encodeTime(t,e);if("null_"===e)return this._encodeNull();if("int"===e||"enum"===e)return this._encodeInt(t,r.args&&r.reverseArgs[0]);if("bool"===e)return this._encodeBool(t);if("objDesc"===e)return this._encodeStr(t,e);throw new Error("Unsupported tag: "+e)},c.prototype._isNumstr=function(e){return/^[0-9 ]*$/.test(e)},c.prototype._isPrintstr=function(e){return/^[A-Za-z0-9 '()+,-./:=?]*$/.test(e)}}}},{package:"3box>ipfs>libp2p-crypto>asn1.js"}],[1605,{inherits:4319},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("inherits");function i(e){this._reporterState={obj:null,path:[],options:e||{},errors:[]}}function a(e,t){this.path=e,this.rethrow(t)}r.Reporter=i,i.prototype.isError=function(e){return e instanceof a},i.prototype.save=function(){const e=this._reporterState;return{obj:e.obj,pathLen:e.path.length}},i.prototype.restore=function(e){const t=this._reporterState;t.obj=e.obj,t.path=t.path.slice(0,e.pathLen)},i.prototype.enterKey=function(e){return this._reporterState.path.push(e)},i.prototype.exitKey=function(e){const t=this._reporterState;t.path=t.path.slice(0,e-1)},i.prototype.leaveKey=function(e,t,r){const n=this._reporterState;this.exitKey(e),null!==n.obj&&(n.obj[t]=r)},i.prototype.path=function(){return this._reporterState.path.join("/")},i.prototype.enterObject=function(){const e=this._reporterState,t=e.obj;return e.obj={},t},i.prototype.leaveObject=function(e){const t=this._reporterState,r=t.obj;return t.obj=e,r},i.prototype.error=function(e){let t;const r=this._reporterState,n=e instanceof a;if(t=n?e:new a(r.path.map((function(e){return"["+JSON.stringify(e)+"]"})).join(""),e.message||e,e.stack),!r.options.partial)throw t;return n||r.errors.push(t),t},i.prototype.wrapResult=function(e){const t=this._reporterState;return t.options.partial?{result:this.isError(e)?null:e,errors:t.errors}:e},n(a,Error),a.prototype.rethrow=function(e){if(this.message=e+" at: "+(this.path||"(shallow)"),Error.captureStackTrace&&Error.captureStackTrace(this,a),!this.stack)try{throw new Error(this.message)}catch(e){this.stack=e.stack}return this}}}},{package:"3box>ipfs>libp2p-crypto>asn1.js"}],[1606,{},function(){with(this)return function(){"use strict";return function(e,t,r){function n(e){const t={};return Object.keys(e).forEach((function(r){(0|r)==r&&(r|=0);const n=e[r];t[n]=r})),t}r.tagClass={0:"universal",1:"application",2:"context",3:"private"},r.tagClassByName=n(r.tagClass),r.tag={0:"end",1:"bool",2:"int",3:"bitstr",4:"octstr",5:"null_",6:"objid",7:"objDesc",8:"external",9:"real",10:"enum",11:"embed",12:"utf8str",13:"relativeOid",16:"seq",17:"set",18:"numstr",19:"printstr",20:"t61str",21:"videostr",22:"ia5str",23:"utctime",24:"gentime",25:"graphstr",26:"iso646str",27:"genstr",28:"unistr",29:"charstr",30:"bmpstr"},r.tagByName=n(r.tag)}}},{package:"3box>ipfs>libp2p-crypto>asn1.js"}],[1607,{"./der":1606},function(){with(this)return function(){"use strict";return function(e,t,r){const n=r;n._reverse=function(e){const t={};return Object.keys(e).forEach((function(r){(0|r)==r&&(r|=0);const n=e[r];t[n]=r})),t},n.der=e("./der")}}},{package:"3box>ipfs>libp2p-crypto>asn1.js"}],[1608,{"../base/buffer":1602,"../base/node":1604,"../constants/der":1606,"bn.js":1952,inherits:4319},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("inherits"),i=e("bn.js"),a=e("../base/buffer").DecoderBuffer,s=e("../base/node"),o=e("../constants/der");function u(e){this.enc="der",this.name=e.name,this.entity=e,this.tree=new c,this.tree._init(e.body)}function c(e){s.call(this,"der",e)}function l(e,t){let r=e.readUInt8(t);if(e.isError(r))return r;const n=o.tagClass[r>>6],i=0==(32&r);if(31==(31&r)){let n=r;for(r=0;128==(128&n);){if(n=e.readUInt8(t),e.isError(n))return n;r<<=7,r|=127&n}}else r&=31;return{cls:n,primitive:i,tag:r,tagStr:o.tag[r]}}function f(e,t,r){let n=e.readUInt8(r);if(e.isError(n))return n;if(!t&&128===n)return null;if(0==(128&n))return n;const i=127&n;if(i>4)return e.error("length octect is too long");n=0;for(let t=0;t<i;t++){n<<=8;const t=e.readUInt8(r);if(e.isError(t))return t;n|=t}return n}t.exports=u,u.prototype.decode=function(e,t){return a.isDecoderBuffer(e)||(e=new a(e,t)),this.tree._decode(e,t)},n(c,s),c.prototype._peekTag=function(e,t,r){if(e.isEmpty())return!1;const n=e.save(),i=l(e,'Failed to peek tag: "'+t+'"');return e.isError(i)?i:(e.restore(n),i.tag===t||i.tagStr===t||i.tagStr+"of"===t||r)},c.prototype._decodeTag=function(e,t,r){const n=l(e,'Failed to decode tag of "'+t+'"');if(e.isError(n))return n;let i=f(e,n.primitive,'Failed to get length of "'+t+'"');if(e.isError(i))return i;if(!r&&n.tag!==t&&n.tagStr!==t&&n.tagStr+"of"!==t)return e.error('Failed to match tag: "'+t+'"');if(n.primitive||null!==i)return e.skip(i,'Failed to match body of: "'+t+'"');const a=e.save(),s=this._skipUntilEnd(e,'Failed to skip indefinite length body: "'+this.tag+'"');return e.isError(s)?s:(i=e.offset-a.offset,e.restore(a),e.skip(i,'Failed to match body of: "'+t+'"'))},c.prototype._skipUntilEnd=function(e,t){for(;;){const r=l(e,t);if(e.isError(r))return r;const n=f(e,r.primitive,t);if(e.isError(n))return n;let i;if(i=r.primitive||null!==n?e.skip(n):this._skipUntilEnd(e,t),e.isError(i))return i;if("end"===r.tagStr)break}},c.prototype._decodeList=function(e,t,r,n){const i=[];for(;!e.isEmpty();){const t=this._peekTag(e,"end");if(e.isError(t))return t;const a=r.decode(e,"der",n);if(e.isError(a)&&t)break;i.push(a)}return i},c.prototype._decodeStr=function(e,t){if("bitstr"===t){const t=e.readUInt8();return e.isError(t)?t:{unused:t,data:e.raw()}}if("bmpstr"===t){const t=e.raw();if(t.length%2==1)return e.error("Decoding of string type: bmpstr length mismatch");let r="";for(let e=0;e<t.length/2;e++)r+=String.fromCharCode(t.readUInt16BE(2*e));return r}if("numstr"===t){const t=e.raw().toString("ascii");return this._isNumstr(t)?t:e.error("Decoding of string type: "+"numstr unsupported characters")}if("octstr"===t)return e.raw();if("objDesc"===t)return e.raw();if("printstr"===t){const t=e.raw().toString("ascii");return this._isPrintstr(t)?t:e.error("Decoding of string type: "+"printstr unsupported characters")}return/str$/.test(t)?e.raw().toString():e.error("Decoding of string type: "+t+" unsupported")},c.prototype._decodeObjid=function(e,t,r){let n;const i=[];let a=0,s=0;for(;!e.isEmpty();)s=e.readUInt8(),a<<=7,a|=127&s,0==(128&s)&&(i.push(a),a=0);128&s&&i.push(a);const o=i[0]/40|0,u=i[0]%40;if(n=r?i:[o,u].concat(i.slice(1)),t){let e=t[n.join(" ")];e===undefined&&(e=t[n.join(".")]),e!==undefined&&(n=e)}return n},c.prototype._decodeTime=function(e,t){const r=e.raw().toString();let n,i,a,s,o,u;if("gentime"===t)n=0|r.slice(0,4),i=0|r.slice(4,6),a=0|r.slice(6,8),s=0|r.slice(8,10),o=0|r.slice(10,12),u=0|r.slice(12,14);else{if("utctime"!==t)return e.error("Decoding "+t+" time is not supported yet");n=0|r.slice(0,2),i=0|r.slice(2,4),a=0|r.slice(4,6),s=0|r.slice(6,8),o=0|r.slice(8,10),u=0|r.slice(10,12),n=n<70?2e3+n:1900+n}return Date.UTC(n,i-1,a,s,o,u,0)},c.prototype._decodeNull=function(){return null},c.prototype._decodeBool=function(e){const t=e.readUInt8();return e.isError(t)?t:0!==t},c.prototype._decodeInt=function(e,t){const r=e.raw();let n=new i(r);return t&&(n=t[n.toString(10)]||n),n},c.prototype._use=function(e,t){return"function"==typeof e&&(e=e(t)),e._getDecoder("der").tree}}}},{package:"3box>ipfs>libp2p-crypto>asn1.js"}],[1609,{"./der":1608,"./pem":1610},function(){with(this)return function(){"use strict";return function(e,t,r){const n=r;n.der=e("./der"),n.pem=e("./pem")}}},{package:"3box>ipfs>libp2p-crypto>asn1.js"}],[161,{"./legacyIpfs3boxAccessController":162,"./moderatorAccessController":163,"./odbIdentityProvider":164,"./threadAccessController":165},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("./odbIdentityProvider"),i=e("./moderatorAccessController"),a=e("./threadAccessController"),s=e("./legacyIpfs3boxAccessController");t.exports={OdbIdentityProvider:n,ModeratorAccessController:i,ThreadAccessController:a,LegacyIPFS3BoxAccessController:s}}}},{package:"3box>3box-orbitdb-plugins"}],[1610,{"./der":1608,buffer:1996,inherits:4319},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("inherits"),i=e("buffer").Buffer,a=e("./der");function s(e){a.call(this,e),this.enc="pem"}n(s,a),t.exports=s,s.prototype.decode=function(e,t){const r=e.toString().split(/[\r\n]+/g),n=t.label.toUpperCase(),s=/^-----(BEGIN|END) ([^-]+)-----$/;let o=-1,u=-1;for(let e=0;e<r.length;e++){const t=r[e].match(s);if(null!==t&&t[2]===n){if(-1!==o){if("END"!==t[1])break;u=e;break}if("BEGIN"!==t[1])break;o=e}}if(-1===o||-1===u)throw new Error("PEM section not found for: "+n);const c=r.slice(o+1,u).join("");c.replace(/[^a-z0-9+/=]+/gi,"");const l=new i(c,"base64");return a.prototype.decode.call(this,l,t)}}}},{package:"3box>ipfs>libp2p-crypto>asn1.js"}],[1611,{"../base/node":1604,"../constants/der":1606,buffer:1996,inherits:4319},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("inherits"),i=e("buffer").Buffer,a=e("../base/node"),s=e("../constants/der");function o(e){this.enc="der",this.name=e.name,this.entity=e,this.tree=new u,this.tree._init(e.body)}function u(e){a.call(this,"der",e)}function c(e){return e<10?"0"+e:e}t.exports=o,o.prototype.encode=function(e,t){return this.tree._encode(e,t).join()},n(u,a),u.prototype._encodeComposite=function(e,t,r,n){const a=function(e,t,r,n){let i;"seqof"===e?e="seq":"setof"===e&&(e="set");if(s.tagByName.hasOwnProperty(e))i=s.tagByName[e];else{if("number"!=typeof e||(0|e)!==e)return n.error("Unknown tag: "+e);i=e}if(i>=31)return n.error("Multi-octet tag encoding unsupported");t||(i|=32);return i|=s.tagClassByName[r||"universal"]<<6,i}(e,t,r,this.reporter);if(n.length<128){const e=new i(2);return e[0]=a,e[1]=n.length,this._createEncoderBuffer([e,n])}let o=1;for(let e=n.length;e>=256;e>>=8)o++;const u=new i(2+o);u[0]=a,u[1]=128|o;for(let e=1+o,t=n.length;t>0;e--,t>>=8)u[e]=255&t;return this._createEncoderBuffer([u,n])},u.prototype._encodeStr=function(e,t){if("bitstr"===t)return this._createEncoderBuffer([0|e.unused,e.data]);if("bmpstr"===t){const t=new i(2*e.length);for(let r=0;r<e.length;r++)t.writeUInt16BE(e.charCodeAt(r),2*r);return this._createEncoderBuffer(t)}return"numstr"===t?this._isNumstr(e)?this._createEncoderBuffer(e):this.reporter.error("Encoding of string type: numstr supports "+"only digits and space"):"printstr"===t?this._isPrintstr(e)?this._createEncoderBuffer(e):this.reporter.error("Encoding of string type: printstr supports "+"only latin upper and lower case letters, "+"digits, space, apostrophe, left and rigth "+"parenthesis, plus sign, comma, hyphen, "+"dot, slash, colon, equal sign, "+"question mark"):/str$/.test(t)||"objDesc"===t?this._createEncoderBuffer(e):this.reporter.error("Encoding of string type: "+t+" unsupported")},u.prototype._encodeObjid=function(e,t,r){if("string"==typeof e){if(!t)return this.reporter.error("string objid given, but no values map found");if(!t.hasOwnProperty(e))return this.reporter.error("objid not found in values map");e=t[e].split(/[\s.]+/g);for(let t=0;t<e.length;t++)e[t]|=0}else if(Array.isArray(e)){e=e.slice();for(let t=0;t<e.length;t++)e[t]|=0}if(!Array.isArray(e))return this.reporter.error("objid() should be either array or string, "+"got: "+JSON.stringify(e));if(!r){if(e[1]>=40)return this.reporter.error("Second objid identifier OOB");e.splice(0,2,40*e[0]+e[1])}let n=0;for(let t=0;t<e.length;t++){let r=e[t];for(n++;r>=128;r>>=7)n++}const a=new i(n);let s=a.length-1;for(let t=e.length-1;t>=0;t--){let r=e[t];for(a[s--]=127&r;(r>>=7)>0;)a[s--]=128|127&r}return this._createEncoderBuffer(a)},u.prototype._encodeTime=function(e,t){let r;const n=new Date(e);return"gentime"===t?r=[c(n.getUTCFullYear()),c(n.getUTCMonth()+1),c(n.getUTCDate()),c(n.getUTCHours()),c(n.getUTCMinutes()),c(n.getUTCSeconds()),"Z"].join(""):"utctime"===t?r=[c(n.getUTCFullYear()%100),c(n.getUTCMonth()+1),c(n.getUTCDate()),c(n.getUTCHours()),c(n.getUTCMinutes()),c(n.getUTCSeconds()),"Z"].join(""):this.reporter.error("Encoding "+t+" time is not supported yet"),this._encodeStr(r,"octstr")},u.prototype._encodeNull=function(){return this._createEncoderBuffer("")},u.prototype._encodeInt=function(e,t){if("string"==typeof e){if(!t)return this.reporter.error("String int or enum given, but no values map");if(!t.hasOwnProperty(e))return this.reporter.error("Values map doesn't contain: "+JSON.stringify(e));e=t[e]}if("number"!=typeof e&&!i.isBuffer(e)){const t=e.toArray();!e.sign&&128&t[0]&&t.unshift(0),e=new i(t)}if(i.isBuffer(e)){let t=e.length;0===e.length&&t++;const r=new i(t);return e.copy(r),0===e.length&&(r[0]=0),this._createEncoderBuffer(r)}if(e<128)return this._createEncoderBuffer(e);if(e<256)return this._createEncoderBuffer([0,e]);let r=1;for(let t=e;t>=256;t>>=8)r++;const n=new Array(r);for(let t=n.length-1;t>=0;t--)n[t]=255&e,e>>=8;return 128&n[0]&&n.unshift(0),this._createEncoderBuffer(new i(n))},u.prototype._encodeBool=function(e){return this._createEncoderBuffer(e?255:0)},u.prototype._use=function(e,t){return"function"==typeof e&&(e=e(t)),e._getEncoder("der").tree},u.prototype._skipDefault=function(e,t,r){const n=this._baseState;let i;if(null===n.default)return!1;const a=e.join();if(n.defaultBuffer===undefined&&(n.defaultBuffer=this._encodeValue(n.default,t,r).join()),a.length!==n.defaultBuffer.length)return!1;for(i=0;i<a.length;i++)if(a[i]!==n.defaultBuffer[i])return!1;return!0}}}},{package:"3box>ipfs>libp2p-crypto>asn1.js"}],[1612,{"./der":1611,"./pem":1613},function(){with(this)return function(){"use strict";return function(e,t,r){const n=r;n.der=e("./der"),n.pem=e("./pem")}}},{package:"3box>ipfs>libp2p-crypto>asn1.js"}],[1613,{"./der":1611,inherits:4319},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("inherits"),i=e("./der");function a(e){i.call(this,e),this.enc="pem"}n(a,i),t.exports=a,a.prototype.encode=function(e,t){const r=i.prototype.encode.call(this,e).toString("base64"),n=["-----BEGIN "+t.label+"-----"];for(let e=0;e<r.length;e+=64)n.push(r.slice(e,e+64));return n.push("-----END "+t.label+"-----"),n.join("\n")}}}},{package:"3box>ipfs>libp2p-crypto>asn1.js"}],[1614,{},function(){with(this)return function(){"use strict";return function(e,t,r){const n="undefined"!=typeof BigUint64Array,i=Symbol();function a(e,t,r){var n=r+4>>>1,i=e[r>>>2],a=[];const s=1024;for(;i>s;){let e=t[n+s-1],r=e>=55296&&e<56320?1023:s,o=t.subarray(n,n+=r);a.push(String.fromCharCode.apply(String,o)),i-=r}return a.join("")+String.fromCharCode.apply(String,t.subarray(n,n+i))}function s(e){var t={};function r(e,t){if(!e)return"<yet unknown>";var r=e.buffer;return a(new Uint32Array(r),new Uint16Array(r),t)}var n=e.env=e.env||{};return n.abort=n.abort||function(e,i,a,s){var o=t.memory||n.memory;throw Error("abort: "+r(o,e)+" at "+r(o,i)+":"+a+":"+s)},n.trace=n.trace||function(e,i){var a=t.memory||n.memory;console.log("trace: "+r(a,e)+(i?" ":"")+Array.prototype.slice.call(arguments,2,2+i).join(", "))},e.Math=e.Math||Math,e.Date=e.Date||Date,t}function o(e,t){var r,i,s,o,c,f,d,p,h,m,y,b=t.exports,g=b.memory,v=b["memory.allocate"],w=b["memory.fill"],_=b["memory.free"],k=b.table,S=b._setargc||function(){};function x(){r!==g.buffer&&(r=g.buffer,i=new Int8Array(r),s=new Uint8Array(r),o=new Int16Array(r),c=new Uint16Array(r),f=new Int32Array(r),d=new Uint32Array(r),n&&(m=new BigInt64Array(r),y=new BigUint64Array(r)),p=new Float32Array(r),h=new Float64Array(r))}return x(),e.newString=function(e){var t=e.length,r=v(4+(t<<1)),n=4+r>>>1;x(),d[r>>>2]=t;for(let r=0;r<t;++r)c[n+r]=e.charCodeAt(r);return r},e.getString=function(e){return x(),a(d,c,e)},e.newArray=function(e,t,n){var i=e.constructor;i===Function?(i=e,e=null):t===undefined&&(t=e.length);var a=i.BYTES_PER_ELEMENT;if(!a)throw Error("not a typed array");var s=a*t,o=v(12),u=v(function(e){return 1<<32-Math.clz32(e+8-1)}(s));if(x(),d[o>>>2]=u,d[o+4>>>2]=0,d[o+8>>>2]=s,d[u>>>2]=s,d[u+4>>>2]=0,e){if(new i(r,u+8,t).set(e),e.length<t&&!n){let t=a*e.length;w(u+8+t,0,s-t)}}else n||w(u+8,0,s);return o},e.getArray=function(e,t){var n=e.BYTES_PER_ELEMENT;if(!n)throw Error("not a typed array");x();var i=d[t>>>2],a=d[t+4>>>2],s=d[t+8>>>2];return new e(r,i+8+a,(s-a)/n)},e.freeArray=function(e){x();var t=d[e>>>2];_(t),_(e)},e.newFunction=function(e){"function"==typeof e.original&&(e=e.original);var t=k.length;return k.grow(1),k.set(t,e),t},e.getFunction=function(e){return u(k.get(e),S)},e.memory=e.memory||g,e.table=e.table||k,l(b,Object.defineProperties(e,{I8:{get:function(){return x(),i}},U8:{get:function(){return x(),s}},I16:{get:function(){return x(),o}},U16:{get:function(){return x(),c}},I32:{get:function(){return x(),f}},U32:{get:function(){return x(),d}},I64:{get:function(){return x(),m}},U64:{get:function(){return x(),y}},F32:{get:function(){return x(),p}},F64:{get:function(){return x(),h}}}))}function u(e,t){var r=(...r)=>(t(r.length),e(...r));return r.original=e,r}function c(e,t){return o(s(t||(t={})),new WebAssembly.Instance(e,t))}function l(e,t){var r=t?Object.create(t):{},n=e._setargc||function(){};function a(e,t){return Object.prototype.hasOwnProperty.call(e,t)}for(let t in e){if(!a(e,t))continue;let s=e[t],o=t.split("."),c=r;for(;o.length>1;){let e=o.shift();a(c,e)||(c[e]={}),c=c[e]}let l=o[0],f=l.indexOf("#");if(f>=0){let r=l.substring(0,f),o=c[r];if(void 0===o||!o.prototype){let e=function(...t){return e.wrap(e.prototype.constructor(0,...t))};e.prototype={},e.wrap=function(t){return Object.create(e.prototype,{[i]:{value:t,writable:!1}})},o&&Object.getOwnPropertyNames(o).forEach((t=>Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t)))),c[r]=e}if(l=l.substring(f+1),c=c[r].prototype,/^(get|set):/.test(l)){if(!a(c,l=l.substring(4))){let r=e[t.replace("set:","get:")],n=e[t.replace("get:","set:")];Object.defineProperty(c,l,{get:function(){return r(this[i])},set:function(e){n(this[i],e)},enumerable:!0})}}else"constructor"===l?c[l]=u(s,n):Object.defineProperty(c,l,{value:function(...e){return n(e.length),s(this[i],...e)}})}else/^(get|set):/.test(l)?a(c,l=l.substring(4))||Object.defineProperty(c,l,{get:e[t.replace("set:","get:")],set:e[t.replace("get:","set:")],enumerable:!0}):c[l]="function"==typeof s?u(s,n):s}return r}r.instantiate=c,r.instantiateBuffer=function(e,t){return c(new WebAssembly.Module(e),t)},r.instantiateStreaming=async function(e,t){return o(s(t||(t={})),(await WebAssembly.instantiateStreaming(e,t)).instance)},r.demangle=l}}},{package:"3box>ipfs>ipfs-unixfs-importer>rabin-wasm>assemblyscript"}],[1619,{},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=async e=>{const t=[];for await(const r of e)t.push(r);return t}}}},{package:"3box>ipfs>async-iterator-all"}],[162,{"did-resolver":2189,"orbit-db-io":5258,"safe-buffer":5660},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("orbit-db-io"),i=e("safe-buffer").Buffer,a=e("did-resolver").default;class s{constructor(e,t){this._ipfs=e,this._write=Array.from(t.write||[])}static get type(){return"legacy-ipfs-3box"}get write(){return this._write}async canAppend(e,t){const r=0===e.v?e.key:await(async e=>{const t=await a(e);return t.publicKey.find((e=>{const r=e.id.split("#");return r[0]===t.id&&("subSigningKey"===r[1]||"signingKey"===r[1])})).publicKeyHex})(e.identity.id);return!(!this.write.includes(r)&&!this.write.includes("*"))&&(0===e.v||await t.verifyIdentity(e.identity))}async load(e){0===e.indexOf("/ipfs")&&(e=e.split("/")[2]);try{const t=await n.read(this._ipfs,e);this._write=t.write}catch(e){console.log("LegacyIPFS3BoxAccessController.load ERROR:",e)}}async save(e){let t;const r={admin:[],write:this.write,read:[]};try{t=await n.write(this._ipfs,"raw",i.from(JSON.stringify(r,null,2)),{format:"dag-pb"})}catch(e){console.log("LegacyIPFS3BoxAccessController.save ERROR:",e)}return{address:t,skipManifest:!0}}static async create(e,t={}){return t={...t,write:t.write||[e.identity.publicKey]},new s(e._ipfs,t)}}t.exports=s}}},{package:"3box>3box-orbitdb-plugins"}],[1620,{},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=async function*(e,t){let r=[];for await(const n of e)for(r=r.concat(n);r.length>=t;)yield r.slice(0,t),r=r.slice(t);for(;r.length;)yield r.slice(0,t),r=r.slice(t)}}}},{package:"3box>ipfs>ipfs-unixfs-importer>async-iterator-batch"}],[1621,{},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=async e=>{for await(const t of e)return t}}}},{package:"3box>ipfs>ipfs-unixfs-importer>async-iterator-first"}],[1622,{},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=async e=>{let t;for await(const r of e)t=r;return t}}}},{package:"3box>ipfs>ipfs-mfs>async-iterator-last"}],[1623,{"get-iterator":4226,"pull-stream-to-async-iterator":5397},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("get-iterator"),i=e("pull-stream-to-async-iterator");function a(e){return e=n(e),async(t,r)=>{if(t){if(e.return)try{await e.return()}catch(e){return r(e)}return r(t)}let n;try{n=await e.next()}catch(e){return r(e)}if(n.done)return r(!0);r(null,n.value)}}a.source=a,a.transform=a.through=e=>t=>a(e(i(t))),a.duplex=e=>({sink:a.sink(e.sink),source:a(e.source)}),a.sink=e=>t=>{e({[Symbol.asyncIterator](){return this},next:()=>new Promise(((e,r)=>{t(null,((t,n)=>!0===t?e({done:!0,value:n}):t?r(t):void e({done:!1,value:n})))})),return:()=>new Promise(((e,r)=>{t(!0,((t,n)=>{if(t&&!0!==t)return r(t);e({done:!0,value:n})}))})),throw:e=>new Promise(((r,n)=>{t(e,((e,t)=>{if(e&&!0!==e)return n(e);r({done:!0,value:t})}))}))})},t.exports=a}}},{package:"3box>ipfs>async-iterator-to-pull-stream"}],[1624,{_process:5342,"readable-stream":1639},function(){with(this)return function(){"use strict";return function(e,t,r){(function(r){(function(){function n(){return n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},n.apply(this,arguments)}function i(e,t,r,n,i,a,s){try{var o=e[a](s),u=o.value}catch(e){return void r(e)}o.done?t(u):Promise.resolve(u).then(n,i)}function a(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var s=e.apply(t,r);function o(e){i(s,n,a,o,u,"next",e)}function u(e){i(s,n,a,o,u,"throw",e)}o(undefined)}))}}const s=e("readable-stream").Readable,o="function"==typeof Symbol?e=>{const t=Symbol[e];return t!==undefined?t:`@@${e}`}:e=>`@@${e}`,u=l.$$asyncIterator=o("asyncIterator"),c=l.$$iterator=o("iterator");function l(e,t){if("function"==typeof e)return function(){return l(e.apply(this,arguments),t)};const n=e.then;if("function"==typeof n)return n.call(e,(e=>l(e,t)));const i=(e=>{let t;return"function"==typeof(t=e[u])||"function"==typeof(t=e[c])?t.call(e):e})(e),o="return"in i,f=t instanceof s?t:new s(t);var d;o&&(f._destroy=(d=a((function*(e,t){try{yield null!=e?i.throw(e):i.return()}catch(e){return t(e)}t(e)})),function(e,t){return d.apply(this,arguments)}));let p=!1;var h;return f._read=(h=a((function*(e){if(!p){p=!0;try{let t;do{let r=i.next(e);if("function"==typeof r.then)r=yield r;else for(;!r.done&&null!=(t=r.value)&&"function"==typeof t.then;){try{t=yield t}catch(e){r=i.throw(e);continue}r=i.next(t)}if(r.done)return f.push(null);t=r.value}while(t===undefined||f.push(t))}catch(e){r.nextTick(f.emit.bind(f,"error",e))}finally{p=!1}}})),function(e){return h.apply(this,arguments)}),f}t.exports=l,l.obj=(e,t)=>l(e,n({objectMode:!0},t))}).call(this)}).call(this,e("_process"))}}},{package:"3box>ipfs>async-iterator-to-stream"}],[1625,{},function(){with(this)return function(){"use strict";return function(e,t,r){var n={};function i(e,t,r){r||(r=Error);var i=function(e){var r,n;function i(r,n,i){return e.call(this,function(e,r,n){return"string"==typeof t?t:t(e,r,n)}(r,n,i))||this}return n=e,(r=i).prototype=Object.create(n.prototype),r.prototype.constructor=r,r.__proto__=n,i}(r);i.prototype.name=r.name,i.prototype.code=e,n[e]=i}function a(e,t){if(Array.isArray(e)){var r=e.length;return e=e.map((function(e){return String(e)})),r>2?"one of ".concat(t," ").concat(e.slice(0,r-1).join(", "),", or ")+e[r-1]:2===r?"one of ".concat(t," ").concat(e[0]," or ").concat(e[1]):"of ".concat(t," ").concat(e[0])}return"of ".concat(t," ").concat(String(e))}i("ERR_INVALID_OPT_VALUE",(function(e,t){return'The value "'+t+'" is invalid for option "'+e+'"'}),TypeError),i("ERR_INVALID_ARG_TYPE",(function(e,t,r){var n,i,s,o;if("string"==typeof t&&(i="not ",t.substr(!s||s<0?0:+s,i.length)===i)?(n="must not be",t=t.replace(/^not /,"")):n="must be",function(e,t,r){return(r===undefined||r>e.length)&&(r=e.length),e.substring(r-t.length,r)===t}(e," argument"))o="The ".concat(e," ").concat(n," ").concat(a(t,"type"));else{var u=function(e,t,r){return"number"!=typeof r&&(r=0),!(r+t.length>e.length)&&-1!==e.indexOf(t,r)}(e,".")?"property":"argument";o='The "'.concat(e,'" ').concat(u," ").concat(n," ").concat(a(t,"type"))}return o+=". Received type ".concat(typeof r)}),TypeError),i("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),i("ERR_METHOD_NOT_IMPLEMENTED",(function(e){return"The "+e+" method is not implemented"})),i("ERR_STREAM_PREMATURE_CLOSE","Premature close"),i("ERR_STREAM_DESTROYED",(function(e){return"Cannot call "+e+" after a stream was destroyed"})),i("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),i("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),i("ERR_STREAM_WRITE_AFTER_END","write after end"),i("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),i("ERR_UNKNOWN_ENCODING",(function(e){return"Unknown encoding: "+e}),TypeError),i("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),t.exports.codes=n}}},{package:"3box>ipfs>async-iterator-to-stream>readable-stream"}],[1626,{"./_stream_readable":1628,"./_stream_writable":1630,_process:5342,inherits:4319},function(){with(this)return function(){"use strict";return function(e,t,r){(function(r){(function(){var n=Object.keys||function(e){var t=[];for(var r in e)t.push(r);return t};t.exports=c;var i=e("./_stream_readable"),a=e("./_stream_writable");e("inherits")(c,i);for(var s=n(a.prototype),o=0;o<s.length;o++){var u=s[o];c.prototype[u]||(c.prototype[u]=a.prototype[u])}function c(e){if(!(this instanceof c))return new c(e);i.call(this,e),a.call(this,e),this.allowHalfOpen=!0,e&&(!1===e.readable&&(this.readable=!1),!1===e.writable&&(this.writable=!1),!1===e.allowHalfOpen&&(this.allowHalfOpen=!1,this.once("end",l)))}function l(){this._writableState.ended||r.nextTick(f,this)}function f(e){e.end()}Object.defineProperty(c.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(c.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(c.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(c.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState!==undefined&&this._writableState!==undefined&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(e){this._readableState!==undefined&&this._writableState!==undefined&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}})}).call(this)}).call(this,e("_process"))}}},{package:"3box>ipfs>async-iterator-to-stream>readable-stream"}],[1627,{"./_stream_transform":1629,inherits:4319},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=i;var n=e("./_stream_transform");function i(e){if(!(this instanceof i))return new i(e);n.call(this,e)}e("inherits")(i,n),i.prototype._transform=function(e,t,r){r(null,e)}}}},{package:"3box>ipfs>async-iterator-to-stream>readable-stream"}],[1628,{"../errors":1625,"./_stream_duplex":1626,"./internal/streams/async_iterator":1631,"./internal/streams/buffer_list":1632,"./internal/streams/destroy":1633,"./internal/streams/from":1635,"./internal/streams/state":1637,"./internal/streams/stream":1638,_process:5342,buffer:1996,events:1997,inherits:4319,"string_decoder/":5818,util:1995},function(){with(this)return function(){"use strict";return function(e,t,r){(function(r){(function(){var n;t.exports=x,x.ReadableState=S;e("events").EventEmitter;var i=function(e,t){return e.listeners(t).length},a=e("./internal/streams/stream"),s=e("buffer").Buffer,o=global.Uint8Array||function(){};var u,c=e("util");u=c&&c.debuglog?c.debuglog("stream"):function(){};var l,f,d,p=e("./internal/streams/buffer_list"),h=e("./internal/streams/destroy"),m=e("./internal/streams/state").getHighWaterMark,y=e("../errors").codes,b=y.ERR_INVALID_ARG_TYPE,g=y.ERR_STREAM_PUSH_AFTER_EOF,v=y.ERR_METHOD_NOT_IMPLEMENTED,w=y.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;e("inherits")(x,a);var _=h.errorOrDestroy,k=["error","close","destroy","pause","resume"];function S(t,r,i){n=n||e("./_stream_duplex"),t=t||{},"boolean"!=typeof i&&(i=r instanceof n),this.objectMode=!!t.objectMode,i&&(this.objectMode=this.objectMode||!!t.readableObjectMode),this.highWaterMark=m(this,t,"readableHighWaterMark",i),this.buffer=new p,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=!1!==t.emitClose,this.autoDestroy=!!t.autoDestroy,this.destroyed=!1,this.defaultEncoding=t.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(l||(l=e("string_decoder/").StringDecoder),this.decoder=new l(t.encoding),this.encoding=t.encoding)}function x(t){if(n=n||e("./_stream_duplex"),!(this instanceof x))return new x(t);var r=this instanceof n;this._readableState=new S(t,this,r),this.readable=!0,t&&("function"==typeof t.read&&(this._read=t.read),"function"==typeof t.destroy&&(this._destroy=t.destroy)),a.call(this)}function E(e,t,r,n,i){u("readableAddChunk",t);var a,c=e._readableState;if(null===t)c.reading=!1,function(e,t){if(u("onEofChunk"),t.ended)return;if(t.decoder){var r=t.decoder.end();r&&r.length&&(t.buffer.push(r),t.length+=t.objectMode?1:r.length)}t.ended=!0,t.sync?A(e):(t.needReadable=!1,t.emittedReadable||(t.emittedReadable=!0,T(e)))}(e,c);else if(i||(a=function(e,t){var r;n=t,s.isBuffer(n)||n instanceof o||"string"==typeof t||t===undefined||e.objectMode||(r=new b("chunk",["string","Buffer","Uint8Array"],t));var n;return r}(c,t)),a)_(e,a);else if(c.objectMode||t&&t.length>0)if("string"==typeof t||c.objectMode||Object.getPrototypeOf(t)===s.prototype||(t=function(e){return s.from(e)}(t)),n)c.endEmitted?_(e,new w):P(e,c,t,!0);else if(c.ended)_(e,new g);else{if(c.destroyed)return!1;c.reading=!1,c.decoder&&!r?(t=c.decoder.write(t),c.objectMode||0!==t.length?P(e,c,t,!1):R(e,c)):P(e,c,t,!1)}else n||(c.reading=!1,R(e,c));return!c.ended&&(c.length<c.highWaterMark||0===c.length)}function P(e,t,r,n){t.flowing&&0===t.length&&!t.sync?(t.awaitDrain=0,e.emit("data",r)):(t.length+=t.objectMode?1:r.length,n?t.buffer.unshift(r):t.buffer.push(r),t.needReadable&&A(e)),R(e,t)}Object.defineProperty(x.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState!==undefined&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),x.prototype.destroy=h.destroy,x.prototype._undestroy=h.undestroy,x.prototype._destroy=function(e,t){t(e)},x.prototype.push=function(e,t){var r,n=this._readableState;return n.objectMode?r=!0:"string"==typeof e&&((t=t||n.defaultEncoding)!==n.encoding&&(e=s.from(e,t),t=""),r=!0),E(this,e,t,!1,r)},x.prototype.unshift=function(e){return E(this,e,null,!0,!1)},x.prototype.isPaused=function(){return!1===this._readableState.flowing},x.prototype.setEncoding=function(t){l||(l=e("string_decoder/").StringDecoder);var r=new l(t);this._readableState.decoder=r,this._readableState.encoding=this._readableState.decoder.encoding;for(var n=this._readableState.buffer.head,i="";null!==n;)i+=r.write(n.data),n=n.next;return this._readableState.buffer.clear(),""!==i&&this._readableState.buffer.push(i),this._readableState.length=i.length,this};var j=1073741824;function O(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=j?e=j:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function A(e){var t=e._readableState;u("emitReadable",t.needReadable,t.emittedReadable),t.needReadable=!1,t.emittedReadable||(u("emitReadable",t.flowing),t.emittedReadable=!0,r.nextTick(T,e))}function T(e){var t=e._readableState;u("emitReadable_",t.destroyed,t.length,t.ended),t.destroyed||!t.length&&!t.ended||(e.emit("readable"),t.emittedReadable=!1),t.needReadable=!t.flowing&&!t.ended&&t.length<=t.highWaterMark,N(e)}function R(e,t){t.readingMore||(t.readingMore=!0,r.nextTick(C,e,t))}function C(e,t){for(;!t.reading&&!t.ended&&(t.length<t.highWaterMark||t.flowing&&0===t.length);){var r=t.length;if(u("maybeReadMore read 0"),e.read(0),r===t.length)break}t.readingMore=!1}function M(e){var t=e._readableState;t.readableListening=e.listenerCount("readable")>0,t.resumeScheduled&&!t.paused?t.flowing=!0:e.listenerCount("data")>0&&e.resume()}function D(e){u("readable nexttick read 0"),e.read(0)}function I(e,t){u("resume",t.reading),t.reading||e.read(0),t.resumeScheduled=!1,e.emit("resume"),N(e),t.flowing&&!t.reading&&e.read(0)}function N(e){var t=e._readableState;for(u("flow",t.flowing);t.flowing&&null!==e.read(););}function L(e,t){return 0===t.length?null:(t.objectMode?r=t.buffer.shift():!e||e>=t.length?(r=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.first():t.buffer.concat(t.length),t.buffer.clear()):r=t.buffer.consume(e,t.decoder),r);var r}function B(e){var t=e._readableState;u("endReadable",t.endEmitted),t.endEmitted||(t.ended=!0,r.nextTick(q,t,e))}function q(e,t){if(u("endReadableNT",e.endEmitted,e.length),!e.endEmitted&&0===e.length&&(e.endEmitted=!0,t.readable=!1,t.emit("end"),e.autoDestroy)){var r=t._writableState;(!r||r.autoDestroy&&r.finished)&&t.destroy()}}function U(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1}x.prototype.read=function(e){u("read",e),e=parseInt(e,10);var t=this._readableState,r=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&((0!==t.highWaterMark?t.length>=t.highWaterMark:t.length>0)||t.ended))return u("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?B(this):A(this),null;if(0===(e=O(e,t))&&t.ended)return 0===t.length&&B(this),null;var n,i=t.needReadable;return u("need readable",i),(0===t.length||t.length-e<t.highWaterMark)&&u("length less than watermark",i=!0),t.ended||t.reading?u("reading or ended",i=!1):i&&(u("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=O(r,t))),null===(n=e>0?L(e,t):null)?(t.needReadable=t.length<=t.highWaterMark,e=0):(t.length-=e,t.awaitDrain=0),0===t.length&&(t.ended||(t.needReadable=!0),r!==e&&t.ended&&B(this)),null!==n&&this.emit("data",n),n},x.prototype._read=function(e){_(this,new v("_read()"))},x.prototype.pipe=function(e,t){var n=this,a=this._readableState;switch(a.pipesCount){case 0:a.pipes=e;break;case 1:a.pipes=[a.pipes,e];break;default:a.pipes.push(e)}a.pipesCount+=1,u("pipe count=%d opts=%j",a.pipesCount,t);var s=(!t||!1!==t.end)&&e!==r.stdout&&e!==r.stderr?c:y;function o(t,r){u("onunpipe"),t===n&&r&&!1===r.hasUnpiped&&(r.hasUnpiped=!0,u("cleanup"),e.removeListener("close",h),e.removeListener("finish",m),e.removeListener("drain",l),e.removeListener("error",p),e.removeListener("unpipe",o),n.removeListener("end",c),n.removeListener("end",y),n.removeListener("data",d),f=!0,!a.awaitDrain||e._writableState&&!e._writableState.needDrain||l())}function c(){u("onend"),e.end()}a.endEmitted?r.nextTick(s):n.once("end",s),e.on("unpipe",o);var l=function(e){return function(){var t=e._readableState;u("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&i(e,"data")&&(t.flowing=!0,N(e))}}(n);e.on("drain",l);var f=!1;function d(t){u("ondata");var r=e.write(t);u("dest.write",r),!1===r&&((1===a.pipesCount&&a.pipes===e||a.pipesCount>1&&-1!==U(a.pipes,e))&&!f&&(u("false write response, pause",a.awaitDrain),a.awaitDrain++),n.pause())}function p(t){u("onerror",t),y(),e.removeListener("error",p),0===i(e,"error")&&_(e,t)}function h(){e.removeListener("finish",m),y()}function m(){u("onfinish"),e.removeListener("close",h),y()}function y(){u("unpipe"),n.unpipe(e)}return n.on("data",d),function(e,t,r){if("function"==typeof e.prependListener)return e.prependListener(t,r);e._events&&e._events[t]?Array.isArray(e._events[t])?e._events[t].unshift(r):e._events[t]=[r,e._events[t]]:e.on(t,r)}(e,"error",p),e.once("close",h),e.once("finish",m),e.emit("pipe",n),a.flowing||(u("pipe resume"),n.resume()),e},x.prototype.unpipe=function(e){var t=this._readableState,r={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,r)),this;if(!e){var n=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var a=0;a<i;a++)n[a].emit("unpipe",this,{hasUnpiped:!1});return this}var s=U(t.pipes,e);return-1===s||(t.pipes.splice(s,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,r)),this},x.prototype.on=function(e,t){var n=a.prototype.on.call(this,e,t),i=this._readableState;return"data"===e?(i.readableListening=this.listenerCount("readable")>0,!1!==i.flowing&&this.resume()):"readable"===e&&(i.endEmitted||i.readableListening||(i.readableListening=i.needReadable=!0,i.flowing=!1,i.emittedReadable=!1,u("on readable",i.length,i.reading),i.length?A(this):i.reading||r.nextTick(D,this))),n},x.prototype.addListener=x.prototype.on,x.prototype.removeListener=function(e,t){var n=a.prototype.removeListener.call(this,e,t);return"readable"===e&&r.nextTick(M,this),n},x.prototype.removeAllListeners=function(e){var t=a.prototype.removeAllListeners.apply(this,arguments);return"readable"!==e&&e!==undefined||r.nextTick(M,this),t},x.prototype.resume=function(){var e=this._readableState;return e.flowing||(u("resume"),e.flowing=!e.readableListening,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,r.nextTick(I,e,t))}(this,e)),e.paused=!1,this},x.prototype.pause=function(){return u("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(u("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},x.prototype.wrap=function(e){var t=this,r=this._readableState,n=!1;for(var i in e.on("end",(function(){if(u("wrapped end"),r.decoder&&!r.ended){var e=r.decoder.end();e&&e.length&&t.push(e)}t.push(null)})),e.on("data",(function(i){(u("wrapped data"),r.decoder&&(i=r.decoder.write(i)),!r.objectMode||null!==i&&i!==undefined)&&((r.objectMode||i&&i.length)&&(t.push(i)||(n=!0,e.pause())))})),e)this[i]===undefined&&"function"==typeof e[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));for(var a=0;a<k.length;a++)e.on(k[a],this.emit.bind(this,k[a]));return this._read=function(t){u("wrapped _read",t),n&&(n=!1,e.resume())},this},"function"==typeof Symbol&&(x.prototype[Symbol.asyncIterator]=function(){return f===undefined&&(f=e("./internal/streams/async_iterator")),f(this)}),Object.defineProperty(x.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(x.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(x.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(e){this._readableState&&(this._readableState.flowing=e)}}),x._fromList=L,Object.defineProperty(x.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),"function"==typeof Symbol&&(x.from=function(t,r){return d===undefined&&(d=e("./internal/streams/from")),d(x,t,r)})}).call(this)}).call(this,e("_process"))}}},{package:"3box>ipfs>async-iterator-to-stream>readable-stream"}],[1629,{"../errors":1625,"./_stream_duplex":1626,inherits:4319},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=l;var n=e("../errors").codes,i=n.ERR_METHOD_NOT_IMPLEMENTED,a=n.ERR_MULTIPLE_CALLBACK,s=n.ERR_TRANSFORM_ALREADY_TRANSFORMING,o=n.ERR_TRANSFORM_WITH_LENGTH_0,u=e("./_stream_duplex");function c(e,t){var r=this._transformState;r.transforming=!1;var n=r.writecb;if(null===n)return this.emit("error",new a);r.writechunk=null,r.writecb=null,null!=t&&this.push(t),n(e);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}function l(e){if(!(this instanceof l))return new l(e);u.call(this,e),this._transformState={afterTransform:c.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",f)}function f(){var e=this;"function"!=typeof this._flush||this._readableState.destroyed?d(this,null,null):this._flush((function(t,r){d(e,t,r)}))}function d(e,t,r){if(t)return e.emit("error",t);if(null!=r&&e.push(r),e._writableState.length)throw new o;if(e._transformState.transforming)throw new s;return e.push(null)}e("inherits")(l,u),l.prototype.push=function(e,t){return this._transformState.needTransform=!1,u.prototype.push.call(this,e,t)},l.prototype._transform=function(e,t,r){r(new i("_transform()"))},l.prototype._write=function(e,t,r){var n=this._transformState;if(n.writecb=r,n.writechunk=e,n.writeencoding=t,!n.transforming){var i=this._readableState;(n.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},l.prototype._read=function(e){var t=this._transformState;null===t.writechunk||t.transforming?t.needTransform=!0:(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform))},l.prototype._destroy=function(e,t){u.prototype._destroy.call(this,e,(function(e){t(e)}))}}}},{package:"3box>ipfs>async-iterator-to-stream>readable-stream"}],[163,{},function(){with(this)return function(){"use strict";return function(e,t,r){const n="moderator-access",i="MODERATOR";class a{constructor(e,t){this._capabilityTypes=[i],this._write=[],this._firstModerator=e,this._write.push(this._firstModerator),this._members=Boolean(t.members),this._members&&this._capabilityTypes.push("MEMBER")}static get type(){return n}isMod(e){return this._write.includes(e)}isValidCapability(e){return this._capabilityTypes.includes(e)}get firstModerator(){return this._firstModerator}async canAppend(e,t){const r=e.identity.id,n=e.payload.value.capability,a=e.payload.value.id,s=this.isMod(r),o=this.isValidCapability(n);return!!(s&&o&&await(async()=>t.verifyIdentity(e.identity))())&&(n===i&&this._write.push(a),!0)}async load(e){const t=e.split("/"),r=t.pop();this._members="members"===r;const n=r.includes("mod")?r:t.pop();this._firstModerator=n.split("_")[1]}async save(){let e=`${n}/mod_${this._firstModerator}`;return e+=this._members?"/members":"",{address:e}}static async create(e,t={}){if(!t.firstModerator)throw new Error("Moderator AC: firstModerator required");return new a(t.firstModerator,t)}}t.exports=a}}},{package:"3box>3box-orbitdb-plugins"}],[1630,{"../errors":1625,"./_stream_duplex":1626,"./internal/streams/destroy":1633,"./internal/streams/state":1637,"./internal/streams/stream":1638,_process:5342,buffer:1996,inherits:4319,"util-deprecate":5929},function(){with(this)return function(){"use strict";return function(e,t,r){(function(r){(function(){function n(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,r){var n=e.entry;e.entry=null;for(;n;){var i=n.callback;t.pendingcb--,i(r),n=n.next}t.corkedRequestsFree.next=e}(t,e)}}var i;t.exports=x,x.WritableState=S;var a={deprecate:e("util-deprecate")},s=e("./internal/streams/stream"),o=e("buffer").Buffer,u=global.Uint8Array||function(){};var c,l=e("./internal/streams/destroy"),f=e("./internal/streams/state").getHighWaterMark,d=e("../errors").codes,p=d.ERR_INVALID_ARG_TYPE,h=d.ERR_METHOD_NOT_IMPLEMENTED,m=d.ERR_MULTIPLE_CALLBACK,y=d.ERR_STREAM_CANNOT_PIPE,b=d.ERR_STREAM_DESTROYED,g=d.ERR_STREAM_NULL_VALUES,v=d.ERR_STREAM_WRITE_AFTER_END,w=d.ERR_UNKNOWN_ENCODING,_=l.errorOrDestroy;function k(){}function S(t,a,s){i=i||e("./_stream_duplex"),t=t||{},"boolean"!=typeof s&&(s=a instanceof i),this.objectMode=!!t.objectMode,s&&(this.objectMode=this.objectMode||!!t.writableObjectMode),this.highWaterMark=f(this,t,"writableHighWaterMark",s),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var o=!1===t.decodeStrings;this.decodeStrings=!o,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var n=e._writableState,i=n.sync,a=n.writecb;if("function"!=typeof a)throw new m;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(n),t)!function(e,t,n,i,a){--t.pendingcb,n?(r.nextTick(a,i),r.nextTick(T,e,t),e._writableState.errorEmitted=!0,_(e,i)):(a(i),e._writableState.errorEmitted=!0,_(e,i),T(e,t))}(e,n,i,t,a);else{var s=O(n)||e.destroyed;s||n.corked||n.bufferProcessing||!n.bufferedRequest||j(e,n),i?r.nextTick(P,e,n,s,a):P(e,n,s,a)}}(a,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!1!==t.emitClose,this.autoDestroy=!!t.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new n(this)}function x(t){var r=this instanceof(i=i||e("./_stream_duplex"));if(!r&&!c.call(x,this))return new x(t);this._writableState=new S(t,this,r),this.writable=!0,t&&("function"==typeof t.write&&(this._write=t.write),"function"==typeof t.writev&&(this._writev=t.writev),"function"==typeof t.destroy&&(this._destroy=t.destroy),"function"==typeof t.final&&(this._final=t.final)),s.call(this)}function E(e,t,r,n,i,a,s){t.writelen=n,t.writecb=s,t.writing=!0,t.sync=!0,t.destroyed?t.onwrite(new b("write")):r?e._writev(i,t.onwrite):e._write(i,a,t.onwrite),t.sync=!1}function P(e,t,r,n){r||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,n(),T(e,t)}function j(e,t){t.bufferProcessing=!0;var r=t.bufferedRequest;if(e._writev&&r&&r.next){var i=t.bufferedRequestCount,a=new Array(i),s=t.corkedRequestsFree;s.entry=r;for(var o=0,u=!0;r;)a[o]=r,r.isBuf||(u=!1),r=r.next,o+=1;a.allBuffers=u,E(e,t,!0,t.length,a,"",s.finish),t.pendingcb++,t.lastBufferedRequest=null,s.next?(t.corkedRequestsFree=s.next,s.next=null):t.corkedRequestsFree=new n(t),t.bufferedRequestCount=0}else{for(;r;){var c=r.chunk,l=r.encoding,f=r.callback;if(E(e,t,!1,t.objectMode?1:c.length,c,l,f),r=r.next,t.bufferedRequestCount--,t.writing)break}null===r&&(t.lastBufferedRequest=null)}t.bufferedRequest=r,t.bufferProcessing=!1}function O(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function A(e,t){e._final((function(r){t.pendingcb--,r&&_(e,r),t.prefinished=!0,e.emit("prefinish"),T(e,t)}))}function T(e,t){var n=O(t);if(n&&(function(e,t){t.prefinished||t.finalCalled||("function"!=typeof e._final||t.destroyed?(t.prefinished=!0,e.emit("prefinish")):(t.pendingcb++,t.finalCalled=!0,r.nextTick(A,e,t)))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"),t.autoDestroy))){var i=e._readableState;(!i||i.autoDestroy&&i.endEmitted)&&e.destroy()}return n}e("inherits")(x,s),S.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(S.prototype,"buffer",{get:a.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer "+"instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(c=Function.prototype[Symbol.hasInstance],Object.defineProperty(x,Symbol.hasInstance,{value:function(e){return!!c.call(this,e)||this===x&&(e&&e._writableState instanceof S)}})):c=function(e){return e instanceof this},x.prototype.pipe=function(){_(this,new y)},x.prototype.write=function(e,t,n){var i,a=this._writableState,s=!1,c=!a.objectMode&&(i=e,o.isBuffer(i)||i instanceof u);return c&&!o.isBuffer(e)&&(e=function(e){return o.from(e)}(e)),"function"==typeof t&&(n=t,t=null),c?t="buffer":t||(t=a.defaultEncoding),"function"!=typeof n&&(n=k),a.ending?function(e,t){var n=new v;_(e,n),r.nextTick(t,n)}(this,n):(c||function(e,t,n,i){var a;return null===n?a=new g:"string"==typeof n||t.objectMode||(a=new p("chunk",["string","Buffer"],n)),!a||(_(e,a),r.nextTick(i,a),!1)}(this,a,e,n))&&(a.pendingcb++,s=function(e,t,r,n,i,a){if(!r){var s=function(e,t,r){e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=o.from(t,r));return t}(t,n,i);n!==s&&(r=!0,i="buffer",n=s)}var u=t.objectMode?1:n.length;t.length+=u;var c=t.length<t.highWaterMark;c||(t.needDrain=!0);if(t.writing||t.corked){var l=t.lastBufferedRequest;t.lastBufferedRequest={chunk:n,encoding:i,isBuf:r,callback:a,next:null},l?l.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else E(e,t,!1,u,n,i,a);return c}(this,a,c,e,t,n)),s},x.prototype.cork=function(){this._writableState.corked++},x.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.bufferProcessing||!e.bufferedRequest||j(this,e))},x.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new w(e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(x.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(x.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),x.prototype._write=function(e,t,r){r(new h("_write()"))},x.prototype._writev=null,x.prototype.end=function(e,t,n){var i=this._writableState;return"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),null!==e&&e!==undefined&&this.write(e,t),i.corked&&(i.corked=1,this.uncork()),i.ending||function(e,t,n){t.ending=!0,T(e,t),n&&(t.finished?r.nextTick(n):e.once("finish",n));t.ended=!0,e.writable=!1}(this,i,n),this},Object.defineProperty(x.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(x.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState!==undefined&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),x.prototype.destroy=l.destroy,x.prototype._undestroy=l.undestroy,x.prototype._destroy=function(e,t){t(e)}}).call(this)}).call(this,e("_process"))}}},{package:"3box>ipfs>async-iterator-to-stream>readable-stream"}],[1631,{"./end-of-stream":1634,_process:5342},function(){with(this)return function(){"use strict";return function(e,t,r){(function(r){(function(){var n;function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var a=e("./end-of-stream"),s=Symbol("lastResolve"),o=Symbol("lastReject"),u=Symbol("error"),c=Symbol("ended"),l=Symbol("lastPromise"),f=Symbol("handlePromise"),d=Symbol("stream");function p(e,t){return{value:e,done:t}}function h(e){var t=e[s];if(null!==t){var r=e[d].read();null!==r&&(e[l]=null,e[s]=null,e[o]=null,t(p(r,!1)))}}function m(e){r.nextTick(h,e)}var y=Object.getPrototypeOf((function(){})),b=Object.setPrototypeOf((i(n={get stream(){return this[d]},next:function(){var e=this,t=this[u];if(null!==t)return Promise.reject(t);if(this[c])return Promise.resolve(p(undefined,!0));if(this[d].destroyed)return new Promise((function(t,n){r.nextTick((function(){e[u]?n(e[u]):t(p(undefined,!0))}))}));var n,i=this[l];if(i)n=new Promise(function(e,t){return function(r,n){e.then((function(){t[c]?r(p(undefined,!0)):t[f](r,n)}),n)}}(i,this));else{var a=this[d].read();if(null!==a)return Promise.resolve(p(a,!1));n=new Promise(this[f])}return this[l]=n,n}},Symbol.asyncIterator,(function(){return this})),i(n,"return",(function(){var e=this;return new Promise((function(t,r){e[d].destroy(null,(function(e){e?r(e):t(p(undefined,!0))}))}))})),n),y);t.exports=function(e){var t,r=Object.create(b,(i(t={},d,{value:e,writable:!0}),i(t,s,{value:null,writable:!0}),i(t,o,{value:null,writable:!0}),i(t,u,{value:null,writable:!0}),i(t,c,{value:e._readableState.endEmitted,writable:!0}),i(t,f,{value:function(e,t){var n=r[d].read();n?(r[l]=null,r[s]=null,r[o]=null,e(p(n,!1))):(r[s]=e,r[o]=t)},writable:!0}),t));return r[l]=null,a(e,(function(e){if(e&&"ERR_STREAM_PREMATURE_CLOSE"!==e.code){var t=r[o];return null!==t&&(r[l]=null,r[s]=null,r[o]=null,t(e)),void(r[u]=e)}var n=r[s];null!==n&&(r[l]=null,r[s]=null,r[o]=null,n(p(undefined,!0))),r[c]=!0})),e.on("readable",m.bind(null,r)),r}}).call(this)}).call(this,e("_process"))}}},{package:"3box>ipfs>async-iterator-to-stream>readable-stream"}],[1632,{buffer:1996,util:1995},function(){with(this)return function(){"use strict";return function(e,t,r){function n(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var s=e("buffer").Buffer,o=e("util").inspect,u=o&&o.custom||"inspect";t.exports=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}var t,r,c;return t=e,r=[{key:"push",value:function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length}},{key:"unshift",value:function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length}},{key:"shift",value:function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(e){if(0===this.length)return"";for(var t=this.head,r=""+t.data;t=t.next;)r+=e+t.data;return r}},{key:"concat",value:function(e){if(0===this.length)return s.alloc(0);for(var t,r,n,i=s.allocUnsafe(e>>>0),a=this.head,o=0;a;)t=a.data,r=i,n=o,s.prototype.copy.call(t,r,n),o+=a.data.length,a=a.next;return i}},{key:"consume",value:function(e,t){var r;return e<this.head.data.length?(r=this.head.data.slice(0,e),this.head.data=this.head.data.slice(e)):r=e===this.head.data.length?this.shift():t?this._getString(e):this._getBuffer(e),r}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(e){var t=this.head,r=1,n=t.data;for(e-=n.length;t=t.next;){var i=t.data,a=e>i.length?i.length:e;if(a===i.length?n+=i:n+=i.slice(0,e),0==(e-=a)){a===i.length?(++r,t.next?this.head=t.next:this.head=this.tail=null):(this.head=t,t.data=i.slice(a));break}++r}return this.length-=r,n}},{key:"_getBuffer",value:function(e){var t=s.allocUnsafe(e),r=this.head,n=1;for(r.data.copy(t),e-=r.data.length;r=r.next;){var i=r.data,a=e>i.length?i.length:e;if(i.copy(t,t.length-e,0,a),0==(e-=a)){a===i.length?(++n,r.next?this.head=r.next:this.head=this.tail=null):(this.head=r,r.data=i.slice(a));break}++n}return this.length-=n,t}},{key:u,value:function(e,t){return o(this,function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?n(Object(r),!0).forEach((function(t){i(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},t,{depth:0,customInspect:!1}))}}],r&&a(t.prototype,r),c&&a(t,c),e}()}}},{package:"3box>ipfs>async-iterator-to-stream>readable-stream"}],[1633,{_process:5342},function(){with(this)return function(){"use strict";return function(e,t,r){(function(e){(function(){function r(e,t){i(e,t),n(e)}function n(e){e._writableState&&!e._writableState.emitClose||e._readableState&&!e._readableState.emitClose||e.emit("close")}function i(e,t){e.emit("error",t)}t.exports={destroy:function(t,a){var s=this,o=this._readableState&&this._readableState.destroyed,u=this._writableState&&this._writableState.destroyed;return o||u?(a?a(t):t&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,e.nextTick(i,this,t)):e.nextTick(i,this,t)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(t||null,(function(t){!a&&t?s._writableState?s._writableState.errorEmitted?e.nextTick(n,s):(s._writableState.errorEmitted=!0,e.nextTick(r,s,t)):e.nextTick(r,s,t):a?(e.nextTick(n,s),a(t)):e.nextTick(n,s)})),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(e,t){var r=e._readableState,n=e._writableState;r&&r.autoDestroy||n&&n.autoDestroy?e.destroy(t):e.emit("error",t)}}}).call(this)}).call(this,e("_process"))}}},{package:"3box>ipfs>async-iterator-to-stream>readable-stream"}],[1634,{"../../../errors":1625},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("../../../errors").codes.ERR_STREAM_PREMATURE_CLOSE;function i(){}t.exports=function e(t,r,a){if("function"==typeof r)return e(t,null,r);r||(r={}),a=function(e){var t=!1;return function(){if(!t){t=!0;for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];e.apply(this,n)}}}(a||i);var s=r.readable||!1!==r.readable&&t.readable,o=r.writable||!1!==r.writable&&t.writable,u=function(){t.writable||l()},c=t._writableState&&t._writableState.finished,l=function(){o=!1,c=!0,s||a.call(t)},f=t._readableState&&t._readableState.endEmitted,d=function(){s=!1,f=!0,o||a.call(t)},p=function(e){a.call(t,e)},h=function(){var e;return s&&!f?(t._readableState&&t._readableState.ended||(e=new n),a.call(t,e)):o&&!c?(t._writableState&&t._writableState.ended||(e=new n),a.call(t,e)):void 0},m=function(){t.req.on("finish",l)};return!function(e){return e.setHeader&&"function"==typeof e.abort}(t)?o&&!t._writableState&&(t.on("end",u),t.on("close",u)):(t.on("complete",l),t.on("abort",h),t.req?m():t.on("request",m)),t.on("end",d),t.on("finish",l),!1!==r.error&&t.on("error",p),t.on("close",h),function(){t.removeListener("complete",l),t.removeListener("abort",h),t.removeListener("request",m),t.req&&t.req.removeListener("finish",l),t.removeListener("end",u),t.removeListener("close",u),t.removeListener("finish",l),t.removeListener("end",d),t.removeListener("error",p),t.removeListener("close",h)}}}}},{package:"3box>ipfs>async-iterator-to-stream>readable-stream"}],[1635,{},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=function(){throw new Error("Readable.from is not available in the browser")}}}},{package:"3box>ipfs>async-iterator-to-stream>readable-stream"}],[1636,{"../../../errors":1625,"./end-of-stream":1634},function(){with(this)return function(){"use strict";return function(e,t,r){var n;var i=e("../../../errors").codes,a=i.ERR_MISSING_ARGS,s=i.ERR_STREAM_DESTROYED;function o(e){if(e)throw e}function u(t,r,i,a){a=function(e){var t=!1;return function(){t||(t=!0,e.apply(void 0,arguments))}}(a);var o=!1;t.on("close",(function(){o=!0})),n===undefined&&(n=e("./end-of-stream")),n(t,{readable:r,writable:i},(function(e){if(e)return a(e);o=!0,a()}));var u=!1;return function(e){if(!o&&!u)return u=!0,function(e){return e.setHeader&&"function"==typeof e.abort}(t)?t.abort():"function"==typeof t.destroy?t.destroy():void a(e||new s("pipe"))}}function c(e){e()}function l(e,t){return e.pipe(t)}function f(e){return e.length?"function"!=typeof e[e.length-1]?o:e.pop():o}t.exports=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n,i=f(t);if(Array.isArray(t[0])&&(t=t[0]),t.length<2)throw new a("streams");var s=t.map((function(e,r){var a=r<t.length-1;return u(e,a,r>0,(function(e){n||(n=e),e&&s.forEach(c),a||(s.forEach(c),i(n))}))}));return t.reduce(l)}}}},{package:"3box>ipfs>async-iterator-to-stream>readable-stream"}],[1637,{"../../../errors":1625},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("../../../errors").codes.ERR_INVALID_OPT_VALUE;t.exports={getHighWaterMark:function(e,t,r,i){var a=function(e,t,r){return null!=e.highWaterMark?e.highWaterMark:t?e[r]:null}(t,i,r);if(null!=a){if(!isFinite(a)||Math.floor(a)!==a||a<0)throw new n(i?r:"highWaterMark",a);return Math.floor(a)}return e.objectMode?16:16384}}}}},{package:"3box>ipfs>async-iterator-to-stream>readable-stream"}],[1638,{events:1997},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=e("events").EventEmitter}}},{package:"3box>ipfs>async-iterator-to-stream>readable-stream"}],[1639,{"./lib/_stream_duplex.js":1626,"./lib/_stream_passthrough.js":1627,"./lib/_stream_readable.js":1628,"./lib/_stream_transform.js":1629,"./lib/_stream_writable.js":1630,"./lib/internal/streams/end-of-stream.js":1634,"./lib/internal/streams/pipeline.js":1636},function(){with(this)return function(){"use strict";return function(e,t,r){(r=t.exports=e("./lib/_stream_readable.js")).Stream=r,r.Readable=r,r.Writable=e("./lib/_stream_writable.js"),r.Duplex=e("./lib/_stream_duplex.js"),r.Transform=e("./lib/_stream_transform.js"),r.PassThrough=e("./lib/_stream_passthrough.js"),r.finished=e("./lib/internal/streams/end-of-stream.js"),r.pipeline=e("./lib/internal/streams/pipeline.js")}}},{package:"3box>ipfs>async-iterator-to-stream>readable-stream"}],[164,{base64url:1872,"did-jwt":2188},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("base64url"),{verifyJWT:i}=e("did-jwt"),a=e=>n.encode(JSON.stringify(e)),s=a({typ:"JWT",alg:"ES256K"});t.exports=class{constructor({threeId:e}){this.threeId=e}static get type(){return"3ID"}async getId({space:e}){return e?this.threeId.getSubDID(e):this.threeId.DID}async signIdentity(e,{space:t}){const r={data:e,iat:null},n=t?{space:t}:{use3ID:!0};return(await this.threeId.signJWT(r,n)).split(".")[2]}static async verifyIdentity(e){const t=a({iat:null,data:e.publicKey+e.signatures.id,iss:e.id}),r=`${s}.${t}.${e.signatures.publicKey}`;try{await i(r,{auth:!0})}catch(e){return!1}return!0}}}}},{package:"3box>3box-orbitdb-plugins"}],[1646,{"./internal/createTester":1658,"./internal/doParallel":1660,"./internal/findGetResult":1664,"lodash/identity":5070},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0});var n=o(e("lodash/identity")),i=o(e("./internal/createTester")),a=o(e("./internal/doParallel")),s=o(e("./internal/findGetResult"));function o(e){return e&&e.__esModule?e:{default:e}}r.default=(0,a.default)((0,i.default)(n.default,s.default)),t.exports=r.default}}},{package:"3box>ipfs>async"}],[1647,{"./internal/createTester":1658,"./internal/doParallelLimit":1661,"./internal/findGetResult":1664,"lodash/identity":5070},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0});var n=o(e("lodash/identity")),i=o(e("./internal/createTester")),a=o(e("./internal/doParallelLimit")),s=o(e("./internal/findGetResult"));function o(e){return e&&e.__esModule?e:{default:e}}r.default=(0,a.default)((0,i.default)(n.default,s.default)),t.exports=r.default}}},{package:"3box>ipfs>async"}],[1648,{"./eachOf":1650,"./internal/withoutIndex":1677,"./internal/wrapAsync":1678},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e,t,r){(0,n.default)(e,(0,i.default)((0,a.default)(t)),r)};var n=s(e("./eachOf")),i=s(e("./internal/withoutIndex")),a=s(e("./internal/wrapAsync"));function s(e){return e&&e.__esModule?e:{default:e}}t.exports=r.default}}},{package:"3box>ipfs>async"}],[165,{events:1997,"ipfs-log/src/entry":4362,"is-ipfs":4612,"orbit-db-access-controllers/src/utils/ensure-ac-address":5237},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("orbit-db-access-controllers/src/utils/ensure-ac-address"),i=e("events").EventEmitter,a=e("ipfs-log/src/entry"),s=(e("is-ipfs"),"MODERATOR"),o="MEMBER";class u extends i{constructor(e,t,r,n,i){super(),this._orbitdb=e,this._db=null,this._options=i||{},this._ipfs=t,this._members=Boolean(i.members),this._firstModerator=n,this._threadName=i.threadName,this._identity=r}static get type(){return"thread-access"}get address(){return this._db.address}async canAppend(e,t){const r=async()=>await t.verifyIdentity(e.identity),n=e.payload.op,i=this.capabilities.moderators,s=this.capabilities.members,o=i.includes(e.identity.id),u=s.includes(e.identity.id);if("ADD"===n){if(!this._members)return await r();if(u||o)return await r()}if("DEL"===n){const t=e.payload.value;if((await a.fromMultihash(this._ipfs,t)).identity.id===e.identity.id)return await r();if(o)return await r()}return!1}get capabilities(){return this._capabilities||this._updateCapabilites(),this._capabilities}_updateCapabilites(){let e=[],t=[];return this._db&&(e.push(this._db.access._firstModerator),Object.entries(this._db.index).forEach((r=>{const n=r[1].payload.value.capability,i=r[1].payload.value.id;n===s&&e.push(i),n===o&&t.push(i)}))),this._capabilities={moderators:e,members:t},this._capabilities}get(e){return this.capabilities[e]||[]}async close(){await this._db.close()}async load(e){this._db&&await this._db.close(),this._db=await this._orbitdb.feed(n(e),{identity:this._identity,accessController:{type:"moderator-access",firstModerator:this._firstModerator,members:this._members},sync:!0}),this._db.events.on("ready",this._onUpdate.bind(this)),this._db.events.on("write",this._onUpdate.bind(this)),this._db.events.on("replicated",this._onUpdate.bind(this)),await this._db.load()}async save(){return{address:this._db.address.toString(),firstModerator:this._firstModerator,members:this._members}}async grant(e,t){if(!this._db.access.isValidCapability(e))throw new Error("grant: Invalid capability to grant");if(e===o&&this.capabilities.members.includes(t))throw new Error(`grant: capability ${e} has already been granted to ${t}`);if(e===s&&this.capabilities.moderators.includes(t))throw new Error(`grant: capability ${e} has already been granted to ${t}`);try{await this._db.add({capability:e,id:t})}catch(r){if(r.toString().includes("not append entry"))throw new Error(`grant: Capability ${e} can not be granted to ${t}`);throw r}}_onUpdate(){this._updateCapabilites(),this.emit("updated")}static async create(e,t={}){if(!t.firstModerator)throw new Error("Thread AC: firstModerator required");const r=new u(e,e._ipfs,t.identity,t.firstModerator,t);return await r.load(t.address||t.threadName),r}}t.exports=u}}},{package:"3box>3box-orbitdb-plugins"}],[1652,{"./eachOfLimit":1651,"./internal/doLimit":1659},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0});var n=a(e("./eachOfLimit")),i=a(e("./internal/doLimit"));function a(e){return e&&e.__esModule?e:{default:e}}r.default=(0,i.default)(n.default,1),t.exports=r.default}}},{package:"3box>ipfs>async"}],[1654,{"./internal/createTester":1658,"./internal/doParallel":1660,"./internal/notId":1669},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0});var n=s(e("./internal/createTester")),i=s(e("./internal/doParallel")),a=s(e("./internal/notId"));function s(e){return e&&e.__esModule?e:{default:e}}r.default=(0,i.default)((0,n.default)(a.default,a.default)),t.exports=r.default}}},{package:"3box>ipfs>async"}],[1655,{"./internal/doParallel":1660,"./internal/filter":1663},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0});var n=a(e("./internal/filter")),i=a(e("./internal/doParallel"));function a(e){return e&&e.__esModule?e:{default:e}}r.default=(0,i.default)(n.default),t.exports=r.default}}},{package:"3box>ipfs>async"}],[1656,{},function(){with(this)return function(){"use strict";return function(e,t,r){function n(){this.head=this.tail=null,this.length=0}function i(e,t){e.length=1,e.head=e.tail=t}Object.defineProperty(r,"__esModule",{value:!0}),r.default=n,n.prototype.removeLink=function(e){return e.prev?e.prev.next=e.next:this.head=e.next,e.next?e.next.prev=e.prev:this.tail=e.prev,e.prev=e.next=null,this.length-=1,e},n.prototype.empty=function(){for(;this.head;)this.shift();return this},n.prototype.insertAfter=function(e,t){t.prev=e,t.next=e.next,e.next?e.next.prev=t:this.tail=t,e.next=t,this.length+=1},n.prototype.insertBefore=function(e,t){t.prev=e.prev,t.next=e,e.prev?e.prev.next=t:this.head=t,e.prev=t,this.length+=1},n.prototype.unshift=function(e){this.head?this.insertBefore(this.head,e):i(this,e)},n.prototype.push=function(e){this.tail?this.insertAfter(this.tail,e):i(this,e)},n.prototype.shift=function(){return this.head&&this.removeLink(this.head)},n.prototype.pop=function(){return this.tail&&this.removeLink(this.tail)},n.prototype.toArray=function(){for(var e=Array(this.length),t=this.head,r=0;r<this.length;r++)e[r]=t.data,t=t.next;return e},n.prototype.remove=function(e){for(var t=this.head;t;){var r=t.next;e(t)&&this.removeLink(t),t=r}return this},t.exports=r.default}}},{package:"3box>ipfs>async"}],[1658,{"./breakLoop":1657,"lodash/noop":5094},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e,t){return function(r,a,s,o){o=o||n.default;var u,c=!1;r(a,(function(r,n,a){s(r,(function(n,s){n?a(n):e(s)&&!u?(c=!0,u=t(!0,r),a(null,i.default)):a()}))}),(function(e){e?o(e):o(null,c?u:t(!1))}))}};var n=a(e("lodash/noop")),i=a(e("./breakLoop"));function a(e){return e&&e.__esModule?e:{default:e}}t.exports=r.default}}},{package:"3box>ipfs>async"}],[166,{"./3id":167,"./api":169,"./config.js":170,"./privateStore":172,"./publicStore":173,"./space":174,"./utils/id":176,"./utils/index":177,"./verified":179,"3box-orbitdb-plugins":161,"@babel/runtime/helpers/asyncToGenerator":189,"@babel/runtime/helpers/classCallCheck":190,"@babel/runtime/helpers/createClass":192,"@babel/runtime/helpers/defineProperty":193,"@babel/runtime/helpers/interopRequireDefault":199,"@babel/runtime/helpers/slicedToArray":212,"@babel/runtime/regenerator":219,ipfs:4553,"orbit-db":5279,"orbit-db-access-controllers":5230,"orbit-db-pubsub":5272,store:5785},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("@babel/runtime/helpers/interopRequireDefault"),i=n(e("@babel/runtime/helpers/slicedToArray")),a=n(e("@babel/runtime/regenerator")),s=n(e("@babel/runtime/helpers/defineProperty")),o=n(e("@babel/runtime/helpers/asyncToGenerator")),u=n(e("@babel/runtime/helpers/classCallCheck")),c=n(e("@babel/runtime/helpers/createClass"));function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function f(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(r,!0).forEach((function(t){(0,s.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var d=e("store"),p=e("ipfs"),h=e("orbit-db"),m=e("orbit-db-pubsub"),y=e("orbit-db-access-controllers"),b=e("3box-orbitdb-plugins"),g=b.LegacyIPFS3BoxAccessController,v=b.ThreadAccessController,w=b.ModeratorAccessController;y.addAccessController({AccessController:g}),y.addAccessController({AccessController:v}),y.addAccessController({AccessController:w});var _,k,S=e("./3id"),x=e("./publicStore"),E=e("./privateStore"),P=e("./verified"),j=e("./space"),O=e("./utils/index"),A=e("./utils/id"),T=e("./config.js"),R=e("./api"),C="ethereum-eoa",M=T.address_server_url,D=T.pinning_node,I=T.pinning_room,N=T.ipfs_options,L=T.orbitdb_options,B=function(){function e(t,r,n){var i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{};(0,u.default)(this,e),this._3id=t,this._web3provider=r,this._ipfs=n,this._serverUrl=i.addressServer||M,this._onSyncDoneCB=function(){},this._boxSynced=!1,this.public=null,this.private=null,this.verified=new P(this),this.spaces={},this.spacesPubSubMessages={}}var t,r,n,s,l,p,y,b,g,v,w,T,N,B,U,$,K,F,z,W,V,J,H,G,Z,Y,Q,X,ee,te;return(0,c.default)(e,[{key:"_load",value:(te=(0,o.default)(a.default.mark((function e(){var t,r,n,s,u,c,l,d,p,y,b,g,v,w,_=this,S=arguments;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=S.length>0&&S[0]!==undefined?S[0]:{},r=this._3id.muportFingerprint+".root",this.pinningNode=t.pinningNode||D,this._ipfs.swarm.connect(this.pinningNode,(function(){})),e.t0=h,e.t1=this._ipfs,e.t2=t.orbitPath,e.next=9,this._3id.getOdbId();case 9:return e.t3=e.sent,e.t4={directory:e.t2,identity:e.t3},e.next=13,e.t0.createInstance.call(e.t0,e.t1,e.t4);case 13:return this._orbitdb=e.sent,k=this._orbitdb,n=this._3id.getKeyringBySpaceName(r).getPublicKeys(!0).signingKey,e.next=18,this._orbitdb.feed(r,f({},L,{format:"dag-pb",accessController:{write:[n],type:"legacy-ipfs-3box",skipManifest:!0}}));case 18:return this._rootStore=e.sent,s=this._rootStore.address.toString(),e.t5=m,e.t6=this._ipfs,e.next=24,this._ipfs.id();case 24:return e.t7=e.sent.id,this._pubsub=new e.t5(e.t6,e.t7),u=function(){var e=(0,o.default)(a.default.mark((function e(t,r){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r===_.pinningNode.split("/").pop()&&_._pubsub.publish(I,{type:"PIN_DB",odbAddress:s,did:_.DID});case 1:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),this.public=new x(this._orbitdb,this._3id.muportFingerprint+".public",this._linkProfile.bind(this),this._ensurePinningNodeConnected.bind(this),this._3id),this.private=new E(this._orbitdb,this._3id.muportFingerprint+".private",this._ensurePinningNodeConnected.bind(this),this._3id),e.next=31,Promise.all([this.public._load(),this.private._load()]);case 31:return c=e.sent,l=(0,i.default)(c,2),d=l[0],p=l[1],y=[],b={},g=!0,v=!1,w=function(){var e=(0,o.default)(a.default.mark((function e(t,r){var n;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(v||(v=!0,setTimeout((function(){g=!1}),3e3)),"HAS_ENTRIES"!==r.type){e.next=12;break}if(r.odbAddress!==p||b[p]||(y.push(_.private._sync(r.numEntries)),b[p]=!0),r.odbAddress!==d||b[d]||(y.push(_.public._sync(r.numEntries)),b[d]=!0),g&&!0===r.odbAddress.includes("space")&&(_.spacesPubSubMessages[r.odbAddress]=r),2!==y.length){e.next=12;break}return n=y,y=[],e.next=10,Promise.all(n);case 10:_._boxSynced=!0,_._onSyncDoneCB();case 12:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),this._pubsub.subscribe(I,w,u),e.next=43,this._createRootStore(s,p,d,this.pinningNode);case 43:case"end":return e.stop()}}),e,this)}))),function(){return te.apply(this,arguments)})},{key:"_createRootStore",value:(ee=(0,o.default)(a.default.mark((function e(t,r,n){var i,s,u=this;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._rootStore.load();case 2:return e.next=4,this._rootStore.iterator({limit:-1}).collect();case 4:if((i=e.sent).find((function(e){return e.payload.value.odbAddress===n}))){e.next=8;break}return e.next=8,this._rootStore.add({odbAddress:n});case 8:if(i.find((function(e){return e.payload.value.odbAddress===r}))){e.next=11;break}return e.next=11,this._rootStore.add({odbAddress:r});case 11:this._publishRootStore(t),s=function(){var e=(0,o.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i.filter((function(e){return"address-link"===e.payload.value.type})).map((function(e){u._ipfs.dag.get(e.payload.value.data)}));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),s();case 14:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return ee.apply(this,arguments)})},{key:"openSpace",value:(X=(0,o.default)(a.default.mark((function e(t){var r,n=arguments;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.length>1&&n[1]!==undefined?n[1]:{},this.spaces[t]){e.next=23;break}return this.spaces[t]=new j(t,this._3id,this._orbitdb,this._rootStore,this._ensurePinningNodeConnected.bind(this)),e.prev=3,r=Object.assign({numEntriesMessages:this.spacesPubSubMessages},r),e.next=7,this.spaces[t].open(r);case 7:return e.next=9,this.isAddressLinked();case 9:if(e.sent){e.next=11;break}this.linkAddress();case 11:e.next=21;break;case 13:if(e.prev=13,e.t0=e.catch(3),delete this.spaces[t],!e.t0.message.includes("User denied message signature.")){e.next=20;break}throw new Error("User denied space consent.");case 20:throw new Error("An error occured while opening space: ",e.t0.message);case 21:e.next=24;break;case 23:r.onSyncDone&&r.onSyncDone();case 24:return e.abrupt("return",this.spaces[t]);case 25:case"end":return e.stop()}}),e,this,[[3,13]])}))),function(e){return X.apply(this,arguments)})},{key:"onSyncDone",value:function(e){this._onSyncDoneCB=e,this._boxSynced&&this._onSyncDoneCB()}},{key:"_publishRootStore",value:(Q=(0,o.default)(a.default.mark((function e(t){var r;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._3id.signJWT({rootStoreAddress:t});case 2:return r=e.sent,e.prev=3,e.next=6,O.fetchJson(this._serverUrl+"/odbAddress",{address_token:r});case 6:e.next=12;break;case 8:if(e.prev=8,e.t0=e.catch(3),e.t0.statusCode){e.next=12;break}throw new Error(e.t0);case 12:return e.abrupt("return",!0);case 13:case"end":return e.stop()}}),e,this,[[3,8]])}))),function(e){return Q.apply(this,arguments)})},{key:"linkAddress",value:(Y=(0,o.default)(a.default.mark((function e(){var t,r=arguments;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=r.length>0&&r[0]!==undefined?r[0]:{}).proof){e.next=5;break}return e.next=4,this._writeAddressLink(t.proof);case 4:return e.abrupt("return");case 5:if(t.type&&t.type!==C){e.next=8;break}return e.next=8,this._linkProfile();case 8:case"end":return e.stop()}}),e,this)}))),function(){return Y.apply(this,arguments)})},{key:"linkAccount",value:(Z=(0,o.default)(a.default.mark((function e(){var t,r=arguments;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&r[0]!==undefined?r[0]:C,console.warn("linkAccount: deprecated, please use linkAddress going forward"),e.next=4,this.linkAddress(t);case 4:case"end":return e.stop()}}),e,this)}))),function(){return Z.apply(this,arguments)})},{key:"removeAddressLink",value:(G=(0,o.default)(a.default.mark((function e(t){var r,n;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=t.toLowerCase(),e.next=3,this.isAddressLinked({address:t});case 3:if(e.sent){e.next=6;break}throw new Error("removeAddressLink: link for given address does not exist");case 6:return r={address:t,type:"delete-address-link"},e.next=10,this._3id.signJWT(r,{expiresIn:3600});case 10:return n=e.sent,e.prev=11,e.next=14,O.fetchJson(this._serverUrl+"/linkdelete",{delete_token:n});case 14:e.next=20;break;case 16:if(e.prev=16,e.t0=e.catch(11),e.t0.statusCode){e.next=20;break}throw new Error(e.t0);case 20:return e.next=22,this._deleteAddressLink(t);case 22:return e.abrupt("return",!0);case 23:case"end":return e.stop()}}),e,this,[[11,16]])}))),function(e){return G.apply(this,arguments)})},{key:"isAddressLinked",value:(H=(0,o.default)(a.default.mark((function e(){var t,r,n,i=arguments;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t=i.length>0&&i[0]!==undefined?i[0]:{}).address&&(t.address=t.address.toLowerCase()),e.next=4,this._readAddressLinks();case 4:return r=e.sent,n=r.find((function(e){var r=!t.address||e.address===t.address;return t.type?r&&e.type===t.type:r})),e.abrupt("return",Boolean(n));case 7:case"end":return e.stop()}}),e,this)}))),function(){return H.apply(this,arguments)})},{key:"isAccountLinked",value:(J=(0,o.default)(a.default.mark((function e(){var t,r=arguments;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&r[0]!==undefined?r[0]:C,console.warn("isAccountLinked: deprecated, please use isAddressLinked going forward"),e.abrupt("return",this.isAddressLinked(t));case 3:case"end":return e.stop()}}),e,this)}))),function(){return J.apply(this,arguments)})},{key:"listAddressLinks",value:(V=(0,o.default)(a.default.mark((function e(){var t;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._readAddressLinks();case 2:return t=e.sent,e.abrupt("return",t.reduce((function(e,t){var r=Object.assign({},t);return r.linkId=r.entry.hash,delete r.entry,r}),[]));case 4:case"end":return e.stop()}}),e,this)}))),function(){return V.apply(this,arguments)})},{key:"_linkProfile",value:(W=(0,o.default)(a.default.mark((function e(){var t,r,n,i;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this._3id.managementAddress,e.next=3,this._readAddressLink(t);case 3:if(r=e.sent){e.next=19;break}return n=this.DID,e.prev=6,e.next=9,O.getLinkConsent(t,n,this._web3provider);case 9:i=e.sent,e.next=16;break;case 12:throw e.prev=12,e.t0=e.catch(6),console.log(e.t0),new Error("Link consent message must be signed before adding data, to link address to store");case 16:return r={version:1,type:C,message:i.msg,signature:i.sig,timestamp:i.timestamp},e.next=19,this._writeAddressLink(r);case 19:return e.next=21,this.public.get("proof_did");case 21:if(e.sent){e.next=29;break}return e.t1=this.public,e.next=25,this._3id.signJWT();case 25:return e.t2=e.sent,e.t3={noLink:!0},e.next=29,e.t1.set.call(e.t1,"proof_did",e.t2,e.t3);case 29:O.fetchJson(this._serverUrl+"/link",r).catch(console.error);case 30:case"end":return e.stop()}}),e,this,[[6,12]])}))),function(){return W.apply(this,arguments)})},{key:"_writeAddressLink",value:(z=(0,o.default)(a.default.mark((function e(t){var r,n;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ipfs.dag.put(t);case 2:return r=e.sent.toBaseEncodedString(),e.next=5,this._linkCIDExists(r);case 5:if(!e.sent){e.next=8;break}return e.abrupt("return");case 8:return n={type:"address-link",data:r},e.next=11,this._rootStore.add(n);case 11:case"end":return e.stop()}}),e,this)}))),function(e){return z.apply(this,arguments)})},{key:"_linkCIDExists",value:(F=(0,o.default)(a.default.mark((function e(t){var r,n;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._rootStore.iterator({limit:-1}).collect();case 2:return r=e.sent,n=r.filter((function(e){return"address-link"===e.payload.value.type})),e.abrupt("return",n.find((function(e){return e.data===t})));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return F.apply(this,arguments)})},{key:"_deleteAddressLink",value:(K=(0,o.default)(a.default.mark((function e(t){var r;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=t.toLowerCase(),e.next=3,this._readAddressLink(t);case 3:if(r=e.sent){e.next=6;break}throw new Error("_deleteAddressLink: link for given address does not exist");case 6:return e.abrupt("return",this._rootStore.remove(r.entry.hash));case 7:case"end":return e.stop()}}),e,this)}))),function(e){return K.apply(this,arguments)})},{key:"_readAddressLinks",value:($=(0,o.default)(a.default.mark((function e(){var t,r,n,i=this;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._rootStore.iterator({limit:-1}).collect();case 2:return t=e.sent,r=t.filter((function(e){return"address-link"===e.payload.value.type})),n=r.map(function(){var e=(0,o.default)(a.default.mark((function e(t){var r;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i._ipfs.dag.get(t.payload.value.data);case 2:if((r=e.sent.value).address){e.next=7;break}return e.next=6,O.recoverPersonalSign(r.message,r.signature);case 6:r.address=e.sent;case 7:return r.entry=t,e.abrupt("return",r);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.abrupt("return",Promise.all(n));case 6:case"end":return e.stop()}}),e,this)}))),function(){return $.apply(this,arguments)})},{key:"_readAddressLink",value:(U=(0,o.default)(a.default.mark((function e(t){var r;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=t.toLowerCase(),e.next=3,this._readAddressLinks();case 3:return r=e.sent,e.abrupt("return",r.find((function(e){return e.address.toLowerCase()===t})));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return U.apply(this,arguments)})},{key:"_ensurePinningNodeConnected",value:(B=(0,o.default)(a.default.mark((function e(t,r){var n,i=this;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ipfs.pubsub.peers(t);case 2:e.sent.find((function(e){return e===i.pinningNode.split("/").pop()}))||(this._ipfs.swarm.connect(this.pinningNode,(function(){})),n=this._rootStore.address.toString(),r?this._pubsub.publish(I,{type:"SYNC_DB",odbAddress:t,thread:!0}):this._pubsub.publish(I,{type:"PIN_DB",odbAddress:n}));case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return B.apply(this,arguments)})},{key:"close",value:(N=(0,o.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._orbitdb.stop();case 2:return e.next=4,this._pubsub.disconnect();case 4:k=null;case 5:case"end":return e.stop()}}),e,this)}))),function(){return N.apply(this,arguments)})},{key:"logout",value:(T=(0,o.default)(a.default.mark((function e(){var t;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.close();case 2:this._3id.logout(),t=this._3id.managementAddress,d.remove("linkConsent_"+t);case 5:case"end":return e.stop()}}),e,this)}))),function(){return T.apply(this,arguments)})},{key:"DID",get:function(){return this._3id.muportDID}}],[{key:"getProfile",value:(w=(0,o.default)(a.default.mark((function e(t){var r,n,i,s,o=arguments;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=o.length>1&&o[1]!==undefined?o[1]:{},n=r.metadata,!(r=Object.assign({useCacheService:!0},r)).useCacheService){e.next=9;break}return e.next=6,R.getProfile(t,r.profileServer,{metadata:n});case 6:i=e.sent,e.next=15;break;case 9:if(!n){e.next=11;break}throw new Error("getting metadata is not yet supported outside of the API");case 11:return s=t.toLowerCase(),e.next=14,this._getProfileOrbit(s,r);case 14:i=e.sent;case 15:return e.abrupt("return",i);case 16:case"end":return e.stop()}}),e,this)}))),function(e){return w.apply(this,arguments)})},{key:"getProfiles",value:(v=(0,o.default)(a.default.mark((function e(t){var r,n=arguments;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.length>1&&n[1]!==undefined?n[1]:{},e.abrupt("return",R.getProfiles(t,r));case 2:case"end":return e.stop()}}),e)}))),function(e){return v.apply(this,arguments)})},{key:"getSpace",value:(g=(0,o.default)(a.default.mark((function e(t,r){var n,i=arguments;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>2&&i[2]!==undefined?i[2]:{},e.abrupt("return",R.getSpace(t,r,n.profileServer,n));case 2:case"end":return e.stop()}}),e)}))),function(e,t){return g.apply(this,arguments)})},{key:"getThread",value:(b=(0,o.default)(a.default.mark((function e(t,r,n,i){var s,o=arguments;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=o.length>4&&o[4]!==undefined?o[4]:{},e.abrupt("return",R.getThread(t,r,n,i,s));case 2:case"end":return e.stop()}}),e)}))),function(e,t,r,n){return b.apply(this,arguments)})},{key:"getThreadByAddress",value:(y=(0,o.default)(a.default.mark((function e(t){var r,n=arguments;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.length>1&&n[1]!==undefined?n[1]:{},e.abrupt("return",R.getThreadByAddress(t,r));case 2:case"end":return e.stop()}}),e)}))),function(e){return y.apply(this,arguments)})},{key:"getConfig",value:(p=(0,o.default)(a.default.mark((function e(t){var r,n=arguments;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.length>1&&n[1]!==undefined?n[1]:{},e.abrupt("return",R.getConfig(t,r));case 2:case"end":return e.stop()}}),e)}))),function(e){return p.apply(this,arguments)})},{key:"listSpaces",value:(l=(0,o.default)(a.default.mark((function e(t){var r,n=arguments;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.length>1&&n[1]!==undefined?n[1]:{},e.abrupt("return",R.listSpaces(t,r.profileServer));case 2:case"end":return e.stop()}}),e)}))),function(e){return l.apply(this,arguments)})},{key:"_getProfileOrbit",value:(s=(0,o.default)(a.default.mark((function e(t){var r,n,i,s,u,c,l,f,d,p,m,y,b=arguments;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=b.length>1&&b[1]!==undefined?b[1]:{},!A.isMuportDID(t)){e.next=3;break}throw new Error("DID are supported in the cached version only");case 3:return e.next=5,R.getRootStoreAddress(t.toLowerCase(),r.addressServer);case 5:if(n=e.sent,!_){e.next=12;break}i=_,e.next=15;break;case 12:return e.next=14,q(r.ipfs,r.iframeStore,r.ipfsOptions);case 14:i=e.sent;case 15:if(k?s=k:(u=null,s=new h(i,r.orbitPath,{cache:u})),c=r.pinningNode||D,i.swarm.connect(c,(function(){})),l=new x(s),!n){e.next=41;break}return e.next=22,s.open(n);case 22:return f=e.sent,d=new Promise((function(e,t){f.events.on("ready",e)})),f.load(),e.next=27,d;case 27:if(f.iterator({limit:-1}).collect().length){e.next=30;break}return e.next=30,new Promise((function(e,t){f.events.on("replicate.progress",(function(t,r,n,i,a){i===a&&f.events.on("replicated",e)}))}));case 30:return p=f.iterator({limit:-1}).collect().find((function(e){return"public"===e.payload.value.odbAddress.split(".")[1]})),e.next=33,l._load(p.payload.value.odbAddress);case 33:return e.next=35,l._sync();case 35:return m=l.all(),y=function(){var e=(0,o.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.close();case 2:return e.next=4,l.close();case 4:case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),y(),e.abrupt("return",m);case 41:return e.abrupt("return",null);case 42:case"end":return e.stop()}}),e)}))),function(e){return s.apply(this,arguments)})},{key:"profileGraphQL",value:(n=(0,o.default)(a.default.mark((function e(t){var r,n=arguments;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.length>1&&n[1]!==undefined?n[1]:{},e.abrupt("return",R.profileGraphQL(t,r.graphqlServer));case 2:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"getVerifiedAccounts",value:(r=(0,o.default)(a.default.mark((function e(t){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",R.getVerifiedAccounts(t));case 1:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},{key:"openBox",value:(t=(0,o.default)(a.default.mark((function t(r,n){var i,s,o,u,c=arguments;return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=c.length>2&&c[2]!==undefined?c[2]:{},t.t0=_,t.t0){t.next=6;break}return t.next=5,q(i.ipfs,i.iframeStore,i.ipfsOptions);case 5:t.t0=t.sent;case 6:return s=t.t0,_=s,t.next=10,S.getIdFromEthAddress(r,n,s,i);case 10:return o=t.sent,u=new e(o,n,s,i),t.next=14,u._load(i);case 14:return t.abrupt("return",u);case 15:case"end":return t.stop()}}),t)}))),function(e,r){return t.apply(this,arguments)})},{key:"isLoggedIn",value:function(e){return S.isLoggedIn(e)}}]),e}();function q(e,t,r){return U.apply(this,arguments)}function U(){return(U=(0,o.default)(a.default.mark((function e(t,r,n){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&r&&console.log("Warning: iframeStore true, orbit db cache in iframe, but the given ipfs object is being used, and may not be running in same iframe."),!t){e.next=5;break}return e.abrupt("return",t);case 5:return e.abrupt("return",new Promise((function(e,r){(t=new p(n||N)).on("error",(function(e){console.error(e),r(e)})),t.on("ready",(function(){return e(t)}))})));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}B.idUtils=A,t.exports=B}}},{package:"3box"}],[1661,{"./eachOfLimit":1662,"./wrapAsync":1678},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e){return function(t,r,a,s){return e((0,n.default)(r),t,(0,i.default)(a),s)}};var n=a(e("./eachOfLimit")),i=a(e("./wrapAsync"));function a(e){return e&&e.__esModule?e:{default:e}}t.exports=r.default}}},{package:"3box>ipfs>async"}],[1663,{"./wrapAsync":1678,"lodash/_arrayMap":4935,"lodash/_baseProperty":4971,"lodash/isArrayLike":5075,"lodash/noop":5094},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e,t,r,n){((0,i.default)(t)?c:l)(e,t,(0,o.default)(r),n||s.default)};var n=u(e("lodash/_arrayMap")),i=u(e("lodash/isArrayLike")),a=u(e("lodash/_baseProperty")),s=u(e("lodash/noop")),o=u(e("./wrapAsync"));function u(e){return e&&e.__esModule?e:{default:e}}function c(e,t,r,n){var i=new Array(t.length);e(t,(function(e,t,n){r(e,(function(e,r){i[t]=!!r,n(e)}))}),(function(e){if(e)return n(e);for(var r=[],a=0;a<t.length;a++)i[a]&&r.push(t[a]);n(null,r)}))}function l(e,t,r,i){var s=[];e(t,(function(e,t,n){r(e,(function(r,i){r?n(r):(i&&s.push({index:t,value:e}),n())}))}),(function(e){e?i(e):i(null,(0,n.default)(s.sort((function(e,t){return e.index-t.index})),(0,a.default)("value")))}))}t.exports=r.default}}},{package:"3box>ipfs>async"}],[1664,{},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e,t){return t},t.exports=r.default}}},{package:"3box>ipfs>async"}],[1669,{},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e){return!e},t.exports=r.default}}},{package:"3box>ipfs>async"}],[167,{"../config.js":170,"../utils/index":177,"./keyring":168,"3box-orbitdb-plugins":161,"3id-resolver":183,"@babel/runtime/helpers/asyncToGenerator":189,"@babel/runtime/helpers/classCallCheck":190,"@babel/runtime/helpers/createClass":192,"@babel/runtime/helpers/interopRequireDefault":199,"@babel/runtime/regenerator":219,buffer:1996,"did-jwt":180,ethers:182,"ipfs-did-document":4357,"ipfs-mini":4400,"orbit-db-identity-provider":5252,store:5785},function(){with(this)return function(){"use strict";return function(e,t,r){(function(r){(function(){var n=e("@babel/runtime/helpers/interopRequireDefault"),i=n(e("@babel/runtime/regenerator")),a=n(e("@babel/runtime/helpers/asyncToGenerator")),s=n(e("@babel/runtime/helpers/classCallCheck")),o=n(e("@babel/runtime/helpers/createClass")),u=e("ethers").utils.HDNode,c=e("did-jwt"),l=e("ipfs-did-document"),f=e("ipfs-mini"),d=e("store"),p=e("orbit-db-identity-provider"),h=e("3box-orbitdb-plugins").OdbIdentityProvider;p.addIdentityProvider(h);var m=e("3id-resolver"),y=e("../utils/index"),b=e("./keyring"),g=e("../config.js"),v="serialized3id_",w={host:g.muport_ipfs_host,port:g.muport_ipfs_port,protocol:g.muport_ipfs_protocol},_=function(){function e(t,r,n,i){(0,s.default)(this,e),this._ethereum=r,this._ipfs=n,this._keyrings={},this._initKeys(t,i),m(n),d.set(v+this.managementAddress,this.serializeState())}var t,n,h,g,_,S,x;return(0,o.default)(e,[{key:"signJWT",value:(x=(0,a.default)(i.default.mark((function e(t){var r,n,a,s,o,u,l,f=arguments;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=f.length>1&&f[1]!==undefined?f[1]:{},n=r.use3ID,a=r.space,s=r.expiresIn,o=a?this._keyrings[a]:this._mainKeyring,u=this.muportDID,n?u=this.DID:a&&(u=this._subDIDs[a]),l={signer:o.getJWTSigner(),issuer:u,expiresIn:s},e.abrupt("return",c.createJWT(t,l));case 6:case"end":return e.stop()}}),e,this)}))),function(e){return x.apply(this,arguments)})},{key:"getSubDID",value:function(e){return this._subDIDs[e]}},{key:"getOdbId",value:(S=(0,a.default)(i.default.mark((function e(t){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",p.createIdentity({type:"3ID",threeId:this,space:t}));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return S.apply(this,arguments)})},{key:"serializeState",value:function(){var e=this,t={managementAddress:this.managementAddress,seed:this._mainKeyring.serialize(),spaceSeeds:{}};return Object.keys(this._keyrings).map((function(r){t.spaceSeeds[r]=e._keyrings[r].serialize()})),JSON.stringify(t)}},{key:"_initKeys",value:function(e){var t=this,r=JSON.parse(e);this.managementAddress=r.managementAddress.toLowerCase(),this._mainKeyring=new b(r.seed),Object.keys(r.spaceSeeds).map((function(e){t._keyrings[e]=new b(r.spaceSeeds[e])}))}},{key:"_initDID",value:(_=(0,a.default)(i.default.mark((function e(t){var r,n,a,s=this;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this._initMuport(t),e.next=3,this._init3ID();case 3:return this._rootDID=e.sent,n=Object.keys(this._keyrings),e.next=7,Promise.all(n.map((function(e){return s._init3ID(e)})));case 7:return a=e.sent,this._subDIDs={},n.map((function(e,t){s._subDIDs[e]=a[t]})),e.next=12,r;case 12:case"end":return e.stop()}}),e,this)}))),function(e){return _.apply(this,arguments)})},{key:"_init3ID",value:(g=(0,a.default)(i.default.mark((function e(t){var r,n,a,s,o;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=new l(this._ipfs,"3"),t){e.next=9;break}n=this._mainKeyring.getPublicKeys(!0),r.addPublicKey("signingKey","Secp256k1VerificationKey2018","publicKeyHex",n.signingKey),r.addPublicKey("encryptionKey","Curve25519EncryptionPublicKey","publicKeyBase64",n.asymEncryptionKey),r.addPublicKey("managementKey","Secp256k1VerificationKey2018","ethereumAddress",this.managementAddress),r.addAuthentication("Secp256k1SignatureAuthentication2018","signingKey"),e.next=20;break;case 9:return a=this._keyrings[t].getPublicKeys(!0),r.addPublicKey("subSigningKey","Secp256k1VerificationKey2018","publicKeyHex",a.signingKey),r.addPublicKey("subEncryptionKey","Curve25519EncryptionPublicKey","publicKeyBase64",a.asymEncryptionKey),r.addAuthentication("Secp256k1SignatureAuthentication2018","subSigningKey"),r.addCustomProperty("space",t),r.addCustomProperty("root",this.DID),s={subSigningKey:a.signingKey,subEncryptionKey:a.asymEncryptionKey,space:t,iat:null},e.next=18,this.signJWT(s,{use3ID:!0});case 18:o=e.sent.split(".")[2],r.addCustomProperty("proof",{alg:"ES256K",signature:o});case 20:return e.next=22,r.commit({noTimestamp:!0});case 22:return e.abrupt("return",r.DID);case 23:case"end":return e.stop()}}),e,this)}))),function(e){return g.apply(this,arguments)})},{key:"_initMuport",value:(h=(0,a.default)(i.default.mark((function e(t){var n,s,o,u;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this._mainKeyring.getPublicKeys(),s=k(n.signingKey,this.managementAddress,n.asymEncryptionKey),e.next=4,this._ipfs.add(r.from(JSON.stringify(s)));case 4:o=e.sent[0].hash,this._muportDID="did:muport:"+o,this.muportFingerprint=y.sha256Multihash(this.muportDID),u=function(){var e=(0,a.default)(i.default.mark((function e(){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:new f(t).addJSON(s,(function(e,t){e&&console.error(e)}));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),u();case 9:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})},{key:"getKeyringBySpaceName",value:function(e){var t=e.split(".");return t[0]===this.muportFingerprint?this._mainKeyring:this._keyrings[t[2]]}},{key:"initKeyringByName",value:(n=(0,a.default)(i.default.mark((function e(t){var r,n,a;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._keyrings[t]){e.next=14;break}return e.next=3,y.openSpaceConsent(this.managementAddress,this._ethereum,t);case 3:return r=e.sent,n="0x"+y.sha256(r.slice(2)),a=u.mnemonicToSeed(u.entropyToMnemonic(n)),this._keyrings[t]=new b(a),e.next=9,this._init3ID(t);case 9:return this._subDIDs[t]=e.sent,d.set(v+this.managementAddress,this.serializeState()),e.abrupt("return",!0);case 14:return e.abrupt("return",!1);case 15:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"logout",value:function(){d.remove(v+this.managementAddress)}},{key:"DID",get:function(){return this._rootDID}},{key:"muportDID",get:function(){return this._muportDID}}],[{key:"isLoggedIn",value:function(e){return Boolean(d.get(v+e.toLowerCase()))}},{key:"getIdFromEthAddress",value:(t=(0,a.default)(i.default.mark((function t(r,n,a){var s,o,c,l,f,p,h,m,b=arguments;return i.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(s=b.length>3&&b[3]!==undefined?b[3]:{},o=r.toLowerCase(),!(c=d.get(v+o))){t.next=7;break}s.consentCallback&&s.consentCallback(!1),t.next=19;break;case 7:if(!s.contentSignature){t.next=11;break}l=s.contentSignature,t.next=14;break;case 11:return t.next=13,y.openBoxConsent(o,n);case 13:l=t.sent;case 14:s.consentCallback&&s.consentCallback(!0),f="0x"+y.sha256(l.slice(2)),p=u.entropyToMnemonic(f),h=u.mnemonicToSeed(p),c=JSON.stringify({managementAddress:o,seed:h,spaceSeeds:{}});case 19:return m=new e(c,n,a,s),t.next=22,m._initDID(s.muportIpfs||w);case 22:return t.abrupt("return",m);case 23:case"end":return t.stop()}}),t)}))),function(e,r,n){return t.apply(this,arguments)})}]),e}(),k=function(e,t,r){return{version:1,signingKey:e,managementKey:t,asymEncryptionKey:r}};t.exports=_}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"3box"}],[1673,{"./DoublyLinkedList":1656,"./onlyOnce":1671,"./setImmediate":1675,"./wrapAsync":1678,"lodash/_baseIndexOf":4955,"lodash/isArray":5074,"lodash/noop":5094},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e,t,r){if(null==t)t=1;else if(0===t)throw new Error("Concurrency must not be zero");var l=(0,c.default)(e),f=0,d=[],p=!1;function h(e,t,r){if(null!=r&&"function"!=typeof r)throw new Error("task callback must be a function");if(b.started=!0,(0,i.default)(e)||(e=[e]),0===e.length&&b.idle())return(0,o.default)((function(){b.drain()}));for(var n=0,s=e.length;n<s;n++){var u={data:e[n],callback:r||a.default};t?b._tasks.unshift(u):b._tasks.push(u)}p||(p=!0,(0,o.default)((function(){p=!1,b.process()})))}function m(e){return function(t){f-=1;for(var r=0,i=e.length;r<i;r++){var a=e[r],s=(0,n.default)(d,a,0);0===s?d.shift():s>0&&d.splice(s,1),a.callback.apply(a,arguments),null!=t&&b.error(t,a.data)}f<=b.concurrency-b.buffer&&b.unsaturated(),b.idle()&&b.drain(),b.process()}}var y=!1,b={_tasks:new u.default,concurrency:t,payload:r,saturated:a.default,unsaturated:a.default,buffer:t/4,empty:a.default,drain:a.default,error:a.default,started:!1,paused:!1,push:function(e,t){h(e,!1,t)},kill:function(){b.drain=a.default,b._tasks.empty()},unshift:function(e,t){h(e,!0,t)},remove:function(e){b._tasks.remove(e)},process:function(){if(!y){for(y=!0;!b.paused&&f<b.concurrency&&b._tasks.length;){var e=[],t=[],r=b._tasks.length;b.payload&&(r=Math.min(r,b.payload));for(var n=0;n<r;n++){var i=b._tasks.shift();e.push(i),d.push(i),t.push(i.data)}f+=1,0===b._tasks.length&&b.empty(),f===b.concurrency&&b.saturated();var a=(0,s.default)(m(e));l(t,a)}y=!1}},length:function(){return b._tasks.length},running:function(){return f},workersList:function(){return d},idle:function(){return b._tasks.length+f===0},pause:function(){b.paused=!0},resume:function(){!1!==b.paused&&(b.paused=!1,(0,o.default)(b.process))}};return b};var n=l(e("lodash/_baseIndexOf")),i=l(e("lodash/isArray")),a=l(e("lodash/noop")),s=l(e("./onlyOnce")),o=l(e("./setImmediate")),u=l(e("./DoublyLinkedList")),c=l(e("./wrapAsync"));function l(e){return e&&e.__esModule?e:{default:e}}t.exports=r.default}}},{package:"3box>ipfs>async"}],[1674,{"./filter":1663},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e,t,r,n){(0,a.default)(e,t,(function(e,t){r(e,(function(e,r){t(e,!r)}))}),n)};var n,i=e("./filter"),a=(n=i)&&n.__esModule?n:{default:n};t.exports=r.default}}},{package:"3box>ipfs>async"}],[168,{"../utils/index":177,"@babel/runtime/helpers/classCallCheck":190,"@babel/runtime/helpers/createClass":192,"@babel/runtime/helpers/interopRequireDefault":199,buffer:1996,"did-jwt":180,elliptic:2230,ethers:182,tweetnacl:5913,"tweetnacl-util":5912},function(){with(this)return function(){"use strict";return function(e,t,r){(function(r){(function(){var n=e("@babel/runtime/helpers/interopRequireDefault"),i=n(e("@babel/runtime/helpers/classCallCheck")),a=n(e("@babel/runtime/helpers/createClass")),s=e("ethers").utils.HDNode,o=e("tweetnacl");o.util=e("tweetnacl-util");var u=e("did-jwt").SimpleSigner,c=e("../utils/index").sha256,l=new(0,e("elliptic").ec)("secp256k1"),f=function(){function e(t){(0,i.default)(this,e),this._seed=t;var n=s.fromSeed(this._seed),a=n.derivePath("m/7696500'/0'/0'");this.signingKey=a.derivePath("0");var u=r.from(a.derivePath("2").privateKey.slice(2),"hex");this.asymEncryptionKey=o.box.keyPair.fromSecretKey(new Uint8Array(u)),this.symEncryptionKey=new Uint8Array(r.from(a.derivePath("3").privateKey.slice(2),"hex")),this.ethereumKey=n.derivePath("m/44'/60'/0'/0").derivePath("0")}return(0,a.default)(e,[{key:"asymEncrypt",value:function(e,t,r){r=r||d(),t=o.util.decodeBase64(t),"string"==typeof e&&(e=o.util.decodeUTF8(e));var n=o.box(e,r,t,this.asymEncryptionKey.secretKey);return{nonce:o.util.encodeBase64(r),ciphertext:o.util.encodeBase64(n)}}},{key:"asymDecrypt",value:function(e,t,n,i){t=o.util.decodeBase64(t),e=o.util.decodeBase64(e),n=o.util.decodeBase64(n);var a=o.box.open(e,n,t,this.asymEncryptionKey.secretKey);return i?a?r.from(a):null:a?o.util.encodeUTF8(a):null}},{key:"symEncrypt",value:function(e,t){return p(e,this.symEncryptionKey,t)}},{key:"symDecrypt",value:function(e,t,r){return h(e,this.symEncryptionKey,t,r)}},{key:"getJWTSigner",value:function(){return u(this.signingKey.privateKey.slice(2))}},{key:"getDBSalt",value:function(){return c(this.signingKey.derivePath("0").privateKey.slice(2))}},{key:"getPublicKeys",value:function(e){var t=this.signingKey.publicKey.slice(2),n=this.ethereumKey.publicKey.slice(2);return e&&(t=l.keyFromPublic(r.from(t,"hex")).getPublic(!1,"hex"),n=l.keyFromPublic(r.from(n,"hex")).getPublic(!1,"hex")),{signingKey:t,ethereumKey:n,asymEncryptionKey:o.util.encodeBase64(this.asymEncryptionKey.publicKey)}}},{key:"serialize",value:function(){return this._seed}}]),e}(),d=function(){return o.randomBytes(24)},p=function(e,t,r){r=r||d(),"string"==typeof e&&(e=o.util.decodeUTF8(e));var n=o.secretbox(e,r,t);return{nonce:o.util.encodeBase64(r),ciphertext:o.util.encodeBase64(n)}},h=function(e,t,n,i){e=o.util.decodeBase64(e),n=o.util.decodeBase64(n);var a=o.secretbox.open(e,n,t);return i?a?r.from(a):null:a?o.util.encodeUTF8(a):null};t.exports=f}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"3box"}],[1680,{"./internal/doParallelLimit":1661,"./internal/map":1668},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0});var n=a(e("./internal/doParallelLimit")),i=a(e("./internal/map"));function a(e){return e&&e.__esModule?e:{default:e}}r.default=(0,n.default)(i.default),t.exports=r.default}}},{package:"3box>ipfs>async"}],[1681,{"./internal/doLimit":1659,"./mapLimit":1680},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0});var n=a(e("./mapLimit")),i=a(e("./internal/doLimit"));function a(e){return e&&e.__esModule?e:{default:e}}r.default=(0,i.default)(n.default,1),t.exports=r.default}}},{package:"3box>ipfs>async"}],[1682,{"./internal/setImmediate":1675,_process:5342,timers:5856},function(){with(this)return function(){"use strict";return function(e,t,r){(function(n,i){(function(){Object.defineProperty(r,"__esModule",{value:!0});var a,s=e("./internal/setImmediate");a=s.hasNextTick?n.nextTick:s.hasSetImmediate?i:s.fallback,r.default=(0,s.wrap)(a),t.exports=r.default}).call(this)}).call(this,e("_process"),e("timers").setImmediate)}}},{package:"3box>ipfs>async"}],[1684,{"./internal/queue":1673,"./internal/wrapAsync":1678},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e,t){var r=(0,i.default)(e);return(0,n.default)((function(e,t){r(e[0],t)}),t,1)};var n=a(e("./internal/queue")),i=a(e("./internal/wrapAsync"));function a(e){return e&&e.__esModule?e:{default:e}}t.exports=r.default}}},{package:"3box>ipfs>async"}],[1685,{"./internal/doParallel":1660,"./internal/reject":1674},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0});var n=a(e("./internal/reject")),i=a(e("./internal/doParallel"));function a(e){return e&&e.__esModule?e:{default:e}}r.default=(0,i.default)(n.default),t.exports=r.default}}},{package:"3box>ipfs>async"}],[1686,{"./internal/wrapAsync":1678,"lodash/constant":5066,"lodash/noop":5094},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e,t,r){var s=5,o=0,u={times:s,intervalFunc:(0,i.default)(o)};function c(e,t){if("object"==typeof t)e.times=+t.times||s,e.intervalFunc="function"==typeof t.interval?t.interval:(0,i.default)(+t.interval||o),e.errorFilter=t.errorFilter;else{if("number"!=typeof t&&"string"!=typeof t)throw new Error("Invalid arguments for async.retry");e.times=+t||s}}arguments.length<3&&"function"==typeof e?(r=t||n.default,t=e):(c(u,e),r=r||n.default);if("function"!=typeof t)throw new Error("Invalid arguments for async.retry");var l=(0,a.default)(t),f=1;function d(){l((function(e){e&&f++<u.times&&("function"!=typeof u.errorFilter||u.errorFilter(e))?setTimeout(d,u.intervalFunc(f)):r.apply(null,arguments)}))}d()};var n=s(e("lodash/noop")),i=s(e("lodash/constant")),a=s(e("./internal/wrapAsync"));function s(e){return e&&e.__esModule?e:{default:e}}t.exports=r.default}}},{package:"3box>ipfs>async"}],[1687,{"./eachOfSeries":1652,"./internal/parallel":1672},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e,t){(0,n.default)(i.default,e,t)};var n=a(e("./internal/parallel")),i=a(e("./eachOfSeries"));function a(e){return e&&e.__esModule?e:{default:e}}t.exports=r.default}}},{package:"3box>ipfs>async"}],[1688,{"./internal/setImmediate":1675},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0});var n,i=e("./internal/setImmediate"),a=(n=i)&&n.__esModule?n:{default:n};r.default=a.default,t.exports=r.default}}},{package:"3box>ipfs>async"}],[1689,{"./internal/createTester":1658,"./internal/doParallel":1660,"lodash/identity":5070},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0});var n=s(e("./internal/createTester")),i=s(e("./internal/doParallel")),a=s(e("lodash/identity"));function s(e){return e&&e.__esModule?e:{default:e}}r.default=(0,i.default)((0,n.default)(Boolean,a.default)),t.exports=r.default}}},{package:"3box>ipfs>async"}],[169,{"./config.js":170,"./utils/id":176,"./utils/index":177,"./utils/verifier":178,"@babel/runtime/helpers/asyncToGenerator":189,"@babel/runtime/helpers/interopRequireDefault":199,"@babel/runtime/regenerator":219,"graphql-request":4234},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("@babel/runtime/helpers/interopRequireDefault"),i=n(e("@babel/runtime/regenerator")),a=n(e("@babel/runtime/helpers/asyncToGenerator")),s=e("graphql-request").request,o=e("./utils/index"),u=e("./utils/verifier"),c=e("./utils/id").isMuportDID,l=e("./config.js"),f=l.graphql_server_url,d=l.profile_server_url,p=l.address_server_url;function h(){return h=(0,a.default)(i.default.mark((function e(t){var r,n,a=arguments;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>1&&a[1]!==undefined?a[1]:p,e.next=3,o.fetchJson(r+"/odbAddress/"+t);case 3:return n=e.sent,e.abrupt("return",n.data.rootStoreAddress);case 5:case"end":return e.stop()}}),e)}))),h.apply(this,arguments)}function m(){return m=(0,a.default)(i.default.mark((function e(t){var r,n=arguments;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.length>1&&n[1]!==undefined?n[1]:d,e.prev=1,!c(t)){e.next=8;break}return e.next=5,o.fetchJson(r+"/list-spaces?did="+encodeURIComponent(t));case 5:case 10:return e.abrupt("return",e.sent);case 8:return e.next=10,o.fetchJson(r+"/list-spaces?address="+encodeURIComponent(t));case 11:e.next=16;break;case 13:return e.prev=13,e.t0=e.catch(1),e.abrupt("return",[]);case 16:case"end":return e.stop()}}),e,null,[[1,13]])}))),m.apply(this,arguments)}function y(){return y=(0,a.default)(i.default.mark((function e(t,r){var n,a,s,u,l,f=arguments;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=f.length>2&&f[2]!==undefined?f[2]:d,a=f.length>3&&f[3]!==undefined?f[3]:{},s=a.metadata,!(u=a.blocklist)||!u(t)){e.next=4;break}throw new Error("user with ".concat(t," is blocked"));case 4:return l="".concat(n,"/space"),e.prev=5,l=c(t)?"".concat(l,"?did=").concat(encodeURIComponent(t)):"".concat(l,"?address=").concat(encodeURIComponent(t.toLowerCase())),l="".concat(l,"&name=").concat(encodeURIComponent(r)),s&&(l="".concat(l,"&metadata=").concat(encodeURIComponent(s))),e.next=11,o.fetchJson(l);case 11:return e.abrupt("return",e.sent);case 14:return e.prev=14,e.t0=e.catch(5),e.abrupt("return",{});case 17:case"end":return e.stop()}}),e,null,[[5,14]])}))),y.apply(this,arguments)}function b(e,t){return g.apply(this,arguments)}function g(){return g=(0,a.default)(i.default.mark((function e(t,r){var n,a,s=arguments;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=s.length>2&&s[2]!==undefined?s[2]:{},e.next=3,_(t,n);case 3:if((a=e.sent).spaces[r]&&a.spaces[r].DID){e.next=6;break}throw new Error("Could not find appropriate DID for address ".concat(t));case 6:return e.abrupt("return",a.spaces[r].DID);case 7:case"end":return e.stop()}}),e)}))),g.apply(this,arguments)}function v(){return v=(0,a.default)(i.default.mark((function e(t,r,n,a){var s,u,c,l=arguments;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=l.length>4&&l[4]!==undefined?l[4]:{},u=s.profileServer||d,!n.startsWith("0x")){e.next=6;break}return e.next=5,b(n,t,s);case 5:n=e.sent;case 6:return e.prev=6,c="".concat(u,"/thread?space=").concat(encodeURIComponent(t),"&name=").concat(encodeURIComponent(r)),c+="&mod=".concat(encodeURIComponent(n),"&members=").concat(encodeURIComponent(a)),e.next=11,o.fetchJson(c);case 11:return e.abrupt("return",e.sent);case 14:throw e.prev=14,e.t0=e.catch(6),new Error(e.t0);case 17:case"end":return e.stop()}}),e,null,[[6,14]])}))),v.apply(this,arguments)}function w(){return w=(0,a.default)(i.default.mark((function e(t){var r,n,a=arguments;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>1&&a[1]!==undefined?a[1]:{},n=r.profileServer||d,e.prev=2,e.next=5,o.fetchJson("".concat(n,"/thread?address=").concat(encodeURIComponent(t)));case 5:return e.abrupt("return",e.sent);case 8:throw e.prev=8,e.t0=e.catch(2),new Error(e.t0);case 11:case"end":return e.stop()}}),e,null,[[2,8]])}))),w.apply(this,arguments)}function _(e){return k.apply(this,arguments)}function k(){return k=(0,a.default)(i.default.mark((function e(t){var r,n,a=arguments;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>1&&a[1]!==undefined?a[1]:{},n=r.profileServer||d,e.prev=2,e.next=5,o.fetchJson("".concat(n,"/config?address=").concat(encodeURIComponent(t)));case 5:return e.abrupt("return",e.sent);case 8:throw e.prev=8,e.t0=e.catch(2),new Error(e.t0);case 11:case"end":return e.stop()}}),e,null,[[2,8]])}))),k.apply(this,arguments)}function S(){return S=(0,a.default)(i.default.mark((function e(t){var r,n,a,s,u,l=arguments;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=l.length>1&&l[1]!==undefined?l[1]:d,n=l.length>2&&l[2]!==undefined?l[2]:{},a=n.metadata,!(s=n.blocklist)||!s(t)){e.next=4;break}throw new Error("user with ".concat(t," is blocked"));case 4:return u="".concat(r,"/profile"),e.prev=5,u=c(t)?"".concat(u,"?did=").concat(encodeURIComponent(t)):"".concat(u,"?address=").concat(encodeURIComponent(t.toLowerCase())),a&&(u="".concat(u,"&metadata=").concat(encodeURIComponent(a))),e.next=10,o.fetchJson(u);case 10:return e.abrupt("return",e.sent);case 13:return e.prev=13,e.t0=e.catch(5),e.abrupt("return",{});case 16:case"end":return e.stop()}}),e,null,[[5,13]])}))),S.apply(this,arguments)}function x(){return x=(0,a.default)(i.default.mark((function e(t){var r,n,a,s=arguments;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>1&&s[1]!==undefined?s[1]:{},r=Object.assign({profileServer:d},r),n={addressList:[],didList:[]},t.forEach((function(e){c(e)?n.didList.push(e):n.addressList.push(e)})),a="".concat(r.profileServer,"/profileList"),e.abrupt("return",o.fetchJson(a,n));case 6:case"end":return e.stop()}}),e)}))),x.apply(this,arguments)}function E(){return E=(0,a.default)(i.default.mark((function e(t){var r,n=arguments;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.length>1&&n[1]!==undefined?n[1]:{},r=Object.assign({graphqlServer:f},r),e.abrupt("return",s(r.graphqlServer,t));case 3:case"end":return e.stop()}}),e)}))),E.apply(this,arguments)}function P(){return(P=(0,a.default)(i.default.mark((function e(t){var r,n;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={},e.prev=1,e.next=4,u.verifyDID(t.proof_did);case 4:if(n=e.sent,r.did=n,!t.proof_github){e.next=15;break}return e.prev=7,e.next=10,u.verifyGithub(n,t.proof_github);case 10:r.github=e.sent,e.next=15;break;case 13:e.prev=13,e.t0=e.catch(7);case 15:if(!t.proof_twitter){e.next=24;break}return e.prev=16,e.next=19,u.verifyTwitter(n,t.proof_twitter);case 19:r.twitter=e.sent,e.next=24;break;case 22:e.prev=22,e.t1=e.catch(16);case 24:if(!t.ethereum_proof){e.next=33;break}return e.prev=25,e.next=28,u.verifyEthereum(t.ethereum_proof,n);case 28:r.ethereum=e.sent,e.next=33;break;case 31:e.prev=31,e.t2=e.catch(25);case 33:e.next=37;break;case 35:e.prev=35,e.t3=e.catch(1);case 37:return e.abrupt("return",r);case 38:case"end":return e.stop()}}),e,null,[[1,35],[7,13],[16,22],[25,31]])})))).apply(this,arguments)}t.exports={profileGraphQL:function(e){return E.apply(this,arguments)},getProfile:function(e){return S.apply(this,arguments)},getSpace:function(e,t){return y.apply(this,arguments)},listSpaces:function(e){return m.apply(this,arguments)},getThread:function(e,t,r,n){return v.apply(this,arguments)},getThreadByAddress:function(e){return w.apply(this,arguments)},getConfig:_,getRootStoreAddress:function(e){return h.apply(this,arguments)},getProfiles:function(e){return x.apply(this,arguments)},getVerifiedAccounts:function(e){return P.apply(this,arguments)},getSpaceDID:b}}}},{package:"3box"}],[1690,{"./internal/createTester":1658,"./internal/doParallelLimit":1661,"lodash/identity":5070},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0});var n=s(e("./internal/createTester")),i=s(e("./internal/doParallelLimit")),a=s(e("lodash/identity"));function s(e){return e&&e.__esModule?e:{default:e}}r.default=(0,i.default)((0,n.default)(Boolean,a.default)),t.exports=r.default}}},{package:"3box>ipfs>async"}],[1691,{"./internal/doLimit":1659,"./someLimit":1690},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0});var n=a(e("./someLimit")),i=a(e("./internal/doLimit"));function a(e){return e&&e.__esModule?e:{default:e}}r.default=(0,i.default)(n.default,1),t.exports=r.default}}},{package:"3box>ipfs>async"}],[1692,{"./internal/initialParams":1666,"./internal/wrapAsync":1678},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e,t,r){var a=(0,i.default)(e);return(0,n.default)((function(n,i){var s,o=!1;n.push((function(){o||(i.apply(null,arguments),clearTimeout(s))})),s=setTimeout((function(){var t=e.name||"anonymous",n=new Error('Callback function "'+t+'" timed out.');n.code="ETIMEDOUT",r&&(n.info=r),o=!0,i(n)}),t),a.apply(null,n)}))};var n=a(e("./internal/initialParams")),i=a(e("./internal/wrapAsync"));function a(e){return e&&e.__esModule?e:{default:e}}t.exports=r.default}}},{package:"3box>ipfs>async"}],[1693,{"./eachSeries":1653,"./internal/slice":1676,"./internal/wrapAsync":1678,"lodash/noop":5094},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e,t){var r,o=null;t=t||n.default,(0,i.default)(e,(function(e,t){(0,a.default)(e)((function(e,n){r=arguments.length>2?(0,s.default)(arguments,1):n,o=e,t(!e)}))}),(function(){t(o,r)}))};var n=o(e("lodash/noop")),i=o(e("./eachSeries")),a=o(e("./internal/wrapAsync")),s=o(e("./internal/slice"));function o(e){return e&&e.__esModule?e:{default:e}}t.exports=r.default}}},{package:"3box>ipfs>async"}],[1695,{"./internal/onlyOnce":1671,"./internal/slice":1676,"./internal/wrapAsync":1678,"lodash/noop":5094},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e,t,r){r=(0,a.default)(r||n.default);var o=(0,s.default)(t);if(!e())return r(null);var u=function(t){if(t)return r(t);if(e())return o(u);var n=(0,i.default)(arguments,1);r.apply(null,[null].concat(n))};o(u)};var n=o(e("lodash/noop")),i=o(e("./internal/slice")),a=o(e("./internal/onlyOnce")),s=o(e("./internal/wrapAsync"));function o(e){return e&&e.__esModule?e:{default:e}}t.exports=r.default}}},{package:"3box>ipfs>async"}],[1697,{"./lib/index":1698},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=e("./lib/index").default}}},{package:"analytics-node>axios-retry"}],[1698,{"is-retry-allowed":4619},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.isNetworkError=o,r.isRetryableError=l,r.isSafeRequestError=f,r.isIdempotentRequestError=d,r.isNetworkOrIdempotentRequestError=p,r.exponentialDelay=m,r.default=b;var n,i=e("is-retry-allowed"),a=(n=i)&&n.__esModule?n:{default:n};var s="axios-retry";function o(e){return!e.response&&Boolean(e.code)&&"ECONNABORTED"!==e.code&&(0,a.default)(e)}var u=["get","head","options"],c=u.concat(["put","delete"]);function l(e){return"ECONNABORTED"!==e.code&&(!e.response||e.response.status>=500&&e.response.status<=599)}function f(e){return!!e.config&&(l(e)&&-1!==u.indexOf(e.config.method))}function d(e){return!!e.config&&(l(e)&&-1!==c.indexOf(e.config.method))}function p(e){return o(e)||d(e)}function h(){return 0}function m(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0,t=100*Math.pow(2,e),r=.2*t*Math.random();return t+r}function y(e){var t=e[s]||{};return t.retryCount=t.retryCount||0,e[s]=t,t}function b(e,t){e.interceptors.request.use((function(e){return y(e).lastRequestTime=Date.now(),e})),e.interceptors.response.use(null,(function(r){var n=r.config;if(!n)return Promise.reject(r);var i=function(e,t){return Object.assign({},t,e[s])}(n,t),a=i.retries,o=a===undefined?3:a,u=i.retryCondition,c=u===undefined?p:u,l=i.retryDelay,f=l===undefined?h:l,d=i.shouldResetTimeout,m=d!==undefined&&d,b=y(n);if(c(r)&&b.retryCount<o){b.retryCount+=1;var g=f(b.retryCount,r);if(function(e,t){e.defaults.agent===t.agent&&delete t.agent,e.defaults.httpAgent===t.httpAgent&&delete t.httpAgent,e.defaults.httpsAgent===t.httpsAgent&&delete t.httpsAgent}(e,n),!m&&n.timeout&&b.lastRequestTime){var v=Date.now()-b.lastRequestTime;n.timeout=Math.max(n.timeout-v-g,1)}return n.transformRequest=[function(e){return e}],new Promise((function(t){return setTimeout((function(){return t(e(n))}),g)}))}return Promise.reject(r)}))}b.isNetworkError=o,b.isSafeRequestError=f,b.isIdempotentRequestError=d,b.isNetworkOrIdempotentRequestError=p,b.exponentialDelay=m,b.isRetryableError=l}}},{package:"analytics-node>axios-retry"}],[1699,{"./lib/axios":1701},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=e("./lib/axios")}}},{package:"analytics-node>axios"}],[17,{"./network":19},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"NETWORK_EVENTS",{enumerable:!0,get:function(){return n.NETWORK_EVENTS}}),Object.defineProperty(r,"default",{enumerable:!0,get:function(){return n.default}});var n=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=i(t);if(r&&r.has(e))return r.get(e);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var o=a?Object.getOwnPropertyDescriptor(e,s):null;o&&(o.get||o.set)?Object.defineProperty(n,s,o):n[s]=e[s]}n.default=e,r&&r.set(e,n);return n}(e("./network"));function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(i=function(e){return e?r:t})(e)}}}},{package:"$root$"}],[170,{_process:5342,"ipfs-log":4368},function(){with(this)return function(){"use strict";return function(e,t,r){(function(r){(function(){var n=e("ipfs-log"),i="0.0.3";t.exports={address_server_url:r.env.ADDRESS_SERVER_URL||"https://beta.3box.io/address-server",pinning_node:r.env.PINNING_NODE||"/dnsaddr/ipfs.3box.io/tcp/443/wss/ipfs/QmZvxEpiVNjmNbEKyQGvFzAY1BwmGuuvdUTmcTstQPhyVC",pinning_room:r.env.PINNING_ROOM||"3box-pinning",iframe_store_version:r.env.IFRAME_STORE_VERSION||i,iframe_store_url:r.env.IFRAME_STORE_URL||"https://iframe.3box.io/".concat(i,"/iframe.html"),ipfs_options:{EXPERIMENTAL:{pubsub:!0},preload:{enabled:!1},config:{Bootstrap:[]}},orbitdb_options:{syncLocal:!0,sortFn:n.Sorting.SortByEntryHash},graphql_server_url:r.env.GRAPHQL_SERVER_URL||"https://api.3box.io/graph/",profile_server_url:r.env.PROFILE_SERVER_URL||"https://ipfs.3box.io",muport_ipfs_host:r.env.MUPORT_IPFS_HOST||"ipfs.infura.io",muport_ipfs_port:r.env.MUPORT_IPFS_PORT||5001,muport_ipfs_protocol:r.env.MUPORT_IPFS_PROTOCOL||"https"}}).call(this)}).call(this,e("_process"))}}},{package:"3box"}],[1700,{"../core/buildFullPath":1707,"../core/createError":1708,"./../core/settle":1712,"./../helpers/buildURL":1716,"./../helpers/cookies":1718,"./../helpers/isURLSameOrigin":1721,"./../helpers/parseHeaders":1723,"./../utils":1726},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("./../utils"),i=e("./../core/settle"),a=e("./../helpers/cookies"),s=e("./../helpers/buildURL"),o=e("../core/buildFullPath"),u=e("./../helpers/parseHeaders"),c=e("./../helpers/isURLSameOrigin"),l=e("../core/createError");t.exports=function(e){return new Promise((function(t,r){var f=e.data,d=e.headers,p=e.responseType;n.isFormData(f)&&delete d["Content-Type"];var h=new XMLHttpRequest;if(e.auth){var m=e.auth.username||"",y=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";d.Authorization="Basic "+btoa(m+":"+y)}var b=o(e.baseURL,e.url);function g(){if(h){var n="getAllResponseHeaders"in h?u(h.getAllResponseHeaders()):null,a={data:p&&"text"!==p&&"json"!==p?h.response:h.responseText,status:h.status,statusText:h.statusText,headers:n,config:e,request:h};i(t,r,a),h=null}}if(h.open(e.method.toUpperCase(),s(b,e.params,e.paramsSerializer),!0),h.timeout=e.timeout,"onloadend"in h?h.onloadend=g:h.onreadystatechange=function(){h&&4===h.readyState&&(0!==h.status||h.responseURL&&0===h.responseURL.indexOf("file:"))&&setTimeout(g)},h.onabort=function(){h&&(r(l("Request aborted",e,"ECONNABORTED",h)),h=null)},h.onerror=function(){r(l("Network Error",e,null,h)),h=null},h.ontimeout=function(){var t="timeout of "+e.timeout+"ms exceeded";e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),r(l(t,e,e.transitional&&e.transitional.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",h)),h=null},n.isStandardBrowserEnv()){var v=(e.withCredentials||c(b))&&e.xsrfCookieName?a.read(e.xsrfCookieName):undefined;v&&(d[e.xsrfHeaderName]=v)}"setRequestHeader"in h&&n.forEach(d,(function(e,t){void 0===f&&"content-type"===t.toLowerCase()?delete d[t]:h.setRequestHeader(t,e)})),n.isUndefined(e.withCredentials)||(h.withCredentials=!!e.withCredentials),p&&"json"!==p&&(h.responseType=e.responseType),"function"==typeof e.onDownloadProgress&&h.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&h.upload&&h.upload.addEventListener("progress",e.onUploadProgress),e.cancelToken&&e.cancelToken.promise.then((function(e){h&&(h.abort(),r(e),h=null)})),f||(f=null),h.send(f)}))}}}},{package:"analytics-node>axios"}],[1701,{"./cancel/Cancel":1702,"./cancel/CancelToken":1703,"./cancel/isCancel":1704,"./core/Axios":1705,"./core/mergeConfig":1711,"./defaults":1714,"./helpers/bind":1715,"./helpers/isAxiosError":1720,"./helpers/spread":1724,"./utils":1726},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("./utils"),i=e("./helpers/bind"),a=e("./core/Axios"),s=e("./core/mergeConfig");function o(e){var t=new a(e),r=i(a.prototype.request,t);return n.extend(r,a.prototype,t),n.extend(r,t),r}var u=o(e("./defaults"));u.Axios=a,u.create=function(e){return o(s(u.defaults,e))},u.Cancel=e("./cancel/Cancel"),u.CancelToken=e("./cancel/CancelToken"),u.isCancel=e("./cancel/isCancel"),u.all=function(e){return Promise.all(e)},u.spread=e("./helpers/spread"),u.isAxiosError=e("./helpers/isAxiosError"),t.exports=u,t.exports.default=u}}},{package:"analytics-node>axios"}],[1702,{},function(){with(this)return function(){"use strict";return function(e,t,r){function n(e){this.message=e}n.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},n.prototype.__CANCEL__=!0,t.exports=n}}},{package:"analytics-node>axios"}],[1703,{"./Cancel":1702},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("./Cancel");function i(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise((function(e){t=e}));var r=this;e((function(e){r.reason||(r.reason=new n(e),t(r.reason))}))}i.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},i.source=function(){var e;return{token:new i((function(t){e=t})),cancel:e}},t.exports=i}}},{package:"analytics-node>axios"}],[1704,{},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=function(e){return!(!e||!e.__CANCEL__)}}}},{package:"analytics-node>axios"}],[1705,{"../helpers/buildURL":1716,"../helpers/validator":1725,"./../utils":1726,"./InterceptorManager":1706,"./dispatchRequest":1709,"./mergeConfig":1711},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("./../utils"),i=e("../helpers/buildURL"),a=e("./InterceptorManager"),s=e("./dispatchRequest"),o=e("./mergeConfig"),u=e("../helpers/validator"),c=u.validators;function l(e){this.defaults=e,this.interceptors={request:new a,response:new a}}l.prototype.request=function(e){"string"==typeof e?(e=arguments[1]||{}).url=arguments[0]:e=e||{},(e=o(this.defaults,e)).method?e.method=e.method.toLowerCase():this.defaults.method?e.method=this.defaults.method.toLowerCase():e.method="get";var t=e.transitional;t!==undefined&&u.assertOptions(t,{silentJSONParsing:c.transitional(c.boolean,"1.0.0"),forcedJSONParsing:c.transitional(c.boolean,"1.0.0"),clarifyTimeoutError:c.transitional(c.boolean,"1.0.0")},!1);var r=[],n=!0;this.interceptors.request.forEach((function(t){"function"==typeof t.runWhen&&!1===t.runWhen(e)||(n=n&&t.synchronous,r.unshift(t.fulfilled,t.rejected))}));var i,a=[];if(this.interceptors.response.forEach((function(e){a.push(e.fulfilled,e.rejected)})),!n){var l=[s,undefined];for(Array.prototype.unshift.apply(l,r),l=l.concat(a),i=Promise.resolve(e);l.length;)i=i.then(l.shift(),l.shift());return i}for(var f=e;r.length;){var d=r.shift(),p=r.shift();try{f=d(f)}catch(e){p(e);break}}try{i=s(f)}catch(e){return Promise.reject(e)}for(;a.length;)i=i.then(a.shift(),a.shift());return i},l.prototype.getUri=function(e){return e=o(this.defaults,e),i(e.url,e.params,e.paramsSerializer).replace(/^\?/,"")},n.forEach(["delete","get","head","options"],(function(e){l.prototype[e]=function(t,r){return this.request(o(r||{},{method:e,url:t,data:(r||{}).data}))}})),n.forEach(["post","put","patch"],(function(e){l.prototype[e]=function(t,r,n){return this.request(o(n||{},{method:e,url:t,data:r}))}})),t.exports=l}}},{package:"analytics-node>axios"}],[1706,{"./../utils":1726},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("./../utils");function i(){this.handlers=[]}i.prototype.use=function(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!r&&r.synchronous,runWhen:r?r.runWhen:null}),this.handlers.length-1},i.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},i.prototype.forEach=function(e){n.forEach(this.handlers,(function(t){null!==t&&e(t)}))},t.exports=i}}},{package:"analytics-node>axios"}],[1707,{"../helpers/combineURLs":1717,"../helpers/isAbsoluteURL":1719},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("../helpers/isAbsoluteURL"),i=e("../helpers/combineURLs");t.exports=function(e,t){return e&&!n(t)?i(e,t):t}}}},{package:"analytics-node>axios"}],[1708,{"./enhanceError":1710},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("./enhanceError");t.exports=function(e,t,r,i,a){var s=new Error(e);return n(s,t,r,i,a)}}}},{package:"analytics-node>axios"}],[1709,{"../cancel/isCancel":1704,"../defaults":1714,"./../utils":1726,"./transformData":1713},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("./../utils"),i=e("./transformData"),a=e("../cancel/isCancel"),s=e("../defaults");function o(e){e.cancelToken&&e.cancelToken.throwIfRequested()}t.exports=function(e){return o(e),e.headers=e.headers||{},e.data=i.call(e,e.data,e.headers,e.transformRequest),e.headers=n.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),n.forEach(["delete","get","head","post","put","patch","common"],(function(t){delete e.headers[t]})),(e.adapter||s.adapter)(e).then((function(t){return o(e),t.data=i.call(e,t.data,t.headers,e.transformResponse),t}),(function(t){return a(t)||(o(e),t&&t.response&&(t.response.data=i.call(e,t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)}))}}}},{package:"analytics-node>axios"}],[171,{"./config":170,"./utils/index":177,"@babel/runtime/helpers/asyncToGenerator":189,"@babel/runtime/helpers/classCallCheck":190,"@babel/runtime/helpers/createClass":192,"@babel/runtime/helpers/defineProperty":193,"@babel/runtime/helpers/interopRequireDefault":199,"@babel/runtime/regenerator":219},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("@babel/runtime/helpers/interopRequireDefault"),i=n(e("@babel/runtime/regenerator")),a=n(e("@babel/runtime/helpers/defineProperty")),s=n(e("@babel/runtime/helpers/asyncToGenerator")),o=n(e("@babel/runtime/helpers/classCallCheck")),u=n(e("@babel/runtime/helpers/createClass"));function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(r,!0).forEach((function(t){(0,a.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var f=e("./utils/index"),d=f.throwIfUndefined,p=f.throwIfNotEqualLenArrays,h=e("./config").orbitdb_options,m=function(){function e(t,r,n,i){(0,o.default)(this,e),this._orbitdb=t,this._name=r,this._name.startsWith("3box.space.")&&(this._space=this._name.split(".")[2]),this._ensureConnected=n,this._3id=i}var t,r,n,a,c,f,m,y,b,g;return(0,u.default)(e,[{key:"get",value:(g=(0,s.default)(i.default.mark((function e(t){var r,n,a,s=arguments;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>1&&s[1]!==undefined?s[1]:{},e.next=3,this._get(t);case 3:if(n=e.sent){e.next=6;break}return e.abrupt("return",n);case 6:if(!r.metadata){e.next=9;break}return a=this._extractMetadata(n),e.abrupt("return",l({},a,{value:n.value}));case 9:return e.abrupt("return",n.value);case 10:case"end":return e.stop()}}),e,this)}))),function(e){return g.apply(this,arguments)})},{key:"getMetadata",value:(b=(0,s.default)(i.default.mark((function e(t){var r;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._get(t);case 2:if(r=e.sent){e.next=5;break}return e.abrupt("return",r);case 5:return e.abrupt("return",this._extractMetadata(r));case 6:case"end":return e.stop()}}),e,this)}))),function(e){return b.apply(this,arguments)})},{key:"set",value:(y=(0,s.default)(i.default.mark((function e(t,r){var n;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d(t,"key"),this._requireLoad(),this._ensureConnected(),n=(new Date).getTime(),e.next=6,this._db.put(t,{value:r,timeStamp:n});case 6:return e.abrupt("return",!0);case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return y.apply(this,arguments)})},{key:"setMultiple",value:(m=(0,s.default)(i.default.mark((function e(t,r){var n=this;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return p(t,r),this._requireLoad(),this._ensureConnected(),e.prev=3,e.next=6,t.reduce(function(){var e=(0,s.default)(i.default.mark((function e(t,a,s){var o;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t;case 2:return d(a,"key"),o=(new Date).getTime(),e.abrupt("return",n._db.put(a,{value:r[s],timeStamp:o}));case 5:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),Promise.resolve());case 6:return e.abrupt("return",!0);case 9:throw e.prev=9,e.t0=e.catch(3),new Error(e.t0);case 12:case"end":return e.stop()}}),e,this,[[3,9]])}))),function(e,t){return m.apply(this,arguments)})},{key:"remove",value:(f=(0,s.default)(i.default.mark((function e(t){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d(t,"key"),this._requireLoad(),this._ensureConnected(),e.next=5,this._db.del(t);case 5:return e.abrupt("return",!0);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return f.apply(this,arguments)})},{key:"_extractMetadata",value:function(e){return{timestamp:Math.floor(e.timeStamp/1e3)}}},{key:"_get",value:(c=(0,s.default)(i.default.mark((function e(t){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._requireLoad(),e.abrupt("return",this._db.get(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"_sync",value:(a=(0,s.default)(i.default.mark((function e(t){var r=this;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._requireLoad(),!(null!==t&&t!==undefined&&t<=this._db._oplog.values.length)){e.next=4;break}return e.abrupt("return",Promise.resolve());case 4:return e.next=6,new Promise((function(e,n){t||setTimeout((function(){r._db.events.removeAllListeners("replicated"),r._db.events.removeAllListeners("replicate.progress"),e()}),3e3),r._db.events.on("replicated",(function(){t<=r._db._oplog.values.length&&e()}))}));case 6:return e.abrupt("return",this._db.address.toString());case 7:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"_load",value:(n=(0,s.default)(i.default.mark((function e(t){var r,n;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this._3id.getKeyringBySpaceName(this._name).getPublicKeys(!0).signingKey,n=l({},h,{format:"dag-pb",accessController:{write:[r],type:"legacy-ipfs-3box",skipManifest:!0}}),!this._space){e.next=6;break}return e.next=5,this._3id.getOdbId(this._space);case 5:n.identity=e.sent;case 6:return e.next=8,this._orbitdb.keyvalue(t||this._name,n);case 8:return this._db=e.sent,e.next=11,this._db.load();case 11:return e.abrupt("return",this._db.address.toString());case 12:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"_requireLoad",value:function(){if(!this._db)throw new Error("_load must be called before interacting with the store")}},{key:"close",value:(r=(0,s.default)(i.default.mark((function e(){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._requireLoad(),e.next=3,this._db.close();case 3:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"all",value:(t=(0,s.default)(i.default.mark((function e(){var t,r,n,a=this,s=arguments;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.length>0&&s[0]!==undefined?s[0]:{},this._requireLoad(),r=this._db.all,n={},Object.keys(r).map((function(e){var i=r[e];t.metadata?n[e]=l({},a._extractMetadata(i),{value:i.value}):n[e]=i.value})),e.abrupt("return",n);case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"log",get:function(){return this._db._oplog.values.map((function(e){return{op:e.payload.op,key:e.payload.key,value:e.payload.value?e.payload.value.value:null,timeStamp:e.payload.value?e.payload.value.timeStamp:null}}))}}]),e}();t.exports=m}}},{package:"3box"}],[1710,{},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=function(e,t,r,n,i){return e.config=t,r&&(e.code=r),e.request=n,e.response=i,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},e}}}},{package:"analytics-node>axios"}],[1711,{"../utils":1726},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("../utils");t.exports=function(e,t){t=t||{};var r={},i=["url","method","data"],a=["headers","auth","proxy","params"],s=["baseURL","transformRequest","transformResponse","paramsSerializer","timeout","timeoutMessage","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","decompress","maxContentLength","maxBodyLength","maxRedirects","transport","httpAgent","httpsAgent","cancelToken","socketPath","responseEncoding"],o=["validateStatus"];function u(e,t){return n.isPlainObject(e)&&n.isPlainObject(t)?n.merge(e,t):n.isPlainObject(t)?n.merge({},t):n.isArray(t)?t.slice():t}function c(i){n.isUndefined(t[i])?n.isUndefined(e[i])||(r[i]=u(undefined,e[i])):r[i]=u(e[i],t[i])}n.forEach(i,(function(e){n.isUndefined(t[e])||(r[e]=u(undefined,t[e]))})),n.forEach(a,c),n.forEach(s,(function(i){n.isUndefined(t[i])?n.isUndefined(e[i])||(r[i]=u(undefined,e[i])):r[i]=u(undefined,t[i])})),n.forEach(o,(function(n){n in t?r[n]=u(e[n],t[n]):n in e&&(r[n]=u(undefined,e[n]))}));var l=i.concat(a).concat(s).concat(o),f=Object.keys(e).concat(Object.keys(t)).filter((function(e){return-1===l.indexOf(e)}));return n.forEach(f,c),r}}}},{package:"analytics-node>axios"}],[1712,{"./createError":1708},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("./createError");t.exports=function(e,t,r){var i=r.config.validateStatus;r.status&&i&&!i(r.status)?t(n("Request failed with status code "+r.status,r.config,null,r.request,r)):e(r)}}}},{package:"analytics-node>axios"}],[1713,{"./../defaults":1714,"./../utils":1726},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("./../utils"),i=e("./../defaults");t.exports=function(e,t,r){var a=this||i;return n.forEach(r,(function(r){e=r.call(a,e,t)})),e}}}},{package:"analytics-node>axios"}],[1714,{"./adapters/http":1700,"./adapters/xhr":1700,"./core/enhanceError":1710,"./helpers/normalizeHeaderName":1722,"./utils":1726,_process:5342},function(){with(this)return function(){"use strict";return function(e,t,r){(function(r){(function(){var n=e("./utils"),i=e("./helpers/normalizeHeaderName"),a=e("./core/enhanceError"),s={"Content-Type":"application/x-www-form-urlencoded"};function o(e,t){!n.isUndefined(e)&&n.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var u,c={transitional:{silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},adapter:("undefined"!=typeof XMLHttpRequest?u=e("./adapters/xhr"):void 0!==r&&"[object process]"===Object.prototype.toString.call(r)&&(u=e("./adapters/http")),u),transformRequest:[function(e,t){return i(t,"Accept"),i(t,"Content-Type"),n.isFormData(e)||n.isArrayBuffer(e)||n.isBuffer(e)||n.isStream(e)||n.isFile(e)||n.isBlob(e)?e:n.isArrayBufferView(e)?e.buffer:n.isURLSearchParams(e)?(o(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):n.isObject(e)||t&&"application/json"===t["Content-Type"]?(o(t,"application/json"),function(e,t,r){if(n.isString(e))try{return(t||JSON.parse)(e),n.trim(e)}catch(e){if("SyntaxError"!==e.name)throw e}return(r||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){var t=this.transitional,r=t&&t.silentJSONParsing,i=t&&t.forcedJSONParsing,s=!r&&"json"===this.responseType;if(s||i&&n.isString(e)&&e.length)try{return JSON.parse(e)}catch(e){if(s){if("SyntaxError"===e.name)throw a(e,this,"E_JSON_PARSE");throw e}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(e){return e>=200&&e<300}};c.headers={common:{Accept:"application/json, text/plain, */*"}},n.forEach(["delete","get","head"],(function(e){c.headers[e]={}})),n.forEach(["post","put","patch"],(function(e){c.headers[e]=n.merge(s)})),t.exports=c}).call(this)}).call(this,e("_process"))}}},{package:"analytics-node>axios"}],[1715,{},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=function(e,t){return function(){for(var r=new Array(arguments.length),n=0;n<r.length;n++)r[n]=arguments[n];return e.apply(t,r)}}}}},{package:"analytics-node>axios"}],[1716,{"./../utils":1726},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("./../utils");function i(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}t.exports=function(e,t,r){if(!t)return e;var a;if(r)a=r(t);else if(n.isURLSearchParams(t))a=t.toString();else{var s=[];n.forEach(t,(function(e,t){null!=e&&(n.isArray(e)?t+="[]":e=[e],n.forEach(e,(function(e){n.isDate(e)?e=e.toISOString():n.isObject(e)&&(e=JSON.stringify(e)),s.push(i(t)+"="+i(e))})))})),a=s.join("&")}if(a){var o=e.indexOf("#");-1!==o&&(e=e.slice(0,o)),e+=(-1===e.indexOf("?")?"?":"&")+a}return e}}}},{package:"analytics-node>axios"}],[1717,{},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}}}},{package:"analytics-node>axios"}],[1718,{"./../utils":1726},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("./../utils");t.exports=n.isStandardBrowserEnv()?{write:function(e,t,r,i,a,s){var o=[];o.push(e+"="+encodeURIComponent(t)),n.isNumber(r)&&o.push("expires="+new Date(r).toGMTString()),n.isString(i)&&o.push("path="+i),n.isString(a)&&o.push("domain="+a),!0===s&&o.push("secure"),document.cookie=o.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}}}},{package:"analytics-node>axios"}],[1719,{},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=function(e){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(e)}}}},{package:"analytics-node>axios"}],[172,{"./keyValueStore":171,"./utils/index":177,"@babel/runtime/helpers/asyncToGenerator":189,"@babel/runtime/helpers/classCallCheck":190,"@babel/runtime/helpers/createClass":192,"@babel/runtime/helpers/defineProperty":193,"@babel/runtime/helpers/get":195,"@babel/runtime/helpers/getPrototypeOf":196,"@babel/runtime/helpers/inherits":197,"@babel/runtime/helpers/interopRequireDefault":199,"@babel/runtime/helpers/possibleConstructorReturn":210,"@babel/runtime/regenerator":219},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("@babel/runtime/helpers/interopRequireDefault"),i=n(e("@babel/runtime/regenerator")),a=n(e("@babel/runtime/helpers/defineProperty")),s=n(e("@babel/runtime/helpers/asyncToGenerator")),o=n(e("@babel/runtime/helpers/classCallCheck")),u=n(e("@babel/runtime/helpers/createClass")),c=n(e("@babel/runtime/helpers/possibleConstructorReturn")),l=n(e("@babel/runtime/helpers/getPrototypeOf")),f=n(e("@babel/runtime/helpers/get")),d=n(e("@babel/runtime/helpers/inherits"));function p(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function h(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?p(r,!0).forEach((function(t){(0,a.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):p(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var m=e("./keyValueStore"),y=e("./utils/index"),b=function(e){function t(e,r,n,i){var a;return(0,o.default)(this,t),(a=(0,c.default)(this,(0,l.default)(t).call(this,e,r,n,i))).keyring=i.getKeyringBySpaceName(r),a._salt=a.keyring.getDBSalt(),a}var r,n,a,p,m;return(0,d.default)(t,e),(0,u.default)(t,[{key:"get",value:(m=(0,s.default)(i.default.mark((function e(r){var n,a,s=arguments;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=s.length>1&&s[1]!==undefined?s[1]:{},e.next=3,(0,f.default)((0,l.default)(t.prototype),"get",this).call(this,this._genDbKey(r),n);case 3:if(a=e.sent){e.next=6;break}return e.abrupt("return",null);case 6:if(!n.metadata){e.next=8;break}return e.abrupt("return",h({},a,{value:this._decryptEntry(a.value)}));case 8:return e.abrupt("return",this._decryptEntry(a));case 9:case"end":return e.stop()}}),e,this)}))),function(e){return m.apply(this,arguments)})},{key:"getMetadata",value:(p=(0,s.default)(i.default.mark((function e(r){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,f.default)((0,l.default)(t.prototype),"getMetadata",this).call(this,this._genDbKey(r)));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"set",value:(a=(0,s.default)(i.default.mark((function e(r,n){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this._encryptEntry(n),r=this._genDbKey(r),e.abrupt("return",(0,f.default)((0,l.default)(t.prototype),"set",this).call(this,r,n));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"setMultiple",value:(n=(0,s.default)(i.default.mark((function e(r,n){var a,s;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return y.throwIfNotEqualLenArrays(r,n),a=r.map(this._genDbKey,this),s=n.map(this._encryptEntry,this),e.abrupt("return",(0,f.default)((0,l.default)(t.prototype),"setMultiple",this).call(this,a,s));case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"remove",value:(r=(0,s.default)(i.default.mark((function e(r){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this._genDbKey(r),e.abrupt("return",(0,f.default)((0,l.default)(t.prototype),"remove",this).call(this,r));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"_genDbKey",value:function(e){return y.throwIfUndefined(e,"key"),y.sha256Multihash(this._salt+e)}},{key:"_encryptEntry",value:function(e){if(void 0===e)throw new Error("Entry to encrypt cannot be undefined");return this.keyring.symEncrypt(this._pad(JSON.stringify(e)))}},{key:"_decryptEntry",value:function(e){var t=e.ciphertext,r=e.nonce;return JSON.parse(this._unpad(this.keyring.symDecrypt(t,r)))}},{key:"_pad",value:function(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:24,r=(t-e.length%t)%t;return"".concat(e).concat("\0".repeat(r))}},{key:"_unpad",value:function(e){return e.replace(/\0+$/,"")}},{key:"log",get:function(){var e=this;return(0,f.default)((0,l.default)(t.prototype),"log",this).map((function(t){return Object.assign(t,{value:t.value?e._decryptEntry(t.value):null})}))}}]),t}(m);t.exports=b}}},{package:"3box"}],[1720,{},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=function(e){return"object"==typeof e&&!0===e.isAxiosError}}}},{package:"analytics-node>axios"}],[1721,{"./../utils":1726},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("./../utils");t.exports=n.isStandardBrowserEnv()?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),r=document.createElement("a");function i(e){var n=e;return t&&(r.setAttribute("href",n),n=r.href),r.setAttribute("href",n),{href:r.href,protocol:r.protocol?r.protocol.replace(/:$/,""):"",host:r.host,search:r.search?r.search.replace(/^\?/,""):"",hash:r.hash?r.hash.replace(/^#/,""):"",hostname:r.hostname,port:r.port,pathname:"/"===r.pathname.charAt(0)?r.pathname:"/"+r.pathname}}return e=i(window.location.href),function(t){var r=n.isString(t)?i(t):t;return r.protocol===e.protocol&&r.host===e.host}}():function(){return!0}}}},{package:"analytics-node>axios"}],[1722,{"../utils":1726},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("../utils");t.exports=function(e,t){n.forEach(e,(function(r,n){n!==t&&n.toUpperCase()===t.toUpperCase()&&(e[t]=r,delete e[n])}))}}}},{package:"analytics-node>axios"}],[1723,{"./../utils":1726},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("./../utils"),i=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];t.exports=function(e){var t,r,a,s={};return e?(n.forEach(e.split("\n"),(function(e){if(a=e.indexOf(":"),t=n.trim(e.substr(0,a)).toLowerCase(),r=n.trim(e.substr(a+1)),t){if(s[t]&&i.indexOf(t)>=0)return;s[t]="set-cookie"===t?(s[t]?s[t]:[]).concat([r]):s[t]?s[t]+", "+r:r}})),s):s}}}},{package:"analytics-node>axios"}],[1724,{},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=function(e){return function(t){return e.apply(null,t)}}}}},{package:"analytics-node>axios"}],[1725,{"./../../package.json":1727},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("./../../package.json"),i={};["object","boolean","number","function","string","symbol"].forEach((function(e,t){i[e]=function(r){return typeof r===e||"a"+(t<1?"n ":" ")+e}}));var a={},s=n.version.split(".");function o(e,t){for(var r=t?t.split("."):s,n=e.split("."),i=0;i<3;i++){if(r[i]>n[i])return!0;if(r[i]<n[i])return!1}return!1}i.transitional=function(e,t,r){var i=t&&o(t);function s(e,t){return"[Axios v"+n.version+"] Transitional option '"+e+"'"+t+(r?". "+r:"")}return function(r,n,o){if(!1===e)throw new Error(s(n," has been removed in "+t));return i&&!a[n]&&(a[n]=!0,console.warn(s(n," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(r,n,o)}},t.exports={isOlderVersion:o,assertOptions:function(e,t,r){if("object"!=typeof e)throw new TypeError("options must be an object");for(var n=Object.keys(e),i=n.length;i-- >0;){var a=n[i],s=t[a];if(s){var o=e[a],u=o===undefined||s(o,a,e);if(!0!==u)throw new TypeError("option "+a+" must be "+u)}else if(!0!==r)throw Error("Unknown option "+a)}},validators:i}}}},{package:"analytics-node>axios"}],[1726,{"./helpers/bind":1715},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("./helpers/bind"),i=Object.prototype.toString;function a(e){return"[object Array]"===i.call(e)}function s(e){return void 0===e}function o(e){return null!==e&&"object"==typeof e}function u(e){if("[object Object]"!==i.call(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}function c(e){return"[object Function]"===i.call(e)}function l(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),a(e))for(var r=0,n=e.length;r<n;r++)t.call(null,e[r],r,e);else for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.call(null,e[i],i,e)}t.exports={isArray:a,isArrayBuffer:function(e){return"[object ArrayBuffer]"===i.call(e)},isBuffer:function(e){return null!==e&&!s(e)&&null!==e.constructor&&!s(e.constructor)&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},isFormData:function(e){return"undefined"!=typeof FormData&&e instanceof FormData},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:o,isPlainObject:u,isUndefined:s,isDate:function(e){return"[object Date]"===i.call(e)},isFile:function(e){return"[object File]"===i.call(e)},isBlob:function(e){return"[object Blob]"===i.call(e)},isFunction:c,isStream:function(e){return o(e)&&c(e.pipe)},isURLSearchParams:function(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&("undefined"!=typeof window&&"undefined"!=typeof document)},forEach:l,merge:function e(){var t={};function r(r,n){u(t[n])&&u(r)?t[n]=e(t[n],r):u(r)?t[n]=e({},r):a(r)?t[n]=r.slice():t[n]=r}for(var n=0,i=arguments.length;n<i;n++)l(arguments[n],r);return t},extend:function(e,t,r){return l(t,(function(t,i){e[i]=r&&"function"==typeof t?n(t,r):t})),e},trim:function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},stripBOM:function(e){return 65279===e.charCodeAt(0)&&(e=e.slice(1)),e}}}}},{package:"analytics-node>axios"}],[1727,{},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports={name:"axios",version:"0.21.4",description:"Promise based HTTP client for the browser and node.js",main:"index.js",scripts:{test:"grunt test",start:"node ./sandbox/server.js",build:"NODE_ENV=production grunt build",preversion:"npm test",version:"npm run build && grunt version && git add -A dist && git add CHANGELOG.md bower.json package.json",postversion:"git push && git push --tags",examples:"node ./examples/server.js",coveralls:"cat coverage/lcov.info | ./node_modules/coveralls/bin/coveralls.js",fix:"eslint --fix lib/**/*.js"},repository:{type:"git",url:"https://github.com/axios/axios.git"},keywords:["xhr","http","ajax","promise","node"],author:"Matt Zabriskie",license:"MIT",bugs:{url:"https://github.com/axios/axios/issues"},homepage:"https://axios-http.com",devDependencies:{coveralls:"^3.0.0","es6-promise":"^4.2.4",grunt:"^1.3.0","grunt-banner":"^0.6.0","grunt-cli":"^1.2.0","grunt-contrib-clean":"^1.1.0","grunt-contrib-watch":"^1.0.0","grunt-eslint":"^23.0.0","grunt-karma":"^4.0.0","grunt-mocha-test":"^0.13.3","grunt-ts":"^6.0.0-beta.19","grunt-webpack":"^4.0.2","istanbul-instrumenter-loader":"^1.0.0","jasmine-core":"^2.4.1",karma:"^6.3.2","karma-chrome-launcher":"^3.1.0","karma-firefox-launcher":"^2.1.0","karma-jasmine":"^1.1.1","karma-jasmine-ajax":"^0.1.13","karma-safari-launcher":"^1.0.0","karma-sauce-launcher":"^4.3.6","karma-sinon":"^1.0.5","karma-sourcemap-loader":"^0.3.8","karma-webpack":"^4.0.2","load-grunt-tasks":"^3.5.2",minimist:"^1.2.0",mocha:"^8.2.1",sinon:"^4.5.0","terser-webpack-plugin":"^4.2.3",typescript:"^4.0.5","url-search-params":"^0.10.0",webpack:"^4.44.2","webpack-dev-server":"^3.11.0"},browser:{"./lib/adapters/http.js":"./lib/adapters/xhr.js"},jsdelivr:"dist/axios.min.js",unpkg:"dist/axios.min.js",typings:"./index.d.ts",dependencies:{"follow-redirects":"^1.14.0"},bundlesize:[{path:"./dist/axios.min.js",threshold:"5kB"}]}}}},{package:"analytics-node>axios"}],[173,{"./keyValueStore":171,"./utils/index":177,"@babel/runtime/helpers/asyncToGenerator":189,"@babel/runtime/helpers/classCallCheck":190,"@babel/runtime/helpers/createClass":192,"@babel/runtime/helpers/get":195,"@babel/runtime/helpers/getPrototypeOf":196,"@babel/runtime/helpers/inherits":197,"@babel/runtime/helpers/interopRequireDefault":199,"@babel/runtime/helpers/possibleConstructorReturn":210,"@babel/runtime/regenerator":219},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("@babel/runtime/helpers/interopRequireDefault"),i=n(e("@babel/runtime/regenerator")),a=n(e("@babel/runtime/helpers/asyncToGenerator")),s=n(e("@babel/runtime/helpers/classCallCheck")),o=n(e("@babel/runtime/helpers/createClass")),u=n(e("@babel/runtime/helpers/possibleConstructorReturn")),c=n(e("@babel/runtime/helpers/getPrototypeOf")),l=n(e("@babel/runtime/helpers/get")),f=n(e("@babel/runtime/helpers/inherits")),d=e("./keyValueStore"),p=e("./utils/index"),h=p.throwIfUndefined,m=p.throwIfNotEqualLenArrays,y=function(e){function t(e,r,n,i,a){var o;return(0,s.default)(this,t),(o=(0,u.default)(this,(0,c.default)(t).call(this,e,r,i,a)))._linkProfile=n,o}var r,n;return(0,f.default)(t,e),(0,o.default)(t,[{key:"set",value:(n=(0,a.default)(i.default.mark((function e(r,n){var a,s=arguments;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=s.length>2&&s[2]!==undefined?s[2]:{},h(r,"key"),a.noLink){e.next=5;break}return e.next=5,this._linkProfile();case 5:return e.abrupt("return",(0,l.default)((0,c.default)(t.prototype),"set",this).call(this,r,n));case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"setMultiple",value:(r=(0,a.default)(i.default.mark((function e(r,n){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return m(r,n),e.next=3,this._linkProfile();case 3:return e.abrupt("return",(0,l.default)((0,c.default)(t.prototype),"setMultiple",this).call(this,r,n));case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})}]),t}(d);t.exports=y}}},{package:"3box"}],[174,{"./keyValueStore":171,"./thread":175,"./utils":177,"@babel/runtime/helpers/asyncToGenerator":189,"@babel/runtime/helpers/classCallCheck":190,"@babel/runtime/helpers/createClass":192,"@babel/runtime/helpers/defineProperty":193,"@babel/runtime/helpers/interopRequireDefault":199,"@babel/runtime/regenerator":219,"orbit-db/src/orbit-db-address":5282},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("@babel/runtime/helpers/interopRequireDefault"),i=n(e("@babel/runtime/helpers/defineProperty")),a=n(e("@babel/runtime/regenerator")),s=n(e("@babel/runtime/helpers/asyncToGenerator")),o=n(e("@babel/runtime/helpers/classCallCheck")),u=n(e("@babel/runtime/helpers/createClass"));function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(r,!0).forEach((function(t){(0,i.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var f=e("./keyValueStore"),d=e("./thread"),p=e("./utils"),h=p.sha256Multihash,m=p.throwIfUndefined,y=p.throwIfNotEqualLenArrays,b=e("orbit-db/src/orbit-db-address"),g=function(e){return"3box.space.".concat(e,".keyvalue")},v=function(e,t){return"3box.thread.".concat(e,".").concat(t)},w=function(){function e(t,r,n,i,a){(0,o.default)(this,e),this._name=t,this._3id=r,this._ensureConnected=a,this._store=new f(n,g(this._name),this._ensureConnected,this._3id),this._orbitdb=n,this._activeThreads={},this._rootStore=i,this.public=null,this.private=null}var t,r,n,i,c,l;return(0,u.default)(e,[{key:"open",value:(l=(0,s.default)(a.default.mark((function e(){var t,r,n,i,o,u,c,l,f=this,d=arguments;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=d.length>0&&d[0]!==undefined?d[0]:{},this._store._db){e.next=29;break}return e.next=4,this._3id.initKeyringByName(this._name);case 4:return r=e.sent,t.consentCallback&&t.consentCallback(r,this._name),e.next=8,this._store._load();case 8:return n=e.sent,e.next=11,this._rootStore.iterator({limit:-1}).collect();case 11:if(i=e.sent,o=i.find((function(e){return e.payload.value.odbAddress&&-1!==e.payload.value.odbAddress.indexOf(g(f._name))}))){e.next=18;break}return e.next=16,this._rootStore.add({type:"space",DID:this.DID,odbAddress:n});case 16:e.next=23;break;case 18:if(o.payload.value.type){e.next=23;break}return e.next=21,this._rootStore.del(o.hash);case 21:return e.next=23,this._rootStore.add({type:"space",DID:this.DID,odbAddress:n});case 23:u=t.numEntriesMessages&&t.numEntriesMessages[n],c=u?t.numEntriesMessages[n].numEntries:undefined,l=function(){var e=(0,s.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f._store._sync(c);case 2:t.onSyncDone&&t.onSyncDone();case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),this._syncSpacePromise=l(),this.public=_(this._store),this.private=k(this._store,this._3id.getKeyringBySpaceName(g(this._name)));case 29:case"end":return e.stop()}}),e,this)}))),function(){return l.apply(this,arguments)})},{key:"joinThread",value:(c=(0,s.default)(a.default.mark((function e(t){var r,n,i,s,o=arguments;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=o.length>1&&o[1]!==undefined?o[1]:{},n=r.noAutoSub?function(){}:this.subscribeThread.bind(this),r.firstModerator||(r.firstModerator=this._3id.getSubDID(this._name)),i=new d(this._orbitdb,v(this._name,t),this._3id,r.members,r.firstModerator,n,this._ensureConnected),e.next=6,i._getThreadAddress();case 6:if(s=e.sent,!this._activeThreads[s]){e.next=9;break}return e.abrupt("return",this._activeThreads[s]);case 9:return e.next=11,i._load();case 11:return this._activeThreads[s]=i,e.abrupt("return",i);case 13:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"joinThreadByAddress",value:(i=(0,s.default)(a.default.mark((function e(t){var r,n,i,s,o,u=arguments;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=u.length>1&&u[1]!==undefined?u[1]:{},b.isValid(t)){e.next=3;break}throw new Error("joinThreadByAddress: valid orbitdb address required");case 3:if(n=t.split(".")[2],i=t.split(".")[3],n===this._name){e.next=7;break}throw new Error("joinThreadByAddress: attempting to open thread from different space, must open within same space");case 7:if(!this._activeThreads[t]){e.next=9;break}return e.abrupt("return",this._activeThreads[t]);case 9:return s=r.noAutoSub?function(){}:this.subscribeThread.bind(this),o=new d(this._orbitdb,v(this._name,i),this._3id,r.members,r.firstModerator,s,this._ensureConnected),e.next=13,o._load(t);case 13:return this._activeThreads[t]=o,e.abrupt("return",o);case 15:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"subscribeThread",value:(n=(0,s.default)(a.default.mark((function e(t){var r,n,i=arguments;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=i.length>1&&i[1]!==undefined?i[1]:{},b.isValid(t)){e.next=3;break}throw new Error("subscribeThread: must subscribe to valid thread/orbitdb address");case 3:return n="thread-".concat(t),e.next=6,this._syncSpacePromise;case 6:return e.next=8,this.public.get(n);case 8:if(e.sent){e.next=11;break}return e.next=11,this.public.set(n,Object.assign({},r,{address:t}));case 11:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"unsubscribeThread",value:(r=(0,s.default)(a.default.mark((function e(t){var r;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="thread-".concat(t),e.next=3,this.public.get(r);case 3:if(!e.sent){e.next=6;break}return e.next=6,this.public.remove(r);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"subscribedThreads",value:(t=(0,s.default)(a.default.mark((function e(){var t;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.public.all();case 2:return t=e.sent,e.abrupt("return",Object.keys(t).reduce((function(e,r){if(r.startsWith("thread")){var n=r.split("thread-")[1];b.isValid(n)&&e.push(t[r])}return e}),[]));case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"DID",get:function(){return this._3id.getSubDID(this._name)}}]),e}();t.exports=w;var _=function(e){var t,r,n,i,o,u,c="pub_";return{get:(u=(0,s.default)(a.default.mark((function t(r){var n,i=arguments;return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=i.length>1&&i[1]!==undefined?i[1]:{},t.abrupt("return",e.get(c+r,n));case 2:case"end":return t.stop()}}),t)}))),function(e){return u.apply(this,arguments)}),getMetadata:(o=(0,s.default)(a.default.mark((function t(r){return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.getMetadata(c+r));case 1:case"end":return t.stop()}}),t)}))),function(e){return o.apply(this,arguments)}),set:(i=(0,s.default)(a.default.mark((function t(r,n){return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return m(r,"key"),t.abrupt("return",e.set(c+r,n));case 2:case"end":return t.stop()}}),t)}))),function(e,t){return i.apply(this,arguments)}),setMultiple:(n=(0,s.default)(a.default.mark((function t(r,n){var i;return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return y(r,n),i=r.map((function(e){return c+e})),t.abrupt("return",e.setMultiple(i,n));case 3:case"end":return t.stop()}}),t)}))),function(e,t){return n.apply(this,arguments)}),remove:(r=(0,s.default)(a.default.mark((function t(r){return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return m(r,"key"),t.abrupt("return",e.remove(c+r));case 2:case"end":return t.stop()}}),t)}))),function(e){return r.apply(this,arguments)}),get log(){return e.log.reduce((function(e,t){return t.key.startsWith(c)&&(t.key=t.key.slice(4),e.push(t)),e}),[])},all:(t=(0,s.default)(a.default.mark((function t(r){var n;return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.all(r);case 2:return n=t.sent,t.abrupt("return",Object.keys(n).reduce((function(e,t){return t.startsWith(c)&&(e[t.slice(4)]=n[t]),e}),{}));case 4:case"end":return t.stop()}}),t)}))),function(e){return t.apply(this,arguments)})}},k=function(e,t){var r,n,i,o,u,c,f="priv_",d=t.getDBSalt(),p=function(e){return m(e,"key"),f+h(d+e)},b=function(e){return t.symEncrypt(function(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:24,r=(t-e.length%t)%t;return"".concat(e).concat("\0".repeat(r))}(JSON.stringify(e)))},g=function(e){var r=e.ciphertext,n=e.nonce;return JSON.parse(t.symDecrypt(r,n).replace(/\0+$/,""))};return{get:(c=(0,s.default)(a.default.mark((function t(r){var n,i,s=arguments;return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=s.length>1&&s[1]!==undefined?s[1]:{},t.next=3,e.get(p(r),n);case 3:if(i=t.sent){t.next=6;break}return t.abrupt("return",null);case 6:if(!n.metadata){t.next=8;break}return t.abrupt("return",l({},i,{value:g(i.value).value}));case 8:return t.abrupt("return",g(i).value);case 9:case"end":return t.stop()}}),t)}))),function(e){return c.apply(this,arguments)}),getMetadata:(u=(0,s.default)(a.default.mark((function t(r){return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.getMetadata(p(r)));case 1:case"end":return t.stop()}}),t)}))),function(e){return u.apply(this,arguments)}),set:(o=(0,s.default)(a.default.mark((function t(r,n){return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.set(p(r),b({key:r,value:n})));case 1:case"end":return t.stop()}}),t)}))),function(e,t){return o.apply(this,arguments)}),setMultiple:(i=(0,s.default)(a.default.mark((function t(r,n){var i,s;return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return y(r,n),i=r.map(p),s=n.map((function(e,t){return b({key:r[t],value:e})})),t.abrupt("return",e.setMultiple(i,s));case 4:case"end":return t.stop()}}),t)}))),function(e,t){return i.apply(this,arguments)}),remove:(n=(0,s.default)(a.default.mark((function t(r){return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.remove(p(r)));case 1:case"end":return t.stop()}}),t)}))),function(e){return n.apply(this,arguments)}),get log(){return e.log.reduce((function(e,t){if(t.key.startsWith(f)){var r=g(t.value);t.key=r.key,t.value=r.value,e.push(t)}return e}),[])},all:(r=(0,s.default)(a.default.mark((function t(){var r,n,i=arguments;return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=i.length>0&&i[0]!==undefined?i[0]:{},t.next=3,e.all(r);case 3:return n=t.sent,t.abrupt("return",Object.keys(n).reduce((function(e,t){if(t.startsWith(f)){var i=n[t];if(r.metadata){var a=g(i.value);e[a.key]=l({},i,{value:a.value})}else{var s=g(i);e[s.key]=s.value}}return e}),{}));case 5:case"end":return t.stop()}}),t)}))),function(){return r.apply(this,arguments)})}}}}},{package:"3box"}],[175,{"./api":169,"./config":170,"@babel/runtime/helpers/asyncToGenerator":189,"@babel/runtime/helpers/classCallCheck":190,"@babel/runtime/helpers/createClass":192,"@babel/runtime/helpers/defineProperty":193,"@babel/runtime/helpers/interopRequireDefault":199,"@babel/runtime/regenerator":219,"is-ipfs":4612},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("@babel/runtime/helpers/interopRequireDefault"),i=n(e("@babel/runtime/helpers/defineProperty")),a=n(e("@babel/runtime/regenerator")),s=n(e("@babel/runtime/helpers/asyncToGenerator")),o=n(e("@babel/runtime/helpers/classCallCheck")),u=n(e("@babel/runtime/helpers/createClass"));function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(r,!0).forEach((function(t){(0,i.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var f=e("is-ipfs"),d=e("./api"),p=e("./config").orbitdb_options,h=function(e){var t=e.split(":");return"did"!==!t[0]&&"3"!==!t[1]&&f.cid(t[2])},m=function(){function e(t,r,n,i,a,s,u){(0,o.default)(this,e),this._orbitdb=t,this._name=r,this._spaceName=r.split(".")[2],this._3id=n,this._subscribe=s,this._ensureConnected=u,this._queuedNewPosts=[],this._members=Boolean(i),this._firstModerator=a||this._3id.getSubDID(this._spaceName)}var t,r,n,i,c,f,m,y,b,g,v,w,_;return(0,u.default)(e,[{key:"post",value:(_=(0,s.default)(a.default.mark((function e(t){var r;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._requireLoad(),this._subscribe(this._address,{firstModerator:this._firstModerator,members:this._members,name:this._name}),this._ensureConnected(this._address,!0),r=Math.floor((new Date).getTime()/1e3),e.abrupt("return",this._db.add({message:t,timestamp:r}));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return _.apply(this,arguments)})},{key:"_getThreadAddress",value:(w=(0,s.default)(a.default.mark((function e(){var t;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._initConfigs();case 2:return e.next=4,this._orbitdb._determineAddress(this._name,"feed",{accessController:this._accessController},!1);case 4:return t=e.sent.toString(),this._address=t,e.abrupt("return",this._address);case 7:case"end":return e.stop()}}),e,this)}))),function(){return w.apply(this,arguments)})},{key:"addModerator",value:(v=(0,s.default)(a.default.mark((function e(t){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._requireLoad(),!t.startsWith("0x")){e.next=5;break}return e.next=4,d.getSpaceDID(t,this._spaceName);case 4:t=e.sent;case 5:if(h(t)){e.next=7;break}throw new Error("addModerator: must provide valid 3ID");case 7:return e.abrupt("return",this._db.access.grant("MODERATOR",t));case 8:case"end":return e.stop()}}),e,this)}))),function(e){return v.apply(this,arguments)})},{key:"listModerators",value:(g=(0,s.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._requireLoad(),e.abrupt("return",this._db.access.capabilities.moderators);case 2:case"end":return e.stop()}}),e,this)}))),function(){return g.apply(this,arguments)})},{key:"addMember",value:(b=(0,s.default)(a.default.mark((function e(t){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._requireLoad(),this._throwIfNotMembers(),!t.startsWith("0x")){e.next=6;break}return e.next=5,d.getSpaceDID(t,this._spaceName);case 5:t=e.sent;case 6:if(h(t)){e.next=8;break}throw new Error("addModerator: must provide valid 3ID");case 8:return this._throwIfNotMembers(),e.abrupt("return",this._db.access.grant("MEMBER",t));case 10:case"end":return e.stop()}}),e,this)}))),function(e){return b.apply(this,arguments)})},{key:"listMembers",value:(y=(0,s.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._throwIfNotMembers(),this._requireLoad(),e.abrupt("return",this._db.access.capabilities.members);case 3:case"end":return e.stop()}}),e,this)}))),function(){return y.apply(this,arguments)})},{key:"_throwIfNotMembers",value:function(){if(!this._members)throw new Error("Thread: Not a members only thread, function not available")}},{key:"deletePost",value:(m=(0,s.default)(a.default.mark((function e(t){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._requireLoad(),e.abrupt("return",this._db.remove(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return m.apply(this,arguments)})},{key:"getPosts",value:(f=(0,s.default)(a.default.mark((function e(){var t,r=arguments;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&r[0]!==undefined?r[0]:{},this._requireLoad(),t.limit||(t.limit=-1),e.abrupt("return",this._db.iterator(t).collect().map((function(e){var t=e.payload.value,r={postId:e.hash,author:e.identity.id};return Object.assign(r,t)})));case 4:case"end":return e.stop()}}),e,this)}))),function(){return f.apply(this,arguments)})},{key:"onUpdate",value:(c=(0,s.default)(a.default.mark((function e(t){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._requireLoad(),this._db.events.on("replicated",(function(e,r,n,i,a){t()})),this._db.events.on("write",(function(e,r){t()}));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"onNewCapabilities",value:(i=(0,s.default)(a.default.mark((function e(t){var r=this;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._db.access.on("updated",(function(e){t(r._db.access.capabilities)}));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"_load",value:(n=(0,s.default)(a.default.mark((function e(t){var r;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._initConfigs();case 2:return r=this._identity,e.next=5,this._orbitdb.feed(t||this._name,l({},p,{identity:r,accessController:this._accessController}));case 5:return this._db=e.sent,e.next=8,this._db.load();case 8:return this._address=this._db.address.toString(),this._ensureConnected(this._address,!0),e.abrupt("return",this._address);case 11:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"_requireLoad",value:function(){if(!this._db)throw new Error("_load must be called before interacting with the store")}},{key:"close",value:(r=(0,s.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._requireLoad(),e.next=3,this._db.close();case 3:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"_initConfigs",value:(t=(0,s.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._identity){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this._3id.getOdbId(this._spaceName);case 4:if(this._identity=e.sent,!this._firstModerator.startsWith("0x")){e.next=9;break}return e.next=8,d.getSpaceDID(this._firstModerator,this._spaceName);case 8:this._firstModerator=e.sent;case 9:this._accessController={type:"thread-access",threadName:this._name,members:this._members,firstModerator:this._firstModerator,identity:this._identity};case 10:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"address",get:function(){return this._db?this._address:null}}]),e}();t.exports=m}}},{package:"3box"}],[176,{"@babel/runtime/helpers/asyncToGenerator":189,"@babel/runtime/helpers/interopRequireDefault":199,"@babel/runtime/regenerator":219,"did-jwt":180},function(){with(this)return function(){"use strict";return function(e,t,r){var n,i=e("@babel/runtime/helpers/interopRequireDefault"),a=i(e("@babel/runtime/regenerator")),s=i(e("@babel/runtime/helpers/asyncToGenerator")),o=e("did-jwt");t.exports={isMuportDID:function(e){return e.startsWith("did:muport:")},isClaim:(n=(0,s.default)(a.default.mark((function e(t){var r,n=arguments;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.length>1&&n[1]!==undefined?n[1]:{},e.prev=1,e.next=4,o.decodeJWT(t,r);case 4:return e.abrupt("return",!0);case 7:return e.prev=7,e.t0=e.catch(1),e.abrupt("return",!1);case 10:case"end":return e.stop()}}),e,null,[[1,7]])}))),function(e){return n.apply(this,arguments)}),verifyClaim:o.verifyJWT}}}},{package:"3box"}],[177,{"@babel/runtime/helpers/asyncToGenerator":189,"@babel/runtime/helpers/interopRequireDefault":199,"@babel/runtime/regenerator":219,buffer:1996,ethers:182,"js-sha256":4632,multihashes:5156,"node-fetch":5184},function(){with(this)return function(){"use strict";return function(e,t,r){(function(r){(function(){var n,i,a,s,o=e("@babel/runtime/helpers/interopRequireDefault"),u=o(e("@babel/runtime/regenerator")),c=o(e("@babel/runtime/helpers/asyncToGenerator")),l="undefined"!=typeof window?window.fetch:e("node-fetch"),f=e("multihashes"),d=e("js-sha256").sha256,p=e("ethers"),h=function(e,t){var r=new Error(t);return r.statusCode=e,r},m=function(e,t){var r="Create a new 3Box profile"+"\n\n"+"- \n"+"Your unique profile ID is "+e;return t&&(r+=" \n"+"Timestamp: "+t),r},y=function(e,t,r){var n=(Boolean(e.sendAsync)?e.sendAsync:e.send).bind(e);return new Promise((function(e,r){n(t,(function(t,n){t&&r(t),n.error&&r(n.error),e(n.result)}))}))};t.exports={getMessageConsent:m,recoverPersonalSign:(s=(0,c.default)(u.default.mark((function e(t,r){return u.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&r){e.next=2;break}throw new Error("recoverPersonalSign: missing arguments, msg and/or personalSig");case 2:return e.abrupt("return",p.utils.verifyMessage(t,r));case 4:case"end":return e.stop()}}),e)}))),function(e,t){return s.apply(this,arguments)}),openBoxConsent:function(e,t){var n="0x"+r.from("This app wants to view and update your 3Box profile.","utf8").toString("hex");return y(t,{jsonrpc:"2.0",id:0,method:"personal_sign",params:[n,e],fromAddress:e})},openSpaceConsent:function(e,t,n){var i="Allow this app to open your ".concat(n," space."),a="0x"+r.from(i,"utf8").toString("hex");return y(t,{jsonrpc:"2.0",id:0,method:"personal_sign",params:[a,e],fromAddress:e})},getLinkConsent:(a=(0,c.default)(u.default.mark((function e(t,n,i){var a,s,o,c,l;return u.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Math.floor((new Date).getTime()/1e3),s=m(n,a),o="0x"+r.from(s,"utf8").toString("hex"),c=[o,t],e.next=7,y(i,{jsonrpc:"2.0",id:0,method:"personal_sign",params:c,fromAddress:t});case 7:return l=e.sent,e.abrupt("return",{msg:s,sig:l,timestamp:a});case 9:case"end":return e.stop()}}),e)}))),function(e,t,r){return a.apply(this,arguments)}),fetchJson:(i=(0,c.default)(u.default.mark((function e(t,r){var n,i;return u.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r&&(n={body:JSON.stringify(r),method:"POST",headers:{"Content-Type":"application/json"}}),e.next=3,l(t,n);case 3:if(!(i=e.sent).ok){e.next=8;break}return e.abrupt("return",i.json());case 8:throw h(i.status,"Invalid response (".concat(i.status,") for query at ").concat(t));case 9:case"end":return e.stop()}}),e)}))),function(e,t){return i.apply(this,arguments)}),fetchText:(n=(0,c.default)(u.default.mark((function e(t,r){var n;return u.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l(t,r);case 2:if(!(n=e.sent).ok){e.next=7;break}return e.abrupt("return",n.text());case 7:throw h(n.status,"Invalid response (".concat(n.status,") for query at ").concat(t));case 8:case"end":return e.stop()}}),e)}))),function(e,t){return n.apply(this,arguments)}),throwIfUndefined:function(e,t){if(e===undefined||null===e)throw new Error("".concat(t," is a required argument"))},throwIfNotEqualLenArrays:function(e,t){if(!Array.isArray(e)||!Array.isArray(t))throw new Error("One or more arguments are not an array");if(e.length!==t.length)throw new Error("Arrays must be of the same length")},sha256Multihash:function(e){var t=r.from(d.digest(e));return f.encode(t,"sha2-256").toString("hex")},sha256:d}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"3box"}],[178,{"./index":177,"@babel/runtime/helpers/asyncToGenerator":189,"@babel/runtime/helpers/interopRequireDefault":199,"@babel/runtime/regenerator":219,"did-jwt":180,ethers:182,"https-did-resolver":4299,"muport-did-resolver":5173},function(){with(this)return function(){"use strict";return function(e,t,r){var n,i,a,s,o,u=e("@babel/runtime/helpers/interopRequireDefault"),c=u(e("@babel/runtime/regenerator")),l=u(e("@babel/runtime/helpers/asyncToGenerator")),f=e("./index"),d=f.fetchText,p=f.getMessageConsent,h=e("did-jwt"),m=e("ethers");e("https-did-resolver").default(),e("muport-did-resolver")(),t.exports={verifyGithub:(o=(0,l.default)(c.default.mark((function e(t,r){var n;return c.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r&&""!==r.trim()){e.next=2;break}return e.abrupt("return",null);case 2:return e.next=4,d(r);case 4:if(-1!==e.sent.indexOf(t)){e.next=7;break}throw new Error("Gist File provided does not contain the correct DID of the user");case 7:return n=r.split("/")[3],e.abrupt("return",{username:n,proof:r});case 9:case"end":return e.stop()}}),e)}))),function(e,t){return o.apply(this,arguments)}),verifyTwitter:(s=(0,l.default)(c.default.mark((function e(t,r){var n,i;return c.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=2;break}return e.abrupt("return",null);case 2:return e.next=4,h.verifyJWT(r);case 4:if((n=e.sent).payload.sub===t){e.next=7;break}throw new Error("Verification not valid for given user");case 7:if((i=n.payload.claim).twitter_handle&&i.twitter_proof){e.next=10;break}throw new Error("The claim for your twitter is not correct");case 10:return e.abrupt("return",{username:i.twitter_handle,proof:i.twitter_proof,verifiedBy:n.payload.iss});case 11:case"end":return e.stop()}}),e)}))),function(e,t){return s.apply(this,arguments)}),verifyEmail:(a=(0,l.default)(c.default.mark((function e(t,r){var n,i;return c.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=2;break}return e.abrupt("return",null);case 2:return e.next=4,h.verifyJWT(r);case 4:if((n=e.sent).payload.sub===t){e.next=7;break}throw new Error("Verification not valid for given user");case 7:if((i=n.payload.claim).email_address){e.next=10;break}throw new Error("The claim for your email address is not correct");case 10:return e.abrupt("return",{email_address:i.email_address,verifiedBy:n.payload.iss});case 11:case"end":return e.stop()}}),e)}))),function(e,t){return a.apply(this,arguments)}),verifyDID:(i=(0,l.default)(c.default.mark((function e(t){var r;return c.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.verifyJWT(t);case 2:return r=e.sent,e.abrupt("return",r.payload.iss);case 4:case"end":return e.stop()}}),e)}))),function(e){return i.apply(this,arguments)}),verifyEthereum:(n=(0,l.default)(c.default.mark((function e(t,r){var n,i,a;return c.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.version?t.message:t.consent_msg,i=t.version?t.signature:t.consent_signature,a=p(r),n===a){e.next=5;break}throw new Error('Invalid consent message, got: "'.concat(n,'", expected: "').concat(a,'"'));case 5:return e.abrupt("return",m.utils.verifyMessage(n,i));case 6:case"end":return e.stop()}}),e)}))),function(e,t){return n.apply(this,arguments)})}}}},{package:"3box"}],[179,{"./utils/verifier":178,"@babel/runtime/helpers/asyncToGenerator":189,"@babel/runtime/helpers/classCallCheck":190,"@babel/runtime/helpers/createClass":192,"@babel/runtime/helpers/interopRequireDefault":199,"@babel/runtime/regenerator":219},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("@babel/runtime/helpers/interopRequireDefault"),i=n(e("@babel/runtime/regenerator")),a=n(e("@babel/runtime/helpers/asyncToGenerator")),s=n(e("@babel/runtime/helpers/classCallCheck")),o=n(e("@babel/runtime/helpers/createClass")),u=e("./utils/verifier"),c=function(){function e(t){(0,s.default)(this,e),this._box=t,this._did=t._3id.muportDID}var t,r,n,c,l,f,d,p,h,m,y;return(0,o.default)(e,[{key:"_addVerifiedPublicAccount",value:(y=(0,a.default)(i.default.mark((function e(t,r,n){var a;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n(this._did,r);case 2:return a=e.sent,e.next=5,this._box.public.set("proof_"+t,r);case 5:return e.abrupt("return",a);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return y.apply(this,arguments)})},{key:"_getVerifiedPublicAccount",value:(m=(0,a.default)(i.default.mark((function e(t,r){var n;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._box.public.get("proof_"+t);case 2:return n=e.sent,e.abrupt("return",r(this._did,n));case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return m.apply(this,arguments)})},{key:"_addVerifiedPrivateAccount",value:(h=(0,a.default)(i.default.mark((function e(t,r,n){var a;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n(this._did,r);case 2:return a=e.sent,e.next=5,this._box.private.set("proof_"+t,r);case 5:return e.abrupt("return",a);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return h.apply(this,arguments)})},{key:"_getVerifiedPrivateAccount",value:(p=(0,a.default)(i.default.mark((function e(t,r){var n;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._box.private.get("proof_"+t);case 2:return n=e.sent,e.abrupt("return",r(this._did,n));case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return p.apply(this,arguments)})},{key:"DID",value:(d=(0,a.default)(i.default.mark((function e(){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._did);case 1:case"end":return e.stop()}}),e,this)}))),function(){return d.apply(this,arguments)})},{key:"github",value:(f=(0,a.default)(i.default.mark((function e(){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._getVerifiedPublicAccount("github",u.verifyGithub));case 1:case"end":return e.stop()}}),e,this)}))),function(){return f.apply(this,arguments)})},{key:"addGithub",value:(l=(0,a.default)(i.default.mark((function e(t){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._addVerifiedPublicAccount("github",t,u.verifyGithub));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"twitter",value:(c=(0,a.default)(i.default.mark((function e(){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._getVerifiedPublicAccount("twitter",u.verifyTwitter));case 1:case"end":return e.stop()}}),e,this)}))),function(){return c.apply(this,arguments)})},{key:"addTwitter",value:(n=(0,a.default)(i.default.mark((function e(t){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._addVerifiedPublicAccount("twitter",t,u.verifyTwitter));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"email",value:(r=(0,a.default)(i.default.mark((function e(){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._getVerifiedPrivateAccount("email",u.verifyEmail));case 1:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"addEmail",value:(t=(0,a.default)(i.default.mark((function e(t){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._addVerifiedPrivateAccount("email",t,u.verifyEmail));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}();t.exports=c}}},{package:"3box"}],[18,{"../util":20,"json-rpc-engine":4641},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.createPendingNonceMiddleware=function({getPendingNonce:e}){return(0,n.createAsyncMiddleware)((async(t,r,n)=>{const{method:i,params:a}=t;if("eth_getTransactionCount"!==i)return void n();const[s,o]=a;"pending"===o?r.result=await e(s):n()}))},r.createPendingTxMiddleware=function({getPendingTransactionByHash:e}){return(0,n.createAsyncMiddleware)((async(t,r,n)=>{const{method:a,params:s}=t;if("eth_getTransactionByHash"!==a)return void n();const[o]=s,u=e(o);u?r.result=(0,i.formatTxMetaForRpcResult)(u):n()}))};var n=e("json-rpc-engine"),i=e("../util")}}},{package:"$root$"}],[180,{"@stablelib/utf8":1470,buffer:1996,"did-resolver":2189,elliptic:2230,"js-sha256":4632,"js-sha3":181,tweetnacl:5913,"uport-base64url":5922},function(){with(this)return function(){"use strict";return function(e,t,r){(function(t){(function(){function n(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var i=e("js-sha256"),a=e("js-sha3"),s=e("elliptic"),o=n(e("tweetnacl")),u=e("@stablelib/utf8"),c=e("buffer"),l=n(e("uport-base64url")),f=n(e("did-resolver"));function d(e){return c.Buffer.from(i.sha256.arrayBuffer(e))}function p(e){return"0x"+(t=c.Buffer.from(e.slice(2),"hex"),c.Buffer.from(a.keccak_256.arrayBuffer(t))).slice(-20).toString("hex");var t}var h=new s.ec("secp256k1");function m(e,t){return void 0===t&&(t=64),e.length===t?e:"0".repeat(t-e.length)+e}function y(e){return new Uint8Array(Array.prototype.slice.call(t.from(e,"base64"),0))}var b=new s.ec("secp256k1");function g(e,t){void 0===t&&(t=!1);var r=l.toBuffer(e);if(r.length!==(t?65:64))throw new Error("wrong signature length");var n={r:r.slice(0,32).toString("hex"),s:r.slice(32,64).toString("hex")};return t&&(n.recoveryParam=r[64]),n}var v={ES256K:function(e,t,r){var n=d(e),i=g(t),a=r.find((function(e){return b.keyFromPublic(e.publicKeyHex,"hex").verify(n,i)}));if(!a)throw new Error("Signature invalid for JWT");return a},"ES256K-R":function(e,t,r){var n=g(t,!0),i=d(e),a=b.recoverPubKey(i,n,n.recoveryParam),s=a.encode("hex"),o=a.encode("hex",!0),u=p(s),c=r.find((function(e){var t=e.publicKeyHex;return t===s||t===o||e.ethereumAddress===u}));if(!c)throw new Error("Signature invalid for JWT");return c},Ed25519:function(e,t,r){var n=u.encode(e),i=y(l.toBase64(t)),a=r.find((function(e){return o.sign.detached.verify(n,i,y(e.publicKeyBase64))}));if(!a)throw new Error("Signature invalid for JWT");return a}};function w(e){var t=v[e];if(!t)throw new Error("Unsupported algorithm "+e);return t}function _(e){return"object"==typeof e&&"r"in e&&"s"in e}function k(e){return function(t,r){try{return Promise.resolve(r(t)).then((function(t){if(_(t))return function(r){var n=t.r,i=t.s,a=t.recoveryParam,s=c.Buffer.alloc(e?65:64);if(c.Buffer.from(n,"hex").copy(s,0),c.Buffer.from(i,"hex").copy(s,32),e){if(void 0===a)throw new Error("Signer did not return a recoveryParam");s[64]=a}return l.encode(s)}();throw new Error("expected a signer function that returns a signature object instead of string")}))}catch(e){return Promise.reject(e)}}}w.toSignatureObject=g;var S={ES256K:k(),"ES256K-R":k(!0),Ed25519:function(e,t){try{return Promise.resolve(t(e)).then((function(e){if(_(e))throw new Error("expected a signer function that returns a string instead of signature object");return e}))}catch(e){return Promise.reject(e)}}},x={ES256K:["Secp256k1VerificationKey2018","Secp256k1SignatureVerificationKey2018","EcdsaPublicKeySecp256k1"],"ES256K-R":["Secp256k1VerificationKey2018","Secp256k1SignatureVerificationKey2018","EcdsaPublicKeySecp256k1"],Ed25519:["ED25519SignatureVerification"]};function E(e){return l.encode(JSON.stringify(e))}function P(e){return e.match(/^[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]+$/)}function j(e){if(e.match(/^did:/))return e;if(P(e))return"did:uport:"+e;throw new Error("Not a valid DID '"+e+"'")}function O(e){if(!e)throw new Error("no JWT passed into decodeJWT");var t=e.match(/^([a-zA-Z0-9_-]+)\.([a-zA-Z0-9_-]+)\.([a-zA-Z0-9_-]+)$/);if(t)return{header:JSON.parse(l.decode(t[1])),payload:JSON.parse(l.decode(t[2])),signature:t[3],data:t[1]+"."+t[2]};throw new Error("Incorrect format JWT")}r.SimpleSigner=function(e){var t=h.keyFromPrivate(e);return function(e){try{var r=t.sign(d(e)),n=r.s,i=r.recoveryParam;return Promise.resolve({r:m(r.r.toString("hex")),s:m(n.toString("hex")),recoveryParam:i})}catch(e){return Promise.reject(e)}}},r.NaclSigner=function(e){var t=y(e);return function(e){try{var r=u.encode(e),n=o.sign.detached(r,t),i=l.encode(c.Buffer.from(n));return Promise.resolve(i)}catch(e){return Promise.reject(e)}}},r.verifyJWT=function(e,t){void 0===t&&(t={auth:null,audience:null,callbackUrl:null});try{var r=t.audience?j(t.audience):void 0,n=O(e),i=n.payload,a=n.header,s=n.signature,o=n.data;return Promise.resolve(function(e,t,r){try{var n=x[e];if(!n||0===n.length)throw new Error("No supported signature types for algorithm "+e);var i=j(t);return Promise.resolve(f(i)).then((function(t){if(!t)throw new Error("Unable to resolve DID document for "+i);var a=!r||(t.authentication||[]).map((function(e){return e.publicKey})),s=(t.publicKey||[]).filter((function(e){var t=e.type,i=e.id;return n.find((function(e){return e===t&&(!r||Array.isArray(a)&&a.indexOf(i)>=0)}))}));if(r&&(!s||0===s.length))throw new Error("DID document for "+i+" does not have public keys suitable for authenticationg user");if(!s||0===s.length)throw new Error("DID document for "+i+" does not have public keys for "+e);return{authenticators:s,issuer:i,doc:t}}))}catch(e){return Promise.reject(e)}}(a.alg,i.iss,t.auth)).then((function(n){var u,c=n.doc,l=n.authenticators,f=n.issuer,d=w(a.alg)(o,s,l),p=Math.floor(Date.now()/1e3);if(d){if(i.iat&&i.iat>p+300)throw new Error("JWT not valid yet (issued in the future): iat: "+i.iat+" > now: "+p);if(i.exp&&i.exp<=p-300)throw new Error("JWT has expired: exp: "+i.exp+" < now: "+p);if(i.aud)if((u=i.aud)&&(u.match(/^did:/)||P(u))){if(!r)throw new Error("JWT audience is required but your app address has not been configured");if(r!==j(i.aud))throw new Error("JWT audience does not match your DID: aud: "+i.aud+" !== yours: "+r)}else{if(!t.callbackUrl)throw new Error("JWT audience matching your callback url is required but one wasn't passed in");if(i.aud!==t.callbackUrl)throw new Error("JWT audience does not match the callback url: aud: "+i.aud+" !== url: "+t.callbackUrl)}return{payload:i,doc:c,issuer:f,signer:d,jwt:e}}}))}catch(e){return Promise.reject(e)}},r.createJWT=function(e,t){var r=t.issuer,n=t.signer,i=t.alg,a=t.expiresIn;try{if(!n)throw new Error("No Signer functionality has been configured");if(!r)throw new Error("No issuing DID has been configured");var s={typ:"JWT",alg:i||"ES256K"},o={iat:Math.floor(Date.now()/1e3),exp:void 0};if(a){if("number"!=typeof a)throw new Error("JWT expiresIn is not a number");o.exp=o.iat+Math.floor(a)}var u=[E(s),E(Object.assign({},o,e,{iss:r}))].join("."),c=function(e){var t=S[e];if(!t)throw new Error("Unsupported algorithm "+e);return t}(s.alg);return Promise.resolve(c(u,n)).then((function(e){return[u,e].join(".")}))}catch(e){return Promise.reject(e)}},r.decodeJWT=O,r.toEthereumAddress=p}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"3box>did-jwt"}],[181,{_process:5342},function(){with(this)return function(){"use strict";return function(e,t,r){(function(e){(function(){
/**
 * [js-sha3]{@link https://github.com/emn178/js-sha3}
 *
 * @version 0.8.0
 * @author Chen, Yi-Cyuan [emn178@gmail.com]
 * @copyright Chen, Yi-Cyuan 2015-2018
 * @license MIT
 */
!function(){var r="input is invalid type",n="object"==typeof window,i=n?window:{};i.JS_SHA3_NO_WINDOW&&(n=!1);var a=!n&&"object"==typeof self;!i.JS_SHA3_NO_NODE_JS&&"object"==typeof e&&e.versions&&e.versions.node?i=global:a&&(i=self);var s=!i.JS_SHA3_NO_COMMON_JS&&"object"==typeof t&&t.exports,o="function"==typeof define&&define.amd,u=!i.JS_SHA3_NO_ARRAY_BUFFER&&"undefined"!=typeof ArrayBuffer,c="0123456789abcdef".split(""),l=[4,1024,262144,67108864],f=[0,8,16,24],d=[1,0,32898,0,32906,2147483648,2147516416,2147483648,32907,0,2147483649,0,2147516545,2147483648,32777,2147483648,138,0,136,0,2147516425,0,2147483658,0,2147516555,0,139,2147483648,32905,2147483648,32771,2147483648,32770,2147483648,128,2147483648,32778,0,2147483658,2147483648,2147516545,2147483648,32896,2147483648,2147483649,0,2147516424,2147483648],p=[224,256,384,512],h=[128,256],m=["hex","buffer","arrayBuffer","array","digest"],y={128:168,256:136};!i.JS_SHA3_NO_NODE_JS&&Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),!u||!i.JS_SHA3_NO_ARRAY_BUFFER_IS_VIEW&&ArrayBuffer.isView||(ArrayBuffer.isView=function(e){return"object"==typeof e&&e.buffer&&e.buffer.constructor===ArrayBuffer});for(var b=function(e,t,r){return function(n){return new C(e,t,e).update(n)[r]()}},g=function(e,t,r){return function(n,i){return new C(e,t,i).update(n)[r]()}},v=function(e,t,r){return function(t,n,i,a){return x["cshake"+e].update(t,n,i,a)[r]()}},w=function(e,t,r){return function(t,n,i,a){return x["kmac"+e].update(t,n,i,a)[r]()}},_=function(e,t,r,n){for(var i=0;i<m.length;++i){var a=m[i];e[a]=t(r,n,a)}return e},k=function(e,t){var r=b(e,t,"hex");return r.create=function(){return new C(e,t,e)},r.update=function(e){return r.create().update(e)},_(r,b,e,t)},S=[{name:"keccak",padding:[1,256,65536,16777216],bits:p,createMethod:k},{name:"sha3",padding:[6,1536,393216,100663296],bits:p,createMethod:k},{name:"shake",padding:[31,7936,2031616,520093696],bits:h,createMethod:function(e,t){var r=g(e,t,"hex");return r.create=function(r){return new C(e,t,r)},r.update=function(e,t){return r.create(t).update(e)},_(r,g,e,t)}},{name:"cshake",padding:l,bits:h,createMethod:function(e,t){var r=y[e],n=v(e,0,"hex");return n.create=function(n,i,a){return i||a?new C(e,t,n).bytepad([i,a],r):x["shake"+e].create(n)},n.update=function(e,t,r,i){return n.create(t,r,i).update(e)},_(n,v,e,t)}},{name:"kmac",padding:l,bits:h,createMethod:function(e,t){var r=y[e],n=w(e,0,"hex");return n.create=function(n,i,a){return new M(e,t,i).bytepad(["KMAC",a],r).bytepad([n],r)},n.update=function(e,t,r,i){return n.create(e,r,i).update(t)},_(n,w,e,t)}}],x={},E=[],P=0;P<S.length;++P)for(var j=S[P],O=j.bits,A=0;A<O.length;++A){var T=j.name+"_"+O[A];if(E.push(T),x[T]=j.createMethod(O[A],j.padding),"sha3"!==j.name){var R=j.name+O[A];E.push(R),x[R]=x[T]}}function C(e,t,r){this.blocks=[],this.s=[],this.padding=t,this.outputBits=r,this.reset=!0,this.finalized=!1,this.block=0,this.start=0,this.blockCount=1600-(e<<1)>>5,this.byteCount=this.blockCount<<2,this.outputBlocks=r>>5,this.extraBytes=(31&r)>>3;for(var n=0;n<50;++n)this.s[n]=0}function M(e,t,r){C.call(this,e,t,r)}C.prototype.update=function(e){if(this.finalized)throw new Error("finalize already called");var t,n=typeof e;if("string"!==n){if("object"!==n)throw new Error(r);if(null===e)throw new Error(r);if(u&&e.constructor===ArrayBuffer)e=new Uint8Array(e);else if(!(Array.isArray(e)||u&&ArrayBuffer.isView(e)))throw new Error(r);t=!0}for(var i,a,s=this.blocks,o=this.byteCount,c=e.length,l=this.blockCount,d=0,p=this.s;d<c;){if(this.reset)for(this.reset=!1,s[0]=this.block,i=1;i<l+1;++i)s[i]=0;if(t)for(i=this.start;d<c&&i<o;++d)s[i>>2]|=e[d]<<f[3&i++];else for(i=this.start;d<c&&i<o;++d)(a=e.charCodeAt(d))<128?s[i>>2]|=a<<f[3&i++]:a<2048?(s[i>>2]|=(192|a>>6)<<f[3&i++],s[i>>2]|=(128|63&a)<<f[3&i++]):a<55296||a>=57344?(s[i>>2]|=(224|a>>12)<<f[3&i++],s[i>>2]|=(128|a>>6&63)<<f[3&i++],s[i>>2]|=(128|63&a)<<f[3&i++]):(a=65536+((1023&a)<<10|1023&e.charCodeAt(++d)),s[i>>2]|=(240|a>>18)<<f[3&i++],s[i>>2]|=(128|a>>12&63)<<f[3&i++],s[i>>2]|=(128|a>>6&63)<<f[3&i++],s[i>>2]|=(128|63&a)<<f[3&i++]);if(this.lastByteIndex=i,i>=o){for(this.start=i-o,this.block=s[l],i=0;i<l;++i)p[i]^=s[i];D(p),this.reset=!0}else this.start=i}return this},C.prototype.encode=function(e,t){var r=255&e,n=1,i=[r];for(r=255&(e>>=8);r>0;)i.unshift(r),r=255&(e>>=8),++n;return t?i.push(n):i.unshift(n),this.update(i),i.length},C.prototype.encodeString=function(e){var t,n=typeof e;if("string"!==n){if("object"!==n)throw new Error(r);if(null===e)throw new Error(r);if(u&&e.constructor===ArrayBuffer)e=new Uint8Array(e);else if(!(Array.isArray(e)||u&&ArrayBuffer.isView(e)))throw new Error(r);t=!0}var i=0,a=e.length;if(t)i=a;else for(var s=0;s<e.length;++s){var o=e.charCodeAt(s);o<128?i+=1:o<2048?i+=2:o<55296||o>=57344?i+=3:(o=65536+((1023&o)<<10|1023&e.charCodeAt(++s)),i+=4)}return i+=this.encode(8*i),this.update(e),i},C.prototype.bytepad=function(e,t){for(var r=this.encode(t),n=0;n<e.length;++n)r+=this.encodeString(e[n]);var i=t-r%t,a=[];return a.length=i,this.update(a),this},C.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var e=this.blocks,t=this.lastByteIndex,r=this.blockCount,n=this.s;if(e[t>>2]|=this.padding[3&t],this.lastByteIndex===this.byteCount)for(e[0]=e[r],t=1;t<r+1;++t)e[t]=0;for(e[r-1]|=2147483648,t=0;t<r;++t)n[t]^=e[t];D(n)}},C.prototype.toString=C.prototype.hex=function(){this.finalize();for(var e,t=this.blockCount,r=this.s,n=this.outputBlocks,i=this.extraBytes,a=0,s=0,o="";s<n;){for(a=0;a<t&&s<n;++a,++s)e=r[a],o+=c[e>>4&15]+c[15&e]+c[e>>12&15]+c[e>>8&15]+c[e>>20&15]+c[e>>16&15]+c[e>>28&15]+c[e>>24&15];s%t==0&&(D(r),a=0)}return i&&(e=r[a],o+=c[e>>4&15]+c[15&e],i>1&&(o+=c[e>>12&15]+c[e>>8&15]),i>2&&(o+=c[e>>20&15]+c[e>>16&15])),o},C.prototype.arrayBuffer=function(){this.finalize();var e,t=this.blockCount,r=this.s,n=this.outputBlocks,i=this.extraBytes,a=0,s=0,o=this.outputBits>>3;e=i?new ArrayBuffer(n+1<<2):new ArrayBuffer(o);for(var u=new Uint32Array(e);s<n;){for(a=0;a<t&&s<n;++a,++s)u[s]=r[a];s%t==0&&D(r)}return i&&(u[a]=r[a],e=e.slice(0,o)),e},C.prototype.buffer=C.prototype.arrayBuffer,C.prototype.digest=C.prototype.array=function(){this.finalize();for(var e,t,r=this.blockCount,n=this.s,i=this.outputBlocks,a=this.extraBytes,s=0,o=0,u=[];o<i;){for(s=0;s<r&&o<i;++s,++o)e=o<<2,t=n[s],u[e]=255&t,u[e+1]=t>>8&255,u[e+2]=t>>16&255,u[e+3]=t>>24&255;o%r==0&&D(n)}return a&&(e=o<<2,t=n[s],u[e]=255&t,a>1&&(u[e+1]=t>>8&255),a>2&&(u[e+2]=t>>16&255)),u},M.prototype=new C,M.prototype.finalize=function(){return this.encode(this.outputBits,!0),C.prototype.finalize.call(this)};var D=function(e){var t,r,n,i,a,s,o,u,c,l,f,p,h,m,y,b,g,v,w,_,k,S,x,E,P,j,O,A,T,R,C,M,D,I,N,L,B,q,U,$,K,F,z,W,V,J,H,G,Z,Y,Q,X,ee,te,re,ne,ie,ae,se,oe,ue,ce,le;for(n=0;n<48;n+=2)i=e[0]^e[10]^e[20]^e[30]^e[40],a=e[1]^e[11]^e[21]^e[31]^e[41],s=e[2]^e[12]^e[22]^e[32]^e[42],o=e[3]^e[13]^e[23]^e[33]^e[43],u=e[4]^e[14]^e[24]^e[34]^e[44],c=e[5]^e[15]^e[25]^e[35]^e[45],l=e[6]^e[16]^e[26]^e[36]^e[46],f=e[7]^e[17]^e[27]^e[37]^e[47],t=(p=e[8]^e[18]^e[28]^e[38]^e[48])^(s<<1|o>>>31),r=(h=e[9]^e[19]^e[29]^e[39]^e[49])^(o<<1|s>>>31),e[0]^=t,e[1]^=r,e[10]^=t,e[11]^=r,e[20]^=t,e[21]^=r,e[30]^=t,e[31]^=r,e[40]^=t,e[41]^=r,t=i^(u<<1|c>>>31),r=a^(c<<1|u>>>31),e[2]^=t,e[3]^=r,e[12]^=t,e[13]^=r,e[22]^=t,e[23]^=r,e[32]^=t,e[33]^=r,e[42]^=t,e[43]^=r,t=s^(l<<1|f>>>31),r=o^(f<<1|l>>>31),e[4]^=t,e[5]^=r,e[14]^=t,e[15]^=r,e[24]^=t,e[25]^=r,e[34]^=t,e[35]^=r,e[44]^=t,e[45]^=r,t=u^(p<<1|h>>>31),r=c^(h<<1|p>>>31),e[6]^=t,e[7]^=r,e[16]^=t,e[17]^=r,e[26]^=t,e[27]^=r,e[36]^=t,e[37]^=r,e[46]^=t,e[47]^=r,t=l^(i<<1|a>>>31),r=f^(a<<1|i>>>31),e[8]^=t,e[9]^=r,e[18]^=t,e[19]^=r,e[28]^=t,e[29]^=r,e[38]^=t,e[39]^=r,e[48]^=t,e[49]^=r,m=e[0],y=e[1],J=e[11]<<4|e[10]>>>28,H=e[10]<<4|e[11]>>>28,A=e[20]<<3|e[21]>>>29,T=e[21]<<3|e[20]>>>29,oe=e[31]<<9|e[30]>>>23,ue=e[30]<<9|e[31]>>>23,F=e[40]<<18|e[41]>>>14,z=e[41]<<18|e[40]>>>14,I=e[2]<<1|e[3]>>>31,N=e[3]<<1|e[2]>>>31,b=e[13]<<12|e[12]>>>20,g=e[12]<<12|e[13]>>>20,G=e[22]<<10|e[23]>>>22,Z=e[23]<<10|e[22]>>>22,R=e[33]<<13|e[32]>>>19,C=e[32]<<13|e[33]>>>19,ce=e[42]<<2|e[43]>>>30,le=e[43]<<2|e[42]>>>30,te=e[5]<<30|e[4]>>>2,re=e[4]<<30|e[5]>>>2,L=e[14]<<6|e[15]>>>26,B=e[15]<<6|e[14]>>>26,v=e[25]<<11|e[24]>>>21,w=e[24]<<11|e[25]>>>21,Y=e[34]<<15|e[35]>>>17,Q=e[35]<<15|e[34]>>>17,M=e[45]<<29|e[44]>>>3,D=e[44]<<29|e[45]>>>3,E=e[6]<<28|e[7]>>>4,P=e[7]<<28|e[6]>>>4,ne=e[17]<<23|e[16]>>>9,ie=e[16]<<23|e[17]>>>9,q=e[26]<<25|e[27]>>>7,U=e[27]<<25|e[26]>>>7,_=e[36]<<21|e[37]>>>11,k=e[37]<<21|e[36]>>>11,X=e[47]<<24|e[46]>>>8,ee=e[46]<<24|e[47]>>>8,W=e[8]<<27|e[9]>>>5,V=e[9]<<27|e[8]>>>5,j=e[18]<<20|e[19]>>>12,O=e[19]<<20|e[18]>>>12,ae=e[29]<<7|e[28]>>>25,se=e[28]<<7|e[29]>>>25,$=e[38]<<8|e[39]>>>24,K=e[39]<<8|e[38]>>>24,S=e[48]<<14|e[49]>>>18,x=e[49]<<14|e[48]>>>18,e[0]=m^~b&v,e[1]=y^~g&w,e[10]=E^~j&A,e[11]=P^~O&T,e[20]=I^~L&q,e[21]=N^~B&U,e[30]=W^~J&G,e[31]=V^~H&Z,e[40]=te^~ne&ae,e[41]=re^~ie&se,e[2]=b^~v&_,e[3]=g^~w&k,e[12]=j^~A&R,e[13]=O^~T&C,e[22]=L^~q&$,e[23]=B^~U&K,e[32]=J^~G&Y,e[33]=H^~Z&Q,e[42]=ne^~ae&oe,e[43]=ie^~se&ue,e[4]=v^~_&S,e[5]=w^~k&x,e[14]=A^~R&M,e[15]=T^~C&D,e[24]=q^~$&F,e[25]=U^~K&z,e[34]=G^~Y&X,e[35]=Z^~Q&ee,e[44]=ae^~oe&ce,e[45]=se^~ue&le,e[6]=_^~S&m,e[7]=k^~x&y,e[16]=R^~M&E,e[17]=C^~D&P,e[26]=$^~F&I,e[27]=K^~z&N,e[36]=Y^~X&W,e[37]=Q^~ee&V,e[46]=oe^~ce&te,e[47]=ue^~le&re,e[8]=S^~m&b,e[9]=x^~y&g,e[18]=M^~E&j,e[19]=D^~P&O,e[28]=F^~I&L,e[29]=z^~N&B,e[38]=X^~W&J,e[39]=ee^~V&H,e[48]=ce^~te&ne,e[49]=le^~re&ie,e[0]^=d[n],e[1]^=d[n+1]};if(s)t.exports=x;else{for(P=0;P<E.length;++P)i[E[P]]=x[E[P]];o&&define((function(){return x}))}}()}).call(this)}).call(this,e("_process"))}}},{package:"3box>did-jwt>js-sha3"}]],[],{});