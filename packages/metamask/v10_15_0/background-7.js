LavaPack.loadBundle([[5840,{"../errors":5837,"./_stream_duplex":5838,"./internal/streams/async_iterator":5843,"./internal/streams/buffer_list":5844,"./internal/streams/destroy":5845,"./internal/streams/from":5847,"./internal/streams/state":5849,"./internal/streams/stream":5850,_process:5342,buffer:1996,events:1997,inherits:4319,"string_decoder/":5818,util:1995},function(){with(this)return function(){"use strict";return function(e,t,r){(function(r){(function(){var n;t.exports=_,_.ReadableState=C;e("events").EventEmitter;var o=function(e,t){return e.listeners(t).length},i=e("./internal/streams/stream"),s=e("buffer").Buffer,a=global.Uint8Array||function(){};var c,l=e("util");c=l&&l.debuglog?l.debuglog("stream"):function(){};var u,d,p,h=e("./internal/streams/buffer_list"),f=e("./internal/streams/destroy"),g=e("./internal/streams/state").getHighWaterMark,m=e("../errors").codes,b=m.ERR_INVALID_ARG_TYPE,y=m.ERR_STREAM_PUSH_AFTER_EOF,E=m.ERR_METHOD_NOT_IMPLEMENTED,v=m.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;e("inherits")(_,i);var w=f.errorOrDestroy,S=["error","close","destroy","pause","resume"];function C(t,r,o){n=n||e("./_stream_duplex"),t=t||{},"boolean"!=typeof o&&(o=r instanceof n),this.objectMode=!!t.objectMode,o&&(this.objectMode=this.objectMode||!!t.readableObjectMode),this.highWaterMark=g(this,t,"readableHighWaterMark",o),this.buffer=new h,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=!1!==t.emitClose,this.autoDestroy=!!t.autoDestroy,this.destroyed=!1,this.defaultEncoding=t.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(u||(u=e("string_decoder/").StringDecoder),this.decoder=new u(t.encoding),this.encoding=t.encoding)}function _(t){if(n=n||e("./_stream_duplex"),!(this instanceof _))return new _(t);var r=this instanceof n;this._readableState=new C(t,this,r),this.readable=!0,t&&("function"==typeof t.read&&(this._read=t.read),"function"==typeof t.destroy&&(this._destroy=t.destroy)),i.call(this)}function T(e,t,r,n,o){c("readableAddChunk",t);var i,l=e._readableState;if(null===t)l.reading=!1,function(e,t){if(c("onEofChunk"),t.ended)return;if(t.decoder){var r=t.decoder.end();r&&r.length&&(t.buffer.push(r),t.length+=t.objectMode?1:r.length)}t.ended=!0,t.sync?P(e):(t.needReadable=!1,t.emittedReadable||(t.emittedReadable=!0,R(e)))}(e,l);else if(o||(i=function(e,t){var r;n=t,s.isBuffer(n)||n instanceof a||"string"==typeof t||t===undefined||e.objectMode||(r=new b("chunk",["string","Buffer","Uint8Array"],t));var n;return r}(l,t)),i)w(e,i);else if(l.objectMode||t&&t.length>0)if("string"==typeof t||l.objectMode||Object.getPrototypeOf(t)===s.prototype||(t=function(e){return s.from(e)}(t)),n)l.endEmitted?w(e,new v):k(e,l,t,!0);else if(l.ended)w(e,new y);else{if(l.destroyed)return!1;l.reading=!1,l.decoder&&!r?(t=l.decoder.write(t),l.objectMode||0!==t.length?k(e,l,t,!1):A(e,l)):k(e,l,t,!1)}else n||(l.reading=!1,A(e,l));return!l.ended&&(l.length<l.highWaterMark||0===l.length)}function k(e,t,r,n){t.flowing&&0===t.length&&!t.sync?(t.awaitDrain=0,e.emit("data",r)):(t.length+=t.objectMode?1:r.length,n?t.buffer.unshift(r):t.buffer.push(r),t.needReadable&&P(e)),A(e,t)}Object.defineProperty(_.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState!==undefined&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),_.prototype.destroy=f.destroy,_.prototype._undestroy=f.undestroy,_.prototype._destroy=function(e,t){t(e)},_.prototype.push=function(e,t){var r,n=this._readableState;return n.objectMode?r=!0:"string"==typeof e&&((t=t||n.defaultEncoding)!==n.encoding&&(e=s.from(e,t),t=""),r=!0),T(this,e,t,!1,r)},_.prototype.unshift=function(e){return T(this,e,null,!0,!1)},_.prototype.isPaused=function(){return!1===this._readableState.flowing},_.prototype.setEncoding=function(t){u||(u=e("string_decoder/").StringDecoder);var r=new u(t);this._readableState.decoder=r,this._readableState.encoding=this._readableState.decoder.encoding;for(var n=this._readableState.buffer.head,o="";null!==n;)o+=r.write(n.data),n=n.next;return this._readableState.buffer.clear(),""!==o&&this._readableState.buffer.push(o),this._readableState.length=o.length,this};var M=1073741824;function O(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=M?e=M:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function P(e){var t=e._readableState;c("emitReadable",t.needReadable,t.emittedReadable),t.needReadable=!1,t.emittedReadable||(c("emitReadable",t.flowing),t.emittedReadable=!0,r.nextTick(R,e))}function R(e){var t=e._readableState;c("emitReadable_",t.destroyed,t.length,t.ended),t.destroyed||!t.length&&!t.ended||(e.emit("readable"),t.emittedReadable=!1),t.needReadable=!t.flowing&&!t.ended&&t.length<=t.highWaterMark,x(e)}function A(e,t){t.readingMore||(t.readingMore=!0,r.nextTick(I,e,t))}function I(e,t){for(;!t.reading&&!t.ended&&(t.length<t.highWaterMark||t.flowing&&0===t.length);){var r=t.length;if(c("maybeReadMore read 0"),e.read(0),r===t.length)break}t.readingMore=!1}function N(e){var t=e._readableState;t.readableListening=e.listenerCount("readable")>0,t.resumeScheduled&&!t.paused?t.flowing=!0:e.listenerCount("data")>0&&e.resume()}function D(e){c("readable nexttick read 0"),e.read(0)}function U(e,t){c("resume",t.reading),t.reading||e.read(0),t.resumeScheduled=!1,e.emit("resume"),x(e),t.flowing&&!t.reading&&e.read(0)}function x(e){var t=e._readableState;for(c("flow",t.flowing);t.flowing&&null!==e.read(););}function L(e,t){return 0===t.length?null:(t.objectMode?r=t.buffer.shift():!e||e>=t.length?(r=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.first():t.buffer.concat(t.length),t.buffer.clear()):r=t.buffer.consume(e,t.decoder),r);var r}function j(e){var t=e._readableState;c("endReadable",t.endEmitted),t.endEmitted||(t.ended=!0,r.nextTick(B,t,e))}function B(e,t){if(c("endReadableNT",e.endEmitted,e.length),!e.endEmitted&&0===e.length&&(e.endEmitted=!0,t.readable=!1,t.emit("end"),e.autoDestroy)){var r=t._writableState;(!r||r.autoDestroy&&r.finished)&&t.destroy()}}function F(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1}_.prototype.read=function(e){c("read",e),e=parseInt(e,10);var t=this._readableState,r=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&((0!==t.highWaterMark?t.length>=t.highWaterMark:t.length>0)||t.ended))return c("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?j(this):P(this),null;if(0===(e=O(e,t))&&t.ended)return 0===t.length&&j(this),null;var n,o=t.needReadable;return c("need readable",o),(0===t.length||t.length-e<t.highWaterMark)&&c("length less than watermark",o=!0),t.ended||t.reading?c("reading or ended",o=!1):o&&(c("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=O(r,t))),null===(n=e>0?L(e,t):null)?(t.needReadable=t.length<=t.highWaterMark,e=0):(t.length-=e,t.awaitDrain=0),0===t.length&&(t.ended||(t.needReadable=!0),r!==e&&t.ended&&j(this)),null!==n&&this.emit("data",n),n},_.prototype._read=function(e){w(this,new E("_read()"))},_.prototype.pipe=function(e,t){var n=this,i=this._readableState;switch(i.pipesCount){case 0:i.pipes=e;break;case 1:i.pipes=[i.pipes,e];break;default:i.pipes.push(e)}i.pipesCount+=1,c("pipe count=%d opts=%j",i.pipesCount,t);var s=(!t||!1!==t.end)&&e!==r.stdout&&e!==r.stderr?l:m;function a(t,r){c("onunpipe"),t===n&&r&&!1===r.hasUnpiped&&(r.hasUnpiped=!0,c("cleanup"),e.removeListener("close",f),e.removeListener("finish",g),e.removeListener("drain",u),e.removeListener("error",h),e.removeListener("unpipe",a),n.removeListener("end",l),n.removeListener("end",m),n.removeListener("data",p),d=!0,!i.awaitDrain||e._writableState&&!e._writableState.needDrain||u())}function l(){c("onend"),e.end()}i.endEmitted?r.nextTick(s):n.once("end",s),e.on("unpipe",a);var u=function(e){return function(){var t=e._readableState;c("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&o(e,"data")&&(t.flowing=!0,x(e))}}(n);e.on("drain",u);var d=!1;function p(t){c("ondata");var r=e.write(t);c("dest.write",r),!1===r&&((1===i.pipesCount&&i.pipes===e||i.pipesCount>1&&-1!==F(i.pipes,e))&&!d&&(c("false write response, pause",i.awaitDrain),i.awaitDrain++),n.pause())}function h(t){c("onerror",t),m(),e.removeListener("error",h),0===o(e,"error")&&w(e,t)}function f(){e.removeListener("finish",g),m()}function g(){c("onfinish"),e.removeListener("close",f),m()}function m(){c("unpipe"),n.unpipe(e)}return n.on("data",p),function(e,t,r){if("function"==typeof e.prependListener)return e.prependListener(t,r);e._events&&e._events[t]?Array.isArray(e._events[t])?e._events[t].unshift(r):e._events[t]=[r,e._events[t]]:e.on(t,r)}(e,"error",h),e.once("close",f),e.once("finish",g),e.emit("pipe",n),i.flowing||(c("pipe resume"),n.resume()),e},_.prototype.unpipe=function(e){var t=this._readableState,r={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,r)),this;if(!e){var n=t.pipes,o=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var i=0;i<o;i++)n[i].emit("unpipe",this,{hasUnpiped:!1});return this}var s=F(t.pipes,e);return-1===s||(t.pipes.splice(s,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,r)),this},_.prototype.on=function(e,t){var n=i.prototype.on.call(this,e,t),o=this._readableState;return"data"===e?(o.readableListening=this.listenerCount("readable")>0,!1!==o.flowing&&this.resume()):"readable"===e&&(o.endEmitted||o.readableListening||(o.readableListening=o.needReadable=!0,o.flowing=!1,o.emittedReadable=!1,c("on readable",o.length,o.reading),o.length?P(this):o.reading||r.nextTick(D,this))),n},_.prototype.addListener=_.prototype.on,_.prototype.removeListener=function(e,t){var n=i.prototype.removeListener.call(this,e,t);return"readable"===e&&r.nextTick(N,this),n},_.prototype.removeAllListeners=function(e){var t=i.prototype.removeAllListeners.apply(this,arguments);return"readable"!==e&&e!==undefined||r.nextTick(N,this),t},_.prototype.resume=function(){var e=this._readableState;return e.flowing||(c("resume"),e.flowing=!e.readableListening,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,r.nextTick(U,e,t))}(this,e)),e.paused=!1,this},_.prototype.pause=function(){return c("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(c("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},_.prototype.wrap=function(e){var t=this,r=this._readableState,n=!1;for(var o in e.on("end",(function(){if(c("wrapped end"),r.decoder&&!r.ended){var e=r.decoder.end();e&&e.length&&t.push(e)}t.push(null)})),e.on("data",(function(o){(c("wrapped data"),r.decoder&&(o=r.decoder.write(o)),!r.objectMode||null!==o&&o!==undefined)&&((r.objectMode||o&&o.length)&&(t.push(o)||(n=!0,e.pause())))})),e)this[o]===undefined&&"function"==typeof e[o]&&(this[o]=function(t){return function(){return e[t].apply(e,arguments)}}(o));for(var i=0;i<S.length;i++)e.on(S[i],this.emit.bind(this,S[i]));return this._read=function(t){c("wrapped _read",t),n&&(n=!1,e.resume())},this},"function"==typeof Symbol&&(_.prototype[Symbol.asyncIterator]=function(){return d===undefined&&(d=e("./internal/streams/async_iterator")),d(this)}),Object.defineProperty(_.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(_.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(_.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(e){this._readableState&&(this._readableState.flowing=e)}}),_._fromList=L,Object.defineProperty(_.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),"function"==typeof Symbol&&(_.from=function(t,r){return p===undefined&&(p=e("./internal/streams/from")),p(_,t,r)})}).call(this)}).call(this,e("_process"))}}},{package:"@metamask/snap-controllers>tar-stream>readable-stream"}],[5841,{"../errors":5837,"./_stream_duplex":5838,inherits:4319},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=u;var n=e("../errors").codes,o=n.ERR_METHOD_NOT_IMPLEMENTED,i=n.ERR_MULTIPLE_CALLBACK,s=n.ERR_TRANSFORM_ALREADY_TRANSFORMING,a=n.ERR_TRANSFORM_WITH_LENGTH_0,c=e("./_stream_duplex");function l(e,t){var r=this._transformState;r.transforming=!1;var n=r.writecb;if(null===n)return this.emit("error",new i);r.writechunk=null,r.writecb=null,null!=t&&this.push(t),n(e);var o=this._readableState;o.reading=!1,(o.needReadable||o.length<o.highWaterMark)&&this._read(o.highWaterMark)}function u(e){if(!(this instanceof u))return new u(e);c.call(this,e),this._transformState={afterTransform:l.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",d)}function d(){var e=this;"function"!=typeof this._flush||this._readableState.destroyed?p(this,null,null):this._flush((function(t,r){p(e,t,r)}))}function p(e,t,r){if(t)return e.emit("error",t);if(null!=r&&e.push(r),e._writableState.length)throw new a;if(e._transformState.transforming)throw new s;return e.push(null)}e("inherits")(u,c),u.prototype.push=function(e,t){return this._transformState.needTransform=!1,c.prototype.push.call(this,e,t)},u.prototype._transform=function(e,t,r){r(new o("_transform()"))},u.prototype._write=function(e,t,r){var n=this._transformState;if(n.writecb=r,n.writechunk=e,n.writeencoding=t,!n.transforming){var o=this._readableState;(n.needTransform||o.needReadable||o.length<o.highWaterMark)&&this._read(o.highWaterMark)}},u.prototype._read=function(e){var t=this._transformState;null===t.writechunk||t.transforming?t.needTransform=!0:(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform))},u.prototype._destroy=function(e,t){c.prototype._destroy.call(this,e,(function(e){t(e)}))}}}},{package:"@metamask/snap-controllers>tar-stream>readable-stream"}],[5842,{"../errors":5837,"./_stream_duplex":5838,"./internal/streams/destroy":5845,"./internal/streams/state":5849,"./internal/streams/stream":5850,_process:5342,buffer:1996,inherits:4319,"util-deprecate":5929},function(){with(this)return function(){"use strict";return function(e,t,r){(function(r){(function(){function n(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,r){var n=e.entry;e.entry=null;for(;n;){var o=n.callback;t.pendingcb--,o(r),n=n.next}t.corkedRequestsFree.next=e}(t,e)}}var o;t.exports=_,_.WritableState=C;var i={deprecate:e("util-deprecate")},s=e("./internal/streams/stream"),a=e("buffer").Buffer,c=global.Uint8Array||function(){};var l,u=e("./internal/streams/destroy"),d=e("./internal/streams/state").getHighWaterMark,p=e("../errors").codes,h=p.ERR_INVALID_ARG_TYPE,f=p.ERR_METHOD_NOT_IMPLEMENTED,g=p.ERR_MULTIPLE_CALLBACK,m=p.ERR_STREAM_CANNOT_PIPE,b=p.ERR_STREAM_DESTROYED,y=p.ERR_STREAM_NULL_VALUES,E=p.ERR_STREAM_WRITE_AFTER_END,v=p.ERR_UNKNOWN_ENCODING,w=u.errorOrDestroy;function S(){}function C(t,i,s){o=o||e("./_stream_duplex"),t=t||{},"boolean"!=typeof s&&(s=i instanceof o),this.objectMode=!!t.objectMode,s&&(this.objectMode=this.objectMode||!!t.writableObjectMode),this.highWaterMark=d(this,t,"writableHighWaterMark",s),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var a=!1===t.decodeStrings;this.decodeStrings=!a,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var n=e._writableState,o=n.sync,i=n.writecb;if("function"!=typeof i)throw new g;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(n),t)!function(e,t,n,o,i){--t.pendingcb,n?(r.nextTick(i,o),r.nextTick(R,e,t),e._writableState.errorEmitted=!0,w(e,o)):(i(o),e._writableState.errorEmitted=!0,w(e,o),R(e,t))}(e,n,o,t,i);else{var s=O(n)||e.destroyed;s||n.corked||n.bufferProcessing||!n.bufferedRequest||M(e,n),o?r.nextTick(k,e,n,s,i):k(e,n,s,i)}}(i,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!1!==t.emitClose,this.autoDestroy=!!t.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new n(this)}function _(t){var r=this instanceof(o=o||e("./_stream_duplex"));if(!r&&!l.call(_,this))return new _(t);this._writableState=new C(t,this,r),this.writable=!0,t&&("function"==typeof t.write&&(this._write=t.write),"function"==typeof t.writev&&(this._writev=t.writev),"function"==typeof t.destroy&&(this._destroy=t.destroy),"function"==typeof t.final&&(this._final=t.final)),s.call(this)}function T(e,t,r,n,o,i,s){t.writelen=n,t.writecb=s,t.writing=!0,t.sync=!0,t.destroyed?t.onwrite(new b("write")):r?e._writev(o,t.onwrite):e._write(o,i,t.onwrite),t.sync=!1}function k(e,t,r,n){r||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,n(),R(e,t)}function M(e,t){t.bufferProcessing=!0;var r=t.bufferedRequest;if(e._writev&&r&&r.next){var o=t.bufferedRequestCount,i=new Array(o),s=t.corkedRequestsFree;s.entry=r;for(var a=0,c=!0;r;)i[a]=r,r.isBuf||(c=!1),r=r.next,a+=1;i.allBuffers=c,T(e,t,!0,t.length,i,"",s.finish),t.pendingcb++,t.lastBufferedRequest=null,s.next?(t.corkedRequestsFree=s.next,s.next=null):t.corkedRequestsFree=new n(t),t.bufferedRequestCount=0}else{for(;r;){var l=r.chunk,u=r.encoding,d=r.callback;if(T(e,t,!1,t.objectMode?1:l.length,l,u,d),r=r.next,t.bufferedRequestCount--,t.writing)break}null===r&&(t.lastBufferedRequest=null)}t.bufferedRequest=r,t.bufferProcessing=!1}function O(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function P(e,t){e._final((function(r){t.pendingcb--,r&&w(e,r),t.prefinished=!0,e.emit("prefinish"),R(e,t)}))}function R(e,t){var n=O(t);if(n&&(function(e,t){t.prefinished||t.finalCalled||("function"!=typeof e._final||t.destroyed?(t.prefinished=!0,e.emit("prefinish")):(t.pendingcb++,t.finalCalled=!0,r.nextTick(P,e,t)))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"),t.autoDestroy))){var o=e._readableState;(!o||o.autoDestroy&&o.endEmitted)&&e.destroy()}return n}e("inherits")(_,s),C.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(C.prototype,"buffer",{get:i.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer "+"instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(l=Function.prototype[Symbol.hasInstance],Object.defineProperty(_,Symbol.hasInstance,{value:function(e){return!!l.call(this,e)||this===_&&(e&&e._writableState instanceof C)}})):l=function(e){return e instanceof this},_.prototype.pipe=function(){w(this,new m)},_.prototype.write=function(e,t,n){var o,i=this._writableState,s=!1,l=!i.objectMode&&(o=e,a.isBuffer(o)||o instanceof c);return l&&!a.isBuffer(e)&&(e=function(e){return a.from(e)}(e)),"function"==typeof t&&(n=t,t=null),l?t="buffer":t||(t=i.defaultEncoding),"function"!=typeof n&&(n=S),i.ending?function(e,t){var n=new E;w(e,n),r.nextTick(t,n)}(this,n):(l||function(e,t,n,o){var i;return null===n?i=new y:"string"==typeof n||t.objectMode||(i=new h("chunk",["string","Buffer"],n)),!i||(w(e,i),r.nextTick(o,i),!1)}(this,i,e,n))&&(i.pendingcb++,s=function(e,t,r,n,o,i){if(!r){var s=function(e,t,r){e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=a.from(t,r));return t}(t,n,o);n!==s&&(r=!0,o="buffer",n=s)}var c=t.objectMode?1:n.length;t.length+=c;var l=t.length<t.highWaterMark;l||(t.needDrain=!0);if(t.writing||t.corked){var u=t.lastBufferedRequest;t.lastBufferedRequest={chunk:n,encoding:o,isBuf:r,callback:i,next:null},u?u.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else T(e,t,!1,c,n,o,i);return l}(this,i,l,e,t,n)),s},_.prototype.cork=function(){this._writableState.corked++},_.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.bufferProcessing||!e.bufferedRequest||M(this,e))},_.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new v(e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(_.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(_.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),_.prototype._write=function(e,t,r){r(new f("_write()"))},_.prototype._writev=null,_.prototype.end=function(e,t,n){var o=this._writableState;return"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),null!==e&&e!==undefined&&this.write(e,t),o.corked&&(o.corked=1,this.uncork()),o.ending||function(e,t,n){t.ending=!0,R(e,t),n&&(t.finished?r.nextTick(n):e.once("finish",n));t.ended=!0,e.writable=!1}(this,o,n),this},Object.defineProperty(_.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(_.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState!==undefined&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),_.prototype.destroy=u.destroy,_.prototype._undestroy=u.undestroy,_.prototype._destroy=function(e,t){t(e)}}).call(this)}).call(this,e("_process"))}}},{package:"@metamask/snap-controllers>tar-stream>readable-stream"}],[5843,{"./end-of-stream":5846,_process:5342},function(){with(this)return function(){"use strict";return function(e,t,r){(function(r){(function(){var n;function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var i=e("./end-of-stream"),s=Symbol("lastResolve"),a=Symbol("lastReject"),c=Symbol("error"),l=Symbol("ended"),u=Symbol("lastPromise"),d=Symbol("handlePromise"),p=Symbol("stream");function h(e,t){return{value:e,done:t}}function f(e){var t=e[s];if(null!==t){var r=e[p].read();null!==r&&(e[u]=null,e[s]=null,e[a]=null,t(h(r,!1)))}}function g(e){r.nextTick(f,e)}var m=Object.getPrototypeOf((function(){})),b=Object.setPrototypeOf((o(n={get stream(){return this[p]},next:function(){var e=this,t=this[c];if(null!==t)return Promise.reject(t);if(this[l])return Promise.resolve(h(undefined,!0));if(this[p].destroyed)return new Promise((function(t,n){r.nextTick((function(){e[c]?n(e[c]):t(h(undefined,!0))}))}));var n,o=this[u];if(o)n=new Promise(function(e,t){return function(r,n){e.then((function(){t[l]?r(h(undefined,!0)):t[d](r,n)}),n)}}(o,this));else{var i=this[p].read();if(null!==i)return Promise.resolve(h(i,!1));n=new Promise(this[d])}return this[u]=n,n}},Symbol.asyncIterator,(function(){return this})),o(n,"return",(function(){var e=this;return new Promise((function(t,r){e[p].destroy(null,(function(e){e?r(e):t(h(undefined,!0))}))}))})),n),m);t.exports=function(e){var t,r=Object.create(b,(o(t={},p,{value:e,writable:!0}),o(t,s,{value:null,writable:!0}),o(t,a,{value:null,writable:!0}),o(t,c,{value:null,writable:!0}),o(t,l,{value:e._readableState.endEmitted,writable:!0}),o(t,d,{value:function(e,t){var n=r[p].read();n?(r[u]=null,r[s]=null,r[a]=null,e(h(n,!1))):(r[s]=e,r[a]=t)},writable:!0}),t));return r[u]=null,i(e,(function(e){if(e&&"ERR_STREAM_PREMATURE_CLOSE"!==e.code){var t=r[a];return null!==t&&(r[u]=null,r[s]=null,r[a]=null,t(e)),void(r[c]=e)}var n=r[s];null!==n&&(r[u]=null,r[s]=null,r[a]=null,n(h(undefined,!0))),r[l]=!0})),e.on("readable",g.bind(null,r)),r}}).call(this)}).call(this,e("_process"))}}},{package:"@metamask/snap-controllers>tar-stream>readable-stream"}],[5844,{buffer:1996,util:1995},function(){with(this)return function(){"use strict";return function(e,t,r){function n(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var s=e("buffer").Buffer,a=e("util").inspect,c=a&&a.custom||"inspect";t.exports=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}var t,r,l;return t=e,r=[{key:"push",value:function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length}},{key:"unshift",value:function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length}},{key:"shift",value:function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(e){if(0===this.length)return"";for(var t=this.head,r=""+t.data;t=t.next;)r+=e+t.data;return r}},{key:"concat",value:function(e){if(0===this.length)return s.alloc(0);for(var t,r,n,o=s.allocUnsafe(e>>>0),i=this.head,a=0;i;)t=i.data,r=o,n=a,s.prototype.copy.call(t,r,n),a+=i.data.length,i=i.next;return o}},{key:"consume",value:function(e,t){var r;return e<this.head.data.length?(r=this.head.data.slice(0,e),this.head.data=this.head.data.slice(e)):r=e===this.head.data.length?this.shift():t?this._getString(e):this._getBuffer(e),r}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(e){var t=this.head,r=1,n=t.data;for(e-=n.length;t=t.next;){var o=t.data,i=e>o.length?o.length:e;if(i===o.length?n+=o:n+=o.slice(0,e),0==(e-=i)){i===o.length?(++r,t.next?this.head=t.next:this.head=this.tail=null):(this.head=t,t.data=o.slice(i));break}++r}return this.length-=r,n}},{key:"_getBuffer",value:function(e){var t=s.allocUnsafe(e),r=this.head,n=1;for(r.data.copy(t),e-=r.data.length;r=r.next;){var o=r.data,i=e>o.length?o.length:e;if(o.copy(t,t.length-e,0,i),0==(e-=i)){i===o.length?(++n,r.next?this.head=r.next:this.head=this.tail=null):(this.head=r,r.data=o.slice(i));break}++n}return this.length-=n,t}},{key:c,value:function(e,t){return a(this,function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?n(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},t,{depth:0,customInspect:!1}))}}],r&&i(t.prototype,r),l&&i(t,l),e}()}}},{package:"@metamask/snap-controllers>tar-stream>readable-stream"}],[5845,{_process:5342},function(){with(this)return function(){"use strict";return function(e,t,r){(function(e){(function(){function r(e,t){o(e,t),n(e)}function n(e){e._writableState&&!e._writableState.emitClose||e._readableState&&!e._readableState.emitClose||e.emit("close")}function o(e,t){e.emit("error",t)}t.exports={destroy:function(t,i){var s=this,a=this._readableState&&this._readableState.destroyed,c=this._writableState&&this._writableState.destroyed;return a||c?(i?i(t):t&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,e.nextTick(o,this,t)):e.nextTick(o,this,t)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(t||null,(function(t){!i&&t?s._writableState?s._writableState.errorEmitted?e.nextTick(n,s):(s._writableState.errorEmitted=!0,e.nextTick(r,s,t)):e.nextTick(r,s,t):i?(e.nextTick(n,s),i(t)):e.nextTick(n,s)})),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(e,t){var r=e._readableState,n=e._writableState;r&&r.autoDestroy||n&&n.autoDestroy?e.destroy(t):e.emit("error",t)}}}).call(this)}).call(this,e("_process"))}}},{package:"@metamask/snap-controllers>tar-stream>readable-stream"}],[5846,{"../../../errors":5837},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("../../../errors").codes.ERR_STREAM_PREMATURE_CLOSE;function o(){}t.exports=function e(t,r,i){if("function"==typeof r)return e(t,null,r);r||(r={}),i=function(e){var t=!1;return function(){if(!t){t=!0;for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];e.apply(this,n)}}}(i||o);var s=r.readable||!1!==r.readable&&t.readable,a=r.writable||!1!==r.writable&&t.writable,c=function(){t.writable||u()},l=t._writableState&&t._writableState.finished,u=function(){a=!1,l=!0,s||i.call(t)},d=t._readableState&&t._readableState.endEmitted,p=function(){s=!1,d=!0,a||i.call(t)},h=function(e){i.call(t,e)},f=function(){var e;return s&&!d?(t._readableState&&t._readableState.ended||(e=new n),i.call(t,e)):a&&!l?(t._writableState&&t._writableState.ended||(e=new n),i.call(t,e)):void 0},g=function(){t.req.on("finish",u)};return!function(e){return e.setHeader&&"function"==typeof e.abort}(t)?a&&!t._writableState&&(t.on("end",c),t.on("close",c)):(t.on("complete",u),t.on("abort",f),t.req?g():t.on("request",g)),t.on("end",p),t.on("finish",u),!1!==r.error&&t.on("error",h),t.on("close",f),function(){t.removeListener("complete",u),t.removeListener("abort",f),t.removeListener("request",g),t.req&&t.req.removeListener("finish",u),t.removeListener("end",c),t.removeListener("close",c),t.removeListener("finish",u),t.removeListener("end",p),t.removeListener("error",h),t.removeListener("close",f)}}}}},{package:"@metamask/snap-controllers>tar-stream>readable-stream"}],[5847,{},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=function(){throw new Error("Readable.from is not available in the browser")}}}},{package:"@metamask/snap-controllers>tar-stream>readable-stream"}],[5848,{"../../../errors":5837,"./end-of-stream":5846},function(){with(this)return function(){"use strict";return function(e,t,r){var n;var o=e("../../../errors").codes,i=o.ERR_MISSING_ARGS,s=o.ERR_STREAM_DESTROYED;function a(e){if(e)throw e}function c(t,r,o,i){i=function(e){var t=!1;return function(){t||(t=!0,e.apply(void 0,arguments))}}(i);var a=!1;t.on("close",(function(){a=!0})),n===undefined&&(n=e("./end-of-stream")),n(t,{readable:r,writable:o},(function(e){if(e)return i(e);a=!0,i()}));var c=!1;return function(e){if(!a&&!c)return c=!0,function(e){return e.setHeader&&"function"==typeof e.abort}(t)?t.abort():"function"==typeof t.destroy?t.destroy():void i(e||new s("pipe"))}}function l(e){e()}function u(e,t){return e.pipe(t)}function d(e){return e.length?"function"!=typeof e[e.length-1]?a:e.pop():a}t.exports=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n,o=d(t);if(Array.isArray(t[0])&&(t=t[0]),t.length<2)throw new i("streams");var s=t.map((function(e,r){var i=r<t.length-1;return c(e,i,r>0,(function(e){n||(n=e),e&&s.forEach(l),i||(s.forEach(l),o(n))}))}));return t.reduce(u)}}}},{package:"@metamask/snap-controllers>tar-stream>readable-stream"}],[5849,{"../../../errors":5837},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("../../../errors").codes.ERR_INVALID_OPT_VALUE;t.exports={getHighWaterMark:function(e,t,r,o){var i=function(e,t,r){return null!=e.highWaterMark?e.highWaterMark:t?e[r]:null}(t,o,r);if(null!=i){if(!isFinite(i)||Math.floor(i)!==i||i<0)throw new n(o?r:"highWaterMark",i);return Math.floor(i)}return e.objectMode?16:16384}}}}},{package:"@metamask/snap-controllers>tar-stream>readable-stream"}],[585,{stream:1999},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.storeAsStream=void 0;const n=e("stream");class o extends n.Duplex{constructor(e){super({objectMode:!0}),this.resume(),this.handler=e=>this.push(e),this.obsStore=e,this.obsStore.subscribe(this.handler)}pipe(e,t){const r=super.pipe(e,t);return e.write(this.obsStore.getState()),r}_write(e,t,r){this.obsStore.putState(e),r()}_read(e){return undefined}_destroy(e,t){this.obsStore.unsubscribe(this.handler),super._destroy(e,t)}}r.storeAsStream=function(e){return new o(e)}}}},{package:"@keystonehq/metamask-airgapped-keyring>@metamask/obs-store"}],[5850,{events:1997},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=e("events").EventEmitter}}},{package:"@metamask/snap-controllers>tar-stream>readable-stream"}],[5851,{"./lib/_stream_duplex.js":5838,"./lib/_stream_passthrough.js":5839,"./lib/_stream_readable.js":5840,"./lib/_stream_transform.js":5841,"./lib/_stream_writable.js":5842,"./lib/internal/streams/end-of-stream.js":5846,"./lib/internal/streams/pipeline.js":5848},function(){with(this)return function(){"use strict";return function(e,t,r){(r=t.exports=e("./lib/_stream_readable.js")).Stream=r,r.Readable=r,r.Writable=e("./lib/_stream_writable.js"),r.Duplex=e("./lib/_stream_duplex.js"),r.Transform=e("./lib/_stream_transform.js"),r.PassThrough=e("./lib/_stream_passthrough.js"),r.finished=e("./lib/internal/streams/end-of-stream.js"),r.pipeline=e("./lib/internal/streams/pipeline.js")}}},{package:"@metamask/snap-controllers>tar-stream>readable-stream"}],[5852,{"./headers":5833,_process:5342,buffer:1996,"end-of-stream":2253,"fs-constants":4218,inherits:4319,"readable-stream":5851,string_decoder:5818},function(){with(this)return function(){"use strict";return function(e,t,r){(function(r,n){(function(){var o=e("fs-constants"),i=e("end-of-stream"),s=e("inherits"),a=n.alloc,c=e("readable-stream").Readable,l=e("readable-stream").Writable,u=e("string_decoder").StringDecoder,d=e("./headers"),p=parseInt("755",8),h=parseInt("644",8),f=a(1024),g=function(){},m=function(e,t){(t&=511)&&e.push(f.slice(0,512-t))};var b=function(e){l.call(this),this.written=0,this._to=e,this._destroyed=!1};s(b,l),b.prototype._write=function(e,t,r){if(this.written+=e.length,this._to.push(e))return r();this._to._drain=r},b.prototype.destroy=function(){this._destroyed||(this._destroyed=!0,this.emit("close"))};var y=function(){l.call(this),this.linkname="",this._decoder=new u("utf-8"),this._destroyed=!1};s(y,l),y.prototype._write=function(e,t,r){this.linkname+=this._decoder.write(e),r()},y.prototype.destroy=function(){this._destroyed||(this._destroyed=!0,this.emit("close"))};var E=function(){l.call(this),this._destroyed=!1};s(E,l),E.prototype._write=function(e,t,r){r(new Error("No body allowed for this entry"))},E.prototype.destroy=function(){this._destroyed||(this._destroyed=!0,this.emit("close"))};var v=function(e){if(!(this instanceof v))return new v(e);c.call(this,e),this._drain=g,this._finalized=!1,this._finalizing=!1,this._destroyed=!1,this._stream=null};s(v,c),v.prototype.entry=function(e,t,s){if(this._stream)throw new Error("already piping an entry");if(!this._finalized&&!this._destroyed){"function"==typeof t&&(s=t,t=null),s||(s=g);var a=this;if(e.size&&"symlink"!==e.type||(e.size=0),e.type||(e.type=function(e){switch(e&o.S_IFMT){case o.S_IFBLK:return"block-device";case o.S_IFCHR:return"character-device";case o.S_IFDIR:return"directory";case o.S_IFIFO:return"fifo";case o.S_IFLNK:return"symlink"}return"file"}(e.mode)),e.mode||(e.mode="directory"===e.type?p:h),e.uid||(e.uid=0),e.gid||(e.gid=0),e.mtime||(e.mtime=new Date),"string"==typeof t&&(t=n.from(t)),n.isBuffer(t)){e.size=t.length,this._encode(e);var c=this.push(t);return m(a,e.size),c?r.nextTick(s):this._drain=s,new E}if("symlink"===e.type&&!e.linkname){var l=new y;return i(l,(function(t){if(t)return a.destroy(),s(t);e.linkname=l.linkname,a._encode(e),s()})),l}if(this._encode(e),"file"!==e.type&&"contiguous-file"!==e.type)return r.nextTick(s),new E;var u=new b(this);return this._stream=u,i(u,(function(t){return a._stream=null,t?(a.destroy(),s(t)):u.written!==e.size?(a.destroy(),s(new Error("size mismatch"))):(m(a,e.size),a._finalizing&&a.finalize(),void s())})),u}},v.prototype.finalize=function(){this._stream?this._finalizing=!0:this._finalized||(this._finalized=!0,this.push(f),this.push(null))},v.prototype.destroy=function(e){this._destroyed||(this._destroyed=!0,e&&this.emit("error",e),this.emit("close"),this._stream&&this._stream.destroy&&this._stream.destroy())},v.prototype._encode=function(e){if(!e.pax){var t=d.encode(e);if(t)return void this.push(t)}this._encodePax(e)},v.prototype._encodePax=function(e){var t=d.encodePax({name:e.name,linkname:e.linkname,pax:e.pax}),r={name:"PaxHeader",mode:e.mode,uid:e.uid,gid:e.gid,size:t.length,mtime:e.mtime,type:"pax-header",linkname:e.linkname&&"PaxHeader",uname:e.uname,gname:e.gname,devmajor:e.devmajor,devminor:e.devminor};this.push(d.encode(r)),this.push(t),m(this,t.length),r.size=e.size,r.type=e.type,this.push(d.encode(r))},v.prototype._read=function(e){var t=this._drain;this._drain=g,t()},t.exports=v}).call(this)}).call(this,e("_process"),e("buffer").Buffer)}}},{package:"@metamask/snap-controllers>tar-stream"}],[5854,{_process:5342,stream:1999},function(){with(this)return function(){"use strict";return function(e,t,r){(function(r){(function(){var n=e("stream");function o(e,t,o){e=e||function(e){this.queue(e)},t=t||function(){this.queue(null)};var i=!1,s=!1,a=[],c=!1,l=new n;function u(){for(;a.length&&!l.paused;){var e=a.shift();if(null===e)return l.emit("end");l.emit("data",e)}}function d(){l.writable=!1,t.call(l),!l.readable&&l.autoDestroy&&l.destroy()}return l.readable=l.writable=!0,l.paused=!1,l.autoDestroy=!(o&&!1===o.autoDestroy),l.write=function(t){return e.call(this,t),!l.paused},l.queue=l.push=function(e){return c||(null===e&&(c=!0),a.push(e),u()),l},l.on("end",(function(){l.readable=!1,!l.writable&&l.autoDestroy&&r.nextTick((function(){l.destroy()}))})),l.end=function(e){if(!i)return i=!0,arguments.length&&l.write(e),d(),l},l.destroy=function(){if(!s)return s=!0,i=!0,a.length=0,l.writable=l.readable=!1,l.emit("close"),l},l.pause=function(){if(!l.paused)return l.paused=!0,l},l.resume=function(){return l.paused&&(l.paused=!1,l.emit("resume")),u(),l.paused||l.emit("drain"),l},l}t.exports=o,o.through=o}).call(this)}).call(this,e("_process"))}}},{package:"debounce-stream>through"}],[5855,{"lodash.throttle":4916},function(){with(this)return function(){"use strict";return function(e,t,r){const n=e("lodash.throttle");t.exports=function e(t){if(!(this instanceof e))return new e(t);const r=(t=t||{}).validity||30,o=new Map,i=n((()=>{o.forEach(((e,t)=>{const n=e.validity||r;(function(e){const t=(new Date).getTime()-e.getTime();return Math.floor(t/1e3)})(e.timestamp)>n&&o.delete(t)}))}),200);this.put=(e,t,r)=>{this.has(e)||o.set(e,{value:t,timestamp:new Date,validity:r}),i()},this.get=e=>{if(o.has(e))return o.get(e).value;throw new Error("key does not exist")},this.has=e=>o.has(e)}}}},{package:"3box>ipfs>libp2p>libp2p-floodsub>libp2p-pubsub>time-cache"}],[5857,{},function(){with(this)return function(){"use strict";return function(e,t,r){
/**
 * Timestamp for 64-bit time_t, nanosecond precision and strftime
 *
 * @author Yusuke Kawasaki
 * @license MIT
 * @see https://github.com/kawanet/timestamp-nano
 */
!function(){void 0!==t&&(t.exports=m);var e=86400,r=3200,n=1168776,o=100982246400,i=1e3*o,s=864e13,a=4294967296,c=1e6,l=1e9,u="000000000",d=Math.trunc||function(e){var t=e-e%1;return 0===t&&(e<0||0===e&&1/e!=1/0)?-0:t},p=m.prototype;m.fromDate=function(e){return new m(+e)},m.fromInt64BE=w(0,1,2,3,0,4),m.fromInt64LE=w(3,2,1,0,4,0),m.fromString=function(e){var t,r=new m,n=(e+="").replace(/^\s*[+\-]?\d+/,(function(e){var t=+e,n=1970+(t-1970)%400;return r.year=t-n,n})).replace(/(?:Z|([+\-]\d{2}):?(\d{2}))$/,(function(e,r,n){return r<0&&(n*=-1),t=6e4*(60*+r+ +n),""})).replace(/\.\d+$/,(function(e){return r.nano=+(e+u).substr(1,9),""})).split(/\D+/);n.length>1?n[1]--:n[1]=0;if(r.time=t=Date.UTC.apply(Date,n)-(t||0),isNaN(t))throw new TypeError("Invalid Date");return b(r)},m.fromTimeT=function(e){return E(e,0)},p.year=0,p.time=0,p.nano=0,p.addNano=function(e){return this.nano+=+e||0,this},p.getNano=function(){var e=b(this);return(e.time%1e3*c+ +e.nano+l)%l},p.getTimeT=function(){var t=b(this),o=Math.floor(t.time/1e3),i=t.year;i&&(o+=i*n*e/r);return o},p.getYear=function(){return this.toDate().getUTCFullYear()+this.year},p.toDate=function(){return y(b(this).time)},p.toJSON=function(){return this.toString().replace(/0{1,6}Z$/,"Z")},p.toString=function(e){var t=this,r=t.toDate(),n={H:function(){return C(r.getUTCHours())},L:function(){return _(r.getUTCMilliseconds(),3)},M:function(){return C(r.getUTCMinutes())},N:function(){return _(t.getNano(),9)},S:function(){return C(r.getUTCSeconds())},Y:function(){var e=t.getYear();return e>999999?"+"+e:e>9999?"+"+_(e,6):e>=0?_(e,4):e>=-999999?"-"+_(-e,6):e},a:function(){return f[r.getUTCDay()]},b:function(){return h[r.getUTCMonth()]},d:function(){return C(r.getUTCDate())},e:function(){return e=r.getUTCDate(),(e>9?"":" ")+(0|e);var e},m:function(){return C(r.getUTCMonth()+1)}};return function e(t){return t.replace(/%./g,(function(t){var r=t[1],o=g[r],i=n[r];return o?e(o):i?i():t}))}(e||"%Y-%m-%dT%H:%M:%S.%NZ")},p.writeInt64BE=v(0,1,2,3,0,4),p.writeInt64LE=v(3,2,1,0,4,0);var h=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],f=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],g={"%":"%",F:"%Y-%m-%d",n:"\n",R:"%H:%M",T:"%H:%M:%S",t:"\t",X:"%T",Z:"GMT",z:"+0000"};return m;function m(e,t,r){var n=this;if(!(n instanceof m))return new m(e,t,r);n.time=+e||0,n.nano=+t||0,n.year=+r||0,b(n)}function b(e){var t,n,o=e.year,a=e.time,l=e.nano;if(l<0||c<=l){var u=Math.floor(l/c);l-=u*c,a+=u,t=1}var p=o%r;if(a<-s||s<a||p){(n=d(a/i))&&(o+=n*r,a-=n*i);var h=y(a);h.setUTCFullYear(p+h.getUTCFullYear());var f=(a=+h)+(n=d((o-=p)/r))*i;n&&-s<=f&&f<=s&&(o-=n*r,a=f),t=1}return t&&(e.year=o,e.time=a,e.nano=l),e}function y(e){var t=new Date(0);return t.setTime(e),t}function E(e,t){t|=0,e=+e||0;var n=d((t*=a)/o)+d(e/o),i=t%o+e%o,s=d(i/o);return s&&(n+=s,i-=s*o),new m(1e3*i,0,n*r)}function v(e,t,r,n,o,i){return function(e,t){var r=b(this);e||(e=new Array(8));S(e,t|=0);var n=Math.floor(r.time/1e3),c=31556952*r.year,l=d(c/a)+d(n/a),u=c%a+n%a,p=Math.floor(u/a);p&&(l+=p,u-=p*a);return s(e,t+o,l),s(e,t+i,u),e};function s(o,i,s){o[i+e]=s>>24&255,o[i+t]=s>>16&255,o[i+r]=s>>8&255,o[i+n]=255&s}}function w(e,t,r,n,o,i){return function(e,t){S(e,t|=0);var r=s(e,t+o);return E(s(e,t+i),r)};function s(o,i){return 16777216*o[i+e]+(o[i+t]<<16|o[i+r]<<8|o[i+n])}}function S(e,t){var r=e&&e.length;if(null==r)throw new TypeError("Invalid Buffer");if(r<t+8)throw new RangeError("Out of range")}function C(e){return(e>9?"":"0")+(0|e)}function _(e,t){return(u+(0|e)).substr(-t)}}()}}},{package:"3box>ipfs>ipns>timestamp-nano"}],[586,{"./ComposedStore":582,"./MergedStore":583,"./ObservableStore":584,"./asStream":585,"./transform":587},function(){with(this)return function(){"use strict";return function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){n===undefined&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){n===undefined&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),o(e("./asStream"),r),o(e("./ComposedStore"),r),o(e("./MergedStore"),r),o(e("./ObservableStore"),r),o(e("./transform"),r)}}},{package:"@keystonehq/metamask-airgapped-keyring>@metamask/obs-store"}],[5861,{},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=function(e,t){for(var r=[],n=(t=t||0)||0;n<e.length;n++)r[n-t]=e[n];return r}}}},{package:"3box>ipfs>libp2p-webrtc-star>socket.io-client>to-array"}],[5862,{},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=function(e){if(e instanceof Int8Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray)return new DataView(e.buffer,e.byteOffset,e.byteLength);if(e instanceof ArrayBuffer)return new DataView(e);throw new TypeError("Expected `data` to be an ArrayBuffer, Buffer, Int8Array, Uint8Array or Uint8ClampedArray")}}}},{package:"base32-encode>to-data-view"}],[5864,{},function(){with(this)return function(){"use strict";return function(e,t,r){r.__esModule=!0,r.FIAT_RATES_UPDATE=r.NOTIFICATION=r.BLOCK=r.CONNECT=r.ERROR=void 0;r.ERROR="blockchain-error";r.CONNECT="blockchain-connect";r.BLOCK="blockchain-block";r.NOTIFICATION="blockchain-notification";r.FIAT_RATES_UPDATE="fiat-rates-update"}}},{package:"eth-trezor-keyring>trezor-connect"}],[5865,{},function(){with(this)return function(){"use strict";return function(e,t,r){r.__esModule=!0,r.POOL_RELAY_TYPE=r.CERTIFICATE_TYPE=r.ADDRESS_TYPE=r.NETWORK_IDS=r.PROTOCOL_MAGICS=void 0;var n=Object.freeze({mainnet:764824073,testnet:42});r.PROTOCOL_MAGICS=n;var o=Object.freeze({mainnet:1,testnet:0});r.NETWORK_IDS=o;var i=Object.freeze({Base:0,Pointer:4,Enterprise:6,Byron:8,Reward:14});r.ADDRESS_TYPE=i;var s=Object.freeze({StakeRegistration:0,StakeDeregistration:1,StakeDelegation:2,StakePoolRegistration:3});r.CERTIFICATE_TYPE=s;var a=Object.freeze({SingleHostIp:0,SingleHostName:1,MultipleHostName:2});r.POOL_RELAY_TYPE=a}}},{package:"eth-trezor-keyring>trezor-connect"}],[5866,{},function(){with(this)return function(){"use strict";return function(e,t,r){r.__esModule=!0,r.WAIT_FOR_SELECTION=r.WORD=r.PASSPHRASE_ON_DEVICE=r.PASSPHRASE=r.PIN=r.BUTTON=r.LOADING=r.USED_ELSEWHERE=r.RELEASED=r.ACQUIRED=r.RELEASE=r.ACQUIRE=r.CHANGED=r.DISCONNECT=r.CONNECT_UNACQUIRED=r.CONNECT=void 0;r.CONNECT="device-connect";r.CONNECT_UNACQUIRED="device-connect_unacquired";r.DISCONNECT="device-disconnect";r.CHANGED="device-changed";r.ACQUIRE="device-acquire";r.RELEASE="device-release";r.ACQUIRED="device-acquired";r.RELEASED="device-released";r.USED_ELSEWHERE="device-used_elsewhere";r.LOADING="device-loading";r.BUTTON="button";r.PIN="pin";r.PASSPHRASE="passphrase";r.PASSPHRASE_ON_DEVICE="passphrase_on_device";r.WORD="word";r.WAIT_FOR_SELECTION="device-wait_for_selection"}}},{package:"eth-trezor-keyring>trezor-connect"}],[5867,{"@babel/runtime/helpers/inheritsLoose":198,"@babel/runtime/helpers/interopRequireDefault":199,"@babel/runtime/helpers/wrapNativeSuper":218},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("@babel/runtime/helpers/interopRequireDefault");r.__esModule=!0,r.LIBUSB_ERROR_MESSAGE=r.WEBUSB_ERROR_MESSAGE=r.INVALID_PIN_ERROR_MESSAGE=r.WRONG_PREVIOUS_SESSION_ERROR_MESSAGE=r.TypedError=r.TrezorError=r.ERROR_CODES=void 0;var o=n(e("@babel/runtime/helpers/inheritsLoose")),i=n(e("@babel/runtime/helpers/wrapNativeSuper")),s={Init_NotInitialized:"TrezorConnect not yet initialized",Init_AlreadyInitialized:"TrezorConnect has been already initialized",Init_IframeBlocked:"Iframe blocked",Init_IframeTimeout:"Iframe timeout",Init_ManifestMissing:"Manifest not set. Read more at https://github.com/trezor/connect/blob/develop/docs/index.md",Popup_ConnectionMissing:"Unable to establish connection with iframe",Transport_Missing:"Transport is missing",Transport_InvalidProtobuf:"",Method_InvalidPackage:"This version of trezor-connect is not suitable to work without browser. Use trezor-connect@extended package instead",Method_InvalidParameter:"",Method_NotAllowed:"Method not allowed for this configuration",Method_PermissionsNotGranted:"Permissions not granted",Method_Cancel:"Cancelled",Method_Interrupted:"Popup closed",Method_UnknownCoin:"Coin not found",Method_AddressNotMatch:"Addresses do not match",Method_FirmwareUpdate_DownloadFailed:"Failed to download firmware binary",Method_CustomMessage_Callback:'Parameter "callback" is not a function',Method_Discovery_BundleException:"",Method_Override:"override",Method_NoResponse:"Call resolved without response",Backend_NotSupported:"BlockchainLink settings not found in coins.json",Backend_WorkerMissing:"",Backend_Disconnected:"Backend disconnected",Backend_Invalid:"Invalid backend",Backend_Error:"",Runtime:"",Device_NotFound:"Device not found",Device_InitializeFailed:"",Device_FwException:"",Device_ModeException:"",Device_Disconnected:"Device disconnected",Device_UsedElsewhere:"Device is used in another window",Device_InvalidState:"Passphrase is incorrect",Device_CallInProgress:"Device call in progress"};r.ERROR_CODES=s;var a=function(e){function t(t,r){var n;return(n=e.call(this,r)||this).code=t,n.message=r,n}return(0,o.default)(t,e),t}((0,i.default)(Error));r.TrezorError=a;r.TypedError=function(e,t){return new a(e,t||s[e])};r.WRONG_PREVIOUS_SESSION_ERROR_MESSAGE="wrong previous session";r.INVALID_PIN_ERROR_MESSAGE="PIN invalid";r.WEBUSB_ERROR_MESSAGE="NetworkError: Unable to claim interface.";r.LIBUSB_ERROR_MESSAGE="LIBUSB_ERROR"}}},{package:"eth-trezor-keyring>trezor-connect"}],[5868,{},function(){with(this)return function(){"use strict";return function(e,t,r){r.__esModule=!0,r.CALL=r.ERROR=r.INIT=r.LOADED=r.BOOTSTRAP=void 0;r.BOOTSTRAP="iframe-bootstrap";r.LOADED="iframe-loaded";r.INIT="iframe-init";r.ERROR="iframe-error";r.CALL="iframe-call"}}},{package:"eth-trezor-keyring>trezor-connect"}],[5869,{"./blockchain":5864,"./cardano":5865,"./device":5866,"./errors":5867,"./iframe":5868,"./network":5870,"./popup":5871,"./transport":5872,"./ui":5873},function(){with(this)return function(){"use strict";return function(e,t,r){r.__esModule=!0,r.CARDANO=r.UI=r.TRANSPORT=r.POPUP=r.NETWORK=r.IFRAME=r.ERRORS=r.DEVICE=r.BLOCKCHAIN=r.BLOCKCHAIN_EVENT=r.RESPONSE_EVENT=r.TRANSPORT_EVENT=r.DEVICE_EVENT=r.UI_EVENT=r.CORE_EVENT=void 0;var n=h(e("./blockchain"));r.BLOCKCHAIN=n;var o=h(e("./device"));r.DEVICE=o;var i=h(e("./errors"));r.ERRORS=i;var s=h(e("./iframe"));r.IFRAME=s;var a=h(e("./network"));r.NETWORK=a;var c=h(e("./popup"));r.POPUP=c;var l=h(e("./transport"));r.TRANSPORT=l;var u=h(e("./ui"));r.UI=u;var d=h(e("./cardano"));function p(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(p=function(e){return e?r:t})(e)}function h(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=p(t);if(r&&r.has(e))return r.get(e);var n={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var s=o?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(n,i,s):n[i]=e[i]}return n.default=e,r&&r.set(e,n),n}r.CARDANO=d;r.CORE_EVENT="CORE_EVENT";r.UI_EVENT="UI_EVENT";r.DEVICE_EVENT="DEVICE_EVENT";r.TRANSPORT_EVENT="TRANSPORT_EVENT";r.RESPONSE_EVENT="RESPONSE_EVENT";r.BLOCKCHAIN_EVENT="BLOCKCHAIN_EVENT"}}},{package:"eth-trezor-keyring>trezor-connect"}],[587,{through2:588},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.storeTransformStream=void 0;const n=e("through2");r.storeTransformStream=function(e){return n.obj(((t,r,n)=>{try{return n(null,e(t)),undefined}catch(e){return n(e),undefined}}))}}}},{package:"@keystonehq/metamask-airgapped-keyring>@metamask/obs-store"}],[5870,{},function(){with(this)return function(){"use strict";return function(e,t,r){r.__esModule=!0,r.TYPES=void 0;var n=Object.freeze({bitcoin:"Bitcoin",ethereum:"Ethereum",eos:"Eos",nem:"NEM",stellar:"Stellar",cardano:"Cardano",ripple:"Ripple",tezos:"Tezors",binance:"Binance"});r.TYPES=n}}},{package:"eth-trezor-keyring>trezor-connect"}],[5871,{},function(){with(this)return function(){"use strict";return function(e,t,r){r.__esModule=!0,r.CLOSE_WINDOW=r.CANCEL_POPUP_REQUEST=r.CLOSED=r.HANDSHAKE=r.EXTENSION_USB_PERMISSIONS=r.ERROR=r.INIT=r.LOADED=r.BOOTSTRAP=void 0;r.BOOTSTRAP="popup-bootstrap";r.LOADED="popup-loaded";r.INIT="popup-init";r.ERROR="popup-error";r.EXTENSION_USB_PERMISSIONS="open-usb-permissions";r.HANDSHAKE="popup-handshake";r.CLOSED="popup-closed";r.CANCEL_POPUP_REQUEST="ui-cancel-popup-request";r.CLOSE_WINDOW="window.close"}}},{package:"eth-trezor-keyring>trezor-connect"}],[5872,{},function(){with(this)return function(){"use strict";return function(e,t,r){r.__esModule=!0,r.START_PENDING=r.DISABLE_WEBUSB=r.REQUEST=r.STREAM=r.UPDATE=r.ERROR=r.START=void 0;r.START="transport-start";r.ERROR="transport-error";r.UPDATE="transport-update";r.STREAM="transport-stream";r.REQUEST="transport-request_device";r.DISABLE_WEBUSB="transport-disable_webusb";r.START_PENDING="transport-start_pending"}}},{package:"eth-trezor-keyring>trezor-connect"}],[5873,{},function(){with(this)return function(){"use strict";return function(e,t,r){r.__esModule=!0,r.IFRAME_FAILURE=r.ADDRESS_VALIDATION=r.BUNDLE_PROGRESS=r.LOGIN_CHALLENGE_RESPONSE=r.LOGIN_CHALLENGE_REQUEST=r.CUSTOM_MESSAGE_RESPONSE=r.CUSTOM_MESSAGE_REQUEST=r.CHANGE_SETTINGS=r.RECEIVE_WORD=r.RECEIVE_FEE=r.RECEIVE_ACCOUNT=r.CHANGE_ACCOUNT=r.RECEIVE_DEVICE=r.RECEIVE_PASSPHRASE=r.RECEIVE_PIN=r.RECEIVE_CONFIRMATION=r.RECEIVE_PERMISSION=r.REQUEST_WORD=r.REQUEST_BUTTON=r.INSUFFICIENT_FUNDS=r.UPDATE_CUSTOM_FEE=r.SELECT_FEE=r.SELECT_ACCOUNT=r.SELECT_DEVICE=r.SET_OPERATION=r.LOADING=r.CONNECT=r.INVALID_PASSPHRASE_ACTION=r.INVALID_PASSPHRASE=r.REQUEST_PASSPHRASE_ON_DEVICE=r.REQUEST_PASSPHRASE=r.INVALID_PIN=r.REQUEST_PIN=r.REQUEST_CONFIRMATION=r.REQUEST_PERMISSION=r.CLOSE_UI_WINDOW=r.REQUEST_UI_WINDOW=r.DEVICE_NEEDS_BACKUP=r.FIRMWARE_PROGRESS=r.FIRMWARE_NOT_INSTALLED=r.FIRMWARE_NOT_COMPATIBLE=r.FIRMWARE_NOT_SUPPORTED=r.FIRMWARE_OUTDATED=r.FIRMWARE_OLD=r.SEEDLESS=r.INITIALIZE=r.REQUIRE_MODE=r.NOT_IN_BOOTLOADER=r.BOOTLOADER=r.TRANSPORT=void 0;r.TRANSPORT="ui-no_transport";r.BOOTLOADER="ui-device_bootloader_mode";r.NOT_IN_BOOTLOADER="ui-device_not_in_bootloader_mode";r.REQUIRE_MODE="ui-device_require_mode";r.INITIALIZE="ui-device_not_initialized";r.SEEDLESS="ui-device_seedless";r.FIRMWARE_OLD="ui-device_firmware_old";r.FIRMWARE_OUTDATED="ui-device_firmware_outdated";r.FIRMWARE_NOT_SUPPORTED="ui-device_firmware_unsupported";r.FIRMWARE_NOT_COMPATIBLE="ui-device_firmware_not_compatible";r.FIRMWARE_NOT_INSTALLED="ui-device_firmware_not_installed";r.FIRMWARE_PROGRESS="ui-firmware-progress";r.DEVICE_NEEDS_BACKUP="ui-device_needs_backup";r.REQUEST_UI_WINDOW="ui-request_window";r.CLOSE_UI_WINDOW="ui-close_window";r.REQUEST_PERMISSION="ui-request_permission";r.REQUEST_CONFIRMATION="ui-request_confirmation";r.REQUEST_PIN="ui-request_pin";r.INVALID_PIN="ui-invalid_pin";r.REQUEST_PASSPHRASE="ui-request_passphrase";r.REQUEST_PASSPHRASE_ON_DEVICE="ui-request_passphrase_on_device";r.INVALID_PASSPHRASE="ui-invalid_passphrase";r.INVALID_PASSPHRASE_ACTION="ui-invalid_passphrase_action";r.CONNECT="ui-connect";r.LOADING="ui-loading";r.SET_OPERATION="ui-set_operation";r.SELECT_DEVICE="ui-select_device";r.SELECT_ACCOUNT="ui-select_account";r.SELECT_FEE="ui-select_fee";r.UPDATE_CUSTOM_FEE="ui-update_custom_fee";r.INSUFFICIENT_FUNDS="ui-insufficient_funds";r.REQUEST_BUTTON="ui-button";r.REQUEST_WORD="ui-request_word";r.RECEIVE_PERMISSION="ui-receive_permission";r.RECEIVE_CONFIRMATION="ui-receive_confirmation";r.RECEIVE_PIN="ui-receive_pin";r.RECEIVE_PASSPHRASE="ui-receive_passphrase";r.RECEIVE_DEVICE="ui-receive_device";r.CHANGE_ACCOUNT="ui-change_account";r.RECEIVE_ACCOUNT="ui-receive_account";r.RECEIVE_FEE="ui-receive_fee";r.RECEIVE_WORD="ui-receive_word";r.CHANGE_SETTINGS="ui-change_settings";r.CUSTOM_MESSAGE_REQUEST="ui-custom_request";r.CUSTOM_MESSAGE_RESPONSE="ui-custom_response";r.LOGIN_CHALLENGE_REQUEST="ui-login_challenge_request";r.LOGIN_CHALLENGE_RESPONSE="ui-login_challenge_response";r.BUNDLE_PROGRESS="ui-bundle_progress";r.ADDRESS_VALIDATION="ui-address_validation";r.IFRAME_FAILURE="ui-iframe_failure"}}},{package:"eth-trezor-keyring>trezor-connect"}],[5874,{"@babel/runtime/helpers/defineProperty":193,"@babel/runtime/helpers/interopRequireDefault":199},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("@babel/runtime/helpers/interopRequireDefault");r.__esModule=!0,r.parse=r.corsValidator=r.getEnv=r.DEFAULT_PRIORITY=void 0;var o=n(e("@babel/runtime/helpers/defineProperty"));function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}var s="8.2.6",a="https://connect.trezor.io/"+(s.split(".").map((function(e){return parseInt(e,10)}))[0]+"/");r.DEFAULT_PRIORITY=2;var c={configSrc:"./data/config.json",version:s,debug:!1,priority:2,trustedHost:!1,connectSrc:a,iframeSrc:a+"iframe.html",popup:!0,popupSrc:a+"popup.html",webusbSrc:a+"webusb.html",transportReconnect:!1,webusb:!0,pendingTransportEvent:!0,supportedBrowser:"undefined"==typeof navigator||!/Trident|MSIE|Edge/.test(navigator.userAgent),manifest:null,env:"web",lazyLoad:!1,timestamp:(new Date).getTime(),interactionTimeout:600},l=function(){if("undefined"!=typeof chrome&&chrome.runtime&&void 0!==chrome.runtime.onConnect)return"webextension";if("undefined"!=typeof navigator){if("string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase())return"react-native";if(navigator.userAgent.toLowerCase().indexOf(" electron/")>-1)return"electron"}return"web"};r.getEnv=l;var u=function(e){if("string"==typeof e)return e.match(/^https:\/\/([A-Za-z0-9\-_]+\.)*trezor\.io\//)||e.match(/^https?:\/\/localhost:[58][0-9]{3}\//)||e.match(/^https:\/\/([A-Za-z0-9\-_]+\.)*sldev\.cz\//)||e.match(/^https?:\/\/([A-Za-z0-9\-_]+\.)*trezoriovpjcahpzkrewelclulmszwbqpzmzgub37gbcjlvluxtruqad\.onion\//)?e:void 0};r.corsValidator=u;r.parse=function(e){void 0===e&&(e={});var t=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){(0,o.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},c);if(Object.prototype.hasOwnProperty.call(e,"debug")&&(Array.isArray(e),"boolean"==typeof e.debug?t.debug=e.debug:"string"==typeof e.debug&&(t.debug="true"===e.debug)),"string"==typeof e.connectSrc&&(t.connectSrc=e.connectSrc),"undefined"!=typeof global&&"string"==typeof global.__TREZOR_CONNECT_SRC&&(t.connectSrc=u(global.__TREZOR_CONNECT_SRC),t.debug=!0),"undefined"!=typeof window&&window.location&&"string"==typeof window.location.search){var r=window.location.search.split("&").find((function(e){return e.indexOf("trezor-connect-src")>=0}));if(r){var n=r.split("=")[1];t.connectSrc=u(decodeURIComponent(n)),t.debug=!0}}var s=t.connectSrc||a;return t.iframeSrc=s+"iframe.html",t.popupSrc=s+"popup.html",t.webusbSrc=s+"webusb.html","boolean"==typeof e.transportReconnect&&(t.transportReconnect=e.transportReconnect),"boolean"==typeof e.webusb&&(t.webusb=e.webusb),"boolean"==typeof e.popup&&(t.popup=e.popup),"boolean"==typeof e.lazyLoad&&(t.lazyLoad=e.lazyLoad),"boolean"==typeof e.pendingTransportEvent&&(t.pendingTransportEvent=e.pendingTransportEvent),"undefined"!=typeof window&&window.location&&"file:"===window.location.protocol&&(t.origin="file://"+window.location.pathname,t.webusb=!1),"string"==typeof e.extension&&(t.extension=e.extension),"string"==typeof e.env?t.env=e.env:t.env=l(),"number"==typeof e.timestamp&&(t.timestamp=e.timestamp),"number"==typeof e.interactionTimeout&&(t.interactionTimeout=e.interactionTimeout),"object"==typeof e.manifest&&(t.manifest=function(e){if(e&&"string"==typeof e.email&&"string"==typeof e.appUrl)return{email:e.email,appUrl:e.appUrl}}(e.manifest)),c=t}}}},{package:"eth-trezor-keyring>trezor-connect"}],[5875,{"../../constants":5869,"../../data/ConnectSettings":5874,"../../iframe/builder":5877,"../../message":5881,"../../message/builder":5880,"../../popup/PopupManager":5883,"../../types":5890,"../../utils/debug":5906,"../../webusb/button":5908,"@babel/runtime/helpers/asyncToGenerator":189,"@babel/runtime/helpers/defineProperty":193,"@babel/runtime/helpers/interopRequireDefault":199,"@babel/runtime/regenerator":219,events:1997},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("@babel/runtime/helpers/interopRequireDefault");r.__esModule=!0,r.disableWebUSB=r.requestLogin=r.customMessage=r.getSettings=r.renderWebUSBButton=r.uiResponse=r.call=r.init=r.cancel=r.dispose=r.manifest=r.eventEmitter=void 0;var o=n(e("@babel/runtime/regenerator")),i=n(e("@babel/runtime/helpers/defineProperty")),s=n(e("@babel/runtime/helpers/asyncToGenerator")),a=n(e("events")),c=n(e("../../popup/PopupManager")),l=b(e("../../iframe/builder")),u=n(e("../../webusb/button")),d=e("../../message"),p=e("../../message/builder"),h=e("../../data/ConnectSettings"),f=e("../../utils/debug"),g=e("../../constants");b(e("../../types"));function m(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(m=function(e){return e?r:t})(e)}function b(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=m(t);if(r&&r.has(e))return r.get(e);var n={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var s=o?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(n,i,s):n[i]=e[i]}return n.default=e,r&&r.set(e,n),n}function y(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function E(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?y(Object(r),!0).forEach((function(t){(0,i.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):y(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var v=new a.default;r.eventEmitter=v;var w,S,C=(0,f.initLog)("[trezor-connect.js]"),_=function(){var e=new c.default(w);return e.on(g.POPUP.CLOSED,(function(e){l.postMessage({type:g.POPUP.CLOSED,payload:e?{error:e}:null},!1)})),e};r.manifest=function(e){w=(0,h.parse)({manifest:e})};var T=function(){v.removeAllListeners(),l.dispose(),S&&S.close()};r.dispose=T;r.cancel=function(e){S&&S.emit(g.POPUP.CLOSED,e)};var k=function(e){if(e.origin===l.origin){var t=(0,d.parseMessage)(e.data),r=t.event,n=t.type,o=t.payload,i=t.id||0;switch(C.log("handleMessage",t),r){case g.RESPONSE_EVENT:l.messagePromises[i]?(l.messagePromises[i].resolve({id:i,success:t.success,payload:o}),delete l.messagePromises[i]):C.warn("Unknown message id "+i);break;case g.DEVICE_EVENT:case g.TRANSPORT_EVENT:case g.BLOCKCHAIN_EVENT:v.emit(r,t),v.emit(n,o);break;case g.UI_EVENT:if(n===g.IFRAME.BOOTSTRAP){l.clearTimeout();break}n===g.IFRAME.LOADED&&l.initPromise.resolve(),n===g.IFRAME.ERROR&&l.initPromise.reject(o.error),v.emit(r,t),v.emit(n,o);break;default:C.log("Undefined message",r,e)}}},M=function(){var e=(0,s.default)(o.default.mark((function e(t){return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===t&&(t={}),!l.instance){e.next=3;break}throw g.ERRORS.TypedError("Init_AlreadyInitialized");case 3:if(w||(w=(0,h.parse)(t)),w.manifest){e.next=6;break}throw g.ERRORS.TypedError("Init_ManifestMissing");case 6:if(!w.lazyLoad){e.next=9;break}return w.lazyLoad=!1,e.abrupt("return");case 9:return S||(S=_()),C.enabled=!!w.debug,window.addEventListener("message",k),window.addEventListener("unload",T),e.next=15,l.init(w);case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();r.init=M;var O=function(){var e=(0,s.default)(o.default.mark((function e(t){var r;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l.instance||l.timeout){e.next=15;break}if((w=(0,h.parse)(w)).manifest){e.next=4;break}return e.abrupt("return",(0,d.errorMessage)(g.ERRORS.TypedError("Init_ManifestMissing")));case 4:return S||(S=_()),S.request(!0),e.prev=6,e.next=9,M(w);case 9:e.next=15;break;case 11:return e.prev=11,e.t0=e.catch(6),S&&(["Init_IframeBlocked","Init_IframeTimeout"].includes(e.t0.code)?S.postMessage((0,p.UiMessage)(g.UI.IFRAME_FAILURE)):S.close()),e.abrupt("return",(0,d.errorMessage)(e.t0));case 15:if(!l.timeout){e.next=17;break}return e.abrupt("return",(0,d.errorMessage)(g.ERRORS.TypedError("Init_ManifestMissing")));case 17:if(!l.error){e.next=19;break}return e.abrupt("return",(0,d.errorMessage)(l.error));case 19:return w.popup&&S&&S.request(),e.prev=20,e.next=23,l.postMessage({type:g.IFRAME.CALL,payload:t});case 23:if(!(r=e.sent)){e.next=27;break}return!r.success&&"Device_CallInProgress"!==r.payload.code&&S&&S.unlock(),e.abrupt("return",r);case 27:return S&&S.unlock(),e.abrupt("return",(0,d.errorMessage)(g.ERRORS.TypedError("Method_NoResponse")));case 31:return e.prev=31,e.t1=e.catch(20),C.error("__call error",e.t1),S&&S.close(),e.abrupt("return",(0,d.errorMessage)(e.t1));case 36:case"end":return e.stop()}}),e,null,[[6,11],[20,31]])})));return function(t){return e.apply(this,arguments)}}();r.call=O;var P=function(e){l.postMessage({event:g.UI_EVENT,type:g.UI.CUSTOM_MESSAGE_RESPONSE,payload:e})};r.uiResponse=function(e){var t=e.type,r=e.payload;l.postMessage({event:g.UI_EVENT,type:t,payload:r})};r.renderWebUSBButton=function(e){(0,u.default)(e,w.webusbSrc,l.origin)};r.getSettings=function(){return l.instance?O({method:"getSettings"}):Promise.resolve((0,d.errorMessage)(g.ERRORS.TypedError("Init_NotInitialized")))};var R=function(){var e=(0,s.default)(o.default.mark((function e(t){var r,n,i;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("function"==typeof t.callback){e.next=2;break}return e.abrupt("return",(0,d.errorMessage)(g.ERRORS.TypedError("Method_CustomMessage_Callback")));case 2:return r=t.callback,n=function(){var e=(0,s.default)(o.default.mark((function e(t){var n,i;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=t.data)||n.type!==g.UI.CUSTOM_MESSAGE_REQUEST){e.next=6;break}return e.next=4,r(n.payload);case 4:i=e.sent,P(i||{message:"release"});case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),window.addEventListener("message",n,!1),e.next=7,O(E(E({method:"customMessage"},t),{},{callback:null}));case 7:return i=e.sent,window.removeEventListener("message",n),e.abrupt("return",i);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();r.customMessage=R;var A=function(){var e=(0,s.default)(o.default.mark((function e(t){var r,n,i;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("function"!=typeof t.callback){e.next=9;break}return r=t.callback,n=function(){var e=(0,s.default)(o.default.mark((function e(t){var n,i;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=t.data)||n.type!==g.UI.LOGIN_CHALLENGE_REQUEST){e.next=12;break}return e.prev=2,e.next=5,r();case 5:i=e.sent,l.postMessage({event:g.UI_EVENT,type:g.UI.LOGIN_CHALLENGE_RESPONSE,payload:i}),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(2),l.postMessage({event:g.UI_EVENT,type:g.UI.LOGIN_CHALLENGE_RESPONSE,payload:e.t0.message});case 12:case"end":return e.stop()}}),e,null,[[2,9]])})));return function(t){return e.apply(this,arguments)}}(),window.addEventListener("message",n,!1),e.next=6,O(E(E({method:"requestLogin"},t),{},{asyncChallenge:!0,callback:null}));case 6:return i=e.sent,window.removeEventListener("message",n),e.abrupt("return",i);case 9:return e.abrupt("return",O(E({method:"requestLogin"},t)));case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();r.requestLogin=A;r.disableWebUSB=function(){l.postMessage({event:g.UI_EVENT,type:g.TRANSPORT.DISABLE_WEBUSB})}}}},{package:"eth-trezor-keyring>trezor-connect"}],[5876,{"@babel/runtime/helpers/asyncToGenerator":189,"@babel/runtime/helpers/interopRequireDefault":199,"@babel/runtime/regenerator":219,"cross-fetch":2104},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("@babel/runtime/helpers/interopRequireDefault");r.__esModule=!0,r.getOrigin=r.httpRequest=void 0;var o=n(e("@babel/runtime/regenerator")),i=n(e("@babel/runtime/helpers/asyncToGenerator")),s=n(e("cross-fetch")),a=function(){var e=(0,i.default)(o.default.mark((function e(t,r){var n,i;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===r&&(r="text"),e.next=3,(0,s.default)(t,{credentials:"same-origin"});case 3:if(!(n=e.sent).ok){e.next=13;break}if("json"!==r){e.next=10;break}return e.next=8,n.text();case 8:return i=e.sent,e.abrupt("return",JSON.parse(i));case 10:if("binary"!==r){e.next=12;break}return e.abrupt("return",n.arrayBuffer());case 12:return e.abrupt("return",n.text());case 13:throw new Error("httpRequest error: "+t+" "+n.statusText);case 14:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}();r.httpRequest=a;r.getOrigin=function(e){if(0===e.indexOf("file://"))return"file://";var t=e.match(/^.+\:\/\/[^\/]+/);return Array.isArray(t)&&t.length>0?t[0]:"unknown"}}}},{package:"eth-trezor-keyring>trezor-connect"}],[5877,{"../constants":5869,"../env/browser/networkUtils":5876,"../utils/deferred":5907,"./inline-styles":5878,"@babel/runtime/helpers/asyncToGenerator":189,"@babel/runtime/helpers/interopRequireDefault":199,"@babel/runtime/regenerator":219},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("@babel/runtime/helpers/interopRequireDefault");r.__esModule=!0,r.clearTimeout=r.dispose=r.postMessage=r.init=r.messagePromises=r.error=r.timeout=r.initPromise=r.origin=r.instance=void 0;var o,i,s=n(e("@babel/runtime/regenerator")),a=n(e("@babel/runtime/helpers/asyncToGenerator")),c=e("../utils/deferred"),l=e("../constants"),u=e("../env/browser/networkUtils"),d=n(e("./inline-styles"));r.instance=o,r.origin=i;var p=(0,c.create)();r.initPromise=p;var h,f=0;r.timeout=f,r.error=h;var g=0,m={};r.messagePromises=m;var b=function(){var e=(0,a.default)(s.default.mark((function e(t){var n,a,d,h,g;return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.initPromise=p=(0,c.create)(),(n=document.getElementById("trezorconnect"))?r.instance=o=n:(r.instance=o=document.createElement("iframe"),o.frameBorder="0",o.width="0px",o.height="0px",o.style.position="absolute",o.style.display="none",o.style.border="0px",o.style.width="0px",o.style.height="0px",o.id="trezorconnect"),"web"===t.env?(d=t.manifest?JSON.stringify(t.manifest):"undefined",h="version="+t.version+"&manifest="+encodeURIComponent(btoa(JSON.stringify(d))),a=t.iframeSrc+"?"+h):a=t.iframeSrc,o.setAttribute("src",a),t.webusb&&o.setAttribute("allow","usb"),r.origin=i=(0,u.getOrigin)(o.src),r.timeout=f=window.setTimeout((function(){p.reject(l.ERRORS.TypedError("Init_IframeTimeout"))}),1e4),g=function(){if(o){try{var e=o.contentWindow.location.origin;if(!e||"null"===e)return void E()}catch(e){}var r;"undefined"!=typeof chrome&&chrome.runtime&&void 0!==chrome.runtime.onConnect&&(chrome.runtime.onConnect.addListener((function(){})),r=chrome.runtime.id),o.contentWindow.postMessage({type:l.IFRAME.INIT,payload:{settings:t,extension:r}},i),o.onload=undefined}else p.reject(l.ERRORS.TypedError("Init_IframeBlocked"))},o.attachEvent?o.attachEvent("onload",g):o.onload=g,document.body&&(document.body.appendChild(o),y()),e.prev=11,e.next=14,p.promise;case 14:e.next=20;break;case 16:throw e.prev=16,e.t0=e.catch(11),o&&(o.parentNode&&o.parentNode.removeChild(o),r.instance=o=null),e.t0;case 20:return e.prev=20,window.clearTimeout(f),r.timeout=f=0,e.finish(20);case 24:case"end":return e.stop()}}),e,null,[[11,16,20,24]])})));return function(t){return e.apply(this,arguments)}}();r.init=b;var y=function(){if(!o)throw l.ERRORS.TypedError("Init_IframeBlocked");var e=o.ownerDocument,t=e.head||e.getElementsByTagName("head")[0],r=document.createElement("style");r.setAttribute("type","text/css"),r.setAttribute("id","TrezorConnectStylesheet"),r.styleSheet?(r.styleSheet.cssText=d.default,t.appendChild(r)):(r.appendChild(document.createTextNode(d.default)),t.append(r))},E=function(){window.clearTimeout(f),r.error=h=l.ERRORS.TypedError("Init_IframeBlocked"),v(),p.reject(h)};r.postMessage=function(e,t){if(void 0===t&&(t=!0),!o)throw l.ERRORS.TypedError("Init_IframeBlocked");if(t){g++,e.id=g,m[g]=(0,c.create)();var r=m[g].promise;return o.contentWindow.postMessage(e,i),r}return o.contentWindow.postMessage(e,i),null};var v=function(){if(o&&o.parentNode)try{o.parentNode.removeChild(o)}catch(e){}r.instance=o=null,r.timeout=f=0};r.dispose=v;r.clearTimeout=function(){window.clearTimeout(f)}}}},{package:"eth-trezor-keyring>trezor-connect"}],[5878,{},function(){with(this)return function(){"use strict";return function(e,t,r){r.__esModule=!0,r.default=void 0;r.default='.trezorconnect-container{position:fixed!important;display:-webkit-box!important;display:-webkit-flex!important;display:-ms-flexbox!important;display:flex!important;-webkit-box-orient:vertical!important;-webkit-box-direction:normal!important;-webkit-flex-direction:column!important;-ms-flex-direction:column!important;flex-direction:column!important;-webkit-box-align:center!important;-webkit-align-items:center!important;-ms-flex-align:center!important;align-items:center!important;z-index:10000!important;width:100%!important;height:100%!important;top:0!important;left:0!important;background:rgba(0,0,0,.35)!important;overflow:auto!important;padding:20px!important;margin:0!important}.trezorconnect-container .trezorconnect-window{position:relative!important;display:block!important;width:370px!important;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif!important;margin:auto!important;border-radius:3px!important;background-color:#fff!important;text-align:center!important;overflow:hidden!important}.trezorconnect-container .trezorconnect-window .trezorconnect-head{text-align:left;padding:12px 24px!important;display:-webkit-box!important;display:-webkit-flex!important;display:-ms-flexbox!important;display:flex!important;-webkit-box-align:center!important;-webkit-align-items:center!important;-ms-flex-align:center!important;align-items:center!important}.trezorconnect-container .trezorconnect-window .trezorconnect-head .trezorconnect-logo{-webkit-box-flex:1;-webkit-flex:1;-ms-flex:1;flex:1}.trezorconnect-container .trezorconnect-window .trezorconnect-head .trezorconnect-close{cursor:pointer!important;height:24px!important}.trezorconnect-container .trezorconnect-window .trezorconnect-head .trezorconnect-close svg{fill:#757575;-webkit-transition:fill .3s ease-in-out!important;transition:fill .3s ease-in-out!important}.trezorconnect-container .trezorconnect-window .trezorconnect-head .trezorconnect-close:hover svg{fill:#494949}.trezorconnect-container .trezorconnect-window .trezorconnect-body{padding:24px 24px 32px!important;background:#FBFBFB!important;border-top:1px solid #EBEBEB}.trezorconnect-container .trezorconnect-window .trezorconnect-body h3{color:#505050!important;font-size:16px!important;font-weight:500!important}.trezorconnect-container .trezorconnect-window .trezorconnect-body p{margin:8px 0 24px!important;font-weight:400!important;color:#A9A9A9!important;font-size:12px!important}.trezorconnect-container .trezorconnect-window .trezorconnect-body button{width:100%!important;padding:12px 24px!important;margin:0!important;border-radius:3px!important;font-size:14px!important;font-weight:300!important;cursor:pointer!important;background:#01B757!important;color:#fff!important;border:0!important;-webkit-transition:background-color .3s ease-in-out!important;transition:background-color .3s ease-in-out!important}.trezorconnect-container .trezorconnect-window .trezorconnect-body button:hover{background-color:#00AB51!important}.trezorconnect-container .trezorconnect-window .trezorconnect-body button:active{background-color:#009546!important}/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImlucHV0IiwiJHN0ZGluIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQWNBLHlCQUNJLFNBQUEsZ0JBQ0EsUUFBQSxzQkFDQSxRQUFBLHVCQUNBLFFBQUEsc0JBRUEsUUFBQSxlQUNBLG1CQUFBLG1CQUNBLHNCQUFBLGlCQUNBLHVCQUFBLGlCQUNBLG1CQUFBLGlCQUNBLGVBQUEsaUJBRUEsa0JBQUEsaUJBQ0Esb0JBQUEsaUJBQ0EsZUFBQSxpQkNmTSxZQUFhLGlCREFyQixRQUFTLGdCQWtCSCxNQUFBLGVBQ0EsT0FBQSxlQUNBLElBQUEsWUFDQSxLQUFBLFlBQ0EsV0FBQSwwQkFDQSxTQUFBLGVBQ0EsUUFBQSxlQUNBLE9BQUEsWUNkUiwrQ0RYRSxTQUFVLG1CQTZCQSxRQUFBLGdCQUNBLE1BQUEsZ0JBQ0EsWUFBQSxjQUFBLG1CQUFBLFdBQUEsT0FBQSxpQkFBQSxNQUFBLHFCQUNBLE9BQUEsZUNmVixjQUFlLGNEakJmLGlCQWlCRSxlQWtCWSxXQUFBLGlCQ2ZkLFNBQVUsaUJEbUJJLG1FQUNBLFdBQUEsS0NoQmQsUUFBUyxLQUFLLGVEeEJkLFFBQVMsc0JBMENTLFFBQUEsdUJBQ0EsUUFBQSxzQkNmbEIsUUFBUyxlRGlCSyxrQkE1QlosaUJBOEJvQixvQkFBQSxpQkNoQmxCLGVBQWdCLGlCRC9CWixZQWlCTixpQkFzQ1EsdUZBQ0EsaUJBQUEsRUNwQlYsYUFBYyxFRHBDVixTQUFVLEVBMkRBLEtBQUEsRUFFQSx3RkNwQmQsT0FBUSxrQkR6Q1IsT0FBUSxlQWlFTSw0RkFDQSxLQUFBLFFBQ0EsbUJBQUEsS0FBQSxJQUFBLHNCQ3BCZCxXQUFZLEtBQUssSUFBSyxzQkR3QlIsa0dBQ0EsS0FBQSxRQUVBLG1FQUNBLFFBQUEsS0FBQSxLQUFBLGVBQ0EsV0FBQSxrQkFDQSxXQUFBLElBQUEsTUFBQSxRQUVBLHNFQUNBLE1BQUEsa0JBQ0EsVUFBQSxlQ3JCZCxZQUFhLGNEd0JLLHFFQ3JCbEIsT0FBUSxJQUFJLEVBQUksZUR3QkYsWUFBQSxjQUNJLE1BQUEsa0JDdEJsQixVQUFXLGVBRWIsMEVBQ0UsTUFBTyxlQUNQLFFBQVMsS0FBSyxlQUNkLE9BQVEsWUFDUixjQUFlLGNBQ2YsVUFBVyxlQUNYLFlBQWEsY0FDYixPQUFRLGtCQUNSLFdBQVksa0JBQ1osTUFBTyxlQUNQLE9BQVEsWUFDUixtQkFBb0IsaUJBQWlCLElBQUssc0JBQzFDLFdBQVksaUJBQWlCLElBQUssc0JBRXBDLGdGQUNFLGlCQUFrQixrQkFFcEIsaUZBQ0UsaUJBQWtCIn0= */'}}},{package:"eth-trezor-keyring>trezor-connect"}],[5879,{"./constants":5869,"./env/node":5875,"./types":5890,"@babel/runtime/helpers/defineProperty":193,"@babel/runtime/helpers/interopRequireDefault":199},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("@babel/runtime/helpers/interopRequireDefault");r.__esModule=!0;var o={};r.default=void 0;var i=n(e("@babel/runtime/helpers/defineProperty")),s=e("./constants");Object.keys(s).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(o,e)||e in r&&r[e]===s[e]||(r[e]=s[e]))}));var a=e("./env/node"),c=e("./types");function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){(0,i.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}Object.keys(c).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(o,e)||e in r&&r[e]===c[e]||(r[e]=c[e]))}));var d={manifest:a.manifest,init:a.init,getSettings:a.getSettings,on:function(e,t){a.eventEmitter.on(e,t)},off:function(e,t){a.eventEmitter.removeListener(e,t)},removeAllListeners:function(){a.eventEmitter.removeAllListeners()},uiResponse:a.uiResponse,blockchainGetAccountBalanceHistory:function(e){return(0,a.call)(u({method:"blockchainGetAccountBalanceHistory"},e))},blockchainGetCurrentFiatRates:function(e){return(0,a.call)(u({method:"blockchainGetCurrentFiatRates"},e))},blockchainGetFiatRatesForTimestamps:function(e){return(0,a.call)(u({method:"blockchainGetFiatRatesForTimestamps"},e))},blockchainDisconnect:function(e){return(0,a.call)(u({method:"blockchainDisconnect"},e))},blockchainEstimateFee:function(e){return(0,a.call)(u({method:"blockchainEstimateFee"},e))},blockchainGetTransactions:function(e){return(0,a.call)(u({method:"blockchainGetTransactions"},e))},blockchainSetCustomBackend:function(e){return(0,a.call)(u({method:"blockchainSetCustomBackend"},e))},blockchainSubscribe:function(e){return(0,a.call)(u({method:"blockchainSubscribe"},e))},blockchainSubscribeFiatRates:function(e){return(0,a.call)(u({method:"blockchainSubscribeFiatRates"},e))},blockchainUnsubscribe:function(e){return(0,a.call)(u({method:"blockchainUnsubscribe"},e))},blockchainUnsubscribeFiatRates:function(e){return(0,a.call)(u({method:"blockchainUnsubscribeFiatRates"},e))},customMessage:function(e){return(0,a.customMessage)(e)},requestLogin:function(e){return(0,a.requestLogin)(e)},cardanoGetAddress:function(e){var t=a.eventEmitter.listenerCount(s.UI.ADDRESS_VALIDATION)>0;return(0,a.call)(u(u({method:"cardanoGetAddress"},e),{},{useEventListener:t}))},cardanoGetNativeScriptHash:function(e){return(0,a.call)(u({method:"cardanoGetNativeScriptHash"},e))},cardanoGetPublicKey:function(e){return(0,a.call)(u({method:"cardanoGetPublicKey"},e))},cardanoSignTransaction:function(e){return(0,a.call)(u({method:"cardanoSignTransaction"},e))},cipherKeyValue:function(e){return(0,a.call)(u({method:"cipherKeyValue"},e))},composeTransaction:function(e){return(0,a.call)(u({method:"composeTransaction"},e))},ethereumGetAddress:function(e){var t=a.eventEmitter.listenerCount(s.UI.ADDRESS_VALIDATION)>0;return(0,a.call)(u(u({method:"ethereumGetAddress"},e),{},{useEventListener:t}))},ethereumGetPublicKey:function(e){return(0,a.call)(u({method:"ethereumGetPublicKey"},e))},ethereumSignMessage:function(e){return(0,a.call)(u({method:"ethereumSignMessage"},e))},ethereumSignTransaction:function(e){return(0,a.call)(u({method:"ethereumSignTransaction"},e))},ethereumSignTypedData:function(e){return(0,a.call)(u({method:"ethereumSignTypedData"},e))},ethereumVerifyMessage:function(e){return(0,a.call)(u({method:"ethereumVerifyMessage"},e))},getAccountInfo:function(e){return(0,a.call)(u({method:"getAccountInfo"},e))},getAddress:function(e){var t=a.eventEmitter.listenerCount(s.UI.ADDRESS_VALIDATION)>0;return(0,a.call)(u(u({method:"getAddress"},e),{},{useEventListener:t}))},getDeviceState:function(e){return(0,a.call)(u({method:"getDeviceState"},e))},getFeatures:function(e){return(0,a.call)(u({method:"getFeatures"},e))},getPublicKey:function(e){return(0,a.call)(u({method:"getPublicKey"},e))},liskGetAddress:function(){return(0,a.call)({method:"liskDeprecated"})},liskGetPublicKey:function(){return(0,a.call)({method:"liskDeprecated"})},liskSignMessage:function(){return(0,a.call)({method:"liskDeprecated"})},liskSignTransaction:function(){return(0,a.call)({method:"liskDeprecated"})},liskVerifyMessage:function(){return(0,a.call)({method:"liskDeprecated"})},nemGetAddress:function(e){var t=a.eventEmitter.listenerCount(s.UI.ADDRESS_VALIDATION)>0;return(0,a.call)(u(u({method:"nemGetAddress"},e),{},{useEventListener:t}))},nemSignTransaction:function(e){return(0,a.call)(u({method:"nemSignTransaction"},e))},pushTransaction:function(e){return(0,a.call)(u({method:"pushTransaction"},e))},rippleGetAddress:function(e){var t=a.eventEmitter.listenerCount(s.UI.ADDRESS_VALIDATION)>0;return(0,a.call)(u(u({method:"rippleGetAddress"},e),{},{useEventListener:t}))},rippleSignTransaction:function(e){return(0,a.call)(u({method:"rippleSignTransaction"},e))},signMessage:function(e){return(0,a.call)(u({method:"signMessage"},e))},signTransaction:function(e){return(0,a.call)(u({method:"signTransaction"},e))},stellarGetAddress:function(e){var t=a.eventEmitter.listenerCount(s.UI.ADDRESS_VALIDATION)>0;return(0,a.call)(u(u({method:"stellarGetAddress"},e),{},{useEventListener:t}))},stellarSignTransaction:function(e){return(0,a.call)(u({method:"stellarSignTransaction"},e))},tezosGetAddress:function(e){var t=a.eventEmitter.listenerCount(s.UI.ADDRESS_VALIDATION)>0;return(0,a.call)(u(u({method:"tezosGetAddress"},e),{},{useEventListener:t}))},tezosGetPublicKey:function(e){return(0,a.call)(u({method:"tezosGetPublicKey"},e))},tezosSignTransaction:function(e){return(0,a.call)(u({method:"tezosSignTransaction"},e))},eosGetPublicKey:function(e){return(0,a.call)(u({method:"eosGetPublicKey"},e))},eosSignTransaction:function(e){return(0,a.call)(u({method:"eosSignTransaction"},e))},binanceGetAddress:function(e){var t=a.eventEmitter.listenerCount(s.UI.ADDRESS_VALIDATION)>0;return(0,a.call)(u(u({method:"binanceGetAddress"},e),{},{useEventListener:t}))},binanceGetPublicKey:function(e){return(0,a.call)(u({method:"binanceGetPublicKey"},e))},binanceSignTransaction:function(e){return(0,a.call)(u({method:"binanceSignTransaction"},e))},verifyMessage:function(e){return(0,a.call)(u({method:"verifyMessage"},e))},resetDevice:function(e){return(0,a.call)(u({method:"resetDevice"},e))},wipeDevice:function(e){return(0,a.call)(u({method:"wipeDevice"},e))},applyFlags:function(e){return(0,a.call)(u({method:"applyFlags"},e))},applySettings:function(e){return(0,a.call)(u({method:"applySettings"},e))},backupDevice:function(e){return(0,a.call)(u({method:"backupDevice"},e))},changePin:function(e){return(0,a.call)(u({method:"changePin"},e))},firmwareUpdate:function(e){return(0,a.call)(u({method:"firmwareUpdate"},e))},recoveryDevice:function(e){return(0,a.call)(u({method:"recoveryDevice"},e))},getCoinInfo:function(e){return(0,a.call)(u({method:"getCoinInfo"},e))},rebootToBootloader:function(e){return(0,a.call)(u({method:"rebootToBootloader"},e))},dispose:a.dispose,cancel:a.cancel,renderWebUSBButton:a.renderWebUSBButton,disableWebUSB:a.disableWebUSB};r.default=d}}},{package:"eth-trezor-keyring>trezor-connect"}],[588,{_process:5342,"readable-stream":5622,util:2002,xtend:6092},function(){with(this)return function(){"use strict";return function(e,t,r){(function(r){(function(){var n=e("readable-stream").Transform,o=e("util").inherits,i=e("xtend");function s(e){n.call(this,e),this._destroyed=!1}function a(e,t,r){r(null,e)}function c(e){return function(t,r,n){return"function"==typeof t&&(n=r,r=t,t={}),"function"!=typeof r&&(r=a),"function"!=typeof n&&(n=null),e(t,r,n)}}o(s,n),s.prototype.destroy=function(e){if(!this._destroyed){this._destroyed=!0;var t=this;r.nextTick((function(){e&&t.emit("error",e),t.emit("close")}))}},t.exports=c((function(e,t,r){var n=new s(e);return n._transform=t,r&&(n._flush=r),n})),t.exports.ctor=c((function(e,t,r){function n(t){if(!(this instanceof n))return new n(t);this.options=i(e,t),s.call(this,this.options)}return o(n,s),n.prototype._transform=t,r&&(n.prototype._flush=r),n})),t.exports.obj=c((function(e,t,r){var n=new s(i({objectMode:!0,highWaterMark:16},e));return n._transform=t,r&&(n._flush=r),n}))}).call(this)}).call(this,e("_process"))}}},{package:"@keystonehq/metamask-airgapped-keyring>@metamask/obs-store>through2"}],[5880,{"../constants":5869,"@babel/runtime/helpers/defineProperty":193,"@babel/runtime/helpers/interopRequireDefault":199},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("@babel/runtime/helpers/interopRequireDefault");r.__esModule=!0,r.BlockchainMessage=r.ResponseMessage=r.TransportMessage=r.DeviceMessage=r.UiMessage=void 0;var o=n(e("@babel/runtime/helpers/defineProperty")),i=e("../constants");function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function a(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach((function(t){(0,o.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}r.UiMessage=function(e,t){return{event:i.UI_EVENT,type:e,payload:t}};r.DeviceMessage=function(e,t){return{event:i.DEVICE_EVENT,type:e,payload:t}};r.TransportMessage=function(e,t){return{event:i.TRANSPORT_EVENT,type:e,payload:t.error?a(a({},t),{},{error:t.error.message,code:t.error.code}):t}};r.ResponseMessage=function(e,t,r){return void 0===r&&(r=null),{event:i.RESPONSE_EVENT,type:i.RESPONSE_EVENT,id:e,success:t,payload:t?r:{error:r.error.message,code:r.error.code}}};r.BlockchainMessage=function(e,t){return{event:i.BLOCKCHAIN_EVENT,type:e,payload:t}}}}},{package:"eth-trezor-keyring>trezor-connect"}],[5881,{},function(){with(this)return function(){"use strict";return function(e,t,r){r.__esModule=!0,r.errorMessage=r.parseMessage=void 0;r.parseMessage=function(e){var t={event:e.event,type:e.type,payload:e.payload};return"number"==typeof e.id&&(t.id=e.id),"boolean"==typeof e.success&&(t.success=e.success),t};r.errorMessage=function(e){return{success:!1,payload:{error:e.message,code:e.code}}}}}},{package:"eth-trezor-keyring>trezor-connect"}],[5882,{"@babel/runtime/helpers/defineProperty":193,"@babel/runtime/helpers/interopRequireDefault":199,"@metamask/eth-sig-util":1115},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("@babel/runtime/helpers/interopRequireDefault")(e("@babel/runtime/helpers/defineProperty"));function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}var i=e("@metamask/eth-sig-util");function s(e){switch(Object.prototype.toString.call(e)){case"[object Object]":var t=Object.keys(e).map((function(t){return[t,s(e[t])]}));return Object.fromEntries(t);case"[object Array]":return e.map((function(e){return s(e)}));case"[object BigInt]":return e.toString();default:return e}}t.exports=function(e,t){if(!t)throw new Error("Trezor: Only version 4 of typed data signing is supported");var r=i.SignTypedDataVersion.V4,a=i.TypedDataUtils.sanitizeData(e),c=a.types,l=a.primaryType,u=a.domain,d=a.message;return function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({domain_separator_hash:i.TypedDataUtils.hashStruct("EIP712Domain",s(u),c,r).toString("hex"),message_hash:i.TypedDataUtils.hashStruct(l,s(d),c,r).toString("hex")},e)}}}},{package:"eth-trezor-keyring>trezor-connect"}],[5883,{"../constants/iframe":5868,"../constants/popup":5871,"../constants/ui":5873,"../env/browser/networkUtils":5876,"../utils/deferred":5907,"./showPopupRequest":5884,"@babel/runtime/helpers/assertThisInitialized":188,"@babel/runtime/helpers/asyncToGenerator":189,"@babel/runtime/helpers/defineProperty":193,"@babel/runtime/helpers/inheritsLoose":198,"@babel/runtime/helpers/interopRequireDefault":199,"@babel/runtime/regenerator":219,events:1997},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("@babel/runtime/helpers/interopRequireDefault");r.__esModule=!0,r.default=void 0;var o=n(e("@babel/runtime/regenerator")),i=n(e("@babel/runtime/helpers/asyncToGenerator")),s=n(e("@babel/runtime/helpers/assertThisInitialized")),a=n(e("@babel/runtime/helpers/inheritsLoose")),c=n(e("@babel/runtime/helpers/defineProperty")),l=n(e("events")),u=b(e("../constants/popup")),d=b(e("../constants/iframe")),p=b(e("../constants/ui")),h=e("./showPopupRequest"),f=e("../env/browser/networkUtils"),g=e("../utils/deferred");function m(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(m=function(e){return e?r:t})(e)}function b(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=m(t);if(r&&r.has(e))return r.get(e);var n={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var s=o?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(n,i,s):n[i]=e[i]}return n.default=e,r&&r.set(e,n),n}var y=function(e){function t(t){var r;return r=e.call(this)||this,(0,c.default)((0,s.default)(r),"requestTimeout",0),(0,c.default)((0,s.default)(r),"closeInterval",0),(0,c.default)((0,s.default)(r),"extensionTabId",0),r.settings=t,r.origin=(0,f.getOrigin)(t.popupSrc),r.handleMessage=r.handleMessage.bind((0,s.default)(r)),r.iframeHandshake=(0,g.create)(d.LOADED),"webextension"===r.settings.env&&(r.handleExtensionConnect=r.handleExtensionConnect.bind((0,s.default)(r)),r.handleExtensionMessage=r.handleExtensionMessage.bind((0,s.default)(r)),chrome.runtime.onConnect.addListener(r.handleExtensionConnect)),window.addEventListener("message",r.handleMessage,!1),r}(0,a.default)(t,e);var r=t.prototype;return r.request=function(e){var t=this;if(void 0===e&&(e=!1),this.locked)this._window&&("webextension"===this.settings.env?chrome.tabs.update(this._window.id,{active:!0}):this._window.focus());else{var r=this.open.bind(this);if(this.locked=!0,this.settings.supportedBrowser){var n=e||"webextension"===this.settings.env?1:850;this.requestTimeout=window.setTimeout((function(){t.requestTimeout=0,r(e)}),n)}else r()}},r.cancel=function(){this.close()},r.unlock=function(){this.locked=!1},r.open=function(e){var t=this,r=this.settings.popupSrc;this.settings.supportedBrowser?(this.popupPromise=(0,g.create)(u.LOADED),this.openWrapper(e?r+"#loading":r),this.closeInterval=window.setInterval((function(){t._window&&("webextension"===t.settings.env?chrome.tabs.get(t._window.id,(function(e){e||(t.close(),t.emit(u.CLOSED))})):t._window.closed&&(t.close(),t.emit(u.CLOSED)))}),500),this.openTimeout=window.setTimeout((function(){t.close(),(0,h.showPopupRequest)(t.open.bind(t),(function(){t.emit(u.CLOSED)}))}),3e3)):this.openWrapper(r+"#unsupported")},r.openWrapper=function(e){var t=this;"webextension"===this.settings.env?chrome.windows.getCurrent(null,(function(r){"normal"!==r.type?chrome.windows.create({url:e},(function(e){chrome.tabs.query({windowId:e.id,active:!0},(function(e){t._window=e[0]}))})):chrome.tabs.query({currentWindow:!0,active:!0},(function(r){t.extensionTabId=r[0].id,chrome.tabs.create({url:e,index:r[0].index+1},(function(e){t._window=e}))}))})):"electron"===this.settings.env?this._window=window.open(e,"modal"):(this._window=window.open("","_blank"),this._window&&(this._window.location.href=e))},r.handleExtensionConnect=function(e){"trezor-connect"===e.name&&(!this._window||this._window&&this._window.id!==e.sender.tab.id?e.disconnect():(window.clearTimeout(this.openTimeout),this.extensionPort=e,this.extensionPort.onMessage.addListener(this.handleExtensionMessage)))},r.handleExtensionMessage=function(e){var t=this;if(this.extensionPort){var r=this.extensionPort,n=e.data;if(n&&"object"==typeof n)if(n.type===u.ERROR){var o=n.payload&&"string"==typeof n.payload.error?n.payload.error:null;this.emit(u.CLOSED,o?"Popup error: "+o:null),this.close()}else n.type===u.LOADED?(this.popupPromise&&this.popupPromise.resolve(),this.iframeHandshake.promise.then((function(e){r.postMessage({type:u.INIT,payload:{settings:t.settings,useBroadcastChannel:e}})}))):n.type===u.EXTENSION_USB_PERMISSIONS?chrome.tabs.query({currentWindow:!0,active:!0},(function(e){chrome.tabs.create({url:"trezor-usb-permissions.html",index:e[0].index+1},(function(e){}))})):n.type===u.CLOSE_WINDOW&&(this.emit(u.CLOSED),this.close())}},r.handleMessage=function(e){var t=this,r=e.data;if((0,f.getOrigin)(e.origin)===this.origin&&r&&"object"==typeof r)if(r.type===d.LOADED){var n=!(!r.payload||"boolean"!=typeof r.payload.useBroadcastChannel)&&r.payload.useBroadcastChannel;this.iframeHandshake.resolve(n)}else if(r.type===u.BOOTSTRAP)window.clearTimeout(this.openTimeout);else if(r.type===u.ERROR&&this._window){var o=r.payload&&"string"==typeof r.payload.error?r.payload.error:null;this.emit(u.CLOSED,o?"Popup error: "+o:null),this.close()}else r.type===u.LOADED?(this.popupPromise&&this.popupPromise.resolve(),this.iframeHandshake.promise.then((function(e){t._window.postMessage({type:u.INIT,payload:{settings:t.settings,useBroadcastChannel:e}},t.origin)}))):r.type!==u.CANCEL_POPUP_REQUEST&&r.type!==p.CLOSE_UI_WINDOW||this.close()},r.close=function(){if(this.locked=!1,this.popupPromise=undefined,this.requestTimeout&&(window.clearTimeout(this.requestTimeout),this.requestTimeout=0),this.openTimeout&&(window.clearTimeout(this.openTimeout),this.openTimeout=0),this.closeInterval&&(window.clearInterval(this.closeInterval),this.closeInterval=0),this.extensionPort&&(this.extensionPort.disconnect(),this.extensionPort=null),this.extensionTabId&&(chrome.tabs.update(this.extensionTabId,{active:!0}),this.extensionTabId=0),this._window){if("webextension"===this.settings.env){chrome.runtime.lastError;chrome.tabs.remove(this._window.id,(function(){chrome.runtime.lastError}))}else this._window.close();this._window=null}},r.postMessage=function(){var e=(0,i.default)(o.default.mark((function e(t){var r=this;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._window||t.type===p.REQUEST_UI_WINDOW||!this.openTimeout){e.next=4;break}return this.close(),(0,h.showPopupRequest)(this.open.bind(this),(function(){r.emit(u.CLOSED)})),e.abrupt("return");case 4:if(!this.popupPromise){e.next=7;break}return e.next=7,this.popupPromise.promise;case 7:this._window&&this._window.postMessage(t,this.origin);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),t}(l.default);r.default=y}}},{package:"eth-trezor-keyring>trezor-connect"}],[5884,{},function(){with(this)return function(){"use strict";return function(e,t,r){r.__esModule=!0,r.showPopupRequest=void 0;var n="TrezorConnectInteractionLayer",o='\n    <div class="trezorconnect-container" id="'+n+'">\n        <div class="trezorconnect-window">\n            <div class="trezorconnect-head">\n                <svg class="trezorconnect-logo" x="0px" y="0px" viewBox="0 0 163.7 41.9" width="78px" height="20px" preserveAspectRatio="xMinYMin meet">\n                    <polygon points="101.1,12.8 118.2,12.8 118.2,17.3 108.9,29.9 118.2,29.9 118.2,35.2 101.1,35.2 101.1,30.7 110.4,18.1 101.1,18.1"/>\n                    <path d="M158.8,26.9c2.1-0.8,4.3-2.9,4.3-6.6c0-4.5-3.1-7.4-7.7-7.4h-10.5v22.3h5.8v-7.5h2.2l4.1,7.5h6.7L158.8,26.9z M154.7,22.5 h-4V18h4c1.5,0,2.5,0.9,2.5,2.2C157.2,21.6,156.2,22.5,154.7,22.5z"/>\n                    <path d="M130.8,12.5c-6.8,0-11.6,4.9-11.6,11.5s4.9,11.5,11.6,11.5s11.7-4.9,11.7-11.5S137.6,12.5,130.8,12.5z M130.8,30.3 c-3.4,0-5.7-2.6-5.7-6.3c0-3.8,2.3-6.3,5.7-6.3c3.4,0,5.8,2.6,5.8,6.3C136.6,27.7,134.2,30.3,130.8,30.3z"/>\n                    <polygon points="82.1,12.8 98.3,12.8 98.3,18 87.9,18 87.9,21.3 98,21.3 98,26.4 87.9,26.4 87.9,30 98.3,30 98.3,35.2 82.1,35.2 "/>\n                    <path d="M24.6,9.7C24.6,4.4,20,0,14.4,0S4.2,4.4,4.2,9.7v3.1H0v22.3h0l14.4,6.7l14.4-6.7h0V12.9h-4.2V9.7z M9.4,9.7 c0-2.5,2.2-4.5,5-4.5s5,2,5,4.5v3.1H9.4V9.7z M23,31.5l-8.6,4l-8.6-4V18.1H23V31.5z"/>\n                    <path d="M79.4,20.3c0-4.5-3.1-7.4-7.7-7.4H61.2v22.3H67v-7.5h2.2l4.1,7.5H80l-4.9-8.3C77.2,26.1,79.4,24,79.4,20.3z M71,22.5h-4V18 h4c1.5,0,2.5,0.9,2.5,2.2C73.5,21.6,72.5,22.5,71,22.5z"/>\n                    <polygon points="40.5,12.8 58.6,12.8 58.6,18.1 52.4,18.1 52.4,35.2 46.6,35.2 46.6,18.1 40.5,18.1 "/>\n                </svg>\n                <div class="trezorconnect-close">\n                    <svg x="0px" y="0px" viewBox="24 24 60 60" width="24px" height="24px" preserveAspectRatio="xMinYMin meet">\n                        <polygon class="st0" points="40,67.9 42.1,70 55,57.1 67.9,70 70,67.9 57.1,55 70,42.1 67.9,40 55,52.9 42.1,40 40,42.1 52.9,55 "/>\n                    </svg>\n                </div>\n            </div>\n            <div class="trezorconnect-body">\n                <h3>Popup was blocked</h3>\n                <p>Please click to “Continue” to open popup manually</p>\n                <button class="trezorconnect-open">Continue</button>\n            </div>\n        </div>\n    </div>\n';r.showPopupRequest=function(e,t){if(!document.getElementById(n)){var r=document.createElement("div");r.id=n,r.className="trezorconnect-container",r.innerHTML=o,document.body&&document.body.appendChild(r),r.getElementsByClassName("trezorconnect-open")[0].onclick=function(){e(),document.body&&document.body.removeChild(r)},r.getElementsByClassName("trezorconnect-close")[0].onclick=function(){t(),document.body&&document.body.removeChild(r)}}}}}},{package:"eth-trezor-keyring>trezor-connect"}],[5885,{},function(){with(this)return function(){"use strict";return function(e,t,r){}}},{package:"eth-trezor-keyring>trezor-connect"}],[5886,{"../constants":5869,"./account":5885,"./backend/blockchain":5887,"./events":5889,"./misc":5891,"./networks/binance":5892,"./networks/bitcoin":5893,"./networks/cardano":5894,"./networks/coinInfo":5895,"./networks/eos":5896,"./networks/ethereum":5897,"./networks/nem":5898,"./networks/ripple":5899,"./networks/stellar":5900,"./networks/tezos":5901,"./params":5902,"./trezor/device":5903,"./trezor/management":5904,"./trezor/protobuf":5905},function(){with(this)return function(){"use strict";return function(e,t,r){o(e("../constants")),o(e("./params")),o(e("./trezor/device")),o(e("./trezor/management")),o(e("./trezor/protobuf")),o(e("./account")),o(e("./networks/bitcoin")),o(e("./networks/binance")),o(e("./networks/cardano")),o(e("./networks/coinInfo")),o(e("./networks/eos")),o(e("./networks/ethereum")),o(e("./networks/nem")),o(e("./networks/ripple")),o(e("./networks/stellar")),o(e("./networks/tezos")),o(e("./misc")),o(e("./events")),o(e("./backend/blockchain"));function n(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(n=function(e){return e?r:t})(e)}function o(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=n(t);if(r&&r.has(e))return r.get(e);var o={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var a=i?Object.getOwnPropertyDescriptor(e,s):null;a&&(a.get||a.set)?Object.defineProperty(o,s,a):o[s]=e[s]}return o.default=e,r&&r.set(e,o),o}}}},{package:"eth-trezor-keyring>trezor-connect"}],[5887,{"../../constants":5869},function(){with(this)return function(){"use strict";return function(e,t,r){e("../../constants")}}},{package:"eth-trezor-keyring>trezor-connect"}],[5888,{},function(){with(this)return function(){"use strict";return function(e,t,r){}}},{package:"eth-trezor-keyring>trezor-connect"}],[5889,{"../constants":5869},function(){with(this)return function(){"use strict";return function(e,t,r){e("../constants")}}},{package:"eth-trezor-keyring>trezor-connect"}],[5890,{"./account":5885,"./api":5886,"./backend/blockchain":5887,"./backend/transactions":5888,"./events":5889,"./misc":5891,"./networks/binance":5892,"./networks/bitcoin":5893,"./networks/cardano":5894,"./networks/coinInfo":5895,"./networks/eos":5896,"./networks/ethereum":5897,"./networks/nem":5898,"./networks/ripple":5899,"./networks/stellar":5900,"./networks/tezos":5901,"./params":5902,"./trezor/device":5903,"./trezor/management":5904},function(){with(this)return function(){"use strict";return function(e,t,r){r.__esModule=!0;var n=e("./api");Object.keys(n).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in r&&r[e]===n[e]||(r[e]=n[e]))}));var o=e("./events");Object.keys(o).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in r&&r[e]===o[e]||(r[e]=o[e]))}));var i=e("./misc");Object.keys(i).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in r&&r[e]===i[e]||(r[e]=i[e]))}));var s=e("./params");Object.keys(s).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in r&&r[e]===s[e]||(r[e]=s[e]))}));var a=e("./account");Object.keys(a).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in r&&r[e]===a[e]||(r[e]=a[e]))}));var c=e("./trezor/device");Object.keys(c).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in r&&r[e]===c[e]||(r[e]=c[e]))}));var l=e("./trezor/management");Object.keys(l).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in r&&r[e]===l[e]||(r[e]=l[e]))}));var u=e("./networks/bitcoin");Object.keys(u).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in r&&r[e]===u[e]||(r[e]=u[e]))}));var d=e("./networks/binance");Object.keys(d).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in r&&r[e]===d[e]||(r[e]=d[e]))}));var p=e("./networks/cardano");Object.keys(p).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in r&&r[e]===p[e]||(r[e]=p[e]))}));var h=e("./networks/coinInfo");Object.keys(h).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in r&&r[e]===h[e]||(r[e]=h[e]))}));var f=e("./networks/eos");Object.keys(f).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in r&&r[e]===f[e]||(r[e]=f[e]))}));var g=e("./networks/ethereum");Object.keys(g).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in r&&r[e]===g[e]||(r[e]=g[e]))}));var m=e("./networks/nem");Object.keys(m).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in r&&r[e]===m[e]||(r[e]=m[e]))}));var b=e("./networks/ripple");Object.keys(b).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in r&&r[e]===b[e]||(r[e]=b[e]))}));var y=e("./networks/stellar");Object.keys(y).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in r&&r[e]===y[e]||(r[e]=y[e]))}));var E=e("./networks/tezos");Object.keys(E).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in r&&r[e]===E[e]||(r[e]=E[e]))}));var v=e("./backend/blockchain");Object.keys(v).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in r&&r[e]===v[e]||(r[e]=v[e]))}));var w=e("./backend/transactions");Object.keys(w).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in r&&r[e]===w[e]||(r[e]=w[e]))}))}}},{package:"eth-trezor-keyring>trezor-connect"}],[5891,{},function(){with(this)return function(){"use strict";return function(e,t,r){}}},{package:"eth-trezor-keyring>trezor-connect"}],[5892,{},function(){with(this)return function(){"use strict";return function(e,t,r){}}},{package:"eth-trezor-keyring>trezor-connect"}],[5893,{},function(){with(this)return function(){"use strict";return function(e,t,r){}}},{package:"eth-trezor-keyring>trezor-connect"}],[5894,{"../trezor/protobuf":5905},function(){with(this)return function(){"use strict";return function(e,t,r){r.__esModule=!0,r.CardanoTxWitnessType=r.CardanoTxSigningMode=r.CardanoPoolRelayType=r.CardanoNativeScriptHashDisplayFormat=r.CardanoNativeScriptType=r.CardanoCertificateType=r.CardanoAddressType=void 0;var n=e("../trezor/protobuf");r.CardanoAddressType=n.Enum_CardanoAddressType,r.CardanoCertificateType=n.Enum_CardanoCertificateType,r.CardanoNativeScriptType=n.Enum_CardanoNativeScriptType,r.CardanoNativeScriptHashDisplayFormat=n.Enum_CardanoNativeScriptHashDisplayFormat,r.CardanoPoolRelayType=n.Enum_CardanoPoolRelayType,r.CardanoTxSigningMode=n.Enum_CardanoTxSigningMode,r.CardanoTxWitnessType=n.Enum_CardanoTxWitnessType}}},{package:"eth-trezor-keyring>trezor-connect"}],[5895,{},function(){with(this)return function(){"use strict";return function(e,t,r){}}},{package:"eth-trezor-keyring>trezor-connect"}],[5896,{},function(){with(this)return function(){"use strict";return function(e,t,r){}}},{package:"eth-trezor-keyring>trezor-connect"}],[5897,{},function(){with(this)return function(){"use strict";return function(e,t,r){}}},{package:"eth-trezor-keyring>trezor-connect"}],[5898,{},function(){with(this)return function(){"use strict";return function(e,t,r){}}},{package:"eth-trezor-keyring>trezor-connect"}],[5899,{},function(){with(this)return function(){"use strict";return function(e,t,r){}}},{package:"eth-trezor-keyring>trezor-connect"}],[59,{lodash:5091},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e){return o((0,n.cloneDeep)(e),(e=>null===e?"null":typeof e))};var n=e("lodash");function o(e={},t){return Object.entries(e).forEach((([r,n])=>{e[r]="object"==typeof n&&null!==n?o(n,t):t(n)})),e}}}},{package:"$root$"}],[5900,{},function(){with(this)return function(){"use strict";return function(e,t,r){}}},{package:"eth-trezor-keyring>trezor-connect"}],[5901,{},function(){with(this)return function(){"use strict";return function(e,t,r){}}},{package:"eth-trezor-keyring>trezor-connect"}],[5902,{},function(){with(this)return function(){"use strict";return function(e,t,r){}}},{package:"eth-trezor-keyring>trezor-connect"}],[5903,{"../../constants":5869},function(){with(this)return function(){"use strict";return function(e,t,r){e("../../constants")}}},{package:"eth-trezor-keyring>trezor-connect"}],[5904,{},function(){with(this)return function(){"use strict";return function(e,t,r){}}},{package:"eth-trezor-keyring>trezor-connect"}],[5905,{},function(){with(this)return function(){"use strict";return function(e,t,r){r.__esModule=!0,r.Enum_TezosBallotType=r.Enum_TezosContractType=r.Enum_StellarSignerType=r.Enum_StellarMemoType=r.Enum_StellarAssetType=r.Enum_NEMImportanceTransferMode=r.Enum_NEMModificationType=r.Enum_NEMSupplyChangeType=r.Enum_NEMMosaicLevy=r.Enum_WordRequestType=r.Enum_RecoveryDeviceType=r.Enum_SdProtectOperationType=r.Enum_Capability=r.Enum_SafetyCheckLevel=r.Enum_BackupType=r.Enum_EthereumDataType=r.Enum_PinMatrixRequestType=r.Enum_ButtonRequestType=r.Enum_FailureType=r.Enum_CardanoTxWitnessType=r.Enum_CardanoTxSigningMode=r.Enum_CardanoTxAuxiliaryDataSupplementType=r.Enum_CardanoPoolRelayType=r.Enum_CardanoCertificateType=r.Enum_CardanoNativeScriptHashDisplayFormat=r.Enum_CardanoNativeScriptType=r.Enum_CardanoAddressType=r.Enum_CardanoDerivationType=r.Enum_RequestType=r.Enum_AmountUnit=r.Enum_DecredStakingSpendType=r.Enum_OutputScriptType=r.Enum_InputScriptType=r.Enum_BinanceTimeInForce=r.Enum_BinanceOrderSide=r.Enum_BinanceOrderType=void 0;var n=Object.freeze({OT_UNKNOWN:0,MARKET:1,LIMIT:2,OT_RESERVED:3});r.Enum_BinanceOrderType=n;var o=Object.freeze({SIDE_UNKNOWN:0,BUY:1,SELL:2});r.Enum_BinanceOrderSide=o;var i=Object.freeze({TIF_UNKNOWN:0,GTE:1,TIF_RESERVED:2,IOC:3});r.Enum_BinanceTimeInForce=i;var s=Object.freeze({SPENDADDRESS:0,SPENDMULTISIG:1,EXTERNAL:2,SPENDWITNESS:3,SPENDP2SHWITNESS:4,SPENDTAPROOT:5});r.Enum_InputScriptType=s;var a=Object.freeze({PAYTOADDRESS:0,PAYTOSCRIPTHASH:1,PAYTOMULTISIG:2,PAYTOOPRETURN:3,PAYTOWITNESS:4,PAYTOP2SHWITNESS:5,PAYTOTAPROOT:6});r.Enum_OutputScriptType=a;var c=Object.freeze({SSGen:0,SSRTX:1});r.Enum_DecredStakingSpendType=c;var l=Object.freeze({BITCOIN:0,MILLIBITCOIN:1,MICROBITCOIN:2,SATOSHI:3});r.Enum_AmountUnit=l;var u=Object.freeze({TXINPUT:0,TXOUTPUT:1,TXMETA:2,TXFINISHED:3,TXEXTRADATA:4,TXORIGINPUT:5,TXORIGOUTPUT:6});r.Enum_RequestType=u;var d=Object.freeze({LEDGER:0,ICARUS:1,ICARUS_TREZOR:2});r.Enum_CardanoDerivationType=d;var p=Object.freeze({BASE:0,BASE_SCRIPT_KEY:1,BASE_KEY_SCRIPT:2,BASE_SCRIPT_SCRIPT:3,POINTER:4,POINTER_SCRIPT:5,ENTERPRISE:6,ENTERPRISE_SCRIPT:7,BYRON:8,REWARD:14,REWARD_SCRIPT:15});r.Enum_CardanoAddressType=p;var h=Object.freeze({PUB_KEY:0,ALL:1,ANY:2,N_OF_K:3,INVALID_BEFORE:4,INVALID_HEREAFTER:5});r.Enum_CardanoNativeScriptType=h;var f=Object.freeze({HIDE:0,BECH32:1,POLICY_ID:2});r.Enum_CardanoNativeScriptHashDisplayFormat=f;var g=Object.freeze({STAKE_REGISTRATION:0,STAKE_DEREGISTRATION:1,STAKE_DELEGATION:2,STAKE_POOL_REGISTRATION:3});r.Enum_CardanoCertificateType=g;var m=Object.freeze({SINGLE_HOST_IP:0,SINGLE_HOST_NAME:1,MULTIPLE_HOST_NAME:2});r.Enum_CardanoPoolRelayType=m;var b=Object.freeze({NONE:0,CATALYST_REGISTRATION_SIGNATURE:1});r.Enum_CardanoTxAuxiliaryDataSupplementType=b;var y=Object.freeze({ORDINARY_TRANSACTION:0,POOL_REGISTRATION_AS_OWNER:1,MULTISIG_TRANSACTION:2});r.Enum_CardanoTxSigningMode=y;var E=Object.freeze({BYRON_WITNESS:0,SHELLEY_WITNESS:1});r.Enum_CardanoTxWitnessType=E;var v=Object.freeze({Failure_UnexpectedMessage:1,Failure_ButtonExpected:2,Failure_DataError:3,Failure_ActionCancelled:4,Failure_PinExpected:5,Failure_PinCancelled:6,Failure_PinInvalid:7,Failure_InvalidSignature:8,Failure_ProcessError:9,Failure_NotEnoughFunds:10,Failure_NotInitialized:11,Failure_PinMismatch:12,Failure_WipeCodeMismatch:13,Failure_InvalidSession:14,Failure_FirmwareError:99});r.Enum_FailureType=v;var w=Object.freeze({ButtonRequest_Other:1,ButtonRequest_FeeOverThreshold:2,ButtonRequest_ConfirmOutput:3,ButtonRequest_ResetDevice:4,ButtonRequest_ConfirmWord:5,ButtonRequest_WipeDevice:6,ButtonRequest_ProtectCall:7,ButtonRequest_SignTx:8,ButtonRequest_FirmwareCheck:9,ButtonRequest_Address:10,ButtonRequest_PublicKey:11,ButtonRequest_MnemonicWordCount:12,ButtonRequest_MnemonicInput:13,_Deprecated_ButtonRequest_PassphraseType:14,ButtonRequest_UnknownDerivationPath:15,ButtonRequest_RecoveryHomepage:16,ButtonRequest_Success:17,ButtonRequest_Warning:18,ButtonRequest_PassphraseEntry:19,ButtonRequest_PinEntry:20});r.Enum_ButtonRequestType=w;var S=Object.freeze({PinMatrixRequestType_Current:1,PinMatrixRequestType_NewFirst:2,PinMatrixRequestType_NewSecond:3,PinMatrixRequestType_WipeCodeFirst:4,PinMatrixRequestType_WipeCodeSecond:5});r.Enum_PinMatrixRequestType=S;var C=Object.freeze({UINT:1,INT:2,BYTES:3,STRING:4,BOOL:5,ADDRESS:6,ARRAY:7,STRUCT:8});r.Enum_EthereumDataType=C;var _=Object.freeze({Bip39:0,Slip39_Basic:1,Slip39_Advanced:2});r.Enum_BackupType=_;var T=Object.freeze({Strict:0,PromptAlways:1,PromptTemporarily:2});r.Enum_SafetyCheckLevel=T;var k=Object.freeze({Capability_Bitcoin:1,Capability_Bitcoin_like:2,Capability_Binance:3,Capability_Cardano:4,Capability_Crypto:5,Capability_EOS:6,Capability_Ethereum:7,Capability_Lisk:8,Capability_Monero:9,Capability_NEM:10,Capability_Ripple:11,Capability_Stellar:12,Capability_Tezos:13,Capability_U2F:14,Capability_Shamir:15,Capability_ShamirGroups:16,Capability_PassphraseEntry:17});r.Enum_Capability=k;var M=Object.freeze({DISABLE:0,ENABLE:1,REFRESH:2});r.Enum_SdProtectOperationType=M;var O=Object.freeze({RecoveryDeviceType_ScrambledWords:0,RecoveryDeviceType_Matrix:1});r.Enum_RecoveryDeviceType=O;var P=Object.freeze({WordRequestType_Plain:0,WordRequestType_Matrix9:1,WordRequestType_Matrix6:2});r.Enum_WordRequestType=P;var R=Object.freeze({MosaicLevy_Absolute:1,MosaicLevy_Percentile:2});r.Enum_NEMMosaicLevy=R;var A=Object.freeze({SupplyChange_Increase:1,SupplyChange_Decrease:2});r.Enum_NEMSupplyChangeType=A;var I=Object.freeze({CosignatoryModification_Add:1,CosignatoryModification_Delete:2});r.Enum_NEMModificationType=I;var N=Object.freeze({ImportanceTransfer_Activate:1,ImportanceTransfer_Deactivate:2});r.Enum_NEMImportanceTransferMode=N;var D=Object.freeze({NATIVE:0,ALPHANUM4:1,ALPHANUM12:2});r.Enum_StellarAssetType=D;var U=Object.freeze({NONE:0,TEXT:1,ID:2,HASH:3,RETURN:4});r.Enum_StellarMemoType=U;var x=Object.freeze({ACCOUNT:0,PRE_AUTH:1,HASH:2});r.Enum_StellarSignerType=x;var L=Object.freeze({Implicit:0,Originated:1});r.Enum_TezosContractType=L;var j=Object.freeze({Yay:0,Nay:1,Pass:2});r.Enum_TezosBallotType=j}}},{package:"eth-trezor-keyring>trezor-connect"}],[5906,{},function(){with(this)return function(){"use strict";return function(e,t,r){r.__esModule=!0,r.getLog=r.enableLogByPrefix=r.enableLog=r.initLog=void 0;var n={DescriptorStream:"color: #77ab59",DeviceList:"color: #36802d",Device:"color: #bada55",Core:"color: #c9df8a",IFrame:"color: #FFFFFF; background: #f4a742;",Popup:"color: #f48a00"},o=function(){function e(e,t){this.prefix=e,this.enabled=t,this.messages=[],this.css=n[e]||"color: #000000; background: #FFFFFF;"}var t=e.prototype;return t.addMessage=function(e,t){for(var r=arguments.length,n=new Array(r>2?r-2:0),o=2;o<r;o++)n[o-2]=arguments[o];this.messages.push({level:e,prefix:t,message:n,timestamp:(new Date).getTime()}),this.messages.length>100&&this.messages.shift()},t.log=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n;(this.addMessage.apply(this,["log",this.prefix].concat(t)),this.enabled)&&(n=console).log.apply(n,[this.prefix].concat(t))},t.error=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n;(this.addMessage.apply(this,["error",this.prefix].concat(t)),this.enabled)&&(n=console).error.apply(n,[this.prefix].concat(t))},t.warn=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n;(this.addMessage.apply(this,["warn",this.prefix].concat(t)),this.enabled)&&(n=console).warn.apply(n,[this.prefix].concat(t))},t.debug=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n;(this.addMessage.apply(this,["debug",this.prefix].concat(t)),this.enabled)&&(n=console).log.apply(n,["%c"+this.prefix,this.css].concat(t))},e}(),i={};r.initLog=function(e,t){var r=new o(e,!!t);return i[e]=r,r};r.enableLog=function(e){Object.keys(i).forEach((function(t){i[t].enabled=e}))};r.enableLogByPrefix=function(e,t){i[e]&&(i[e].enabled=t)};r.getLog=function(){var e=[];return Object.keys(i).forEach((function(t){e=e.concat(i[t].messages)})),e.sort((function(e,t){return e.timestamp-t.timestamp})),e}}}},{package:"eth-trezor-keyring>trezor-connect"}],[5907,{"@babel/runtime/helpers/asyncToGenerator":189,"@babel/runtime/helpers/interopRequireDefault":199,"@babel/runtime/regenerator":219},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("@babel/runtime/helpers/interopRequireDefault");r.__esModule=!0,r.create=function(e,t){var r,n=function(e){},s=function(e){},a=new Promise(function(){var t=(0,i.default)(o.default.mark((function t(i,a){return o.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=i,s=a,"function"!=typeof e){t.next=11;break}return t.prev=3,t.next=6,e();case 6:t.next=11;break;case 8:t.prev=8,t.t0=t.catch(3),a(t.t0);case 11:"string"==typeof e&&(r=e);case 12:case"end":return t.stop()}}),t,null,[[3,8]])})));return function(e,r){return t.apply(this,arguments)}}());return{id:r,device:t,resolve:n,reject:s,promise:a}},r.createAsync=function(e){var t=function(e){},r=function(e){},n=new Promise((function(e,n){t=e,r=n})),s=function(){var t=(0,i.default)(o.default.mark((function t(){return o.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e();case 2:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return{resolve:t,reject:r,promise:n,run:function(){return s(),n}}},r.resolveTimeoutPromise=function(e,t){return new Promise((function(r){setTimeout((function(){r(t)}),e)}))},r.rejectTimeoutPromise=void 0;var o=n(e("@babel/runtime/regenerator")),i=n(e("@babel/runtime/helpers/asyncToGenerator"));r.rejectTimeoutPromise=function(e,t){return new Promise((function(r,n){setTimeout((function(){n(t)}),e)}))}}}},{package:"eth-trezor-keyring>trezor-connect"}],[5908,{},function(){with(this)return function(){"use strict";return function(e,t,r){r.__esModule=!0,r.default=void 0;var n=function(e,t,r){var n=e||".trezor-webusb-button",o=document.querySelectorAll(n),i=t+"?"+Date.now();o.forEach((function(e){if(e.getElementsByTagName("iframe").length<1){var t=e.getBoundingClientRect(),n=document.createElement("iframe");n.frameBorder="0",n.width=Math.round(t.width)+"px",n.height=Math.round(t.height)+"px",n.style.position="absolute",n.style.top="0px",n.style.left="0px",n.style.zIndex="1",n.setAttribute("allow","usb"),n.setAttribute("scrolling","no"),n.onload=function(){n.contentWindow.postMessage({},r)},n.src=i,e.append(n)}}))};r.default=n}}},{package:"eth-trezor-keyring>trezor-connect"}],[5909,{"./lib/truncate":5910,"utf8-byte-length/browser":5927},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("./lib/truncate"),o=e("utf8-byte-length/browser");t.exports=n.bind(null,o)}}},{package:"3box>ipfs>libp2p-keychain>sanitize-filename>truncate-utf8-bytes"}],[5910,{},function(){with(this)return function(){"use strict";return function(e,t,r){function n(e){return e>=55296&&e<=56319}function o(e){return e>=56320&&e<=57343}t.exports=function(e,t,r){if("string"!=typeof t)throw new Error("Input must be string");for(var i,s,a=t.length,c=0,l=0;l<a;l+=1){if(i=t.charCodeAt(l),s=t[l],n(i)&&o(t.charCodeAt(l+1))&&(s+=t[l+=1]),(c+=e(s))===r)return t.slice(0,l+1);if(c>r)return t.slice(0,l-s.length+1)}return t}}}},{package:"3box>ipfs>libp2p-keychain>sanitize-filename>truncate-utf8-bytes"}],[5914,{buffer:1996,"is-typedarray":4621},function(){with(this)return function(){"use strict";return function(e,t,r){(function(r){(function(){var n=e("is-typedarray").strict;t.exports=function(e){if(n(e)){var t=r.from(e.buffer);return e.byteLength!==e.buffer.byteLength&&(t=t.slice(e.byteOffset,e.byteOffset+e.byteLength)),t}return r.from(e)}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"stylelint>write-file-atomic>typedarray-to-buffer"}],[5915,{},function(){with(this)return function(){"use strict";return function(e,t,r){!function(e,n){"object"==typeof r&&void 0!==t?n(r):"function"==typeof define&&define.amd?define(["exports"],n):n((e=e||self).typical={})}(this,(function(e){function t(e){return!isNaN(parseFloat(e))&&isFinite(e)}function r(e){return null!==e&&"object"==typeof e&&e.constructor===Object}function n(e){return o(e)&&"number"==typeof e.length}function o(e){return"object"==typeof e&&null!==e}function i(e){return void 0!==e}function s(e){return"function"==typeof e&&/^class /.test(Function.prototype.toString.call(e))}function a(e){if(null===e)return!0;switch(typeof e){case"string":case"number":case"symbol":case"undefined":case"boolean":return!0;default:return!1}}function c(e){if(e){const t=i(Promise)&&e instanceof Promise,r=e.then&&"function"==typeof e.then;return!(!t&&!r)}return!1}function l(e){return!(null===e||!i(e))&&("function"==typeof e[Symbol.iterator]||"function"==typeof e[Symbol.asyncIterator])}function u(e){return"string"==typeof e}function d(e){return"function"==typeof e}var p={isNumber:t,isPlainObject:r,isArrayLike:n,isObject:o,isDefined:i,isClass:s,isPrimitive:a,isPromise:c,isIterable:l,isString:u,isFunction:d};e.default=p,e.isArrayLike=n,e.isClass=s,e.isDefined=i,e.isFunction=d,e.isIterable=l,e.isNumber=t,e.isObject=o,e.isPlainObject=r,e.isPrimitive=a,e.isPromise=c,e.isString=u,Object.defineProperty(e,"__esModule",{value:!0})}))}}},{package:"3box>ipfs>ipld>typical"}],[5918,{},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=function(e,t){var r=[],n={};if("function"!=typeof t){var o=t;t=function(e){return e[o]}}return e.forEach((function(e){var o=t(e);n[o]||(n[o]=!0,r.push(e))})),r}}}},{package:"3box>ipfs>peer-info>unique-by"}],[5920,{"./pad-string":5921,buffer:1996},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0});var n=e("buffer"),o=e("./pad-string");function i(e,t){return void 0===t&&(t="utf8"),n.Buffer.isBuffer(e)?a(e.toString("base64")):a(n.Buffer.from(e,t).toString("base64"))}function s(e){return e=e.toString(),o.default(e).replace(/\-/g,"+").replace(/_/g,"/")}function a(e){return e.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}var c=i;c.encode=i,c.decode=function(e,t){return void 0===t&&(t="utf8"),n.Buffer.from(s(e),"base64").toString(t)},c.toBase64=s,c.fromBase64=a,c.toBuffer=function(e){return n.Buffer.from(s(e),"base64")},r.default=c}}},{package:"3box>did-jwt>uport-base64url"}],[5921,{buffer:1996},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0});var n=e("buffer");r.default=function(e){var t=e.length,r=t%4;if(!r)return e;var o=t,i=4-r,s=t+i,a=n.Buffer.alloc(s);for(a.write(e);i--;)a.write("=",o++);return a.toString()}}}},{package:"3box>did-jwt>uport-base64url"}],[5922,{"./dist/base64url":5920},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=e("./dist/base64url").default,t.exports.default=t.exports}}},{package:"3box>did-jwt>uport-base64url"}],[5927,{},function(){with(this)return function(){"use strict";return function(e,t,r){function n(e){return e>=55296&&e<=56319}function o(e){return e>=56320&&e<=57343}t.exports=function(e){if("string"!=typeof e)throw new Error("Input must be string");for(var t=e.length,r=0,i=null,s=null,a=0;a<t;a++)o(i=e.charCodeAt(a))?null!=s&&n(s)?r+=1:r+=3:i<=127?r+=1:i>=128&&i<=2047?r+=2:i>=2048&&i<=65535&&(r+=3),s=i;return r}}}},{package:"3box>ipfs>libp2p-keychain>sanitize-filename>truncate-utf8-bytes>utf8-byte-length"}],[5949,{"../../is-buffer/index.js":4601,varint:5952},function(){with(this)return function(){"use strict";return function(e,t,r){(function(r){(function(){const n=e("varint");t.exports=e=>{if(!r.isBuffer(e))throw new Error("arg needs to be a buffer");let t=[];for(;e.length>0;){const r=n.decode(e);t.push(r),e=e.slice(n.decode.bytes)}return t}}).call(this)}).call(this,{isBuffer:e("../../is-buffer/index.js")})}}},{package:"3box>ipfs>ipfs-bitswap>varint-decoder"}],[5950,{},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=function e(t,r){var n,o=0,i=0,s=r=r||0,a=t.length;do{if(s>=a)throw e.bytes=0,new RangeError("Could not decode varint");n=t[s++],o+=i<28?(127&n)<<i:(127&n)*Math.pow(2,i),i+=7}while(n>=128);return e.bytes=s-r,o}}}},{package:"3box>ipfs>varint"}],[5951,{},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=function e(t,r,o){r=r||[];var i=o=o||0;for(;t>=n;)r[o++]=255&t|128,t/=128;for(;-128&t;)r[o++]=255&t|128,t>>>=7;return r[o]=0|t,e.bytes=o-i+1,r};var n=Math.pow(2,31)}}},{package:"3box>ipfs>varint"}],[5952,{"./decode.js":5950,"./encode.js":5951,"./length.js":5953},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports={encode:e("./encode.js"),decode:e("./decode.js"),encodingLength:e("./length.js")}}}},{package:"3box>ipfs>varint"}],[5953,{},function(){with(this)return function(){"use strict";return function(e,t,r){var n=Math.pow(2,7),o=Math.pow(2,14),i=Math.pow(2,21),s=Math.pow(2,28),a=Math.pow(2,35),c=Math.pow(2,42),l=Math.pow(2,49),u=Math.pow(2,56),d=Math.pow(2,63);t.exports=function(e){return e<n?1:e<o?2:e<i?3:e<s?4:e<a?5:e<c?6:e<l?7:e<u?8:e<d?9:10}}}},{package:"3box>ipfs>varint"}],[5956,{util:2002},function(){with(this)return function(){"use strict";return function(e,t,r){r.TextEncoder="undefined"!=typeof TextEncoder?TextEncoder:e("util").TextEncoder,r.TextDecoder="undefined"!=typeof TextDecoder?TextDecoder:e("util").TextDecoder}}},{package:"@ensdomains/content-hash>multihashes>web-encoding"}],[6,{"../../../shared/constants/alerts":6104,"@babel/runtime/helpers/defineProperty":193,"@babel/runtime/helpers/interopRequireDefault":199,"@metamask/obs-store":1197},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var o=n(e("@babel/runtime/helpers/defineProperty")),i=e("@metamask/obs-store"),s=e("../../../shared/constants/alerts");function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){(0,o.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const l={alertEnabledness:s.TOGGLEABLE_ALERT_TYPES.reduce(((e,t)=>(e[t]=!0,e)),{}),unconnectedAccountAlertShownOrigins:{},web3ShimUsageOrigins:{}};r.default=class{constructor(e={}){const{initState:t={},preferencesStore:r}=e,n=c(c({},l),{},{alertEnabledness:c(c({},l.alertEnabledness),t.alertEnabledness)});this.store=new i.ObservableStore(n),this.selectedAddress=r.getState().selectedAddress,r.subscribe((({selectedAddress:e})=>{this.store.getState().unconnectedAccountAlertShownOrigins&&this.selectedAddress!==e&&(this.selectedAddress=e,this.store.updateState({unconnectedAccountAlertShownOrigins:{}}))}))}setAlertEnabledness(e,t){let{alertEnabledness:r}=this.store.getState();r=c({},r),r[e]=t,this.store.updateState({alertEnabledness:r})}setUnconnectedAccountAlertShown(e){let{unconnectedAccountAlertShownOrigins:t}=this.store.getState();t=c({},t),t[e]=!0,this.store.updateState({unconnectedAccountAlertShownOrigins:t})}getWeb3ShimUsageState(e){return this.store.getState().web3ShimUsageOrigins[e]}setWeb3ShimUsageRecorded(e){this._setWeb3ShimUsageState(e,s.WEB3_SHIM_USAGE_ALERT_STATES.RECORDED)}setWeb3ShimUsageAlertDismissed(e){this._setWeb3ShimUsageState(e,s.WEB3_SHIM_USAGE_ALERT_STATES.DISMISSED)}_setWeb3ShimUsageState(e,t){let{web3ShimUsageOrigins:r}=this.store.getState();r=c({},r),r[e]=t,this.store.updateState({web3ShimUsageOrigins:r})}}}}},{package:"$root$"}],[60,{"./util":83,"@babel/runtime/helpers/interopRequireDefault":199,loglevel:5104,"webextension-polyfill":6080},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var o=n(e("webextension-polyfill")),i=n(e("loglevel")),s=e("./util");r.default=class{constructor(){this.isSupported=Boolean(o.default.storage.local),this.isSupported||i.default.error("Storage local API not available.")}async get(){if(!this.isSupported)return undefined;const e=await this._get();return t=e,0===Object.keys(t).length?undefined:e;var t}async set(e){return this._set(e)}_get(){const{local:e}=o.default.storage;return new Promise(((t,r)=>{e.get(null).then((e=>{const n=(0,s.checkForError)();n?r(n):t(e)}))}))}_set(e){const{local:t}=o.default.storage;return new Promise(((r,n)=>{t.set(e).then((()=>{const e=(0,s.checkForError)();e?n(e):r()}))}))}}}}},{package:"$root$"}],[6081,{},function(){with(this)return function(){"use strict";return function(e,t,r){var n,o;self.mozRTCPeerConnection||navigator.mozGetUserMedia?(n="moz",o=parseInt(navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1],10)):(self.webkitRTCPeerConnection||navigator.webkitGetUserMedia)&&(n="webkit",o=navigator.userAgent.match(/Chrom(e|ium)/)&&parseInt(navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./)[2],10));var i=self.RTCPeerConnection||self.mozRTCPeerConnection||self.webkitRTCPeerConnection,s=self.mozRTCIceCandidate||self.RTCIceCandidate,a=self.mozRTCSessionDescription||self.RTCSessionDescription,c=self.webkitMediaStream||self.MediaStream,l="https:"===self.location.protocol&&("webkit"===n&&o>=26||"moz"===n&&o>=33),u=self.AudioContext||self.webkitAudioContext,d=self.document&&document.createElement("video"),p=d&&d.canPlayType&&"probably"===d.canPlayType('video/webm; codecs="vp8", vorbis'),h=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.msGetUserMedia||navigator.mozGetUserMedia;t.exports={prefix:n,browserVersion:o,support:!!i&&!!h,supportRTCPeerConnection:!!i,supportVp8:p,supportGetUserMedia:!!h,supportDataChannel:!!(i&&i.prototype&&i.prototype.createDataChannel),supportWebAudio:!(!u||!u.prototype.createMediaStreamSource),supportMediaStream:!(!c||!c.prototype.removeTrack),supportScreenSharing:!!l,AudioContext:u,PeerConnection:i,SessionDescription:a,IceCandidate:s,MediaStream:c,getUserMedia:h}}}},{package:"3box>ipfs>libp2p-webrtc-star>webrtcsupport"}],[6091,{buffer:1996},function(){with(this)return function(){"use strict";return function(e,t,r){(function(e){(function(){function r(t,r){if(t.length!==r.length)throw new Error("Inputs should have the same length");for(var n=e.allocUnsafe(t.length),o=0;o<t.length;o++)n[o]=t[o]^r[o];return n}t.exports=r,r.compare=function(e,t){if(e.length!==t.length)throw new Error("Inputs should have the same length");for(var r=0;r<e.length;r++)if(e[r]!==t[r])return e[r]<t[r]?-1:1;return 0},r.gt=function(e,t){return 1===r.compare(e,t)},r.lt=function(e,t){return-1===r.compare(e,t)},r.eq=function(e,t){return 0===r.compare(e,t)}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"3box>ipfs>libp2p-kad-dht>xor-distance"}],[6093,{},function(){with(this)return function(){"use strict";return function(e,t,r){t.exports=function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)n.call(r,o)&&(e[o]=r[o])}return e};var n=Object.prototype.hasOwnProperty}}},{package:"watchify>xtend"}],[6096,{},function(){with(this)return function(){"use strict";return function(e,t,r){var n,o="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),i={},s=0,a=0;function c(e){var t="";do{t=o[e%64]+t,e=Math.floor(e/64)}while(e>0);return t}function l(){var e=c(+new Date);return e!==n?(s=0,n=e):e+"."+c(s++)}for(;a<64;a++)i[o[a]]=a;l.encode=c,l.decode=function(e){var t=0;for(a=0;a<e.length;a++)t=64*t+i[e.charAt(a)];return t},t.exports=l}}},{package:"3box>ipfs>libp2p-webrtc-star>socket.io-client>engine.io-client>yeast"}],[61,{"../../../shared/constants/app":6105,"../../../shared/constants/metametrics":6109,"../../../shared/modules/random-id":6122,"../metamask-controller":84,"@babel/runtime/helpers/interopRequireDefault":199,"@metamask/obs-store":1197,buffer:1996,"eth-rpc-errors":2371,"ethereumjs-util":2437,events:1997},function(){with(this)return function(){"use strict";return function(e,t,r){(function(t){(function(){var n=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0,r.normalizeMsgData=h;var o=n(e("events")),i=e("@metamask/obs-store"),s=e("ethereumjs-util"),a=e("eth-rpc-errors"),c=e("../../../shared/constants/app"),l=e("../metamask-controller"),u=n(e("../../../shared/modules/random-id")),d=e("../../../shared/constants/metametrics");class p extends o.default{constructor({metricsEvent:e}){super(),this.memStore=new i.ObservableStore({unapprovedMsgs:{},unapprovedMsgCount:0}),this.messages=[],this.metricsEvent=e}get unapprovedMsgCount(){return Object.keys(this.getUnapprovedMsgs()).length}getUnapprovedMsgs(){return this.messages.filter((e=>"unapproved"===e.status)).reduce(((e,t)=>(e[t.id]=t,e)),{})}async addUnapprovedMessageAsync(e,t){const r=this.addUnapprovedMessage(e,t);return await new Promise(((t,n)=>{this.once(`${r}:finished`,(r=>{switch(r.status){case"signed":return t(r.rawSig);case"rejected":return n(a.ethErrors.provider.userRejectedRequest("MetaMask Message Signature: User denied message signature."));case"errored":return n(new Error(`MetaMask Message Signature: ${r.error}`));default:return n(new Error(`MetaMask Message Signature: Unknown problem: ${JSON.stringify(e)}`))}}))}))}addUnapprovedMessage(e,t){t&&(e.origin=t.origin),e.data=h(e.data);const r=(new Date).getTime(),n=(0,u.default)(),o={id:n,msgParams:e,time:r,status:"unapproved",type:c.MESSAGE_TYPE.ETH_SIGN};return this.addMsg(o),this.emit("update"),n}addMsg(e){this.messages.push(e),this._saveMsgList()}getMsg(e){return this.messages.find((t=>t.id===e))}approveMessage(e){return this.setMsgStatusApproved(e.metamaskId),this.prepMsgForSigning(e)}setMsgStatusApproved(e){this._setMsgStatus(e,"approved")}setMsgStatusSigned(e,t){const r=this.getMsg(e);r.rawSig=t,this._updateMsg(r),this._setMsgStatus(e,"signed")}prepMsgForSigning(e){return delete e.metamaskId,Promise.resolve(e)}rejectMsg(e,t=undefined){if(t){const r=this.getMsg(e);this.metricsEvent({event:t,category:d.EVENT.CATEGORIES.TRANSACTIONS,properties:{action:"Sign Request",type:r.type}})}this._setMsgStatus(e,"rejected")}errorMessage(e,t){const r=this.getMsg(e);r.error=t,this._updateMsg(r),this._setMsgStatus(e,"errored")}clearUnapproved(){this.messages=this.messages.filter((e=>"unapproved"!==e.status)),this._saveMsgList()}_setMsgStatus(e,t){const r=this.getMsg(e);if(!r)throw new Error(`MessageManager - Message not found for id: "${e}".`);r.status=t,this._updateMsg(r),this.emit(`${e}:${t}`,r),"rejected"!==t&&"signed"!==t||this.emit(`${e}:finished`,r)}_updateMsg(e){const t=this.messages.findIndex((t=>t.id===e.id));-1!==t&&(this.messages[t]=e),this._saveMsgList()}_saveMsgList(){const e=this.getUnapprovedMsgs(),t=Object.keys(e).length;this.memStore.updateState({unapprovedMsgs:e,unapprovedMsgCount:t}),this.emit(l.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE)}}function h(e){return"0x"===e.slice(0,2)?e:(0,s.bufferToHex)(t.from(e,"utf8"))}r.default=p}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"$root$"}],[63,{"@babel/runtime/helpers/interopRequireDefault":199,events:1997},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var o=n(e("events"));class i extends o.default{constructor(e={}){super();const t=e.migrations||[];this.migrations=t.sort(((e,t)=>e.version-t.version));const r=this.migrations.slice(-1)[0];this.defaultVersion=e.defaultVersion||r&&r.version||0}async migrateData(e=this.generateInitialState()){const t=this.migrations.filter((function(t){return t.version>e.meta.version}));for(const r of t)try{const t=await r.migrate(e);if(!t.data)throw new Error("Migrator - migration returned empty data");if(t.version!==undefined&&t.meta.version!==r.version)throw new Error("Migrator - Migration did not update version number correctly");e=t}catch(t){const n=t.message;return t.message=`MetaMask Migration Error #${r.version}: ${n}`,this.emit("error",t),e}return e}generateInitialState(e){return{meta:{version:this.defaultVersion},data:e}}}r.default=i}}},{package:"$root$"}],[64,{"../../../shared/constants/time":6113,"../../../shared/modules/fetch-with-timeout":6118,"@babel/runtime/helpers/defineProperty":193,"@babel/runtime/helpers/interopRequireDefault":199,loglevel:5104},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var o=n(e("@babel/runtime/helpers/defineProperty")),i=n(e("loglevel")),s=e("../../../shared/constants/time");const a=(0,n(e("../../../shared/modules/fetch-with-timeout")).default)(30*s.SECOND);r.default=class{constructor(){(0,o.default)(this,"isSupported",!0),this._initialized=!1,this._initializing=this._init(),this._state=undefined}async _init(){try{const e=await a("http://localhost:12345/state.json");e.ok&&(this._state=await e.json())}catch(e){i.default.debug(`Error loading network state: '${e.message}'`)}finally{this._initialized=!0}}async get(){return this._initialized||await this._initializing,this._state}async set(e){this._initialized||await this._initializing,this._state=e}}}}},{package:"$root$"}],[65,{"../platforms/extension":157,"@babel/runtime/helpers/interopRequireDefault":199,"safe-event-emitter":5661},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=r.NOTIFICATION_MANAGER_EVENTS=void 0;var o=n(e("safe-event-emitter")),i=n(e("../platforms/extension"));const s={POPUP_CLOSED:"onPopupClosed"};r.NOTIFICATION_MANAGER_EVENTS=s;class a extends o.default{constructor(){super(),this.platform=new i.default,this.platform.addOnRemovedListener(this._onWindowClosed.bind(this))}markAsAutomaticallyClosed(){this._popupAutomaticallyClosed=!0}async showPopup(){const e=await this._getPopup();if(e)await this.platform.focusWindow(e.id);else{let e=0,t=0;try{const r=await this.platform.getLastFocusedWindow();t=r.top,e=r.left+(r.width-360)}catch(r){const{screenX:n,screenY:o,outerWidth:i}=window;t=Math.max(o,0),e=Math.max(n+(i-360),0)}const r=await this.platform.openWindow({url:"notification.html",type:"popup",width:360,height:620,left:e,top:t});r.left!==e&&"fullscreen"!==r.state&&await this.platform.updateWindowPosition(r.id,e,t),this._popupId=r.id}}_onWindowClosed(e){e===this._popupId&&(this._popupId=undefined,this.emit(s.POPUP_CLOSED,{automaticallyClosed:this._popupAutomaticallyClosed}),this._popupAutomaticallyClosed=undefined)}async _getPopup(){const e=await this.platform.getAllWindows();return this._getPopupIn(e)}_getPopupIn(e){return e?e.find((e=>e&&"popup"===e.type&&e.id===this._popupId)):null}}r.default=a}}},{package:"$root$"}],[66,{"../../../shared/constants/app":6105,"../../../shared/constants/metametrics":6109,"../../../shared/modules/random-id":6122,"../metamask-controller":84,"./util":83,"@babel/runtime/helpers/interopRequireDefault":199,"@metamask/obs-store":1197,buffer:1996,"eth-rpc-errors":2371,"ethereumjs-util":2437,events:1997,loglevel:5104},function(){with(this)return function(){"use strict";return function(e,t,r){(function(t){(function(){var n=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var o=n(e("events")),i=e("@metamask/obs-store"),s=e("ethereumjs-util"),a=e("eth-rpc-errors"),c=n(e("loglevel")),l=e("../../../shared/constants/app"),u=e("../metamask-controller"),d=n(e("../../../shared/modules/random-id")),p=e("../../../shared/constants/metametrics"),h=e("./util");const f=/^[0-9A-Fa-f]+$/gu;class g extends o.default{constructor({metricsEvent:e}){super(),this.memStore=new i.ObservableStore({unapprovedPersonalMsgs:{},unapprovedPersonalMsgCount:0}),this.messages=[],this.metricsEvent=e}get unapprovedPersonalMsgCount(){return Object.keys(this.getUnapprovedMsgs()).length}getUnapprovedMsgs(){return this.messages.filter((e=>"unapproved"===e.status)).reduce(((e,t)=>(e[t.id]=t,e)),{})}addUnapprovedMessageAsync(e,t){return new Promise(((r,n)=>{if(!e.from)return void n(new Error("MetaMask Message Signature: from field is required."));const o=this.addUnapprovedMessage(e,t);this.once(`${o}:finished`,(t=>{switch(t.status){case"signed":return void r(t.rawSig);case"rejected":return void n(a.ethErrors.provider.userRejectedRequest("MetaMask Message Signature: User denied message signature."));case"errored":return void n(new Error(`MetaMask Message Signature: ${t.error}`));default:n(new Error(`MetaMask Message Signature: Unknown problem: ${JSON.stringify(e)}`))}}))}))}addUnapprovedMessage(e,t){c.default.debug(`PersonalMessageManager addUnapprovedMessage: ${JSON.stringify(e)}`),t&&(e.origin=t.origin),e.data=this.normalizeMsgData(e.data);const r=(new Date).getTime(),n=(0,d.default)(),o={id:n,msgParams:e,time:r,status:"unapproved",type:l.MESSAGE_TYPE.PERSONAL_SIGN};return this.addMsg(o),this.emit("update"),n}addMsg(e){this.messages.push(e),this._saveMsgList()}getMsg(e){return this.messages.find((t=>t.id===e))}approveMessage(e){return this.setMsgStatusApproved(e.metamaskId),this.prepMsgForSigning(e)}setMsgStatusApproved(e){this._setMsgStatus(e,"approved")}setMsgStatusSigned(e,t){const r=this.getMsg(e);r.rawSig=t,this._updateMsg(r),this._setMsgStatus(e,"signed")}prepMsgForSigning(e){return delete e.metamaskId,Promise.resolve(e)}rejectMsg(e,t=undefined){if(t){const r=this.getMsg(e);this.metricsEvent({event:t,category:p.EVENT.CATEGORIES.TRANSACTIONS,properties:{action:"Sign Request",type:r.type}})}this._setMsgStatus(e,"rejected")}errorMessage(e,t){const r=this.getMsg(e);r.error=t,this._updateMsg(r),this._setMsgStatus(e,"errored")}clearUnapproved(){this.messages=this.messages.filter((e=>"unapproved"!==e.status)),this._saveMsgList()}_setMsgStatus(e,t){const r=this.getMsg(e);if(!r)throw new Error(`PersonalMessageManager - Message not found for id: "${e}".`);r.status=t,this._updateMsg(r),this.emit(`${e}:${t}`,r),"rejected"!==t&&"signed"!==t||this.emit(`${e}:finished`,r)}_updateMsg(e){const t=this.messages.findIndex((t=>t.id===e.id));-1!==t&&(this.messages[t]=e),this._saveMsgList()}_saveMsgList(){const e=this.getUnapprovedMsgs(),t=Object.keys(e).length;this.memStore.updateState({unapprovedPersonalMsgs:e,unapprovedPersonalMsgCount:t}),this.emit(u.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE)}normalizeMsgData(e){try{const t=(0,s.stripHexPrefix)(e);if(t.match(f))return(0,h.addHexPrefix)(t)}catch(e){c.default.debug("Message was not hex encoded, interpreting as utf8.")}return(0,s.bufferToHex)(t.from(e,"utf8"))}}r.default=g}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"$root$"}],[67,{"../../../../shared/constants/network":6110,"./handlers":71,"@babel/runtime/helpers/interopRequireDefault":199,"@metamask/controllers":1047,"@metamask/rpc-methods":1217,"eth-rpc-errors":2371,lodash:5091},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.createMethodMiddleware=function(e){const t=d.filter((t=>!Object.hasOwnProperty.call(e,t)));if(t.length>0)throw new Error(`Missing expected hooks:\n\n${t.join("\n")}\n`);return async function(t,r,n,o){if(c.UNSUPPORTED_RPC_METHODS.has(t.method))return o(s.ethErrors.rpc.methodNotSupported());const a=u.get(t.method);if(a){const{implementation:s,hookNames:c}=a;try{return await s(t,r,n,o,(0,i.selectHooks)(e,c))}catch(e){return console.error(e),o(e)}}return n()}};var o=e("@metamask/controllers"),i=e("@metamask/rpc-methods"),s=e("eth-rpc-errors"),a=e("lodash"),c=e("../../../../shared/constants/network");const l=[...n(e("./handlers")).default,...o.permissionRpcMethods.handlers],u=l.reduce(((e,t)=>{for(const r of t.methodNames)e.set(r,t);return e}),new Map),d=Array.from(new Set((0,a.flatten)(l.map((({hookNames:e})=>Object.keys(e))))).values())}}},{package:"$root$"}],[68,{"../../../../../shared/constants/app":6105,"../../../../../shared/constants/metametrics":6109,"../../../../../shared/constants/network":6110,"../../../../../shared/modules/network.utils":6121,"../../../../../shared/modules/rpc.utils":6123,"@babel/runtime/helpers/interopRequireDefault":199,"eth-rpc-errors":2371,lodash:5091,"valid-url":5945},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var o=e("eth-rpc-errors"),i=n(e("valid-url")),s=e("lodash"),a=e("../../../../../shared/constants/app"),c=e("../../../../../shared/constants/metametrics"),l=e("../../../../../shared/modules/network.utils"),u=e("../../../../../shared/modules/rpc.utils"),d=e("../../../../../shared/constants/network");var p={methodNames:[a.MESSAGE_TYPE.ADD_ETHEREUM_CHAIN],implementation:async function(e,t,r,n,{addCustomRpc:p,getCurrentChainId:h,findCustomRpcBy:f,updateRpcTarget:g,requestUserApproval:m,sendMetrics:b}){var y;if(null===(y=e.params)||void 0===y||!y[0]||"object"!=typeof e.params[0])return n(o.ethErrors.rpc.invalidParams({message:`Expected single, object parameter. Received:\n${JSON.stringify(e.params)}`}));const{origin:E}=e,{chainId:v,chainName:w=null,blockExplorerUrls:S=null,nativeCurrency:C=null,rpcUrls:_}=e.params[0],T=Object.keys((0,s.omit)(e.params[0],["chainId","chainName","blockExplorerUrls","iconUrls","rpcUrls","nativeCurrency"]));if(T.length>0)return n(o.ethErrors.rpc.invalidParams({message:`Received unexpected keys on object parameter. Unsupported keys:\n${T}`}));const k=Array.isArray(_)?_.find((e=>i.default.isHttpsUri(e))):null,M=null!==S&&Array.isArray(S)?S.find((e=>i.default.isHttpsUri(e))):null;if(!k)return n(o.ethErrors.rpc.invalidParams({message:`Expected an array with at least one valid string HTTPS url 'rpcUrls', Received:\n${_}`}));if(null!==S&&!M)return n(o.ethErrors.rpc.invalidParams({message:`Expected null or array with at least one valid string HTTPS URL 'blockExplorerUrl'. Received: ${S}`}));const O="string"==typeof v&&v.toLowerCase();if(!(0,l.isPrefixedFormattedHexString)(O))return n(o.ethErrors.rpc.invalidParams({message:`Expected 0x-prefixed, unpadded, non-zero hexadecimal string 'chainId'. Received:\n${v}`}));if(!(0,l.isSafeChainId)(parseInt(O,16)))return n(o.ethErrors.rpc.invalidParams({message:`Invalid chain ID "${O}": numerical value greater than max safe value. Received:\n${v}`}));if(d.CHAIN_ID_TO_NETWORK_ID_MAP[O])return n(o.ethErrors.rpc.invalidParams({message:"May not specify default MetaMask chain."}));const P=f({chainId:O});if(P){t.result=null;if(h()===O)return n();try{await g(await m({origin:E,type:a.MESSAGE_TYPE.SWITCH_ETHEREUM_CHAIN,requestData:{rpcUrl:P.rpcUrl,chainId:P.chainId,nickname:P.nickname,ticker:P.ticker}})),t.result=null}catch(e){if(e.code!==o.errorCodes.provider.userRejectedRequest)return n(e)}return n()}let R;try{R=await(0,u.jsonRpcRequest)(k,"eth_chainId")}catch(e){return n(o.ethErrors.rpc.internal({message:`Request for method 'eth_chainId on ${k} failed`,data:{networkErr:e}}))}if(O!==R)return n(o.ethErrors.rpc.invalidParams({message:`Chain ID returned by RPC URL ${k} does not match ${O}`,data:{chainId:R}}));if("string"!=typeof w||!w)return n(o.ethErrors.rpc.invalidParams({message:`Expected non-empty string 'chainName'. Received:\n${w}`}));const A=w.length>100?w.substring(0,100):w;if(null!==C){if("object"!=typeof C||Array.isArray(C))return n(o.ethErrors.rpc.invalidParams({message:`Expected null or object 'nativeCurrency'. Received:\n${C}`}));if(18!==C.decimals)return n(o.ethErrors.rpc.invalidParams({message:`Expected the number 18 for 'nativeCurrency.decimals' when 'nativeCurrency' is provided. Received: ${C.decimals}`}));if(!C.symbol||"string"!=typeof C.symbol)return n(o.ethErrors.rpc.invalidParams({message:`Expected a string 'nativeCurrency.symbol'. Received: ${C.symbol}`}))}const I=(null==C?void 0:C.symbol)||"ETH";if("string"!=typeof I||I.length<2||I.length>6)return n(o.ethErrors.rpc.invalidParams({message:`Expected 2-6 character string 'nativeCurrency.symbol'. Received:\n${I}`}));try{await p(await m({origin:E,type:a.MESSAGE_TYPE.ADD_ETHEREUM_CHAIN,requestData:{chainId:O,blockExplorerUrl:M,chainName:A,rpcUrl:k,ticker:I}})),b({event:"Custom Network Added",category:c.EVENT.CATEGORIES.NETWORK,referrer:{url:E},sensitiveProperties:{chain_id:O,rpc_url:k,network_name:A,network:k,symbol:I,block_explorer_url:M,source:"dapp"}}),t.result=null}catch(e){return n(e)}try{await g(await m({origin:E,type:a.MESSAGE_TYPE.SWITCH_ETHEREUM_CHAIN,requestData:{rpcUrl:k,chainId:O,nickname:A,ticker:I}}))}catch(e){if(e.code!==o.errorCodes.provider.userRejectedRequest)return n(e)}return n()},hookNames:{addCustomRpc:!0,getCurrentChainId:!0,findCustomRpcBy:!0,updateRpcTarget:!0,requestUserApproval:!0,sendMetrics:!0}};r.default=p}}},{package:"$root$"}],[69,{"../../../../../shared/constants/app":6105},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n={methodNames:[e("../../../../../shared/constants/app").MESSAGE_TYPE.ETH_ACCOUNTS],implementation:async function(e,t,r,n,{getAccounts:o}){return t.result=await o(),n()},hookNames:{getAccounts:!0}};r.default=n}}},{package:"$root$"}],[7,{"../../../shared/constants/time":6113,"../metamask-controller":84,"@babel/runtime/helpers/defineProperty":193,"@babel/runtime/helpers/interopRequireDefault":199,"@metamask/obs-store":1197,events:1997},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var o=n(e("@babel/runtime/helpers/defineProperty")),i=n(e("events")),s=e("@metamask/obs-store"),a=e("../metamask-controller"),c=e("../../../shared/constants/time");function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){(0,o.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}class d extends i.default{constructor(e={}){const{addUnlockListener:t,isUnlocked:r,initState:n,onInactiveTimeout:o,showUnlockRequest:i,preferencesStore:a,qrHardwareStore:c}=e;super(),this.onInactiveTimeout=o||(()=>undefined),this.store=new s.ObservableStore(u(u({timeoutMinutes:0,connectedStatusPopoverHasBeenShown:!0,defaultHomeActiveTabName:null,browserEnvironment:{},popupGasPollTokens:[],notificationGasPollTokens:[],fullScreenGasPollTokens:[],recoveryPhraseReminderHasBeenShown:!1,recoveryPhraseReminderLastShown:(new Date).getTime(),collectiblesDetectionNoticeDismissed:!1,enableEIP1559V2NoticeDismissed:!1,showTestnetMessageInDropdown:!0,trezorModel:null},n),{},{qrHardware:{},collectiblesDropdownState:{}})),this.timer=null,this.isUnlocked=r,this.waitingForUnlock=[],t(this.handleUnlock.bind(this)),this._showUnlockRequest=i,a.subscribe((({preferences:e})=>{this.store.getState().timeoutMinutes!==e.autoLockTimeLimit&&this._setInactiveTimeout(e.autoLockTimeLimit)})),c.subscribe((e=>{this.store.updateState({qrHardware:e})}));const{preferences:l}=a.getState();this._setInactiveTimeout(l.autoLockTimeLimit)}getUnlockPromise(e){return new Promise((t=>{this.isUnlocked()?t():this.waitForUnlock(t,e)}))}waitForUnlock(e,t){this.waitingForUnlock.push({resolve:e}),this.emit(a.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE),t&&this._showUnlockRequest()}handleUnlock(){if(this.waitingForUnlock.length>0){for(;this.waitingForUnlock.length>0;)this.waitingForUnlock.shift().resolve();this.emit(a.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE)}}setDefaultHomeActiveTabName(e){this.store.updateState({defaultHomeActiveTabName:e})}setConnectedStatusPopoverHasBeenShown(){this.store.updateState({connectedStatusPopoverHasBeenShown:!0})}setRecoveryPhraseReminderHasBeenShown(){this.store.updateState({recoveryPhraseReminderHasBeenShown:!0})}setRecoveryPhraseReminderLastShown(e){this.store.updateState({recoveryPhraseReminderLastShown:e})}setLastActiveTime(){this._resetTimer()}_setInactiveTimeout(e){this.store.updateState({timeoutMinutes:e}),this._resetTimer()}_resetTimer(){const{timeoutMinutes:e}=this.store.getState();this.timer&&clearTimeout(this.timer),e&&(this.timer=setTimeout((()=>this.onInactiveTimeout()),e*c.MINUTE))}setBrowserEnvironment(e,t){this.store.updateState({browserEnvironment:{os:e,browser:t}})}addPollingToken(e,t){const r=this.store.getState()[t];this.store.updateState({[t]:[...r,e]})}removePollingToken(e,t){const r=this.store.getState()[t];this.store.updateState({[t]:r.filter((t=>t!==e))})}clearPollingTokens(){this.store.updateState({popupGasPollTokens:[],notificationGasPollTokens:[],fullScreenGasPollTokens:[]})}setShowTestnetMessageInDropdown(e){this.store.updateState({showTestnetMessageInDropdown:e})}setTrezorModel(e){this.store.updateState({trezorModel:e})}setCollectiblesDetectionNoticeDismissed(e){this.store.updateState({collectiblesDetectionNoticeDismissed:e})}setEnableEIP1559V2NoticeDismissed(e){this.store.updateState({enableEIP1559V2NoticeDismissed:e})}updateCollectibleDropDownState(e){this.store.updateState({collectiblesDropdownState:e})}}r.default=d}}},{package:"$root$"}],[70,{"../../../../../shared/constants/app":6105,"@babel/runtime/helpers/defineProperty":193,"@babel/runtime/helpers/interopRequireDefault":199},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var o=n(e("@babel/runtime/helpers/defineProperty"));function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){(0,o.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var a={methodNames:[e("../../../../../shared/constants/app").MESSAGE_TYPE.GET_PROVIDER_STATE],implementation:async function(e,t,r,n,{getProviderState:o}){return t.result=s({},await o(e.origin)),n()},hookNames:{getProviderState:!0}};r.default=a}}},{package:"$root$"}],[71,{"./add-ethereum-chain":68,"./eth-accounts":69,"./get-provider-state":70,"./log-web3-shim-usage":72,"./request-accounts":73,"./send-metadata":74,"./switch-ethereum-chain":75,"./watch-asset":76,"@babel/runtime/helpers/interopRequireDefault":199},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var o=n(e("./add-ethereum-chain")),i=n(e("./eth-accounts")),s=n(e("./get-provider-state")),a=n(e("./log-web3-shim-usage")),c=n(e("./request-accounts")),l=n(e("./send-metadata")),u=n(e("./switch-ethereum-chain")),d=n(e("./watch-asset"));var p=[o.default,i.default,s.default,a.default,c.default,l.default,u.default,d.default];r.default=p}}},{package:"$root$"}],[72,{"../../../../../shared/constants/app":6105,"../../../../../shared/constants/metametrics":6109},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("../../../../../shared/constants/app"),o=e("../../../../../shared/constants/metametrics");var i={methodNames:[n.MESSAGE_TYPE.LOG_WEB3_SHIM_USAGE],implementation:function(e,t,r,n,{sendMetrics:i,getWeb3ShimUsageState:s,setWeb3ShimUsageRecorded:a}){const{origin:c}=e;s(c)===undefined&&(a(c),i({event:"Website Accessed window.web3 Shim",category:o.EVENT.CATEGORIES.INPAGE_PROVIDER,referrer:{url:c}},{excludeMetaMetricsId:!0}));return t.result=!0,n()},hookNames:{sendMetrics:!0,getWeb3ShimUsageState:!0,setWeb3ShimUsageRecorded:!0}};r.default=i}}},{package:"$root$"}],[73,{"../../../../../shared/constants/app":6105,"eth-rpc-errors":2371},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("eth-rpc-errors"),o=e("../../../../../shared/constants/app");var i={methodNames:[o.MESSAGE_TYPE.ETH_REQUEST_ACCOUNTS],implementation:async function(e,t,r,i,{origin:a,getAccounts:c,getUnlockPromise:l,hasPermission:u,requestAccountsPermission:d}){if(s.has(a))return t.error=n.ethErrors.rpc.resourceUnavailable(`Already processing ${o.MESSAGE_TYPE.ETH_REQUEST_ACCOUNTS}. Please wait.`),i();if(u(o.MESSAGE_TYPE.ETH_ACCOUNTS)){try{s.add(a),await l(!0),t.result=await c(),i()}catch(e){i(e)}finally{s.delete(a)}return undefined}try{await d()}catch(e){return t.error=e,i()}const p=await c();p.length>0?t.result=p:t.error=n.ethErrors.rpc.internal("Accounts unexpectedly unavailable. Please report this bug.");return i()},hookNames:{origin:!0,getAccounts:!0,getUnlockPromise:!0,hasPermission:!0,requestAccountsPermission:!0}};r.default=i;const s=new Set}}},{package:"$root$"}],[74,{"../../../../../shared/constants/app":6105,"@babel/runtime/helpers/defineProperty":193,"@babel/runtime/helpers/interopRequireDefault":199,"@babel/runtime/helpers/objectWithoutProperties":208,"eth-rpc-errors":2371},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var o=n(e("@babel/runtime/helpers/defineProperty")),i=n(e("@babel/runtime/helpers/objectWithoutProperties")),s=e("eth-rpc-errors"),a=e("../../../../../shared/constants/app");const c=["icon","name"];function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){(0,o.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var d={methodNames:[a.MESSAGE_TYPE.SEND_METADATA],implementation:function(e,t,r,n,{addSubjectMetadata:o,subjectType:a}){const{origin:l,params:d}=e;if(!d||"object"!=typeof d||Array.isArray(d))return n(s.ethErrors.rpc.invalidParams({data:d}));{const{icon:e=null,name:t=null}=d,r=(0,i.default)(d,c);o(u(u({},r),{},{iconUrl:e,name:t,subjectType:a,origin:l}))}return t.result=!0,n()},hookNames:{addSubjectMetadata:!0,subjectType:!0}};r.default=d}}},{package:"$root$"}],[75,{"../../../../../shared/constants/app":6105,"../../../../../shared/constants/network":6110,"../../../../../shared/modules/network.utils":6121,"eth-rpc-errors":2371,lodash:5091},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("eth-rpc-errors"),o=e("lodash"),i=e("../../../../../shared/constants/app"),s=e("../../../../../shared/constants/network"),a=e("../../../../../shared/modules/network.utils");var c={methodNames:[i.MESSAGE_TYPE.SWITCH_ETHEREUM_CHAIN],implementation:async function(e,t,r,c,{getCurrentChainId:l,findCustomRpcBy:u,setProviderType:d,updateRpcTarget:p,requestUserApproval:h}){var f;if(null===(f=e.params)||void 0===f||!f[0]||"object"!=typeof e.params[0])return c(n.ethErrors.rpc.invalidParams({message:`Expected single, object parameter. Received:\n${JSON.stringify(e.params)}`}));const{origin:g}=e,{chainId:m}=e.params[0],b=Object.keys((0,o.omit)(e.params[0],["chainId"]));if(b.length>0)return c(n.ethErrors.rpc.invalidParams({message:`Received unexpected keys on object parameter. Unsupported keys:\n${b}`}));const y="string"==typeof m&&m.toLowerCase();if(!(0,a.isPrefixedFormattedHexString)(y))return c(n.ethErrors.rpc.invalidParams({message:`Expected 0x-prefixed, unpadded, non-zero hexadecimal string 'chainId'. Received:\n${m}`}));if(!(0,a.isSafeChainId)(parseInt(y,16)))return c(n.ethErrors.rpc.invalidParams({message:`Invalid chain ID "${y}": numerical value greater than max safe value. Received:\n${m}`}));const E=function(e,t){if(e in s.CHAIN_ID_TO_TYPE_MAP)return{chainId:e,ticker:s.ETH_SYMBOL,nickname:s.NETWORK_TO_NAME_MAP[e],rpcUrl:s.CHAIN_ID_TO_RPC_URL_MAP[e],type:s.CHAIN_ID_TO_TYPE_MAP[e]};return t({chainId:e})}(y,u);if(E){if(l()===y)return t.result=null,c();try{const e=await h({origin:g,type:i.MESSAGE_TYPE.SWITCH_ETHEREUM_CHAIN,requestData:E});m in s.CHAIN_ID_TO_TYPE_MAP?d(e.type):await p(e),t.result=null}catch(e){return c(e)}return c()}return c(n.ethErrors.provider.custom({code:4902,message:`Unrecognized chain ID "${m}". Try adding the chain using ${i.MESSAGE_TYPE.ADD_ETHEREUM_CHAIN} first.`}))},hookNames:{getCurrentChainId:!0,findCustomRpcBy:!0,setProviderType:!0,updateRpcTarget:!0,requestUserApproval:!0}};r.default=c}}},{package:"$root$"}],[76,{"../../../../../shared/constants/app":6105,"eth-rpc-errors":2371},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("eth-rpc-errors"),o=e("../../../../../shared/constants/app");var i={methodNames:[o.MESSAGE_TYPE.WATCH_ASSET,o.MESSAGE_TYPE.WATCH_ASSET_LEGACY],implementation:async function(e,t,r,o,{handleWatchAssetRequest:i}){try{const{options:r,type:n}=e.params,s=await i(r,n);return await s.result,t.result=!0,o()}catch(e){return"User rejected to watch the asset."===e.message?o(n.ethErrors.provider.userRejectedRequest()):o(e)}},hookNames:{handleWatchAssetRequest:!0}};r.default=i}}},{package:"$root$"}],[77,{"./createMethodMiddleware":67},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0});var n=e("./createMethodMiddleware");Object.keys(n).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in r&&r[e]===n[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return n[e]}}))}))}}},{package:"$root$"}],[78,{"@babel/runtime/helpers/interopRequireDefault":199,"eth-keyring-controller":2357,loglevel:5104},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var o=n(e("eth-keyring-controller")),i=n(e("loglevel"));var s={async verifyAccounts(e,t){if(!e||e.length<1)throw new Error("No created accounts defined.");const r=new(new o.default({}).getKeyringClassForType("HD Key Tree"))({mnemonic:t,numberOfAccounts:e.length}),n=await r.getAccounts();if(i.default.debug(`Created accounts: ${JSON.stringify(e)}`),i.default.debug(`Restored accounts: ${JSON.stringify(n)}`),n.length!==e.length)throw new Error("Wrong number of accounts");for(let t=0;t<n.length;t++)if(n[t].toLowerCase()!==e[t].toLowerCase())throw new Error(`Not identical accounts! Original: ${e[t]}, Restored: ${n[t]}`)}};r.default=s}}},{package:"$root$"}],[79,{"../../../shared/constants/time":6113,"@babel/runtime/helpers/interopRequireDefault":199,_process:5342,"analytics-node":1592},function(){with(this)return function(){"use strict";return function(e,t,r){(function(t){(function(){var n=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.segment=r.createSegmentMock=void 0;var o,i,s=n(e("analytics-node")),a=e("../../../shared/constants/time");const c=null!==(o="XdGJ17zKf3NjBPCDQ2UDjJjkx6FYBMGP")?o:null,l=null!==(i=t.env.SEGMENT_HOST)&&void 0!==i?i:null,u=undefined,d=5*a.SECOND,p=(e=u)=>{const t={queue:[],flush(){t.queue.forEach((([e,t])=>{t()})),t.queue=[]},track(r,n=(()=>undefined)){t.queue.push([r,n]),t.queue.length>=e&&t.flush()},page(){},identify(){}};return t};r.createSegmentMock=p;const h=c?new s.default(c,{host:l,flushAt:u,flushInterval:d}):p(u);r.segment=h}).call(this)}).call(this,e("_process"))}}},{package:"$root$"}],[8,{"@babel/runtime/helpers/defineProperty":193,"@babel/runtime/helpers/interopRequireDefault":199,"@metamask/obs-store":1197},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var o=n(e("@babel/runtime/helpers/defineProperty")),i=e("@metamask/obs-store");function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function a(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach((function(t){(0,o.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}r.default=class{constructor(e={}){const{accountTracker:t,getCurrentChainId:r}=e;this.accountTracker=t,this.getCurrentChainId=r;const n=a({cachedBalances:{}},e.initState);this.store=new i.ObservableStore(n),this._registerUpdates()}async updateCachedBalances({accounts:e}){const t=this.getCurrentChainId(),r=await this._generateBalancesToCache(e,t);this.store.updateState({cachedBalances:r})}_generateBalancesToCache(e,t){const{cachedBalances:r}=this.store.getState(),n=a({},r[t]);Object.keys(e).forEach((t=>{const r=e[t];r.balance&&(n[t]=r.balance)}));return a(a({},r),{},{[t]:n})}clearCachedBalances(){this.store.updateState({cachedBalances:{}})}_registerUpdates(){const e=this.updateCachedBalances.bind(this);this.accountTracker.store.subscribe(e)}}}}},{package:"$root$"}],[82,{"../../../shared/constants/app":6105,"../../../shared/constants/metametrics":6109,"../../../shared/modules/hexstring-utils":6120,"../../../shared/modules/random-id":6122,"../metamask-controller":84,"@babel/runtime/helpers/interopRequireDefault":199,"@metamask/obs-store":1197,assert:1615,"eth-rpc-errors":2371,"eth-sig-util":2373,events:1997,jsonschema:4654,loglevel:5104},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var o=n(e("events")),i=e("assert"),s=e("@metamask/obs-store"),a=e("eth-rpc-errors"),c=e("eth-sig-util"),l=n(e("loglevel")),u=n(e("jsonschema")),d=e("../../../shared/constants/app"),p=e("../metamask-controller"),h=n(e("../../../shared/modules/random-id")),f=e("../../../shared/constants/metametrics"),g=e("../../../shared/modules/hexstring-utils");class m extends o.default{constructor({getCurrentChainId:e,metricsEvent:t}){super(),this._getCurrentChainId=e,this.memStore=new s.ObservableStore({unapprovedTypedMessages:{},unapprovedTypedMessagesCount:0}),this.messages=[],this.metricsEvent=t}get unapprovedTypedMessagesCount(){return Object.keys(this.getUnapprovedMsgs()).length}getUnapprovedMsgs(){return this.messages.filter((e=>"unapproved"===e.status)).reduce(((e,t)=>(e[t.id]=t,e)),{})}addUnapprovedMessageAsync(e,t,r){return new Promise(((n,o)=>{const i=this.addUnapprovedMessage(e,t,r);this.once(`${i}:finished`,(t=>{switch(t.status){case"signed":return n(t.rawSig);case"rejected":return o(a.ethErrors.provider.userRejectedRequest("MetaMask Message Signature: User denied message signature."));case"errored":return o(new Error(`MetaMask Message Signature: ${t.error}`));default:return o(new Error(`MetaMask Message Signature: Unknown problem: ${JSON.stringify(e)}`))}}))}))}addUnapprovedMessage(e,t,r){e.version=r,t&&(e.origin=t.origin),this.validateParams(e),l.default.debug(`TypedMessageManager addUnapprovedMessage: ${JSON.stringify(e)}`);const n=(new Date).getTime(),o=(0,h.default)(),i={id:o,msgParams:e,time:n,status:"unapproved",type:d.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA};return this.addMsg(i),this.emit("update"),o}validateParams(e){switch(i.strict.ok(e&&"object"==typeof e,"Params must be an object."),i.strict.ok("data"in e,'Params must include a "data" field.'),i.strict.ok("from"in e,'Params must include a "from" field.'),i.strict.ok("string"==typeof e.from&&(0,g.isValidHexAddress)(e.from,{allowNonPrefixed:!1}),'"from" field must be a valid, lowercase, hexadecimal Ethereum address string.'),e.version){case"V1":i.strict.ok(Array.isArray(e.data),'"params.data" must be an array.'),i.strict.doesNotThrow((()=>{(0,c.typedSignatureHash)(e.data)}),"Signing data must be valid EIP-712 typed data.");break;case"V3":case"V4":{let t;i.strict.equal(typeof e.data,"string",'"params.data" must be a string.'),i.strict.doesNotThrow((()=>{t=JSON.parse(e.data)}),'"data" must be a valid JSON string.');const r=u.default.validate(t,c.TYPED_MESSAGE_SCHEMA);if(i.strict.ok(t.primaryType in t.types,`Primary type of "${t.primaryType}" has no type definition.`),0!==r.errors.length)throw a.ethErrors.rpc.invalidParams({message:"Signing data must conform to EIP-712 schema. See https://git.io/fNtcx.",data:r.errors.map((e=>e.message.toString()))});let{chainId:n}=t.domain;if(n){const e=parseInt(this._getCurrentChainId(),16);i.strict.ok(!Number.isNaN(e),`Cannot sign messages for chainId "${n}", because MetaMask is switching networks.`),"string"==typeof n&&(n=parseInt(n,n.startsWith("0x")?16:10)),i.strict.equal(n,e,`Provided chainId "${n}" must match the active chainId "${e}"`)}break}default:i.strict.fail(`Unknown typed data version "${e.version}"`)}}addMsg(e){this.messages.push(e),this._saveMsgList()}getMsg(e){return this.messages.find((t=>t.id===e))}approveMessage(e){return this.setMsgStatusApproved(e.metamaskId),this.prepMsgForSigning(e)}setMsgStatusApproved(e){this._setMsgStatus(e,"approved")}setMsgStatusSigned(e,t){const r=this.getMsg(e);r.rawSig=t,this._updateMsg(r),this._setMsgStatus(e,"signed")}prepMsgForSigning(e){return delete e.metamaskId,delete e.version,Promise.resolve(e)}rejectMsg(e,t=undefined){if(t){const r=this.getMsg(e);this.metricsEvent({event:t,category:f.EVENT.CATEGORIES.TRANSACTIONS,properties:{action:"Sign Request",version:r.msgParams.version,type:r.type}})}this._setMsgStatus(e,"rejected")}errorMessage(e,t){const r=this.getMsg(e);r.error=t,this._updateMsg(r),this._setMsgStatus(e,"errored")}clearUnapproved(){this.messages=this.messages.filter((e=>"unapproved"!==e.status)),this._saveMsgList()}_setMsgStatus(e,t){const r=this.getMsg(e);if(!r)throw new Error(`TypedMessageManager - Message not found for id: "${e}".`);r.status=t,this._updateMsg(r),this.emit(`${e}:${t}`,r),"rejected"!==t&&"signed"!==t&&"errored"!==t||this.emit(`${e}:finished`,r)}_updateMsg(e){const t=this.messages.findIndex((t=>t.id===e.id));-1!==t&&(this.messages[t]=e),this._saveMsgList()}_saveMsgList(){const e=this.getUnapprovedMsgs(),t=Object.keys(e).length;this.memStore.updateState({unapprovedTypedMessages:e,unapprovedTypedMessagesCount:t}),this.emit(p.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE)}}r.default=m}}},{package:"$root$"}],[84,{"../../shared/constants/app":6105,"../../shared/constants/hardware-wallets":6107,"../../shared/constants/metametrics":6109,"../../shared/constants/network":6110,"../../shared/constants/permissions":6111,"../../shared/constants/swaps":6112,"../../shared/constants/time":6113,"../../shared/constants/transaction":6114,"../../shared/modules/hexstring-utils":6120,"../../shared/modules/string-utils":6124,"../../shared/modules/transaction.utils":6126,"../../shared/notifications":6127,"../../ui/helpers/utils/conversions.util":6651,"../../ui/helpers/utils/token-util":6666,"./account-import-strategies":2,"./controllers/alert":6,"./controllers/app-state":7,"./controllers/cached-balances":8,"./controllers/detect-tokens":9,"./controllers/ens":11,"./controllers/incoming-transactions":12,"./controllers/metametrics":13,"./controllers/network":17,"./controllers/onboarding":21,"./controllers/permissions":25,"./controllers/preferences":29,"./controllers/swaps":30,"./controllers/threebox":31,"./controllers/transactions":32,"./detect-multiple-instances":38,"./lib/ComposableObservableStore":40,"./lib/account-tracker":41,"./lib/createLoggerMiddleware":44,"./lib/createMetaRPCHandler":45,"./lib/createOnboardingMiddleware":46,"./lib/createOriginMiddleware":47,"./lib/createRPCMethodTrackingMiddleware":48,"./lib/createTabIdMiddleware":50,"./lib/decrypt-message-manager":51,"./lib/encryption-public-key-manager":52,"./lib/message-manager":61,"./lib/personal-message-manager":66,"./lib/rpc-method-middleware":77,"./lib/seed-phrase-verifier":78,"./lib/segment":79,"./lib/stream-utils":81,"./lib/typed-message-manager":82,"@babel/runtime/helpers/defineProperty":193,"@babel/runtime/helpers/interopRequireDefault":199,"@keystonehq/metamask-airgapped-keyring":576,"@metamask/controllers":1047,"@metamask/eth-ledger-bridge-keyring":1097,"@metamask/obs-store":1197,"@metamask/obs-store/dist/asStream":1196,"@metamask/smart-transactions-controller":1236,"@sentry/browser":1395,_process:5342,"await-semaphore":1696,buffer:1996,"eth-json-rpc-filters":2297,"eth-json-rpc-filters/subscriptionManager":2303,"eth-json-rpc-middleware":2321,"eth-keyring-controller":2357,"eth-lattice-keyring":2358,"eth-query":2367,"eth-rpc-errors":2371,"eth-trezor-keyring":2395,"ethereumjs-util":2437,events:1997,"json-rpc-engine":4641,"json-rpc-middleware-stream/engineStream":4643,lodash:5091,loglevel:5104,nanoid:5179,pump:5441},function(){with(this)return function(){"use strict";return function(e,t,r){(function(t,n){(function(){var o=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=r.METAMASK_CONTROLLER_EVENTS=void 0;var i=o(e("@babel/runtime/helpers/defineProperty")),s=o(e("events")),a=o(e("pump")),c=e("@metamask/obs-store"),l=e("@metamask/obs-store/dist/asStream"),u=e("json-rpc-engine"),d=e("lodash"),p=o(e("json-rpc-middleware-stream/engineStream")),h=o(e("eth-json-rpc-filters")),f=o(e("eth-json-rpc-filters/subscriptionManager")),g=e("eth-json-rpc-middleware"),m=o(e("eth-keyring-controller")),b=e("eth-rpc-errors"),y=e("await-semaphore"),E=e("ethereumjs-util"),v=o(e("loglevel")),w=o(e("eth-trezor-keyring")),S=o(e("@metamask/eth-ledger-bridge-keyring")),C=o(e("eth-lattice-keyring")),_=e("@keystonehq/metamask-airgapped-keyring"),T=o(e("eth-query")),k=o(e("nanoid")),M=e("@sentry/browser"),O=e("@metamask/controllers"),P=o(e("@metamask/smart-transactions-controller")),R=e("../../shared/constants/transaction"),A=e("../../shared/constants/swaps"),I=e("../../shared/constants/network"),N=e("../../shared/constants/hardware-wallets"),D=e("../../shared/constants/permissions"),U=e("../../shared/notifications"),x=e("../../shared/modules/hexstring-utils"),L=e("../../shared/constants/time"),j=e("../../shared/constants/app"),B=e("../../shared/constants/metametrics"),F=e("../../ui/helpers/utils/conversions.util"),z=e("../../ui/helpers/utils/token-util"),G=e("../../shared/modules/string-utils"),q=e("../../shared/modules/transaction.utils"),W=e("./detect-multiple-instances"),H=o(e("./lib/ComposableObservableStore")),V=o(e("./lib/account-tracker")),Q=o(e("./lib/createLoggerMiddleware")),K=e("./lib/rpc-method-middleware"),$=o(e("./lib/createOriginMiddleware")),Y=o(e("./lib/createTabIdMiddleware")),J=o(e("./lib/createOnboardingMiddleware")),Z=e("./lib/stream-utils"),X=o(e("./controllers/ens")),ee=_e(e("./controllers/network")),te=o(e("./controllers/preferences")),re=o(e("./controllers/app-state")),ne=o(e("./controllers/cached-balances")),oe=o(e("./controllers/alert")),ie=o(e("./controllers/onboarding")),se=o(e("./controllers/threebox")),ae=o(e("./controllers/incoming-transactions")),ce=_e(e("./lib/message-manager")),le=o(e("./lib/decrypt-message-manager")),ue=o(e("./lib/encryption-public-key-manager")),de=o(e("./lib/personal-message-manager")),pe=o(e("./lib/typed-message-manager")),he=o(e("./controllers/transactions")),fe=o(e("./controllers/detect-tokens")),ge=o(e("./controllers/swaps")),me=o(e("./account-import-strategies")),be=o(e("./lib/seed-phrase-verifier")),ye=o(e("./controllers/metametrics")),Ee=e("./lib/segment"),ve=o(e("./lib/createMetaRPCHandler")),we=e("./controllers/permissions"),Se=o(e("./lib/createRPCMethodTrackingMiddleware"));function Ce(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(Ce=function(e){return e?r:t})(e)}function _e(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=Ce(t);if(r&&r.has(e))return r.get(e);var n={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var s=o?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(n,i,s):n[i]=e[i]}return n.default=e,r&&r.set(e,n),n}function Te(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ke(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Te(Object(r),!0).forEach((function(t){(0,i.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Te(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}r.METAMASK_CONTROLLER_EVENTS={UPDATE_BADGE:"updateBadge",APPROVAL_STATE_CHANGE:"ApprovalController:stateChange"};class Me extends s.default{constructor(e){var r;super(),this.defaultMaxListeners=20,this.sendUpdate=(0,d.debounce)(this.privateSendUpdate.bind(this),200*L.MILLISECOND),this.opts=e,this.extension=e.browser,this.platform=e.platform,this.notificationManager=e.notificationManager;const n=e.initState||{},o=this.platform.getVersion();this.recordFirstTimeInfo(n),this.activeControllerConnections=0,this.getRequestAccountTabIds=e.getRequestAccountTabIds,this.getOpenMetamaskTabsIds=e.getOpenMetamaskTabsIds,this.controllerMessenger=new O.ControllerMessenger,this.store=new H.default({state:n,controllerMessenger:this.controllerMessenger,persist:!0}),this.connections={},this.createVaultMutex=new y.Mutex,this.extension.runtime.onInstalled.addListener((e=>{"update"===e.reason&&"8.1.0"===o&&this.platform.openExtensionInBrowser()})),this.approvalController=new O.ApprovalController({messenger:this.controllerMessenger.getRestricted({name:"ApprovalController"}),showApprovalRequest:e.showUserConfirmation}),this.networkController=new ee.default(n.NetworkController),this.networkController.setInfuraProjectId(e.infuraProjectId),this.initializeProvider(),this.provider=this.networkController.getProviderAndBlockTracker().provider,this.blockTracker=this.networkController.getProviderAndBlockTracker().blockTracker,this.preferencesController=new te.default({initState:n.PreferencesController,initLangCode:e.initLangCode,openPopup:e.openPopup,network:this.networkController,provider:this.provider,migrateAddressBookState:this.migrateAddressBookState.bind(this)}),this.tokensController=new O.TokensController({onPreferencesStateChange:this.preferencesController.store.subscribe.bind(this.preferencesController.store),onNetworkStateChange:this.networkController.store.subscribe.bind(this.networkController.store),config:{provider:this.provider},state:n.TokensController}),this.assetsContractController=new O.AssetsContractController({onPreferencesStateChange:e=>this.preferencesController.store.subscribe(e)},{provider:this.provider}),this.collectiblesController=new O.CollectiblesController({onPreferencesStateChange:this.preferencesController.store.subscribe.bind(this.preferencesController.store),onNetworkStateChange:this.networkController.store.subscribe.bind(this.networkController.store),getERC721AssetName:this.assetsContractController.getERC721AssetName.bind(this.assetsContractController),getERC721AssetSymbol:this.assetsContractController.getERC721AssetSymbol.bind(this.assetsContractController),getERC721TokenURI:this.assetsContractController.getERC721TokenURI.bind(this.assetsContractController),getERC721OwnerOf:this.assetsContractController.getERC721OwnerOf.bind(this.assetsContractController),getERC1155BalanceOf:this.assetsContractController.getERC1155BalanceOf.bind(this.assetsContractController),getERC1155TokenURI:this.assetsContractController.getERC1155TokenURI.bind(this.assetsContractController)},{},n.CollectiblesController),this.collectiblesController.setApiKey(t.env.OPENSEA_KEY),this.metaMetricsController=new ye.default({segment:Ee.segment,preferencesStore:this.preferencesController.store,onNetworkDidChange:this.networkController.on.bind(this.networkController,ee.NETWORK_EVENTS.NETWORK_DID_CHANGE),getNetworkIdentifier:this.networkController.getNetworkIdentifier.bind(this.networkController),getCurrentChainId:this.networkController.getCurrentChainId.bind(this.networkController),version:this.platform.getVersion(),environment:"production",initState:n.MetaMetricsController,captureException:M.captureException}),this.on("update",(e=>{this.metaMetricsController.handleMetaMaskStateUpdate(e)}));const i=this.controllerMessenger.getRestricted({name:"GasFeeController"}),s=A.GAS_API_BASE_URL;this.gasFeeController=new O.GasFeeController({interval:1e4,messenger:i,clientId:A.SWAPS_CLIENT_ID,getProvider:()=>this.networkController.getProviderAndBlockTracker().provider,onNetworkStateChange:this.networkController.on.bind(this.networkController,ee.NETWORK_EVENTS.NETWORK_DID_CHANGE),getCurrentNetworkEIP1559Compatibility:this.networkController.getEIP1559Compatibility.bind(this.networkController),getCurrentAccountEIP1559Compatibility:this.getCurrentAccountEIP1559Compatibility.bind(this),legacyAPIEndpoint:`${s}/networks/<chain_id>/gasPrices`,EIP1559APIEndpoint:`${s}/networks/<chain_id>/suggestedGasFees`,getCurrentNetworkLegacyGasAPICompatibility:()=>{const e=this.networkController.getCurrentChainId();return t.env.IN_TEST||e===I.MAINNET_CHAIN_ID},getChainId:()=>t.env.IN_TEST?I.MAINNET_CHAIN_ID:this.networkController.getCurrentChainId()}),this.qrHardwareKeyring=new _.MetaMaskKeyring,this.appStateController=new re.default({addUnlockListener:this.on.bind(this,"unlock"),isUnlocked:this.isUnlocked.bind(this),initState:n.AppStateController,onInactiveTimeout:()=>this.setLocked(),showUnlockRequest:e.showUserConfirmation,preferencesStore:this.preferencesController.store,qrHardwareStore:this.qrHardwareKeyring.getMemStore()});const a=this.controllerMessenger.getRestricted({name:"CurrencyRateController"});this.currencyRateController=new O.CurrencyRateController({includeUSDRate:!0,messenger:a,state:ke(ke({},n.CurrencyController),{},{nativeCurrency:this.networkController.providerStore.getState().ticker})});const c=this.controllerMessenger.getRestricted({name:"TokenListController"});this.tokenListController=new O.TokenListController({chainId:(0,F.hexToDecimal)(this.networkController.getCurrentChainId()),useStaticTokenList:!this.preferencesController.store.getState().useTokenDetection,onNetworkStateChange:e=>this.networkController.store.subscribe((t=>{const r=ke(ke({},t),{},{provider:ke(ke({},t.provider),{},{chainId:(0,F.hexToDecimal)(t.provider.chainId)})});return e(r)})),onPreferencesStateChange:e=>this.preferencesController.store.subscribe((t=>{const r=ke(ke({},t),{},{useStaticTokenList:!this.preferencesController.store.getState().useTokenDetection});return e(r)})),messenger:c,state:n.TokenListController}),this.phishingController=new O.PhishingController,this.announcementController=new O.AnnouncementController({allAnnouncements:U.UI_NOTIFICATIONS},n.AnnouncementController),this.tokenRatesController=new O.TokenRatesController({onTokensStateChange:e=>this.tokensController.subscribe(e),onCurrencyRateStateChange:e=>this.controllerMessenger.subscribe(`${this.currencyRateController.name}:stateChange`,e),onNetworkStateChange:e=>this.networkController.store.subscribe((t=>{const r=ke(ke({},t),{},{provider:ke(ke({},t.provider),{},{chainId:(0,F.hexToDecimal)(t.provider.chainId)})});return e(r)}))}),this.ensController=new X.default({provider:this.provider,getCurrentChainId:this.networkController.getCurrentChainId.bind(this.networkController),onNetworkDidChange:this.networkController.on.bind(this.networkController,ee.NETWORK_EVENTS.NETWORK_DID_CHANGE)}),this.incomingTransactionsController=new ae.default({blockTracker:this.blockTracker,onNetworkDidChange:this.networkController.on.bind(this.networkController,ee.NETWORK_EVENTS.NETWORK_DID_CHANGE),getCurrentChainId:this.networkController.getCurrentChainId.bind(this.networkController),preferencesController:this.preferencesController,initState:n.IncomingTransactionsController}),this.accountTracker=new V.default({provider:this.provider,blockTracker:this.blockTracker,getCurrentChainId:this.networkController.getCurrentChainId.bind(this.networkController)}),this.on("controllerConnectionChanged",(e=>{e>0?(this.accountTracker.start(),this.incomingTransactionsController.start(),this.currencyRateController.start(),this.tokenListController.start()):(this.accountTracker.stop(),this.incomingTransactionsController.stop(),this.currencyRateController.stop(),this.tokenListController.stop())})),this.cachedBalancesController=new ne.default({accountTracker:this.accountTracker,getCurrentChainId:this.networkController.getCurrentChainId.bind(this.networkController),initState:n.CachedBalancesController}),this.onboardingController=new ie.default({initState:n.OnboardingController}),this.tokensController.hub.on("pendingSuggestedAsset",(async()=>{await e.openPopup()}));const l=[w.default,S.default,C.default,_.MetaMaskKeyring];this.keyringController=new m.default({keyringTypes:l,initState:n.KeyringController,encryptor:e.encryptor||undefined}),this.keyringController.memStore.subscribe((e=>this._onKeyringControllerUpdate(e))),this.keyringController.on("unlock",(()=>this._onUnlock())),this.keyringController.on("lock",(()=>this._onLock()));const u=()=>this.preferencesController.store.getState().identities;this.permissionController=new O.PermissionController({messenger:this.controllerMessenger.getRestricted({name:"PermissionController",allowedActions:[`${this.approvalController.name}:addRequest`,`${this.approvalController.name}:hasRequest`,`${this.approvalController.name}:acceptRequest`,`${this.approvalController.name}:rejectRequest`]}),state:n.PermissionController,caveatSpecifications:(0,we.getCaveatSpecifications)({getIdentities:u}),permissionSpecifications:ke({},(0,we.getPermissionSpecifications)({getIdentities:u,getAllAccounts:this.keyringController.getAccounts.bind(this.keyringController),captureKeyringTypesWithMissingIdentities:(e={},t=[])=>{const r=t.filter((t=>!e[t])).map((e=>{var t;return null===(t=this.keyringController.getKeyringForAccount(e))||void 0===t?void 0:t.type})),n=Object.keys(e||{}).length,o=Object.keys(this.accountTracker.store.getState().accounts||{}).length;(0,M.captureException)(new Error(`Attempt to get permission specifications failed because their were ${t.length} accounts, but ${n} identities, and the ${r} keyrings included accounts with missing identities. Meanwhile, there are ${o} accounts in the account tracker.`))}})),unrestrictedMethods:we.unrestrictedMethods}),this.permissionLogController=new we.PermissionLogController({restrictedMethods:new Set(Object.keys(D.RestrictedMethods)),initState:n.PermissionLogController}),this.subjectMetadataController=new O.SubjectMetadataController({messenger:this.controllerMessenger.getRestricted({name:"SubjectMetadataController",allowedActions:[`${this.permissionController.name}:hasPermissions`]}),state:n.SubjectMetadataController,subjectCacheLimit:100}),this.detectTokensController=new fe.default({preferences:this.preferencesController,tokensController:this.tokensController,network:this.networkController,keyringMemStore:this.keyringController.memStore,tokenList:this.tokenListController}),this.addressBookController=new O.AddressBookController(undefined,n.AddressBookController),this.alertController=new oe.default({initState:n.AlertController,preferencesStore:this.preferencesController.store}),this.threeBoxController=new se.default({preferencesController:this.preferencesController,addressBookController:this.addressBookController,keyringController:this.keyringController,initState:n.ThreeBoxController,getKeyringControllerState:this.keyringController.memStore.getState.bind(this.keyringController.memStore),version:o,trackMetaMetricsEvent:this.metaMetricsController.trackEvent.bind(this.metaMetricsController)}),this.txController=new he.default({initState:n.TransactionController||n.TransactionManager,getPermittedAccounts:this.getPermittedAccounts.bind(this),getProviderConfig:this.networkController.getProviderConfig.bind(this.networkController),getCurrentNetworkEIP1559Compatibility:this.networkController.getEIP1559Compatibility.bind(this.networkController),getCurrentAccountEIP1559Compatibility:this.getCurrentAccountEIP1559Compatibility.bind(this),networkStore:this.networkController.networkStore,getCurrentChainId:this.networkController.getCurrentChainId.bind(this.networkController),preferencesStore:this.preferencesController.store,txHistoryLimit:60,signTransaction:this.keyringController.signTransaction.bind(this.keyringController),provider:this.provider,blockTracker:this.blockTracker,createEventFragment:this.metaMetricsController.createEventFragment.bind(this.metaMetricsController),updateEventFragment:this.metaMetricsController.updateEventFragment.bind(this.metaMetricsController),finalizeEventFragment:this.metaMetricsController.finalizeEventFragment.bind(this.metaMetricsController),getEventFragmentById:this.metaMetricsController.getEventFragmentById.bind(this.metaMetricsController),trackMetaMetricsEvent:this.metaMetricsController.trackEvent.bind(this.metaMetricsController),getParticipateInMetrics:()=>this.metaMetricsController.state.participateInMetaMetrics,getEIP1559GasFeeEstimates:this.gasFeeController.fetchGasFeeEstimates.bind(this.gasFeeController),getExternalPendingTransactions:this.getExternalPendingTransactions.bind(this),getAccountType:this.getAccountType.bind(this),getDeviceModel:this.getDeviceModel.bind(this),getTokenStandardAndDetails:this.assetsContractController.getTokenStandardAndDetails.bind(this.assetsContractController)}),this.txController.on("newUnapprovedTx",(()=>e.showUserConfirmation())),this.txController.on("tx:status-update",(async(e,t)=>{if(t===R.TRANSACTION_STATUSES.CONFIRMED||t===R.TRANSACTION_STATUSES.FAILED){const t=this.txController.txStateManager.getTransaction(e),i=this.preferencesController.getFrequentRpcListDetail();let s={};if(t.chainId){var r;const e=i.find((e=>t.chainId===e.chainId));s=null!==(r=null==e?void 0:e.rpcPrefs)&&void 0!==r?r:{}}this.platform.showTransactionNotification(t,s);const{txReceipt:a}=t;if(t.type===R.TRANSACTION_TYPES.TOKEN_METHOD_TRANSFER_FROM&&t.txParams!==undefined){var n;const{data:e,to:r,from:o}=t.txParams,{chainId:i}=t,s=(0,q.parseStandardTokenTransactionData)(e),a=(0,z.getTokenValueParam)(s),{allCollectibles:c}=this.collectiblesController.state,l=null==c||null===(n=c[o])||void 0===n?void 0:n[i].find((({address:e,tokenId:t})=>(0,G.isEqualCaseInsensitive)(e,r)&&t===a));l&&this.collectiblesController.checkAndUpdateSingleCollectibleOwnershipStatus(l,!1,{userAddress:o,chainId:i})}const c=await this.getState();var o;if(a&&"0x0"===a.status)this.metaMetricsController.trackEvent({event:"Tx Status Update: On-Chain Failure",category:B.EVENT.CATEGORIES.BACKGROUND,properties:{action:"Transactions",errorMessage:null===(o=t.simulationFails)||void 0===o?void 0:o.reason,numberOfTokens:c.tokens.length,numberOfAccounts:Object.keys(c.accounts).length}},{matomoEvent:!0})}})),this.networkController.on(ee.NETWORK_EVENTS.NETWORK_DID_CHANGE,(async()=>{const{ticker:e}=this.networkController.getProviderConfig();try{await this.currencyRateController.setNativeCurrency(e)}catch(e){console.error(e)}})),this.networkController.lookupNetwork(),this.messageManager=new ce.default({metricsEvent:this.metaMetricsController.trackEvent.bind(this.metaMetricsController)}),this.personalMessageManager=new de.default({metricsEvent:this.metaMetricsController.trackEvent.bind(this.metaMetricsController)}),this.decryptMessageManager=new le.default({metricsEvent:this.metaMetricsController.trackEvent.bind(this.metaMetricsController)}),this.encryptionPublicKeyManager=new ue.default({metricsEvent:this.metaMetricsController.trackEvent.bind(this.metaMetricsController)}),this.typedMessageManager=new pe.default({getCurrentChainId:this.networkController.getCurrentChainId.bind(this.networkController),metricsEvent:this.metaMetricsController.trackEvent.bind(this.metaMetricsController)}),this.swapsController=new ge.default({getBufferedGasLimit:this.txController.txGasUtil.getBufferedGasLimit.bind(this.txController.txGasUtil),networkController:this.networkController,provider:this.provider,getProviderConfig:this.networkController.getProviderConfig.bind(this.networkController),getTokenRatesState:()=>this.tokenRatesController.state,getCurrentChainId:this.networkController.getCurrentChainId.bind(this.networkController),getEIP1559GasFeeEstimates:this.gasFeeController.fetchGasFeeEstimates.bind(this.gasFeeController)}),this.smartTransactionsController=new P.default({onNetworkStateChange:this.networkController.store.subscribe.bind(this.networkController.store),getNetwork:this.networkController.getNetworkState.bind(this.networkController),getNonceLock:this.txController.nonceTracker.getNonceLock.bind(this.txController.nonceTracker),confirmExternalTransaction:this.txController.confirmExternalTransaction.bind(this.txController),provider:this.provider,trackMetaMetricsEvent:this.metaMetricsController.trackEvent.bind(this.metaMetricsController)},undefined,n.SmartTransactionsController),this.networkController.on(ee.NETWORK_EVENTS.NETWORK_DID_CHANGE,(()=>{this.accountTracker._updateAccounts()})),this.networkController.on(ee.NETWORK_EVENTS.NETWORK_WILL_CHANGE,(()=>{this.txController.txStateManager.clearUnapprovedTxs(),this.encryptionPublicKeyManager.clearUnapproved(),this.personalMessageManager.clearUnapproved(),this.typedMessageManager.clearUnapproved(),this.decryptMessageManager.clearUnapproved(),this.messageManager.clearUnapproved()})),this.on("update",(e=>this._onStateUpdate(e))),this.store.updateStructure({AppStateController:this.appStateController.store,TransactionController:this.txController.store,KeyringController:this.keyringController.store,PreferencesController:this.preferencesController.store,MetaMetricsController:this.metaMetricsController.store,AddressBookController:this.addressBookController,CurrencyController:this.currencyRateController,NetworkController:this.networkController.store,CachedBalancesController:this.cachedBalancesController.store,AlertController:this.alertController.store,OnboardingController:this.onboardingController.store,IncomingTransactionsController:this.incomingTransactionsController.store,PermissionController:this.permissionController,PermissionLogController:this.permissionLogController.store,SubjectMetadataController:this.subjectMetadataController,ThreeBoxController:this.threeBoxController.store,AnnouncementController:this.announcementController,GasFeeController:this.gasFeeController,TokenListController:this.tokenListController,TokensController:this.tokensController,SmartTransactionsController:this.smartTransactionsController,CollectiblesController:this.collectiblesController}),this.memStore=new H.default({config:{AppStateController:this.appStateController.store,NetworkController:this.networkController.store,AccountTracker:this.accountTracker.store,TxController:this.txController.memStore,CachedBalancesController:this.cachedBalancesController.store,TokenRatesController:this.tokenRatesController,MessageManager:this.messageManager.memStore,PersonalMessageManager:this.personalMessageManager.memStore,DecryptMessageManager:this.decryptMessageManager.memStore,EncryptionPublicKeyManager:this.encryptionPublicKeyManager.memStore,TypesMessageManager:this.typedMessageManager.memStore,KeyringController:this.keyringController.memStore,PreferencesController:this.preferencesController.store,MetaMetricsController:this.metaMetricsController.store,AddressBookController:this.addressBookController,CurrencyController:this.currencyRateController,AlertController:this.alertController.store,OnboardingController:this.onboardingController.store,IncomingTransactionsController:this.incomingTransactionsController.store,PermissionController:this.permissionController,PermissionLogController:this.permissionLogController.store,SubjectMetadataController:this.subjectMetadataController,ThreeBoxController:this.threeBoxController.store,SwapsController:this.swapsController.store,EnsController:this.ensController.store,ApprovalController:this.approvalController,AnnouncementController:this.announcementController,GasFeeController:this.gasFeeController,TokenListController:this.tokenListController,TokensController:this.tokensController,SmartTransactionsController:this.smartTransactionsController,CollectiblesController:this.collectiblesController},controllerMessenger:this.controllerMessenger}),this.memStore.subscribe(this.sendUpdate.bind(this));const p=null===(r={})||void 0===r?void 0:r.PASSWORD;p&&!this.isUnlocked()&&this.onboardingController.store.getState().completedOnboarding&&this.submitPassword(p),this.extension.runtime.getPlatformInfo().then((({os:e})=>{this.appStateController.setBrowserEnvironment(e,this.extension.runtime.getBrowserInfo===undefined?"chrome":"firefox")})),this.setupControllerEventSubscriptions(),this.publicConfigStore=this.createPublicConfigStore(),this.extension.runtime.onMessageExternal.addListener(W.onMessageReceived),(0,W.checkForMultipleVersionsRunning)()}setupControllerEventSubscriptions(){const e=async(e,t)=>{this.isUnlocked()&&this.notifyConnections(e,{method:we.NOTIFICATION_NAMES.accountsChanged,params:t.length<2?t:await this.getPermittedAccounts(e)}),this.permissionLogController.updateAccountsHistory(e,t)};let t;this.preferencesController.store.subscribe((async({selectedAddress:r})=>{if(r&&r!==t){t=r;const n=(0,we.getPermittedAccountsByOrigin)(this.permissionController.state);for(const[t,o]of n.entries())o.includes(r)&&e(t,o)}})),this.controllerMessenger.subscribe(`${this.permissionController.name}:stateChange`,(async(t,r)=>{const n=(0,we.getChangedAccounts)(t,r);for(const[t,r]of n.entries())e(t,r)}),we.getPermittedAccountsByOrigin)}initializeProvider(){const e=this.platform.getVersion(),t={static:{eth_syncing:!1,web3_clientVersion:`MetaMask/v${e}`},version:e,getAccounts:async({origin:e})=>{if(e===j.ORIGIN_METAMASK){const e=this.preferencesController.getSelectedAddress();return e?[e]:[]}return this.isUnlocked()?await this.getPermittedAccounts(e):[]},processTransaction:this.newUnapprovedTransaction.bind(this),processEthSignMessage:this.newUnsignedMessage.bind(this),processTypedMessage:this.newUnsignedTypedMessage.bind(this),processTypedMessageV3:this.newUnsignedTypedMessage.bind(this),processTypedMessageV4:this.newUnsignedTypedMessage.bind(this),processPersonalMessage:this.newUnsignedPersonalMessage.bind(this),processDecryptMessage:this.newRequestDecryptMessage.bind(this),processEncryptionPublicKey:this.newRequestEncryptionPublicKey.bind(this),getPendingNonce:this.getPendingNonce.bind(this),getPendingTransactionByHash:e=>this.txController.getTransactions({searchCriteria:{hash:e,status:R.TRANSACTION_STATUSES.SUBMITTED}})[0]};return this.networkController.initializeProvider(t)}createPublicConfigStore(){const e=new c.ObservableStore,{networkController:t}=this;function r(r){const n=t.getCurrentChainId();"loading"!==r.network&&e.putState(function(e,{isUnlocked:t,network:r}){return{isUnlocked:t,chainId:e,networkVersion:r}}(n,r))}return this.on("update",r),r(this.getState()),e}async getProviderState(e){return ke(ke({isUnlocked:this.isUnlocked()},this.getProviderNetworkState()),{},{accounts:await this.getPermittedAccounts(e)})}getProviderNetworkState(e){const{network:t}=e||this.getState();return{chainId:this.networkController.getCurrentChainId(),networkVersion:t}}getState(){const{vault:e}=this.keyringController.store.getState();return ke({isInitialized:Boolean(e)},this.memStore.getFlatState())}getApi(){const{addressBookController:e,alertController:t,approvalController:r,appStateController:n,collectiblesController:o,collectibleDetectionController:i,currencyRateController:s,detectTokensController:a,ensController:c,gasFeeController:l,keyringController:u,metaMetricsController:d,networkController:p,announcementController:h,onboardingController:f,permissionController:g,preferencesController:m,qrHardwareKeyring:y,swapsController:E,threeBoxController:v,tokensController:w,smartTransactionsController:S,txController:C,assetsContractController:_}=this;return ke(ke({getState:this.getState.bind(this),setCurrentCurrency:s.setCurrentCurrency.bind(s),setUseBlockie:m.setUseBlockie.bind(m),setUseNonceField:m.setUseNonceField.bind(m),setUsePhishDetect:m.setUsePhishDetect.bind(m),setUseTokenDetection:m.setUseTokenDetection.bind(m),setUseCollectibleDetection:m.setUseCollectibleDetection.bind(m),setOpenSeaEnabled:m.setOpenSeaEnabled.bind(m),setIpfsGateway:m.setIpfsGateway.bind(m),setParticipateInMetaMetrics:d.setParticipateInMetaMetrics.bind(d),setCurrentLocale:m.setCurrentLocale.bind(m),markPasswordForgotten:this.markPasswordForgotten.bind(this),unMarkPasswordForgotten:this.unMarkPasswordForgotten.bind(this),getRequestAccountTabIds:this.getRequestAccountTabIds,getOpenMetamaskTabsIds:this.getOpenMetamaskTabsIds,markNotificationPopupAsAutomaticallyClosed:()=>this.notificationManager.markAsAutomaticallyClosed(),addNewAccount:this.addNewAccount.bind(this),verifySeedPhrase:this.verifySeedPhrase.bind(this),resetAccount:this.resetAccount.bind(this),removeAccount:this.removeAccount.bind(this),importAccountWithStrategy:this.importAccountWithStrategy.bind(this),connectHardware:this.connectHardware.bind(this),forgetDevice:this.forgetDevice.bind(this),checkHardwareStatus:this.checkHardwareStatus.bind(this),unlockHardwareWalletAccount:this.unlockHardwareWalletAccount.bind(this),setLedgerTransportPreference:this.setLedgerTransportPreference.bind(this),attemptLedgerTransportCreation:this.attemptLedgerTransportCreation.bind(this),establishLedgerTransportPreference:this.establishLedgerTransportPreference.bind(this),submitQRHardwareCryptoHDKey:y.submitCryptoHDKey.bind(y),submitQRHardwareCryptoAccount:y.submitCryptoAccount.bind(y),cancelSyncQRHardware:y.cancelSync.bind(y),submitQRHardwareSignature:y.submitSignature.bind(y),cancelQRHardwareSignRequest:y.cancelSignRequest.bind(y),fetchInfoToSync:this.fetchInfoToSync.bind(this),submitPassword:this.submitPassword.bind(this),verifyPassword:this.verifyPassword.bind(this),setProviderType:p.setProviderType.bind(p),rollbackToPreviousProvider:p.rollbackToPreviousProvider.bind(p),setCustomRpc:this.setCustomRpc.bind(this),updateAndSetCustomRpc:this.updateAndSetCustomRpc.bind(this),delCustomRpc:this.delCustomRpc.bind(this),setSelectedAddress:m.setSelectedAddress.bind(m),addToken:w.addToken.bind(w),rejectWatchAsset:w.rejectWatchAsset.bind(w),acceptWatchAsset:w.acceptWatchAsset.bind(w),updateTokenType:w.updateTokenType.bind(w),removeToken:w.removeAndIgnoreToken.bind(w),setAccountLabel:m.setAccountLabel.bind(m),setFeatureFlag:m.setFeatureFlag.bind(m),setPreference:m.setPreference.bind(m),addKnownMethodData:m.addKnownMethodData.bind(m),setDismissSeedBackUpReminder:m.setDismissSeedBackUpReminder.bind(m),setAdvancedGasFee:m.setAdvancedGasFee.bind(m),setEIP1559V2Enabled:m.setEIP1559V2Enabled.bind(m),setTheme:m.setTheme.bind(m),getTokenStandardAndDetails:this.getTokenStandardAndDetails.bind(this),addCollectible:o.addCollectible.bind(o),addCollectibleVerifyOwnership:o.addCollectibleVerifyOwnership.bind(o),removeAndIgnoreCollectible:o.removeAndIgnoreCollectible.bind(o),removeCollectible:o.removeCollectible.bind(o),checkAndUpdateAllCollectiblesOwnershipStatus:o.checkAndUpdateAllCollectiblesOwnershipStatus.bind(o),checkAndUpdateSingleCollectibleOwnershipStatus:o.checkAndUpdateSingleCollectibleOwnershipStatus.bind(o),isCollectibleOwner:o.isCollectibleOwner.bind(o),setAddressBook:e.set.bind(e),removeFromAddressBook:e.delete.bind(e),setLastActiveTime:n.setLastActiveTime.bind(n),setDefaultHomeActiveTabName:n.setDefaultHomeActiveTabName.bind(n),setConnectedStatusPopoverHasBeenShown:n.setConnectedStatusPopoverHasBeenShown.bind(n),setRecoveryPhraseReminderHasBeenShown:n.setRecoveryPhraseReminderHasBeenShown.bind(n),setRecoveryPhraseReminderLastShown:n.setRecoveryPhraseReminderLastShown.bind(n),setShowTestnetMessageInDropdown:n.setShowTestnetMessageInDropdown.bind(n),setCollectiblesDetectionNoticeDismissed:n.setCollectiblesDetectionNoticeDismissed.bind(n),setEnableEIP1559V2NoticeDismissed:n.setEnableEIP1559V2NoticeDismissed.bind(n),updateCollectibleDropDownState:n.updateCollectibleDropDownState.bind(n),tryReverseResolveAddress:c.reverseResolveAddress.bind(c),setLocked:this.setLocked.bind(this),createNewVaultAndKeychain:this.createNewVaultAndKeychain.bind(this),createNewVaultAndRestore:this.createNewVaultAndRestore.bind(this),exportAccount:u.exportAccount.bind(u),cancelTransaction:C.cancelTransaction.bind(C),updateTransaction:C.updateTransaction.bind(C),updateAndApproveTransaction:C.updateAndApproveTransaction.bind(C),approveTransactionsWithSameNonce:C.approveTransactionsWithSameNonce.bind(C),createCancelTransaction:this.createCancelTransaction.bind(this),createSpeedUpTransaction:this.createSpeedUpTransaction.bind(this),estimateGas:this.estimateGas.bind(this),getNextNonce:this.getNextNonce.bind(this),addUnapprovedTransaction:C.addUnapprovedTransaction.bind(C),createTransactionEventFragment:C.createTransactionEventFragment.bind(C),getTransactions:C.getTransactions.bind(C),updateEditableParams:C.updateEditableParams.bind(C),updateTransactionGasFees:C.updateTransactionGasFees.bind(C),updateTransactionSendFlowHistory:C.updateTransactionSendFlowHistory.bind(C),updateSwapApprovalTransaction:C.updateSwapApprovalTransaction.bind(C),updateSwapTransaction:C.updateSwapTransaction.bind(C),updatePreviousGasParams:C.updatePreviousGasParams.bind(C),signMessage:this.signMessage.bind(this),cancelMessage:this.cancelMessage.bind(this),signPersonalMessage:this.signPersonalMessage.bind(this),cancelPersonalMessage:this.cancelPersonalMessage.bind(this),signTypedMessage:this.signTypedMessage.bind(this),cancelTypedMessage:this.cancelTypedMessage.bind(this),decryptMessage:this.decryptMessage.bind(this),decryptMessageInline:this.decryptMessageInline.bind(this),cancelDecryptMessage:this.cancelDecryptMessage.bind(this),encryptionPublicKey:this.encryptionPublicKey.bind(this),cancelEncryptionPublicKey:this.cancelEncryptionPublicKey.bind(this),setSeedPhraseBackedUp:f.setSeedPhraseBackedUp.bind(f),completeOnboarding:f.completeOnboarding.bind(f),setFirstTimeFlowType:f.setFirstTimeFlowType.bind(f),setAlertEnabledness:t.setAlertEnabledness.bind(t),setUnconnectedAccountAlertShown:t.setUnconnectedAccountAlertShown.bind(t),setWeb3ShimUsageAlertDismissed:t.setWeb3ShimUsageAlertDismissed.bind(t),setThreeBoxSyncingPermission:v.setThreeBoxSyncingPermission.bind(v),restoreFromThreeBox:v.restoreFromThreeBox.bind(v),setShowRestorePromptToFalse:v.setShowRestorePromptToFalse.bind(v),getThreeBoxLastUpdated:v.getLastUpdated.bind(v),turnThreeBoxSyncingOn:v.turnThreeBoxSyncingOn.bind(v),initializeThreeBox:this.initializeThreeBox.bind(this),removePermissionsFor:g.revokePermissions.bind(g),approvePermissionsRequest:g.acceptPermissionsRequest.bind(g),rejectPermissionsRequest:g.rejectPermissionsRequest.bind(g)},(0,we.getPermissionBackgroundApiMethods)(g)),{},{fetchAndSetQuotes:E.fetchAndSetQuotes.bind(E),setSelectedQuoteAggId:E.setSelectedQuoteAggId.bind(E),resetSwapsState:E.resetSwapsState.bind(E),setSwapsTokens:E.setSwapsTokens.bind(E),clearSwapsQuotes:E.clearSwapsQuotes.bind(E),setApproveTxId:E.setApproveTxId.bind(E),setTradeTxId:E.setTradeTxId.bind(E),setSwapsTxGasPrice:E.setSwapsTxGasPrice.bind(E),setSwapsTxGasLimit:E.setSwapsTxGasLimit.bind(E),setSwapsTxMaxFeePerGas:E.setSwapsTxMaxFeePerGas.bind(E),setSwapsTxMaxFeePriorityPerGas:E.setSwapsTxMaxFeePriorityPerGas.bind(E),safeRefetchQuotes:E.safeRefetchQuotes.bind(E),stopPollingForQuotes:E.stopPollingForQuotes.bind(E),setBackgroundSwapRouteState:E.setBackgroundSwapRouteState.bind(E),resetPostFetchState:E.resetPostFetchState.bind(E),setSwapsErrorKey:E.setSwapsErrorKey.bind(E),setInitialGasEstimate:E.setInitialGasEstimate.bind(E),setCustomApproveTxData:E.setCustomApproveTxData.bind(E),setSwapsLiveness:E.setSwapsLiveness.bind(E),setSwapsFeatureFlags:E.setSwapsFeatureFlags.bind(E),setSwapsUserFeeLevel:E.setSwapsUserFeeLevel.bind(E),setSwapsQuotesPollingLimitEnabled:E.setSwapsQuotesPollingLimitEnabled.bind(E),setSmartTransactionsOptInStatus:S.setOptInState.bind(S),fetchSmartTransactionFees:S.getFees.bind(S),estimateSmartTransactionsGas:S.estimateGas.bind(S),submitSignedTransactions:S.submitSignedTransactions.bind(S),cancelSmartTransaction:S.cancelSmartTransaction.bind(S),fetchSmartTransactionsLiveness:S.fetchLiveness.bind(S),updateSmartTransaction:S.updateSmartTransaction.bind(S),setStatusRefreshInterval:S.setStatusRefreshInterval.bind(S),trackMetaMetricsEvent:d.trackEvent.bind(d),trackMetaMetricsPage:d.trackPage.bind(d),createEventFragment:d.createEventFragment.bind(d),updateEventFragment:d.updateEventFragment.bind(d),finalizeEventFragment:d.finalizeEventFragment.bind(d),resolvePendingApproval:r.accept.bind(r),rejectPendingApproval:async(e,t)=>{r.reject(e,new b.EthereumRpcError(t.code,t.message,t.data))},updateViewedNotifications:h.updateViewed.bind(h),getGasFeeEstimatesAndStartPolling:l.getGasFeeEstimatesAndStartPolling.bind(l),disconnectGasFeeEstimatePoller:l.disconnectPoller.bind(l),getGasFeeTimeEstimate:l.getTimeEstimate.bind(l),addPollingTokenToAppState:n.addPollingToken.bind(n),removePollingTokenFromAppState:n.removePollingToken.bind(n),detectNewTokens:a.detectNewTokens.bind(a),detectCollectibles:null,addDetectedTokens:null,importTokens:null,ignoreTokens:null,getBalancesInSingleCall:null})}async getTokenStandardAndDetails(e,t,r){var n,o;const i=await this.assetsContractController.getTokenStandardAndDetails(e,t,r);return ke(ke({},i),{},{decimals:null==i||null===(n=i.decimals)||void 0===n?void 0:n.toString(10),balance:null==i||null===(o=i.balance)||void 0===o?void 0:o.toString(10)})}async createNewVaultAndKeychain(e){const t=await this.createVaultMutex.acquire();try{let r;if((await this.keyringController.getAccounts()).length>0)r=await this.keyringController.fullUpdate();else{r=await this.keyringController.createNewVaultAndKeychain(e);const t=await this.keyringController.getAccounts();this.preferencesController.setAddresses(t),this.selectFirstIdentity()}return r}finally{t()}}async createNewVaultAndRestore(e,t){const r=await this.createVaultMutex.acquire();try{let o,i;const s=n.from(t),{keyringController:a}=this;this.preferencesController.setAddresses([]),this.permissionController.clearState(),this.accountTracker.clearAccounts(),this.cachedBalancesController.clearCachedBalances(),this.txController.txStateManager.clearUnapprovedTxs();const c=await a.createNewVaultAndRestore(e,s),l=new T.default(this.provider);o=await a.getAccounts(),i=await this.getBalance(o[o.length-1],l);const u=a.getKeyringsByType("HD Key Tree")[0];if(!u)throw new Error("MetamaskController - No HD Key Tree found");for(;"0x0"!==i;)await a.addNewAccount(u),o=await a.getAccounts(),i=await this.getBalance(o[o.length-1],l);o.length>1&&"0x0"===i&&(await this.removeAccount(o[o.length-1]),o=await a.getAccounts());const d=this.preferencesController.getLedgerTransportPreference();return this.setLedgerTransportPreference(d),this.preferencesController.setAddresses(o),this.selectFirstIdentity(),c}finally{r()}}getBalance(e,t){return new Promise(((r,n)=>{const o=this.accountTracker.store.getState().accounts[e];o&&o.balance?r(o.balance):t.getBalance(e,((e,t)=>{e?(n(e),v.default.error(e)):r(t||"0x0")}))}))}async fetchInfoToSync(){const{currentLocale:e,frequentRpcList:t,identities:r,selectedAddress:n,useTokenDetection:o}=this.preferencesController.store.getState(),{tokenList:i}=this.tokenListController.state,s={currentLocale:e,frequentRpcList:t,identities:r,selectedAddress:n},{allTokens:a,allIgnoredTokens:c}=this.tokensController.state,l={};Object.keys(a).forEach((e=>{l[e]={},Object.keys(a[e]).forEach((t=>{const r=(0,x.toChecksumHexAddress)(t);l[e][r]=a[e][r].filter((e=>{if(e.isERC721===undefined){const t=o?e.address.toLowerCase():e.address;if(i[t]!==undefined)return!0}else if(!1===e.isERC721)return!0;return!1}))}))}));const u=this.keyringController.getKeyringsByType("HD Key Tree")[0],d=this.keyringController.getKeyringsByType("Simple Key Pair"),p=await u.getAccounts(),h=(await Promise.all(d.map((e=>e.getAccounts())))).reduce(((e,t)=>[...e,...t]),[]),f={hd:p.filter(((e,t)=>p.indexOf(e)===t)).map((e=>(0,x.toChecksumHexAddress)(e))),simpleKeyPair:h.filter(((e,t)=>h.indexOf(e)===t)).map((e=>(0,x.toChecksumHexAddress)(e))),ledger:[],trezor:[],lattice:[]};let{transactions:g}=this.txController.store.getState();return g=Object.values(g).filter((e=>{const t=(0,x.toChecksumHexAddress)(e.txParams.from);return f.hd.includes(t)})),{accounts:f,preferences:s,transactions:g,tokens:{allTokens:l,allIgnoredTokens:c},network:this.networkController.store.getState()}}async submitPassword(e){await this.keyringController.submitPassword(e);try{await this.blockTracker.checkForLatestBlock()}catch(e){v.default.error("Error while unlocking extension.",e)}try{const e=this.threeBoxController.getThreeBoxSyncingState();e&&!this.threeBoxController.box?(this.threeBoxController.init(),this.threeBoxController.turnThreeBoxSyncingOn()):e&&this.threeBoxController.box&&this.threeBoxController.turnThreeBoxSyncingOn()}catch(e){v.default.error("Error while unlocking extension.",e)}const t=this.preferencesController.getLedgerTransportPreference();return this.setLedgerTransportPreference(t),this.keyringController.fullUpdate()}async verifyPassword(e){await this.keyringController.verifyPassword(e)}selectFirstIdentity(){const{identities:e}=this.preferencesController.store.getState(),t=Object.keys(e)[0];this.preferencesController.setSelectedAddress(t)}getPrimaryKeyringMnemonic(){const e=this.keyringController.getKeyringsByType("HD Key Tree")[0];if(!e.mnemonic)throw new Error("Primary keyring mnemonic unavailable.");return e.mnemonic}async getKeyringForDevice(e,t=null){let r=null;switch(e){case N.DEVICE_NAMES.TREZOR:r=w.default.type;break;case N.DEVICE_NAMES.LEDGER:r=S.default.type;break;case N.DEVICE_NAMES.QR:r=_.MetaMaskKeyring.type;break;case N.DEVICE_NAMES.LATTICE:r=C.default.type;break;default:throw new Error("MetamaskController:getKeyringForDevice - Unknown device")}let n=await this.keyringController.getKeyringsByType(r)[0];if(n||(n=await this.keyringController.addNewKeyring(r)),t&&n.setHdPath&&n.setHdPath(t),e===N.DEVICE_NAMES.LATTICE&&(n.appName="MetaMask"),e===N.DEVICE_NAMES.TREZOR){const e=n.getModel();this.appStateController.setTrezorModel(e)}return n.network=this.networkController.getProviderConfig().type,n}async attemptLedgerTransportCreation(){const e=await this.getKeyringForDevice(N.DEVICE_NAMES.LEDGER);return await e.attemptMakeApp()}async establishLedgerTransportPreference(){const e=this.preferencesController.getLedgerTransportPreference();return await this.setLedgerTransportPreference(e)}async connectHardware(e,t,r){const n=await this.getKeyringForDevice(e,r);let o=[];switch(t){case-1:o=await n.getPreviousPage();break;case 1:o=await n.getNextPage();break;default:o=await n.getFirstPage()}const i=await this.keyringController.getAccounts(),s=[...new Set(i.concat(o.map((e=>e.address.toLowerCase()))))];return this.accountTracker.syncWithAddresses(s),o}async checkHardwareStatus(e,t){return(await this.getKeyringForDevice(e,t)).isUnlocked()}async forgetDevice(e){return(await this.getKeyringForDevice(e)).forgetDevice(),!0}async getAccountType(e){switch((await this.keyringController.getKeyringForAccount(e)).type){case N.KEYRING_TYPES.TREZOR:case N.KEYRING_TYPES.LATTICE:case N.KEYRING_TYPES.QR:case N.KEYRING_TYPES.LEDGER:return"hardware";case N.KEYRING_TYPES.IMPORTED:return"imported";default:return"MetaMask"}}async getDeviceModel(e){const t=await this.keyringController.getKeyringForAccount(e);switch(t.type){case N.KEYRING_TYPES.TREZOR:return t.getModel();case N.KEYRING_TYPES.QR:return t.getName();case N.KEYRING_TYPES.LEDGER:return N.DEVICE_NAMES.LEDGER;case N.KEYRING_TYPES.LATTICE:return N.DEVICE_NAMES.LATTICE;default:return"N/A"}}getAccountLabel(e,t,r){return`${e[0].toUpperCase()}${e.slice(1)} ${parseInt(t,10)+1} ${r||""}`.trim()}async unlockHardwareWalletAccount(e,t,r,n){const o=await this.getKeyringForDevice(t,r);o.setAccountToUnlock(e);const i=await this.keyringController.getAccounts(),s=await this.keyringController.addNewAccount(o),a=await this.keyringController.getAccounts();this.preferencesController.setAddresses(a),a.forEach((r=>{if(!i.includes(r)){const i=this.getAccountLabel(t===N.DEVICE_NAMES.QR?o.getName():t,e,n);this.preferencesController.setAccountLabel(r,i),this.preferencesController.setSelectedAddress(r)}}));const{identities:c}=this.preferencesController.store.getState();return ke(ke({},s),{},{identities:c})}async addNewAccount(){const e=this.keyringController.getKeyringsByType("HD Key Tree")[0];if(!e)throw new Error("MetamaskController - No HD Key Tree found");const{keyringController:t}=this,r=await t.getAccounts(),n=await t.addNewAccount(e),o=await t.getAccounts();await this.verifySeedPhrase(),this.preferencesController.setAddresses(o),o.forEach((e=>{r.includes(e)||this.preferencesController.setSelectedAddress(e)}));const{identities:i}=this.preferencesController.store.getState();return ke(ke({},n),{},{identities:i})}async verifySeedPhrase(){const e=this.keyringController.getKeyringsByType("HD Key Tree")[0];if(!e)throw new Error("MetamaskController - No HD Key Tree found");const t=await e.serialize(),r=n.from(t.mnemonic),o=await e.getAccounts();if(o.length<1)throw new Error("MetamaskController - No accounts found");try{return await be.default.verifyAccounts(o,r),Array.from(r.values())}catch(e){throw v.default.error(e.message),e}}async resetAccount(){const e=this.preferencesController.getSelectedAddress();return this.txController.wipeTransactions(e),this.networkController.resetConnection(),e}async getPermittedAccounts(e){try{return await this.permissionController.executeRestrictedMethod(e,D.RestrictedMethods.eth_accounts)}catch(e){if(e.code===b.errorCodes.provider.unauthorized)return[];throw e}}removeAllAccountPermissions(e){this.permissionController.updatePermissionsByCaveat(D.CaveatTypes.restrictReturnedAccounts,(t=>we.CaveatMutatorFactories[D.CaveatTypes.restrictReturnedAccounts].removeAccount(e,t)))}async removeAccount(e){return this.removeAllAccountPermissions(e),this.preferencesController.removeAddress(e),this.accountTracker.removeAccount([e]),await this.keyringController.removeAccount(e),e}async importAccountWithStrategy(e,t){const r=await me.default.importAccount(e,t),n=await this.keyringController.addNewKeyring("Simple Key Pair",[r]),o=await n.getAccounts(),i=await this.keyringController.getAccounts();this.preferencesController.setAddresses(i),await this.preferencesController.setSelectedAddress(o[0])}async newUnapprovedTransaction(e,t){return await this.txController.newUnapprovedTransaction(e,t)}async newUnsignedMessage(e,t){const r=(0,ce.normalizeMsgData)(e.data);let n;if(66!==r.length&&67!==r.length)throw b.ethErrors.rpc.invalidParams("eth_sign requires 32 byte message hash");return n=this.messageManager.addUnapprovedMessageAsync(e,t),this.sendUpdate(),this.opts.showUserConfirmation(),await n}async signMessage(e){v.default.info("MetaMaskController - signMessage");const t=e.metamaskId;try{const r=await this.messageManager.approveMessage(e),n=await this.keyringController.signMessage(r);return this.messageManager.setMsgStatusSigned(t,n),this.getState()}catch(e){throw v.default.info("MetaMaskController - eth_sign failed",e),this.messageManager.errorMessage(t,e),e}}cancelMessage(e){const{messageManager:t}=this;return t.rejectMsg(e),this.getState()}async newUnsignedPersonalMessage(e,t){const r=this.personalMessageManager.addUnapprovedMessageAsync(e,t);return this.sendUpdate(),this.opts.showUserConfirmation(),r}async signPersonalMessage(e){v.default.info("MetaMaskController - signPersonalMessage");const t=e.metamaskId;try{const r=await this.personalMessageManager.approveMessage(e),n=await this.keyringController.signPersonalMessage(r);return this.personalMessageManager.setMsgStatusSigned(t,n),this.getState()}catch(e){throw v.default.info("MetaMaskController - eth_personalSign failed",e),this.personalMessageManager.errorMessage(t,e),e}}cancelPersonalMessage(e){return this.personalMessageManager.rejectMsg(e),this.getState()}async newRequestDecryptMessage(e,t){const r=this.decryptMessageManager.addUnapprovedMessageAsync(e,t);return this.sendUpdate(),this.opts.showUserConfirmation(),r}async decryptMessageInline(e){v.default.info("MetaMaskController - decryptMessageInline");const t=e.metamaskId,r=this.decryptMessageManager.getMsg(t);try{const t=(0,E.stripHexPrefix)(e.data),o=n.from(t,"hex");e.data=JSON.parse(o.toString("utf8")),r.rawData=await this.keyringController.decryptMessage(e)}catch(e){r.error=e.message}return this.decryptMessageManager._updateMsg(r),this.getState()}async decryptMessage(e){v.default.info("MetaMaskController - decryptMessage");const t=e.metamaskId;try{const r=await this.decryptMessageManager.approveMessage(e),o=(0,E.stripHexPrefix)(r.data),i=n.from(o,"hex");r.data=JSON.parse(i.toString("utf8"));const s=await this.keyringController.decryptMessage(r);this.decryptMessageManager.setMsgStatusDecrypted(t,s)}catch(e){v.default.info("MetaMaskController - eth_decrypt failed.",e),this.decryptMessageManager.errorMessage(t,e)}return this.getState()}cancelDecryptMessage(e){return this.decryptMessageManager.rejectMsg(e),this.getState()}async newRequestEncryptionPublicKey(e,t){const r=e;switch((await this.keyringController.getKeyringForAccount(r)).type){case N.KEYRING_TYPES.LEDGER:return new Promise(((e,t)=>{t(new Error("Ledger does not support eth_getEncryptionPublicKey."))}));case N.KEYRING_TYPES.TREZOR:return new Promise(((e,t)=>{t(new Error("Trezor does not support eth_getEncryptionPublicKey."))}));case N.KEYRING_TYPES.LATTICE:return new Promise(((e,t)=>{t(new Error("Lattice does not support eth_getEncryptionPublicKey."))}));case N.KEYRING_TYPES.QR:return Promise.reject(new Error("QR hardware does not support eth_getEncryptionPublicKey."));default:{const r=this.encryptionPublicKeyManager.addUnapprovedMessageAsync(e,t);return this.sendUpdate(),this.opts.showUserConfirmation(),r}}}async encryptionPublicKey(e){v.default.info("MetaMaskController - encryptionPublicKey");const t=e.metamaskId;try{const r=await this.encryptionPublicKeyManager.approveMessage(e),n=await this.keyringController.getEncryptionPublicKey(r.data);this.encryptionPublicKeyManager.setMsgStatusReceived(t,n)}catch(e){v.default.info("MetaMaskController - eth_getEncryptionPublicKey failed.",e),this.encryptionPublicKeyManager.errorMessage(t,e)}return this.getState()}cancelEncryptionPublicKey(e){return this.encryptionPublicKeyManager.rejectMsg(e),this.getState()}newUnsignedTypedMessage(e,t,r){const n=this.typedMessageManager.addUnapprovedMessageAsync(e,t,r);return this.sendUpdate(),this.opts.showUserConfirmation(),n}async signTypedMessage(e){v.default.info("MetaMaskController - eth_signTypedData");const t=e.metamaskId,{version:r}=e;try{const n=await this.typedMessageManager.approveMessage(e);"V1"!==r&&"string"==typeof n.data&&(n.data=JSON.parse(n.data));const o=await this.keyringController.signTypedMessage(n,{version:r});return this.typedMessageManager.setMsgStatusSigned(t,o),this.getState()}catch(e){throw v.default.info("MetaMaskController - eth_signTypedData failed.",e),this.typedMessageManager.errorMessage(t,e),e}}cancelTypedMessage(e){return this.typedMessageManager.rejectMsg(e),this.getState()}async getCurrentAccountEIP1559Compatibility(){return!0}async createCancelTransaction(e,t,r){await this.txController.createCancelTransaction(e,t,r);return await this.getState()}async createSpeedUpTransaction(e,t,r){await this.txController.createSpeedUpTransaction(e,t,r);return await this.getState()}estimateGas(e){return new Promise(((t,r)=>this.txController.txGasUtil.query.estimateGas(e,((e,n)=>e?r(e):t(n.toString(16))))))}markPasswordForgotten(){this.preferencesController.setPasswordForgotten(!0),this.sendUpdate()}unMarkPasswordForgotten(){this.preferencesController.setPasswordForgotten(!1),this.sendUpdate()}setupUntrustedCommunication({connectionStream:e,sender:t,subjectType:r}){const{usePhishDetect:n}=this.preferencesController.store.getState();let o;if(o=r||(t.id&&t.id!==this.extension.runtime.id?j.SUBJECT_TYPES.EXTENSION:j.SUBJECT_TYPES.WEBSITE),t.url){const{hostname:r}=new URL(t.url);if(n&&this.phishingController.test(r))return v.default.debug("MetaMask - sending phishing warning for",r),void this.sendPhishingWarning(e,r)}const i=(0,Z.setupMultiplex)(e);this.setupProviderConnection(i.createStream("metamask-provider"),t,o),t.url&&this.setupPublicConfig(i.createStream("publicConfig"))}setupTrustedCommunication(e,t){const r=(0,Z.setupMultiplex)(e);this.setupControllerConnection(r.createStream("controller")),this.setupProviderConnection(r.createStream("provider"),t,j.SUBJECT_TYPES.INTERNAL)}setupPhishingCommunication({connectionStream:e}){const{usePhishDetect:t}=this.preferencesController.store.getState();if(!t)return;const r=(0,Z.setupMultiplex)(e).createStream("metamask-phishing-safelist");r.on("data",(0,ve.default)({safelistPhishingDomain:this.safelistPhishingDomain.bind(this)},r))}sendPhishingWarning(e,t){(0,Z.setupMultiplex)(e).createStream("phishing").write({hostname:t})}setupControllerConnection(e){const t=this.getApi();this.activeControllerConnections+=1,this.emit("controllerConnectionChanged",this.activeControllerConnections),e.on("data",(0,ve.default)(t,e));const r=t=>{e._writableState.ended||e.write({jsonrpc:"2.0",method:"sendUpdate",params:[t]})};this.on("update",r),e.on("end",(()=>{this.activeControllerConnections-=1,this.emit("controllerConnectionChanged",this.activeControllerConnections),this.removeListener("update",r)}))}setupProviderConnection(e,t,r){let n,o;n=r===j.SUBJECT_TYPES.INTERNAL?j.ORIGIN_METAMASK:new URL(t.url).origin,t.id&&t.id!==this.extension.runtime.id&&this.subjectMetadataController.addSubjectMetadata({origin:n,extensionId:t.id,subjectType:j.SUBJECT_TYPES.EXTENSION}),t.tab&&t.tab.id&&(o=t.tab.id);const i=this.setupProviderEngine({origin:n,sender:t,subjectType:r,tabId:o}),s=(0,p.default)({engine:i}),c=this.addConnection(n,{engine:i});(0,a.default)(e,s,e,(e=>{i._middleware.forEach((e=>{e.destroy&&"function"==typeof e.destroy&&e.destroy()})),c&&this.removeConnection(n,c),e&&v.default.error(e)}))}setupProviderEngine({origin:e,subjectType:t,sender:r,tabId:n}){const o=new u.JsonRpcEngine,{blockTracker:i,provider:s}=this,a=(0,h.default)({provider:s,blockTracker:i}),c=(0,f.default)({provider:s,blockTracker:i});return c.events.on("notification",(e=>o.emit("notification",e))),o.push((0,$.default)({origin:e})),n&&o.push((0,Y.default)({tabId:n})),o.push((0,Q.default)({origin:e})),o.push(this.permissionLogController.createMiddleware()),o.push((0,Se.default)({trackEvent:this.metaMetricsController.trackEvent.bind(this.metaMetricsController),getMetricsState:this.metaMetricsController.store.getState.bind(this.metaMetricsController.store)})),t===j.SUBJECT_TYPES.WEBSITE&&o.push((0,J.default)({location:r.url,registerOnboarding:this.onboardingController.registerOnboarding})),o.push((0,K.createMethodMiddleware)({origin:e,subjectType:t,addSubjectMetadata:this.subjectMetadataController.addSubjectMetadata.bind(this.subjectMetadataController),getProviderState:this.getProviderState.bind(this),getUnlockPromise:this.appStateController.getUnlockPromise.bind(this.appStateController),handleWatchAssetRequest:this.tokensController.watchAsset.bind(this.tokensController),requestUserApproval:this.approvalController.addAndShowApprovalRequest.bind(this.approvalController),sendMetrics:this.metaMetricsController.trackEvent.bind(this.metaMetricsController),getAccounts:this.getPermittedAccounts.bind(this,e),getPermissionsForOrigin:this.permissionController.getPermissions.bind(this.permissionController,e),hasPermission:this.permissionController.hasPermission.bind(this.permissionController,e),requestAccountsPermission:this.permissionController.requestPermissions.bind(this.permissionController,{origin:e},{eth_accounts:{}}),requestPermissionsForOrigin:this.permissionController.requestPermissions.bind(this.permissionController,{origin:e}),addCustomRpc:async({chainId:e,blockExplorerUrl:t,ticker:r,chainName:n,rpcUrl:o}={})=>{await this.preferencesController.addToFrequentRpcList(o,e,r,n,{blockExplorerUrl:t})},findCustomRpcBy:this.findCustomRpcBy.bind(this),getCurrentChainId:this.networkController.getCurrentChainId.bind(this.networkController),setProviderType:this.networkController.setProviderType.bind(this.networkController),updateRpcTarget:({rpcUrl:e,chainId:t,ticker:r,nickname:n})=>{this.networkController.setRpcTarget(e,t,r,n)},getWeb3ShimUsageState:this.alertController.getWeb3ShimUsageState.bind(this.alertController),setWeb3ShimUsageRecorded:this.alertController.setWeb3ShimUsageRecorded.bind(this.alertController)})),o.push(a),o.push(c.middleware),t!==j.SUBJECT_TYPES.INTERNAL&&o.push(this.permissionController.createPermissionMiddleware({origin:e})),o.push((0,g.providerAsMiddleware)(s)),o}setupPublicConfig(e){const t=(0,l.storeAsStream)(this.publicConfigStore);(0,a.default)(t,e,(e=>{t.destroy(),e&&v.default.error(e)}))}addConnection(e,{engine:t}){if(e===j.ORIGIN_METAMASK)return null;this.connections[e]||(this.connections[e]={});const r=(0,k.default)();return this.connections[e][r]={engine:t},r}removeConnection(e,t){const r=this.connections[e];r&&(delete r[t],0===Object.keys(r).length&&delete this.connections[e])}removeAllConnections(e){const t=this.connections[e];t&&Object.keys(t).forEach((t=>{this.removeConnection(e,t)}))}notifyConnections(e,t){const r=this.connections[e];r&&Object.values(r).forEach((e=>{e.engine&&e.engine.emit("notification",t)}))}notifyAllConnections(e){const t="function"==typeof e?t=>e(t):()=>e;Object.keys(this.connections).forEach((e=>{Object.values(this.connections[e]).forEach((async r=>{r.engine&&r.engine.emit("notification",await t(e))}))}))}async _onKeyringControllerUpdate(e){const{keyrings:t}=e,r=t.reduce(((e,{accounts:t})=>e.concat(t)),[]);r.length&&(this.preferencesController.syncAddresses(r),this.accountTracker.syncWithAddresses(r))}_onUnlock(){this.notifyAllConnections((async e=>({method:we.NOTIFICATION_NAMES.unlockStateChanged,params:{isUnlocked:!0,accounts:await this.getPermittedAccounts(e)}}))),this.emit("unlock")}_onLock(){this.notifyAllConnections({method:we.NOTIFICATION_NAMES.unlockStateChanged,params:{isUnlocked:!1}}),this.emit("lock")}_onStateUpdate(e){this.isClientOpenAndUnlocked=e.isUnlocked&&this._isClientOpen,this.notifyAllConnections({method:we.NOTIFICATION_NAMES.chainChanged,params:this.getProviderNetworkState(e)})}privateSendUpdate(){this.emit("update",this.getState())}isUnlocked(){return this.keyringController.memStore.getState().isUnlocked}getExternalPendingTransactions(e){return this.smartTransactionsController.getTransactions({addressFrom:e,status:"pending"})}async getPendingNonce(e){const{nonceDetails:t,releaseLock:r}=await this.txController.nonceTracker.getNonceLock(e),n=t.params.highestSuggested;return r(),n}async getNextNonce(e){const t=await this.txController.nonceTracker.getNonceLock(e);return t.releaseLock(),t.nextNonce}async migrateAddressBookState(e,t,r=!1){const{addressBook:n}=this.addressBookController.state;if(n[e])for(const o of Object.keys(n[e])){const i=n[e][o];this.addressBookController.set(o,i.name,t,i.memo),r||this.addressBookController.delete(e,o)}}async updateAndSetCustomRpc(e,t,r="ETH",n,o){return this.networkController.setRpcTarget(e,t,r,n,o),await this.preferencesController.updateRpc({rpcUrl:e,chainId:t,ticker:r,nickname:n,rpcPrefs:o}),e}async setCustomRpc(e,t,r="ETH",n="",o={}){const i=this.preferencesController.getFrequentRpcListDetail().find((t=>e===t.rpcUrl));return i?this.networkController.setRpcTarget(i.rpcUrl,i.chainId,i.ticker,i.nickname,o):(this.networkController.setRpcTarget(e,t,r,n,o),await this.preferencesController.addToFrequentRpcList(e,t,r,n,o)),e}async delCustomRpc(e){await this.preferencesController.removeFromFrequentRpcList(e)}findCustomRpcBy(e){const t=this.preferencesController.getFrequentRpcListDetail();for(const r of t)for(const t of Object.keys(e))if(r[t]===e[t])return r;return null}async initializeThreeBox(){await this.threeBoxController.init()}async setLedgerTransportPreference(e){const t=this.preferencesController.getLedgerTransportPreference(),r=this.preferencesController.setLedgerTransportPreference(e),n=await this.getKeyringForDevice(N.DEVICE_NAMES.LEDGER);return null!=n&&n.updateTransportMethod?n.updateTransportMethod(r).catch((e=>{throw this.preferencesController.setLedgerTransportPreference(t),e})):undefined}recordFirstTimeInfo(e){if(!("firstTimeInfo"in e)){const t=this.platform.getVersion();e.firstTimeInfo={version:t,date:Date.now()}}}set isClientOpen(e){this._isClientOpen=e,this.detectTokensController.isOpen=e}onClientClosed(){try{this.gasFeeController.stopPolling(),this.appStateController.clearPollingTokens()}catch(e){console.error(e)}}onEnvironmentTypeClosed(e){const t=j.POLLING_TOKEN_ENVIRONMENT_TYPES[e];this.appStateController.store.getState()[t].forEach((e=>{this.gasFeeController.disconnectPoller(e),this.appStateController.removePollingToken(e,t)}))}safelistPhishingDomain(e){return this.phishingController.bypass(e)}setLocked(){var e;const[t]=this.keyringController.getKeyringsByType(N.KEYRING_TYPES.TREZOR);t&&t.dispose();const[r]=this.keyringController.getKeyringsByType(N.KEYRING_TYPES.LEDGER);return null==r||null===(e=r.destroy)||void 0===e||e.call(r),this.keyringController.setLocked()}}r.default=Me}).call(this)}).call(this,e("_process"),e("buffer").Buffer)}}},{package:"$root$"}],[85,{lodash:5091},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");var o={version:2,migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=2;try{"etherscan"===t.data.config.provider.type&&(t.data.config.provider.type="rpc",t.data.config.provider.rpcTarget="https://rpc.metamask.io/")}catch(e){}return Promise.resolve(t)}};r.default=o}}},{package:"$root$"}],[86,{lodash:5091},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");var o={version:3,migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=3;try{"https://rawtestrpc.metamask.io/"===t.data.config.provider.rpcTarget&&(t.data.config.provider.rpcTarget="https://testrpc.metamask.io/")}catch(e){}return Promise.resolve(t)}};r.default=o}}},{package:"$root$"}],[87,{lodash:5091},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");var o={version:4,migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=4;try{if("rpc"!==t.data.config.provider.type)return Promise.resolve(t);switch(t.data.config.provider.rpcTarget){case"https://testrpc.metamask.io/":t.data.config.provider={type:"testnet"};break;case"https://rpc.metamask.io/":t.data.config.provider={type:"mainnet"}}}catch(e){}return Promise.resolve(t)}};r.default=o}}},{package:"$root$"}],[88,{"@babel/runtime/helpers/defineProperty":193,"@babel/runtime/helpers/interopRequireDefault":199,lodash:5091},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var o=n(e("@babel/runtime/helpers/defineProperty")),i=e("lodash");function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function a(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach((function(t){(0,o.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var c={version:5,migrate(e){const t=(0,i.cloneDeep)(e);t.meta.version=5;try{const e=function(e){const{config:t}=e,r=a(a({},e),{},{KeyringController:{vault:e.vault,selectedAccount:t.selectedAccount,walletNicknames:e.walletNicknames}});return delete r.vault,delete r.walletNicknames,delete r.config.selectedAccount,r}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #5${e.stack}`)}return Promise.resolve(t)}};r.default=c}}},{package:"$root$"}],[89,{"@babel/runtime/helpers/defineProperty":193,"@babel/runtime/helpers/interopRequireDefault":199,lodash:5091},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var o=n(e("@babel/runtime/helpers/defineProperty")),i=e("lodash");function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function a(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach((function(t){(0,o.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var c={version:6,migrate(e){const t=(0,i.cloneDeep)(e);t.meta.version=6;try{const e=function(e){const t=e.KeyringController,r=a(a({},e),{},{PreferencesController:{selectedAddress:t.selectedAccount}});return delete r.KeyringController.selectedAccount,r}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #6${e.stack}`)}return Promise.resolve(t)}};r.default=c}}},{package:"$root$"}],[9,{"../../../shared/constants/network":6110,"../../../shared/constants/time":6113,"../../../shared/modules/network.utils":6121,"../../../shared/modules/string-utils":6124,"../constants/contracts":4,"@babel/runtime/helpers/interopRequireDefault":199,loglevel:5104,"single-call-balance-checker-abi":5757,web3:6028},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var o=n(e("web3")),i=e("loglevel"),s=n(e("single-call-balance-checker-abi")),a=e("../constants/contracts"),c=e("../../../shared/constants/time"),l=e("../../../shared/constants/network"),u=(e("../../../shared/modules/network.utils"),e("../../../shared/modules/string-utils"));const d=3*c.MINUTE;r.default=class{constructor({interval:e=d,preferences:t,network:r,keyringMemStore:n,tokenList:o,tokensController:i,assetsContractController:s=null}={}){var a,c,l;this.assetsContractController=s,this.tokensController=i,this.preferences=t,this.interval=e,this.network=r,this.keyringMemStore=n,this.tokenList=o,this.selectedAddress=null===(a=this.preferences)||void 0===a?void 0:a.store.getState().selectedAddress,this.tokenAddresses=null===(c=this.tokensController)||void 0===c?void 0:c.state.tokens.map((e=>e.address)),this.hiddenTokens=null===(l=this.tokensController)||void 0===l?void 0:l.state.ignoredTokens,this.detectedTokens=[],null==t||t.store.subscribe((({selectedAddress:e,useTokenDetection:t})=>{this.selectedAddress===e&&this.useTokenDetection===t||(this.selectedAddress=e,this.useTokenDetection=t,this.restartTokenDetection())})),null==i||i.subscribe((({tokens:e=[],ignoredTokens:t=[],detectedTokens:r=[]})=>{this.tokenAddresses=e.map((e=>e.address)),this.hiddenTokens=t,this.detectedTokens=[]}))}async _getTokenBalances(e){const t=this.web3.eth.contract(s.default).at(a.SINGLE_CALL_BALANCES_ADDRESS);return new Promise(((r,n)=>{t.balances([this.selectedAddress],e,((e,t)=>e?n(e):r(t)))}))}async detectNewTokens(){if(!this.isActive)return;const{tokenList:e}=this._tokenList.state;if(this._network.store.getState().provider.chainId!==l.MAINNET_CHAIN_ID||0===Object.keys(e).length)return;const t=[];this.web3.setProvider(this._network._provider);for(const r in e)this.tokenAddresses.find((e=>(0,u.isEqualCaseInsensitive)(e,r)))||this.hiddenTokens.find((e=>(0,u.isEqualCaseInsensitive)(e,r)))||this.detectedTokens.find((({address:e})=>(0,u.isEqualCaseInsensitive)(e,r)))||t.push(r);const r=[t.slice(0,1e3),t.slice(1e3,t.length-1)];for(const t of r){let r;try{r=await this._getTokenBalances(t)}catch(e){return void(0,i.warn)("MetaMask - DetectTokensController single call balance fetch failed",e)}let n=[];n=t.filter(((e,t)=>{const n=r[t];return n&&!n.isZero()})),await Promise.all(n.map((t=>this.tokensController.addToken(t,e[t].symbol,e[t].decimals))))}}restartTokenDetection(){this.isActive&&this.selectedAddress&&(this.detectNewTokens(),this.interval=d)}set interval(e){this._handle&&clearInterval(this._handle),e&&(this._handle=setInterval((()=>{this.detectNewTokens()}),e))}set network(e){e&&(this._network=e,this.web3=new o.default(e._provider))}set keyringMemStore(e){e&&(this._keyringMemStore=e,this._keyringMemStore.subscribe((({isUnlocked:e})=>{this.isUnlocked!==e&&(this.isUnlocked=e,e&&this.restartTokenDetection())})))}set tokenList(e){e&&(this._tokenList=e)}get isActive(){return this.isOpen&&this.isUnlocked}}}}},{package:"$root$"}],[90,{"@babel/runtime/helpers/defineProperty":193,"@babel/runtime/helpers/interopRequireDefault":199,lodash:5091},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var o=n(e("@babel/runtime/helpers/defineProperty")),i=e("lodash");function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function a(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach((function(t){(0,o.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var c={version:7,migrate(e){const t=(0,i.cloneDeep)(e);t.meta.version=7;try{const e=function(e){const t=a(a({},e),{},{TransactionManager:{transactions:e.transactions||[],gasMultiplier:e.gasMultiplier||1}});return delete t.transactions,delete t.gasMultiplier,t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #7${e.stack}`)}return Promise.resolve(t)}};r.default=c}}},{package:"$root$"}],[91,{"@babel/runtime/helpers/defineProperty":193,"@babel/runtime/helpers/interopRequireDefault":199,lodash:5091},function(){with(this)return function(){"use strict";return function(e,t,r){var n=e("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var o=n(e("@babel/runtime/helpers/defineProperty")),i=e("lodash");function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function a(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach((function(t){(0,o.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var c={version:8,migrate(e){const t=(0,i.cloneDeep)(e);t.meta.version=8;try{const e=function(e){const t=a(a({},e),{},{NoticeController:{noticesList:e.noticesList||[]}});return delete t.noticesList,t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #8${e.stack}`)}return Promise.resolve(t)}};r.default=c}}},{package:"$root$"}],[92,{lodash:5091},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");var o={version:9,migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=9;try{const e=function(e){const t=(0,n.merge)({},e,{CurrencyController:{currentCurrency:e.currentFiat||e.fiatCurrency||"USD",conversionRate:e.conversionRate,conversionDate:e.conversionDate}});return delete t.currentFiat,delete t.fiatCurrency,delete t.conversionRate,delete t.conversionDate,t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #9${e.stack}`)}return Promise.resolve(t)}};r.default=o}}},{package:"$root$"}],[93,{lodash:5091},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");var o={version:10,migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=10;try{const e=function(e){const t=(0,n.merge)({},e,{ShapeShiftController:{shapeShiftTxList:e.shapeShiftTxList||[]}});return delete t.shapeShiftTxList,t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #10${e.stack}`)}return Promise.resolve(t)}};r.default=o}}},{package:"$root$"}],[94,{lodash:5091},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");var o={version:11,migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=11;try{const e=function(e){const t=e;return delete t.TOSHash,delete t.isDisclaimerConfirmed,t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #11${e.stack}`)}return Promise.resolve(t)}};r.default=o}}},{package:"$root$"}],[95,{lodash:5091},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");var o={version:12,migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=12;try{const e=function(e){const t=e;return t.NoticeController.noticesList.forEach((e=>{e.read&&(e.body="")})),t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #12${e.stack}`)}return Promise.resolve(t)}};r.default=o}}},{package:"$root$"}],[96,{lodash:5091},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");var o={version:13,migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=13;try{const e=function(e){const t=e,{config:r}=t;r&&r.provider&&"testnet"===r.provider.type&&(t.config.provider.type="ropsten");return t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #13${e.stack}`)}return Promise.resolve(t)}};r.default=o}}},{package:"$root$"}],[97,{lodash:5091},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");var o={version:14,migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=14;try{const e=function(e){const t=e;return t.NetworkController={},t.NetworkController.provider=t.config.provider,delete t.config.provider,t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #14${e.stack}`)}return Promise.resolve(t)}};r.default=o}}},{package:"$root$"}],[98,{"../../../shared/constants/transaction":6114,lodash:5091},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash"),o=e("../../../shared/constants/transaction");var i={version:15,migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=15;try{const e=function(e){const t=e,{TransactionController:r}=t;if(r&&r.transactions){const{transactions:e}=r;t.TransactionController.transactions=e.map((e=>e.err?("Gave up submitting tx."===e.err.message&&(e.status=o.TRANSACTION_STATUSES.FAILED),e):e))}return t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #15${e.stack}`)}return Promise.resolve(t)}};r.default=i}}},{package:"$root$"}],[99,{"../../../shared/constants/transaction":6114,lodash:5091},function(){with(this)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash"),o=e("../../../shared/constants/transaction");var i={version:16,migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=16;try{const e=function(e){const t=e,{TransactionController:r}=t;if(r&&r.transactions){const{transactions:e}=t.TransactionController;t.TransactionController.transactions=e.map((e=>e.err?("transaction with the same hash was already imported."===e.err&&(e.status=o.TRANSACTION_STATUSES.SUBMITTED,delete e.err),e):e))}return t}(t.data);t.data=e}catch(e){console.warn(`MetaMask Migration #16${e.stack}`)}return Promise.resolve(t)}};r.default=i}}},{package:"$root$"}],[3,{"../../shared/constants/app":6105,"../../shared/constants/metametrics":6109,"../../shared/constants/time":6113,"./first-time-state":39,"./lib/createStreamSink":49,"./lib/ens-ipfs/setup":56,"./lib/get-first-preferred-lang-code":58,"./lib/getObjStructure":59,"./lib/local-store":60,"./lib/migrator":63,"./lib/network-store":64,"./lib/notification-manager":65,"./lib/util":83,"./metamask-controller":84,"./migrations":156,"./platforms/extension":157,"@babel/runtime/helpers/defineProperty":193,"@babel/runtime/helpers/interopRequireDefault":199,"@metamask/obs-store":1197,"@sentry/browser":1395,_process:5342,"debounce-stream":2165,"end-of-stream":2253,"eth-rpc-errors":2371,"extension-port-stream":2501,loglevel:5104,pump:5441,"webextension-polyfill":6080},function(){with(this)return function(){"use strict";return function(e,t,r){(function(t){(function(){var r=e("@babel/runtime/helpers/interopRequireDefault"),n=r(e("@babel/runtime/helpers/defineProperty")),o=r(e("end-of-stream")),i=r(e("pump")),s=r(e("debounce-stream")),a=r(e("loglevel")),c=r(e("webextension-polyfill")),l=e("@metamask/obs-store"),u=r(e("extension-port-stream")),d=e("@sentry/browser"),p=e("eth-rpc-errors"),h=e("../../shared/constants/app"),f=e("../../shared/constants/time"),g=e("../../shared/constants/metametrics"),m=r(e("./migrations")),b=r(e("./lib/migrator")),y=r(e("./platforms/extension")),E=r(e("./lib/local-store")),v=r(e("./lib/network-store")),w=r(e("./lib/createStreamSink")),S=R(e("./lib/notification-manager")),C=R(e("./metamask-controller")),_=r(e("./first-time-state")),T=r(e("./lib/get-first-preferred-lang-code")),k=r(e("./lib/getObjStructure")),M=r(e("./lib/ens-ipfs/setup")),O=e("./lib/util");function P(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(P=function(e){return e?r:t})(e)}function R(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=P(t);if(r&&r.has(e))return r.get(e);var n={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var s=o?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(n,i,s):n[i]=e[i]}return n.default=e,r&&r.set(e,n),n}function A(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}const{sentry:I}=global,N=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?A(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):A(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},_.default);a.default.setDefaultLevel(t.env.METAMASK_DEBUG?"debug":"info");const D=new y.default,U=new S.default;global.METAMASK_NOTIFIER=U;let x=!1,L=!1,j=!1;const B={},F={},z=t.env.IN_TEST,G=z?new v.default:new E.default;let q;(z||t.env.METAMASK_DEBUG)&&(global.metamaskGetState=G.get.bind(G));const W=new URL("https://metamask.github.io/phishing-warning/v1.1.0/");(async function(){const e=await async function(){const e=new b.default({migrations:m.default});e.on("error",console.warn),q=await G.get()||e.generateInitialState(N),q&&!q.data&&(q=e.generateInitialState(N),I.captureMessage("MetaMask - Empty vault found - unable to recover"));if(e.on("error",(e=>{const t=(0,k.default)(q);I.captureException(e,{extra:{vaultStructure:t}})})),q=await e.migrateData(q),!q)throw new Error("MetaMask - migrator returned undefined");G.isSupported?G.set(q):setTimeout((()=>{throw new Error("MetaMask - Localstore not supported")}));return q.data}(),t=await(0,T.default)();await function(e,t){const r=new C.default({infuraProjectId:"9aa3d95b3bc440fa88ea12eaa4456161",showUserConfirmation:V,openPopup:Q,initState:e,initLangCode:t,platform:D,notificationManager:U,browser:c.default,getRequestAccountTabIds:()=>F,getOpenMetamaskTabsIds:()=>B});function n(e){return q.data=e,q}(0,M.default)({getCurrentChainId:r.networkController.getCurrentChainId.bind(r.networkController),getIpfsGateway:r.preferencesController.getIpfsGateway.bind(r.preferencesController),provider:r.provider}),(0,i.default)((0,l.storeAsStream)(r.store),(0,s.default)(1e3),(0,l.storeTransformStream)(n),(0,w.default)(m),(e=>{a.default.error("MetaMask - Persistence pipeline failed",e)}));let f=!1;async function m(e){if(!e)throw new Error("MetaMask - updated state is missing");if(!e.data)throw new Error("MetaMask - updated state does not have data");if(G.isSupported)try{await G.set(e),f&&(f=!1)}catch(e){f||(f=!0,(0,d.captureException)(e)),a.default.error("error setting state in local store:",e)}}c.default.runtime.onConnect.addListener(_),c.default.runtime.onConnectExternal.addListener(T);const b={[h.ENVIRONMENT_TYPE_POPUP]:!0,[h.ENVIRONMENT_TYPE_NOTIFICATION]:!0,[h.ENVIRONMENT_TYPE_FULLSCREEN]:!0},y=["trezor-connect"],E=()=>x||Boolean(Object.keys(B).length)||L,v=(e,t)=>{if(!1===e)r.onClientClosed();else{if(t===h.ENVIRONMENT_TYPE_FULLSCREEN&&Boolean(Object.keys(B).length))return;r.onEnvironmentTypeClosed(t)}};function _(e){var t;const n=e.name;if(y.includes(e.name))return;let i=!1;i=(0,O.getPlatform)()===h.PLATFORM_FIREFOX?b[n]:e.sender.origin===`chrome-extension://${c.default.runtime.id}`;const s=null!==(t=e.sender)&&void 0!==t&&t.url?new URL(e.sender.url):null;if(i){const t=new u.default(e);if(r.isClientOpen=!0,r.setupTrustedCommunication(t,e.sender),n===h.ENVIRONMENT_TYPE_POPUP&&(x=!0,(0,o.default)(t,(()=>{x=!1;const e=E();r.isClientOpen=e,v(e,h.ENVIRONMENT_TYPE_POPUP)}))),n===h.ENVIRONMENT_TYPE_NOTIFICATION&&(L=!0,(0,o.default)(t,(()=>{L=!1;const e=E();r.isClientOpen=e,v(e,h.ENVIRONMENT_TYPE_NOTIFICATION)}))),n===h.ENVIRONMENT_TYPE_FULLSCREEN){const n=e.sender.tab.id;B[n]=!0,(0,o.default)(t,(()=>{delete B[n];const e=E();r.isClientOpen=e,v(e,h.ENVIRONMENT_TYPE_FULLSCREEN)}))}}else if(s&&s.origin===W.origin&&s.pathname===W.pathname){const t=new u.default(e);r.setupPhishingCommunication({connectionStream:t})}else{if(e.sender&&e.sender.tab&&e.sender.url){const t=e.sender.tab.id,r=new URL(e.sender.url),{origin:n}=r;e.onMessage.addListener((e=>{e.data&&"eth_requestAccounts"===e.data.method&&(F[n]=t)}))}T(e)}}function T(e){const t=new u.default(e);r.setupUntrustedCommunication({connectionStream:t,sender:e.sender})}function k(){let e="";const t=P();t&&(e=String(t)),c.default.browserAction.setBadgeText({text:e}),c.default.browserAction.setBadgeBackgroundColor({color:"#037DD6"})}function P(){const e=r.txController.getUnapprovedTxCount(),{unapprovedMsgCount:t}=r.messageManager,{unapprovedPersonalMsgCount:n}=r.personalMessageManager,{unapprovedDecryptMsgCount:o}=r.decryptMessageManager,{unapprovedEncryptionPublicKeyMsgCount:i}=r.encryptionPublicKeyManager,{unapprovedTypedMessagesCount:s}=r.typedMessageManager;return e+t+n+o+i+s+r.approvalController.getTotalApprovalCount()+r.appStateController.waitingForUnlock.length}function R(){Object.keys(r.txController.txStateManager.getUnapprovedTxList()).forEach((e=>r.txController.txStateManager.setTxStatusRejected(e))),r.messageManager.messages.filter((e=>"unapproved"===e.status)).forEach((e=>r.messageManager.rejectMsg(e.id,g.REJECT_NOTFICIATION_CLOSE_SIG))),r.personalMessageManager.messages.filter((e=>"unapproved"===e.status)).forEach((e=>r.personalMessageManager.rejectMsg(e.id,g.REJECT_NOTFICIATION_CLOSE_SIG))),r.typedMessageManager.messages.filter((e=>"unapproved"===e.status)).forEach((e=>r.typedMessageManager.rejectMsg(e.id,g.REJECT_NOTFICIATION_CLOSE_SIG))),r.decryptMessageManager.messages.filter((e=>"unapproved"===e.status)).forEach((e=>r.decryptMessageManager.rejectMsg(e.id,g.REJECT_NOTFICIATION_CLOSE))),r.encryptionPublicKeyManager.messages.filter((e=>"unapproved"===e.status)).forEach((e=>r.encryptionPublicKeyManager.rejectMsg(e.id,g.REJECT_NOTFICIATION_CLOSE))),r.approvalController.clear(p.ethErrors.provider.userRejectedRequest()),k()}return k(),r.txController.on(C.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE,k),r.messageManager.on(C.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE,k),r.personalMessageManager.on(C.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE,k),r.decryptMessageManager.on(C.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE,k),r.encryptionPublicKeyManager.on(C.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE,k),r.typedMessageManager.on(C.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE,k),r.appStateController.on(C.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE,k),r.controllerMessenger.subscribe(C.METAMASK_CONTROLLER_EVENTS.APPROVAL_STATE_CHANGE,k),U.on(S.NOTIFICATION_MANAGER_EVENTS.POPUP_CLOSED,(({automaticallyClosed:e})=>{e?P()>0&&V():R()})),Promise.resolve()}(e,t),await async function(){let e;try{const t=new URL("https://metamask.github.io/phishing-warning/v1.1.0/");let r,n;t.hash="#extensionStartup",e=window.document.createElement("iframe"),e.setAttribute("src",t.href),e.setAttribute("sandbox","allow-scripts allow-same-origin");const o=new Promise(((e,t)=>{r=e,n=t}));e.addEventListener("load",r),window.document.body.appendChild(e),setTimeout((()=>n(new H)),1e3),await o}catch(e){e instanceof H?console.warn("Phishing warning page timeout; page not guaraneteed to work offline."):console.error("Failed to initialize phishing warning page",e)}finally{e&&e.remove()}}(),a.default.info("MetaMask initialization complete.")})().catch(a.default.error);class H extends Error{constructor(){super("Timeout failed")}}async function V(){const e=await D.getActiveTabs(),t=Boolean(e.find((e=>B[e.id]))),r=e.length>0&&e[0].extData&&e[0].extData.indexOf("vivaldi_tab")>-1;if(!j&&(r||!x)&&!t){j=!0;try{await U.showPopup()}finally{j=!1}}}async function Q(){await V(),await new Promise((e=>{const t=setInterval((()=>{L||(clearInterval(t),e())}),f.SECOND)}))}c.default.runtime.onInstalled.addListener((({reason:e})=>{"install"!==e||t.env.METAMASK_DEBUG||t.env.IN_TEST||D.openExtensionInBrowser()}))}).call(this)}).call(this,e("_process"))}}},{package:"$root$"}]],[3],{});